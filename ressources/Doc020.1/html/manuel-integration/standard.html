

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conventions REST Générales &mdash; documentation VITAM - Manuel Intégraption Applicative 0.20.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static\css\theme.css" type="text/css">
  

  

  
        <link rel="index" title="Index" href="genindex.html">
        <link rel="search" title="Recherche" href="search.html">
    <link rel="top" title="documentation VITAM - Manuel Intégraption Applicative 0.20.0" href="index.html">
        <link rel="next" title="DSL" href="DSL.html">
        <link rel="prev" title="API" href="API.html"> 

  
  <script src="_static\js\modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> VITAM - Manuel Intégraption Applicative
          

          
            
            <img src="_static\LogoVitamGrand2.png" class="logo">
          
          </a>

          
            
            
              <div class="version">
                0.20.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Vitam.html">VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Conventions REST Générales</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modele-rest">Modèle REST</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modele-asynchrone">Modèle asynchrone</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mode-pooling">Mode Pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-callback-unsupported">Mode Callback <strong>UNSUPPORTED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#perspectives-d-evolution">Perspectives d&#8217;évolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authentification">Authentification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#identifiant-de-correlation">Identifiant de corrélation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pagination">Pagination</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#methode-standard">Méthode standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methode-optimisee-unsupported">Méthode optimisée <strong>UNSUPPORTED</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DSL.html">DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl-introduction.html">DSL Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exemples.html">Exemples</a></li>
<li class="toctree-l1"><a class="reference internal" href="exemple-dsl.html">Exemple DSL Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-usage.html">Utilisation des clients externes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">VITAM - Manuel Intégraption Applicative</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Conventions REST Générales</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources\standard.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conventions-rest-generales">
<h1>Conventions REST Générales<a class="headerlink" href="#conventions-rest-generales" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ici sont présentées des conventions dans le cadre des API Vitam.</p>
<div class="section" id="modele-rest">
<h2>Modèle REST<a class="headerlink" href="#modele-rest" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les URL sont découpées de la façon suivantes :</p>
<ul class="simple">
<li>protocole: https</li>
<li>FQDN : exemple api.vitam.fr avec éventuellement un port spécifique</li>
<li>Base : &lt;nom du service&gt;/&lt;version&gt;</li>
<li>Resource : le nom d&#8217;une collection</li>
<li>L&#8217;URL peut contenir d&#8217;autres éléments (item, sous-collections)</li>
</ul>
<p>Exemple: <a class="reference external" href="https://api.vitam.fr/access/v1/units/id">https://api.vitam.fr/access/v1/units/id</a></p>
<p>Les méthodes utilisées :</p>
<ul class="simple">
<li>GET: pour l&#8217;équivalent de &#8220;Select&#8221; (possibilité d&#8217;utiliser POST avec X-Http-Method-Override: GET dans le Header)</li>
<li>POST: pour l&#8217;équivalent de &#8220;Insert&#8221;</li>
<li>PUT: pour l&#8217;équivalent de &#8220;Update&#8221;</li>
<li>DELETE: pour l&#8217;équivalent de &#8220;Delete&#8221; (possibilité d&#8217;utiliser POST avec X-Http-Method-Override: DELETE dans le Header)</li>
<li>HEAD: pour l&#8217;équivalent du &#8220;Test d&#8217;existence&#8221;</li>
<li>OPTIONS: pour l&#8217;équivalent de &#8220;Lister les commandes disponibles&#8221;</li>
</ul>
<p>Les codes retours HTTP standards utilisés sont :</p>
<ul class="simple">
<li>200: Sur des opérations de GET, PUT, DELETE, HEAD, OPTIONS</li>
<li>201: Sur l&#8217;opération POST (sans X-Http-Method-Override)</li>
<li>202: Pour les réponses asynchrones</li>
<li>204: Pour des réponses sans contenu (type HEAD sans options)</li>
<li>206: Pour des réponses partielles ou des réponses en mode Warning (OK mais avec une alerte)</li>
</ul>
<p>Les codes d&#8217;erreurs HTTP standards utilisés sont :</p>
<ul class="simple">
<li>400: Requête mal formulée</li>
<li>401: Requête non autorisée</li>
<li>404: Resource non trouvée</li>
<li>409: Requête en conflit</li>
<li>412: Des préconditions ne sont pas respectées</li>
<li>413: La requête dépasse les capacités du service</li>
<li>415: Le Media Type demandé n&#8217;est pas supporté</li>
<li>500: si une erreur interne est survenue dans le back-office (peut être un bug ou un effet de bord d&#8217;une mauvaise commande)</li>
<li>501: Le service n&#8217;est pas implémenté</li>
</ul>
</div>
<div class="section" id="modele-asynchrone">
<h2>Modèle asynchrone<a class="headerlink" href="#modele-asynchrone" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le cas d&#8217;une opération asynchrone, deux options sont possibles :</p>
<div class="section" id="mode-pooling">
<h3>Mode Pooling<a class="headerlink" href="#mode-pooling" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le mode pooling, le client est responsable de requêter de manière répétée l&#8217;URI de vérification du statut, et ce de manière raisonnée (pas trop souvent).</p>
<p>Le principe est le suivant :</p>
<ul class="simple">
<li>Création de l&#8217;opération à effectuer<ul>
<li>Exemple: POST /ingests et retourne 202 + X-Request-Id noté id</li>
</ul>
</li>
<li>Pooling sur l&#8217;opération demandée<ul>
<li>Exemple: GET /operations/id et retourne 202 + X-Request-Id tant que non terminé
- Intervalle recommandé : pas moins que la minute</li>
</ul>
</li>
<li>Fin de pooling sur l&#8217;opération demandée<ul>
<li>Exemple : GET /operations/id et retourne 200 + le résultat</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="mode-callback-unsupported">
<h3>Mode Callback <strong>UNSUPPORTED</strong><a class="headerlink" href="#mode-callback-unsupported" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le mode Callback, le client soumet une création d&#8217;opération et simultanément propose une URI de Callback sur laquelle Vitam rappellera le client pour lui indiquer que cette opération est terminée.</p>
<p>Le principe est le suivant :</p>
<ul class="simple">
<li>Création de l&#8217;opération à effectuer avec l&#8217;URI de Callback<ul>
<li>Exemple: POST /ingests + dans le Header X-Callback: <a class="reference external" href="https://uri">https://uri</a>?id={id}&amp;status={status} et retourne 202 + #id + Header X-Callback confirmé</li>
</ul>
</li>
<li>A la fin de l&#8217;opération, Vitam rappelle le client avec l&#8217;URI de Callback<ul>
<li>Exemple: GET /uri?id=idop&amp;status=OK</li>
</ul>
</li>
<li>Le client rappelle alors Vitam pour obtenir l&#8217;information<ul>
<li>Exemple: GET /ingests/#id et retourne 200 + le résultat</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="perspectives-d-evolution">
<h3>Perspectives d&#8217;évolution<a class="headerlink" href="#perspectives-d-evolution" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le cas où l&#8217;accès au résulat final ne doit pas se faire sur l&#8217;URI /resources/id, il faudra ajouter une réponse 303.</p>
</div>
</div>
<div class="section" id="authentification">
<h2>Authentification<a class="headerlink" href="#authentification" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;authentification dans Vitam authentifie l&#8217;application Front-Office qui se connecte à ses API. Cette authentification s&#8217;effectue en trois temps :</p>
<ul class="simple">
<li>Un premier composant authentifie la nouvelle connexion<ul>
<li>La première implémentation sera basée sur une authentification du certificat client dans la connexion TLS</li>
<li>Note : il est possible au travers d&#8217;un ReverseProxy de passer le certificat client dans le Header</li>
</ul>
</li>
<li>Le premier composant passe au service REST la variable Header &#8220;X-Identity&#8221; contenant l&#8217;identifiant de l&#8217;application Front-Office.<ul>
<li>Comme cette identification est actuellement interne, ce Header est actuellement non généré.</li>
</ul>
</li>
<li>Le service REST, sur la base de cette authentification, s&#8217;assure que l&#8217;application Front-Office ait bien l&#8217;habilitation nécessaire pour effectuer la requête exprimée.</li>
</ul>
</div>
<div class="section" id="identifiant-de-correlation">
<h2>Identifiant de corrélation<a class="headerlink" href="#identifiant-de-correlation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Vitam étant un service REST, il est &#8220;State Less&#8221;. Il ne dispose donc pas de notion de session en propre.
Cependant chaque requête retourne un identifiant de requête &#8220;<strong>X-Request-Id</strong>&#8221; qui est traçé dans les logs et journaux du SAE et permet donc de faire une corrélation avec les événements de l&#8217;application Front-Office cliente si celle-ci enregistre elle-aussi cet identifiant.</p>
<p><strong>UNSUPPORTED</strong> Considérant que cela peut rendre difficile le suivi d&#8217;une session utilisateur connecté sur un Front-Office, il est proposé que l&#8217;application Front-Office puisse passer en paramètre dans le Header l&#8217;argument &#8220;<strong>X-Application-Id</strong>&#8221; correspondant à un identifiant de session de l&#8217;utilisateur connecté. Cet identifiant DOIT être non signifiant car il sera lui aussi dans les logs et les journaux de Vitam. Il est inclus dans chaque réponse de Vitam si celui-ci est exprimé dans la requête correspondante.
Grâce à cet identifiant externe de session, il est alors plus facile de retracer l&#8217;activité d&#8217;un utilisateur grâce d&#8217;une part au regroupement de l&#8217;ensemble des actions dans Vitam au travers de cet identifiant, et d&#8217;autre part grâce aux logs de l&#8217;application Front-Office utilisant ce même identifiant de session.</p>
<p>Afin de gérer plusieurs tenants, il est imposé (pour le moment) que l&#8217;application Front-Office puisse passer en paramètre
dans le Header l&#8217;argument <strong>X-Tenant-Id</strong> correspondant au tenant sur lequel se baser pour exécuter la requête.</p>
</div>
<div class="section" id="pagination">
<h2>Pagination<a class="headerlink" href="#pagination" title="Lien permanent vers ce titre">¶</a></h2>
<p>Vitam ne dispose pas de notion de session en raison de son implémentation «&nbsp;State Less&nbsp;». Néanmoins, pour des raisons d&#8217;optimisations sur des requêtes où le nombre de résultats serait important, il est proposé une option tendant à améliorer les performances&nbsp;: X-Cursor et X-Cursor-Id.</p>
<div class="section" id="methode-standard">
<h3>Méthode standard<a class="headerlink" href="#methode-standard" title="Lien permanent vers ce titre">¶</a></h3>
<p>De manière standard, il est possible de paginer les résultats en utilisant le DSL avec les arguments suivants dans la requête&nbsp;: (pour GET uniquement)</p>
<ul class="simple">
<li><strong>$limit</strong> : le nombre maximum d&#8217;items retournés (limité à 1000 par défaut, maximum à 100000)</li>
<li><strong>$per_page</strong> : le nombre maximum des premiers items retournés (limité à 100 par défaut, maximum à 100) (<strong>UNSUPPORTED</strong>)</li>
<li><strong>$offset</strong> : la position de démarrage dans la liste retournée (positionné à 0 par défaut, maximum à 100000)</li>
</ul>
<p>En raison du principe State-less, les requêtes suivantes (en manipulant notamment $offset) seront à nouveau exécutées, conduisant à des performances réduites.</p>
</div>
<div class="section" id="methode-optimisee-unsupported">
<h3>Méthode optimisée <strong>UNSUPPORTED</strong><a class="headerlink" href="#methode-optimisee-unsupported" title="Lien permanent vers ce titre">¶</a></h3>
<p>Afin d&#8217;optimiser, il est proposé d&#8217;ajouter de manière optionnelle dans le Header lors de la première requête le champs suivant&nbsp;: <strong>X-Cursor: true</strong>
Si la requête nécessite une pagination (plus d&#8217;une page de réponses possible), le SAE répondra alors la première page (dans le Body) et dans le Header&nbsp;:</p>
<ul class="simple">
<li><strong>X-Cursor-Id</strong>: id (identifiant du curseur)</li>
<li><strong>X-Cursor-Timeout</strong>: datetime (date limite de validité du curseur)</li>
</ul>
<p>Le client peut alors demander les pages suivantes en envoyant simplement une requête GET avec un Body vide et dans le Header&nbsp;: <strong>X-Cursor-Id</strong>: id.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="DSL.html" class="btn btn-neutral float-right" title="DSL" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="API.html" class="btn btn-neutral" title="API" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.20.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static\jquery.js"></script>
      <script type="text/javascript" src="_static\underscore.js"></script>
      <script type="text/javascript" src="_static\doctools.js"></script>
      <script type="text/javascript" src="_static\translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static\js\theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>