

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.3. Processing Management &mdash; Documentation VITAM - Manuel de développement 3.0.1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'3.0.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="10.4. Processing Distributor" href="processing-distributor.html" />
    <link rel="prev" title="10.2. Paramètres" href="parametres/parametres.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> VITAM - Manuel de développement
          

          
            
            <img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-environnement.html">Configuration de l’environnement de développement</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">Détails par composant</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../access/_toc.html">1. Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common/_toc.html">2. Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functional-administration/_toc.html">3. Functional administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ihm-demo/_toc.html">4. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ihm-recette/_toc.html">5. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ingest/_toc.html">6. Ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-security/_toc.html">7. Security-Internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logbook/_toc.html">8. Logbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata/_toc.html">9. Metadata</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">10. Processing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">10.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="parametres/parametres.html">10.2. Paramètres</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">10.3. Processing Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#presentation">10.3.1. Présentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">10.3.2. Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="processing-distributor.html">10.4. Processing Distributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="processing-engine.html">10.5. Processing Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="worker/_toc.html">10.6. Etudes en cours</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../storage/_toc.html">11. Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technical-administration/_toc.html">12. Technical administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../worker/_toc.html">13. Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/_toc.html">14. Workspace</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../parallisation_tests.html">Parallélisation des tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugin-icu-elasticsearch.html">Plugin ICU Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gestion-database.html">Gestion des bases de données</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-ressource-rest.html">Ressources et clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devstack_vm.html">Création d’une machine de dev contenant <em>Swift</em></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Manuel de développement</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../_toc.html">Détails par composant</a> &raquo;</li>
        
          <li><a href="_toc.html">10. Processing</a> &raquo;</li>
        
      <li>10.3. Processing Management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/include/processing/processing-management.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="processing-management">
<h1>10.3. Processing Management<a class="headerlink" href="#processing-management" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">27/02/2017</td>
</tr>
</tbody>
</table>
<div class="section" id="presentation">
<h2>10.3.1. Présentation<a class="headerlink" href="#presentation" title="Lien permanent vers ce titre">¶</a></h2>
<div class="line-block">
<div class="line"><em>Parent package:</em> <strong>fr.gouv.vitam.processing</strong></div>
<div class="line"><em>Package proposition:</em> <strong>fr.gouv.vitam.processing.management</strong></div>
</div>
<p>4 modules composent la partie processing-management :</p>
<ul class="simple">
<li>processing-management : incluant la partie core + la partie REST.</li>
<li>processing-management-client : incluant le client permettant d’appeler le REST.</li>
<li>processing-engine : le moteur workflow.</li>
<li>processing-data : le module de persistance et d’accès aux processus lancés (en éxécution, en pause, annulés, terminés).</li>
</ul>
<div class="section" id="id1">
<h3>10.3.1.1. Processing-management<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="rest-api">
<h4>10.3.1.1.1. Rest API<a class="headerlink" href="#rest-api" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans le module Processing-management (package rest) :
| <a class="reference external" href="http://server/processing/v1">http://server/processing/v1</a></p>
<div class="line-block">
<div class="line">GET /status -&gt; <strong>statut du logbook</strong></div>
</div>
<div class="line-block">
<div class="line">POST /operations/{id} -&gt; <strong>initialiser et/ou exécuter une action sur un processus workflow existant</strong></div>
<div class="line">PUT /operations/{id} -&gt; <strong>exécuter une action sur processus existant</strong></div>
<div class="line">- Relancer un processus en mode continu avec header X-ACTION==&gt; resume</div>
<div class="line">- Exécuter l’étape suivante avec header X-ACTION==&gt; next</div>
<div class="line">- Mettre en pause un processus avec header X-ACTION==&gt; pause</div>
<div class="line">- Réexécuter l’étape précédemment exécutée avec header X-ACTION==&gt; replay</div>
<div class="line">GET /operations/{id} -&gt; <strong>récupérer les details d’un processus workflow par id et tenant</strong></div>
<div class="line">HEAD /operations/{id} -&gt; <strong>récupérer l’état d’éxécution d’un processus workflow par id et tenant</strong></div>
<div class="line">DELETE /operations/{id} -&gt; <strong>Annuler un processus</strong></div>
</div>
<p>De plus est ajoutée à la resource existante une resource déclarée dans le module processing-distributor (package rest).</p>
<div class="line-block">
<div class="line"><a class="reference external" href="http://server/processing/v1/worker_family">http://server/processing/v1/worker_family</a></div>
<div class="line">POST /{id_family}/workers/{id_worker} -&gt; <strong>POST Permet d’ajouter un worker à la liste des workers</strong></div>
<div class="line">DELETE /{id_family}/workers/{id_worker} -&gt; <strong>DELETE Permet de supprimer un worker</strong></div>
</div>
</div>
<div class="section" id="core">
<h4>10.3.1.1.2. Core<a class="headerlink" href="#core" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans la partie Core, la classe ProcessManagementImpl propose les méthodes suivantes :</p>
<ul class="simple">
<li><strong>init</strong>: Initialiser un processus avec un workflow donné. Dans cette étape on attach avec un cardinalité un-à-un un ProcessEngine et une machine à état à ce processus.</li>
<li><strong>next</strong>: Exécute l’action next (exécuter l’étape suivante mode step by step) sur un processus existant.</li>
<li><strong>replay</strong>: Exécute l’action replay (relancer la dernière étape exécutée) sur un processus existant.</li>
<li><strong>resume</strong>: Exécute l’action resume (exécuter toutes les étapes mode continu) sur un processus existant.</li>
<li><strong>pause</strong>: Exécute l’action pause (mettre le processus en état pause dès que possible) sur un processus existant.</li>
<li><strong>cancel</strong>: Exécute l’action cancel (annuler un processus dès que possible) sur un processus existant.</li>
<li><strong>findAllProcessWorkflow</strong>: Lister tous les processus d’un tenant donné.</li>
<li><strong>findOneProcessWorkflow</strong>: Trouver un processus avec son id et son tenant.</li>
</ul>
</div>
<div class="section" id="la-machine-a-etat">
<h4>10.3.1.1.3. La machine à état:<a class="headerlink" href="#la-machine-a-etat" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans la partie core on trouve aussi la classe StateMachine. Elle gère toutes les actions sur un processus donné.</p>
<ul class="simple">
<li><strong>next</strong>:</li>
</ul>
<p>Evaluer le passage de l’état actuel du processus vers l’état RUNNING en mode step by step.
On ne peut passer à l’état RUNNING que depuis un état en cours PAUSE.
Si cette évaluation ne lance pas d’exception alors on lance l’exécution d’un processus et appel de la méthode <strong>doRunning</strong></p>
<ul class="simple">
<li><strong>replay</strong>:</li>
</ul>
<p>Evaluer le passage de l’état actuel du processus vers l’état RUNNING en mode step by step.
On ne peut passer à l’état RUNNING que depuis un état en cours PAUSE.
Si cette évaluation ne lance pas d’exception alors on lance l’exécution d’un processus et appel de la méthode <strong>doReplay</strong>.</p>
<ul class="simple">
<li><strong>resume</strong>:</li>
</ul>
<p>Evaluer le passage de l’état actuel du processus vers l’état RUNNING en mode continu.
On ne peut passer à l’état RUNNING que depuis un état en cours PAUSE.
Si cette évaluation ne lance pas d’exception alors on lance l’exécution d’un processus et appel de la méthode <strong>doRunning</strong>.</p>
<ul class="simple">
<li><strong>pause</strong>:</li>
</ul>
<p>Evaluer le passage de l’état actuel du processus vers l’état PAUSE.
On ne peut passer à l’état PAUSE que depuis un état en cours (PAUSE, RUNNING).
Si cette évaluation ne lance pas d’exception alors , dans le cas d’un état en cours RUNNING, finir l’exécution de l’étape en cours et passer à l’état PAUSE, et si c’est la dernière étape, alors passer à l’état COMPLETED. Appel de la méthode <strong>doPause</strong></p>
<ul class="simple">
<li><strong>cancel</strong>:</li>
</ul>
<p>Evaluer le passage de l’état actuel du processus vers l’état COMPLETED.
On ne peut passer à l’état COMPLETED que depuis un état en cours (PAUSE, RUNNING).
Si cette évaluation ne lance pas d’exception alors , dans le cas d’un état en cours RUNNING,  finir l’exécution de l’étape en cours et passer à l’état COMPLETED. Appel de la méthode <strong>doCompleted</strong></p>
<p>-<strong>doRunning</strong>: Appelée depuis <strong>next</strong> ou <strong>resume</strong>.
-<strong>doReplay</strong>: Appelée depuis <strong>replay</strong>.
-<strong>doPause</strong>: Appelée depusi <strong>pause</strong>.
-<strong>doCompleted</strong>: Appelée depuis <strong>cancel</strong>.</p>
<p>-<strong>onComplete</strong>:</p>
<p>Appelée depuis le ProcessEngine quand une étape a été exécuté.
Evaluation sur l’exécution de l’étape suivante selon les informations suivantes:</p>
<ul>
<li><p class="first">Si la dernière étape alors exécuter finaliser le logbook et persister le processus.</p>
</li>
<li><p class="first">Sinon :</p>
<blockquote>
<div><ul>
<li><p class="first">Vérifier si le status de l’étape est KO bloquant ou FATAL alors exécuter la dernière étape.</p>
</li>
<li><p class="first">Sinon vérifier si une demande d’action est présente (évaluer la targetState):</p>
<blockquote>
<div><ul class="simple">
<li>targetState = COMPLETED: Exécuter la dernière étape.</li>
<li>targetState = PAUSE: Alors pause</li>
<li>Sinon exécuter l’étape suivante.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>-<strong>onError</strong>:</p>
<p>Appelée depuis le ProcessEngine quand une exception est levée lors de l’exécution d’un étape.
Si c’est pas la dernière étape alors essayer d’exécuter la dernière étape.
Dans tous les cas, finaliser le logbook et persister le processus.</p>
<p>-<strong>onUpdate</strong>:</p>
<p>Appelée depuis le ProcessEngine pour metter à jour les informations du processus à la volé.</p>
<p>Lors de la finalisation du logbook, la mise à jours des informations sur l’état et le status son effectué au niveau du processus. Une suppression de l’opération depuis le workspace.</p>
</div>
<div class="section" id="processing-management-client">
<h4>10.3.1.1.4. Processing-management-client<a class="headerlink" href="#processing-management-client" title="Lien permanent vers ce titre">¶</a></h4>
</div>
<div class="section" id="utilisation">
<h4>10.3.1.1.5. Utilisation<a class="headerlink" href="#utilisation" title="Lien permanent vers ce titre">¶</a></h4>
<p>Le client propose les méthode suivantes :</p>
<ul class="simple">
<li><strong>initVitamProcess</strong>: initialiser le contexte d’un processus.</li>
<li><strong>executeVitamProcess</strong>: ! absolète !.</li>
<li><strong>executeOperationProcess</strong>:lancer un processus workflow avec un mode d’éxécution (resume/step by step).</li>
<li><strong>updateOperationActionProcess</strong>:relancer un processus workflow pour éxécuter une etape (mode: «&nbsp;next&nbsp;») ou toutes les étapes («&nbsp;resume&nbsp;»).</li>
<li><strong>getOperationProcessStatus</strong>:récupérer l’état d’éxécution d’un processus workflow par id et tenant.</li>
<li><strong>cancelOperationProcessExecution</strong>:annuler un processus workflow par id et tenant.</li>
<li><strong>listOperationsDetails</strong>:récupérer la liste des processus.</li>
<li><strong>registerWorker</strong> : permet d’ajouter un nouveau worker à la liste des workers.</li>
<li><strong>unregisterWorker</strong> : permet de supprimer un worker à la liste des workers.</li>
</ul>
</div>
<div class="section" id="exemple">
<h4>10.3.1.1.6. Exemple:<a class="headerlink" href="#exemple" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">processingClient</span> <span class="o">=</span> <span class="n">ProcessingManagementClientFactory</span><span class="p">.</span><span class="na">getInstance</span><span class="p">().</span><span class="na">getClient</span><span class="p">();</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">processingClient</span><span class="p">.</span><span class="na">executeOperationProcess</span><span class="p">(</span><span class="s">&quot;containerName&quot;</span><span class="p">,</span> <span class="s">&quot;workflowId&quot;</span><span class="p">,</span>
        <span class="n">logbookTypeProcess</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span> <span class="n">ProcessAction</span><span class="p">.</span><span class="na">RESUME</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="processing-data">
<h3>10.3.1.2. Processing-data<a class="headerlink" href="#processing-data" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le module Processing data est responsable de la partie persistance ,accès aux données des processus avoir l’état d’exécution et l’oordonnancement des étapes.</p>
<p>Le module processing data propose plusieurs méthodes:</p>
<ul class="simple">
<li><strong>initProcessWorkflow</strong>: initialiser le contexte d’un processus.</li>
<li><strong>updateStep</strong>: mettre à jour une étape (les elements éxécutés/restés).</li>
<li><strong>findOneProcessWorkflow</strong>: Trouver depuis la map un processus par son id et son tenant.</li>
<li><strong>findAllProcessWorkflow</strong>: Trouver depuis la map tous les processus d’un tenant.</li>
<li><strong>addToWorkflowList</strong>: Ajouter un processus à la map (sauvegrade mémoire)</li>
</ul>
</div>
</div>
<div class="section" id="configuration">
<h2>10.3.2. Configuration<a class="headerlink" href="#configuration" title="Lien permanent vers ce titre">¶</a></h2>
<ol class="arabic simple">
<li>Configuration du pom</li>
</ol>
<p>Configuration du pom avec maven-surefire-plugin permet le build sous jenkins. Il permet de configurer le chemin des resources de esapi dans le common private.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="processing-distributor.html" class="btn btn-neutral float-right" title="10.4. Processing Distributor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parametres/parametres.html" class="btn btn-neutral float-left" title="10.2. Paramètres" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>