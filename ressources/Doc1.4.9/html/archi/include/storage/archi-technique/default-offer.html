

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.11.2.7. Vitam Offer &mdash; Documentation VITAM - Architecture 1.4.9</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="next" title="7.11.3. Securite" href="../securite/index.html" />
    <link rel="prev" title="7.11.2.6. Storage Offers" href="storage-offers.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> VITAM - Architecture
          

          
            
            <img src="../../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/_toc.html">3. Vue d’ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archi-applicative/_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archi-exploit-infra/_toc.html">5. Architecture technique / exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../securite/_toc.html">6. Securite</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../_toc.html">7. Architecture détaillée</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../access/_toc.html">7.1. Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../common/_toc.html">7.2. Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../functional-administration/_toc.html">7.3. Functional administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ihm-demo/_toc.html">7.4. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ihm-recette/_toc.html">7.5. IHM recette</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ingest/_toc.html">7.6. Ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-security/_toc.html">7.7. Security-Internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logbook/_toc.html">7.8. Logbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metadata/_toc.html">7.9. Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../processing/_toc.html">7.10. Processing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_toc.html">7.11. Storage</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../fonctionnelle/index.html">7.11.1. Architecture Fonctionnelle</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">7.11.2. Architecture Technique</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="introduction.html">7.11.2.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage-general.html">7.11.2.2. Architecture générale</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage-driver.html">7.11.2.3. Storage Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage-engine.html">7.11.2.4. Storage Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage-engine-client.html">7.11.2.5. Storage Engine Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage-offers.html">7.11.2.6. Storage Offers</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">7.11.2.7. Vitam Offer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../securite/index.html">7.11.3. Securite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../technical-administration/_toc.html">7.12. Technical administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../worker/_toc.html">7.13. Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../workspace/_toc.html">7.14. Workspace</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VITAM - Architecture</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../_toc.html">7. Architecture détaillée</a> &raquo;</li>
        
          <li><a href="../_toc.html">7.11. Storage</a> &raquo;</li>
        
          <li><a href="index.html">7.11.2. Architecture Technique</a> &raquo;</li>
        
      <li>7.11.2.7. Vitam Offer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/include/storage/archi-technique/default-offer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vitam-offer">
<h1>7.11.2.7. Vitam Offer<a class="headerlink" href="#vitam-offer" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="presentation">
<h2>7.11.2.7.1. Présentation<a class="headerlink" href="#presentation" title="Lien permanent vers ce titre">¶</a></h2>
<div class="line-block">
<div class="line"><em>Parent package:</em> <strong>fr.gouv.vitam.storage.offers</strong></div>
<div class="line"><em>Package proposition:</em> <strong>fr.gouv.vitam.storage.offers.workspace</strong></div>
</div>
<p>Module embarquant l’offre de stockage Vitam utilisant une partie du workspace.
Utilisation du terme worskpace dans les packages car le terme default est réservé.</p>
<p>L’offre de stockage workspace est séparé en deux parties :</p>
<ul class="simple">
<li>le serveur de l’offre de stockage par défaut</li>
<li>l’implémentation du driver associé à l’offre de stockage par défaut</li>
</ul>
<p>Dans l’offre, tout les objets binaires sont stockés dans des conteneur définis par : {type}_{tenant}. Un objet binaire est lui définit par son identifiant ET son conteneur.</p>
</div>
<div class="section" id="driver">
<h2>7.11.2.7.2. Driver<a class="headerlink" href="#driver" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="docutils">
<dt>Objet technique responsable d’établir une connexion avec le service de stockage en fonction des</dt>
<dd>paramètres qui lui sont fournis. C’est aussi lui qui est responsable de déterminer si le service est disponible ou
non. La méthode connect, permet de récupérer un objet Connection afin de pouvoir effectuer des actions sur l’offre de stockage.</dd>
</dl>
</div>
<div class="section" id="serveur">
<h2>7.11.2.7.3. Serveur<a class="headerlink" href="#serveur" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="description">
<h3>7.11.2.7.3.1. Description<a class="headerlink" href="#description" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les fonctionnalités sont :</p>
<ul class="simple">
<li>récupérer la capacité et disponibilité de l’offre</li>
<li>envoyer un objet en mode chunk</li>
<li>récupérer un objet</li>
<li>tester l’existence d’un objet</li>
<li>récupérer l’empreinte d’un objet</li>
<li>compter le nombre d’objets d’un conteneur</li>
<li>contrôler un objet pour valider son transfert</li>
<li>supprimer un objet</li>
</ul>
</div>
<div class="section" id="rest">
<h3>7.11.2.7.3.2. REST<a class="headerlink" href="#rest" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="id1">
<h4>7.11.2.7.3.2.1. Description<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h4>
<p>L’API REST, trois header spécifiques sont définis :</p>
<ul class="simple">
<li>X-Tenant-Id : l’identifiant du Tenant</li>
<li>X-Command : utilisée pour l’envoi d’un objet par fragments (chunk)<ul>
<li>INIT : création de l’objet donc l’offre de stockage, sans données envoyés</li>
<li>WRITE : envoi d’un fragment de data</li>
<li>END : indique que l’objet est fini d’être créé</li>
</ul>
</li>
<li>X-Type : permets de préciser le résultat attendu pour la recupération de l’objet<ul>
<li>DATA : l’objet en lui-même (valeur par défaut)</li>
<li>DIGEST : empreinte de l’objet</li>
</ul>
</li>
</ul>
<p>Les réponses en erreur définies par l’API Vitam sont respéctées (400, 401, 404, etc)</p>
</div>
<div class="section" id="rest-api">
<h4>7.11.2.7.3.2.2. REST API<a class="headerlink" href="#rest-api" title="Lien permanent vers ce titre">¶</a></h4>
<p><strong>HEAD /</strong></p>
<ul class="simple">
<li>description : recupération des informations de l’offre</li>
<li>response :<ul>
<li>code : 200</li>
<li>contenu : information sur l’offre (capacité, disponibilité, …)</li>
</ul>
</li>
</ul>
<p><strong>GET /count/{type}/</strong></p>
<ul class="simple">
<li>description : compter le nombre d’objet d’un conteneur de l’offre</li>
<li>headers :<ul>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>path :<ul>
<li>{type} : le type permettant d’identifier un conteneur (unit/report/logbook/etc, se basant sur une enum)</li>
</ul>
</li>
<li>response :<ul>
<li>code : 200</li>
<li>contenu : le nombre d’objets binaires (hors répertoires)</li>
</ul>
</li>
</ul>
<p><strong>GET /objects/{id}</strong></p>
<ul class="simple">
<li>description : recupération sur l’offre d’un objet ou de son empreinte</li>
<li>headers :<ul>
<li>X-Type: DATA / DIGEST</li>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>path :<ul>
<li>{id} : path de l’objet</li>
</ul>
</li>
<li>response :<ul>
<li>code : 200</li>
<li>contenu : data ou empreinte de l’objet</li>
</ul>
</li>
</ul>
<p><strong>GET /objects/{type}/{id:.+}/check</strong></p>
<ul class="simple">
<li>description : vérification d’un objet</li>
<li>headers :<ul>
<li>X-Type: DATA / DIGEST</li>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>path :<ul>
<li>{id} : path de l’objet</li>
<li>{type} : le type permettant d’identifier un conteneur (unit/report/logbook/etc, se basant sur une enum)</li>
</ul>
</li>
<li>response :<ul>
<li>code : 200</li>
<li>contenu : un boolean indiquant si le digest de l’objet correspond ou non</li>
</ul>
</li>
</ul>
<p><strong>POST /objects</strong></p>
<ul class="simple">
<li>description : création d’un nouvel objet vide sur l’offre</li>
<li>headers :<ul>
<li>X-Command: INIT</li>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>body :<ul>
<li>GUID</li>
<li>ObjectInit contenant la taille (taille finale), le type (unit/objectgroup/logbook/etc, se basant sur une enum), le digest-type (type de digest) ainsi qu’un identifiant vide à l’envoi qui sera rempli pour l’offre. Il s’agit de l’identifiant de l’objet sur l’offre. Dans l’implémentation par défaut, c’est le GUID.</li>
</ul>
</li>
<li>response :<ul>
<li>code : 201</li>
<li>contenu : l’objectInit envoyé avec l’identifiant de l’objet créé</li>
</ul>
</li>
</ul>
<p><strong>PUT /objects/{id}</strong></p>
<ul class="simple">
<li>description : écriture  et finalisation d’objet de l’offre</li>
<li>headers :<ul>
<li>X-Command: WRITE / END</li>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>path :<ul>
<li>{id} : id de l’objet</li>
</ul>
</li>
<li>body :<ul>
<li>flux : data ou digest</li>
</ul>
</li>
<li>response :<ul>
<li>code : 201</li>
<li>contenu : un json avec une clef unique, digest, le digest du fichier complet sur l’offre pour le END, le digest du morceau envoyé pour le WRITE</li>
</ul>
</li>
</ul>
<p><strong>HEAD /objects/{id}</strong></p>
<ul class="simple">
<li>description : existance de l’objet sur l’offre</li>
<li>headers :<ul>
<li>X-Tenant-Id: id du tenant</li>
</ul>
</li>
<li>path :<ul>
<li>{id} : id de l’objet</li>
</ul>
</li>
<li>response :<ul>
<li>code : 204</li>
</ul>
</li>
</ul>
<p><strong>DELETE /objects/{type}/{id}</strong></p>
<ul class="simple">
<li>description : suppression d’un objet de l’offre</li>
<li>headers :<ul>
<li>X-Tenant-Id: id du tenant</li>
<li>X-Type: DATA / DIGEST</li>
</ul>
</li>
<li>path :<ul>
<li>{id} : id de l’objet</li>
<li>{type} : le type permettant d’identifier un conteneur (unit/report/logbook/etc, se basant sur une enum)</li>
</ul>
</li>
<li>response :<ul>
<li>code : 200</li>
<li>contenu : l’id de l’objet supprimé + le statut</li>
</ul>
</li>
</ul>
<p><strong>GET /status</strong></p>
<ul class="simple">
<li>description : état du serveur</li>
<li>reponse :<ul>
<li>code : 200</li>
<li>contenu : statut</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../securite/index.html" class="btn btn-neutral float-right" title="7.11.3. Securite" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="storage-offers.html" class="btn btn-neutral" title="7.11.2.6. Storage Offers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.4.9',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>