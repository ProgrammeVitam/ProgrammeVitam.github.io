

<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5.7. Métriques applicatives &mdash; Documentation VITAM - Architecture 5.0</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'5.0',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="5.8. Outillage de déploiement" href="07-deployment-tooling.html" />
    <link rel="prev" title="5.6. Concentration et exploitation des logs applicatifs" href="05-logs-architecture.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VITAM - Architecture
          

          
            
            <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/_toc.html">3. Vue d’ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../archi-applicative/_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">5. Architecture technique / exploitation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="principes/_toc.html">5.1. Principes d’architecture technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="01-services-techniques.html">5.2. Services techniques fournis par la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-dependencies.html">5.3. Composants logiciels utilisés</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-technical-architecture.html">5.4. Architecture technique détaillée</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-data-storage.html">5.5. Stockage des données</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-logs-architecture.html">5.6. Concentration et exploitation des logs applicatifs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.7. Métriques applicatives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#besoins">5.7.1. Besoins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modele-generique">5.7.2. Modèle générique</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choix-des-implementations">5.7.3. Choix des implémentations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enregistreur-de-metriques">5.7.3.1. Enregistreur de métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reporters-de-metriques">5.7.3.2. Reporters de métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#endpoint-des-metriques">5.7.3.3. Endpoint des métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stockage-des-metriques">5.7.3.4. Stockage des métriques</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#limites">5.7.4. Limites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07-deployment-tooling.html">5.8. Outillage de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-consul.html">5.9. Service registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-it-services.html">5.10. Dépendances aux services d’infrastructures</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-services.html">5.11. Composants déployés</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-deployment-guidelines.html">5.12. Guidelines de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="25-resources.html">5.13. Eléments de dimensionnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-flux-all.html">5.14. Matrice des flux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../securite/_toc.html">6. Sécurité</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">7. Architecture détaillée</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Architecture</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="_toc.html">5. Architecture technique / exploitation</a> &raquo;</li>
        
      <li>5.7. Métriques applicatives</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/archi-exploit-infra/06-metrics-architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="metriques-applicatives">
<h1>5.7. Métriques applicatives<a class="headerlink" href="#metriques-applicatives" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="besoins">
<h2>5.7.1. Besoins<a class="headerlink" href="#besoins" title="Lien permanent vers ce titre">¶</a></h2>
<p>À des fins de monitoring des composants logiciels Java <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> et de l’utilisation des ressources système par ceux-ci, <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> intègre un reporting et une gestion de métriques applicatives.</p>
</div>
<div class="section" id="modele-generique">
<h2>5.7.2. Modèle générique<a class="headerlink" href="#modele-generique" title="Lien permanent vers ce titre">¶</a></h2>
<p>On peut noter les composants suivants :</p>
<ul class="simple">
<li>Enregistreur de métriques : il s’agit de la librairie en charge de l’enregistrement d’une métrique.</li>
<li>Reporters de métriques: il s’agit de librairies en charge de collecter les métriques enregistrées et d’en faire un reporting.</li>
<li>Endpoint des métriques: Il s’agit d’une API depuis laquelle des outils de monitoring peuvent récupérer des métriques en mode <cite>pull</cite> au format prometheus</li>
<li>Stockage des métriques : il s’agit du composant stockant les métriques (de manière plus ou moins requêtable).</li>
<li>Visualisation des métriques : il s’agit du composant (souvent:term:<cite>IHM</cite>) qui permet la recherche et la visualisation des métriques.</li>
</ul>
</div>
<div class="section" id="choix-des-implementations">
<h2>5.7.3. Choix des implémentations<a class="headerlink" href="#choix-des-implementations" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="enregistreur-de-metriques">
<h3>5.7.3.1. Enregistreur de métriques<a class="headerlink" href="#enregistreur-de-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le système <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, l’enregistrement de métriques s’effectue uniquement dans les composants logiciels Java à l’aide du librairie <a class="reference external" href="https://prometheus.io/docs/instrumenting/clientlibs/">Prometheus metrics</a>.</p>
<p>Les plugins suivants sont utilisés pour leur métriques respectives :</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/prometheus/client_java/tree/master/simpleclient">Prometheus simpleclient_common et simpleclient</a> pour développer de nouvelles métriques.</li>
<li><a class="reference external" href="https://github.com/prometheus/client_java/tree/master/simpleclient_hotspot">Prometheus simpleclient_hotspot</a>  pour les métriques JVM.</li>
<li><a class="reference external" href="https://github.com/prometheus/client_java/tree/master/simpleclient_dropwizard">Prometheus simpleclient_dropwizard</a> pour envelopper les métriques Dropwizard.</li>
</ul>
<p>L’enregistreur de métriques possède un registre interne qui peut stocker différentes métriques :</p>
<blockquote>
<div><ul class="simple">
<li>Prometheus : <strong>Gauges</strong>, <strong>Counter</strong>, <strong>Summary</strong> ou <strong>Histograms</strong>. Ces métriques seront exposée via une API.</li>
</ul>
</div></blockquote>
<p>A la différence des Counter dans Dropwizard, ceux de prometheus ne se décrémente pas, il faut privilégier une Gauge dans ce das de figure</p>
<p>Les métriques RESTEasy sont automatiquement générées par l’application <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>. Elles représentent un jeu de 3 métriques, <strong>Meter</strong>, <strong>Timer</strong> et <strong>ExceptionMeter</strong> pour chaque <em>end-point</em> des ressources de l’application.</p>
<p>Les métriques JVM sont aussi uniques par application. Elles représentent plusieurs types de métriques sur la consommation de ressources système.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Une description fonctionnelle des métriques est disponible dans le <a class="reference external" href="https://metrics.dropwizard.io/4.1.2/manual/core.html">manuel utilisateur dropwizard metrics</a>.
Veuillez  vous référer au document d’architecture de chaque composant <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> qui doit documenter ses propres métriques, si des métriques spécifiques sont ajoutées.</p>
</div>
</div>
<div class="section" id="reporters-de-metriques">
<h3>5.7.3.2. Reporters de métriques<a class="headerlink" href="#reporters-de-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le système <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, un ou plusieurs reporters de métriques peuvent être utilisés. A ce jour, il existe deux reporters différents :</p>
<ul class="simple">
<li>Un reporter logback ;</li>
<li>Un reporter ElasticSearch issue de la librairie <a class="reference external" href="https://github.com/ProgrammeVitam/elasticsearch-metrics-reporter-java">metrics elasticsearch reporter</a>.</li>
</ul>
<p>Les reporters sont utilisés dans les composants logiciels Java. Ils sont en charge de récupérer les valeurs de toutes les métriques enregistrées et de les transmettre sur différents canaux, ici soit un logger logback ou une base de données ElasticSearch.</p>
</div>
<div class="section" id="endpoint-des-metriques">
<h3>5.7.3.3. Endpoint des métriques<a class="headerlink" href="#endpoint-des-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>À partir de la release R14, le système <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> permet d’exposer des métriques au format prometheus. Ces métriques sont exposées via une API dédiée.
Un serveur prometheus, ou une autre solution de monitoring compatible avec le format prometheus, peut récupérer les métriques en mode <cite>pull</cite> depuis cette API.
Un avantage du mode “pull” est de donner l’information sur l’état de la disponibilité du service en question. Ce mode est aussi plus économe en ressource qu’un mode “push” depuis le service lui-même vers l’outil de monitoring.</p>
</div>
<div class="section" id="stockage-des-metriques">
<h3>5.7.3.4. Stockage des métriques<a class="headerlink" href="#stockage-des-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si un reporter de métriques ElasticSearch est utilisé, celles-ci seront stockées dans le moteur d’indexation ElasticSearch, dans un cluster dédié au stockage des logs/métriques (pour séparer les données de logs/métriques et les données métier d’archives). La description de ce cluster commun logs/métriques, incluant la gestion des index et la visualisation, se trouve <a class="reference internal" href="05-logs-architecture.html"><span class="doc">dans la section précédente</span></a>.</p>
<ul>
<li><p class="first">Index : chaque index stockant des données de métriques correspond à 1 jour de métriques (déterminé à partir du timestamp de la métrique). Les index définis sont les suivants :</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">metrics-vitam-rest-YYYY.MM.dd</span></code> pour les métriques de RESTEasy, avec un champ <em>name</em> automatiquement généré sous la forme :</p>
<blockquote>
<div><p><strong>uri:http_method:consumed_types:produced_types:metric_type</strong>
Exemple:
<strong>_offer_v1__bulk_objects__type_:PUT:application_octet_stream:application_json:meter_total</strong>
<strong>_offer_v1__bulk_objects__type_:PUT:application_octet_stream:application_json:timer</strong></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">metrics-vitam-jvm-YYYY.MM.dd</span></code> pour les métriques JVM.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">metrics-vitam-business-YYYY.MM.dd</span></code> pour les métriques métier.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">.kibana</span></code> pour le stockage des paramètres (et notamment des dashboards) Kibana.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>À partir de la release R14 de la solution <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">Vitam</span></a> expose ses métriques au format prometheus.
Il est possible de configurer un serveur prometheus pour récupérer ces métriques et un Grafana pour les visualiser.
Ces deux outils sont largement utilisés, à ce jour, dans la communauté open source.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Veuillez vous référer à la documentation d’exploitation pour savoir comment fonctionne l’intégration et la configuration du serveur prometheus dans <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">Vitam</span></a></p>
</div>
</div>
</div>
<div class="section" id="limites">
<h2>5.7.4. Limites<a class="headerlink" href="#limites" title="Lien permanent vers ce titre">¶</a></h2>
<p>La solution implémentée dans <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">Vitam</span></a> possède les limites connues suivantes :</p>
<ul class="simple">
<li>Du fait que la librairie Dropwizard Metrics fait une agrégation des métriques et que le système de visualisation Kibana fonctionne lui aussi à l’aide d’agrégations, les résultats visualisés sont corrects dans la limite d’une certaine précision (certaines données deviennent non-représentatives de la réalité).</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="07-deployment-tooling.html" class="btn btn-neutral float-right" title="5.8. Outillage de déploiement" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="05-logs-architecture.html" class="btn btn-neutral float-left" title="5.6. Concentration et exploitation des logs applicatifs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>