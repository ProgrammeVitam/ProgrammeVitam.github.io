<!DOCTYPE HTML><html><head><title>API-Vitam Version Beta - Introduction API documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="https://github.com/raml2html/raml2html 4.0.0-beta14"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css"><script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script><script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script><script type="text/javascript">
      $(document).ready(function() {
        $('.page-header pre code, .top-resource-description pre code, .modal-body pre code').each(function(i, block) {
          hljs.highlightBlock(block);
        });

        $('[data-toggle]').click(function() {
          var selector = $(this).data('target') + ' pre code';
          $(selector).each(function(i, block) {
            hljs.highlightBlock(block);
          });
        });

        // open modal on hashes like #_action_get
        $(window).bind('hashchange', function(e) {
          var anchor_id = document.location.hash.substr(1); //strip #
          var element = $('#' + anchor_id);

          // do we have such element + is it a modal?  --> show it
          if (element.length && element.hasClass('modal')) {
            element.modal('show');
          }
        });

        // execute hashchange on first page load
        $(window).trigger('hashchange');

        // remove url fragment on modal hide
        $('.modal').on('hidden.bs.modal', function() {
          try {
            if (history && history.replaceState) {
                history.replaceState({}, '', '#');
            }
          } catch(e) {}
        });
      });
    </script><style>
      .hljs {
        background: transparent;
      }
      .parent {
        color: #999;
      }
      .list-group-item > .badge {
        float: none;
        margin-right: 6px;
      }
      .panel-title > .methods {
        float: right;
      }
      .badge {
        border-radius: 0;
        text-transform: uppercase;
        width: 70px;
        font-weight: normal;
        color: #f3f3f6;
        line-height: normal;
      }
      .badge_get {
        background-color: #63a8e2;
      }
      .badge_post {
        background-color: #6cbd7d;
      }
      .badge_put {
        background-color: #22bac4;
      }
      .badge_delete {
        background-color: #d26460;
      }
      .badge_patch {
        background-color: #ccc444;
      }
      .list-group, .panel-group {
        margin-bottom: 0;
      }
      .panel-group .panel+.panel-white {
        margin-top: 0;
      }
      .panel-group .panel-white {
        border-bottom: 1px solid #F5F5F5;
        border-radius: 0;
      }
      .panel-white:last-child {
        border-bottom-color: white;
        -webkit-box-shadow: none;
        box-shadow: none;
      }
      .panel-white .panel-heading {
        background: white;
      }
      .tab-pane ul {
        padding-left: 2em;
      }
      .tab-pane h1 {
        font-size: 1.3em;
      }
      .tab-pane h2 {
        font-size: 1.2em;
        padding-bottom: 4px;
        border-bottom: 1px solid #ddd;
      }
      .tab-pane h3 {
        font-size: 1.1em;
      }
      .tab-content {
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        padding: 10px;
      }
      #sidebar {
        margin-top: 30px;
        padding-right: 5px;
        overflow: auto;
        height: 90%;
      }
      .top-resource-description {
        border-bottom: 1px solid #ddd;
        background: #fcfcfc;
        padding: 15px 15px 0 15px;
        margin: -15px -15px 10px -15px;
      }
      .resource-description {
        border-bottom: 1px solid #fcfcfc;
        background: #fcfcfc;
        padding: 15px 15px 0 15px;
        margin: -15px -15px 10px -15px;
      }
      .resource-description p:last-child {
        margin: 0;
      }
      .list-group .badge {
        float: left;
      }
      .method_description {
        margin-left: 85px;
      }
      .method_description p:last-child {
        margin: 0;
      }
      .list-group-item {
        cursor: pointer;
      }
      .list-group-item:hover {
        background-color: #f5f5f5;
      }

      pre code {
        overflow: auto;
        word-wrap: normal;
        white-space: pre;
      }
    </style></head><body data-spy="scroll" data-target="#sidebar"><div class="container-fluid"><div class="row"><div class="col-md-9" role="main"><div class="page-header"><h1>API-Vitam Version Beta - Introduction API documentation <small>version v1</small></h1><p>https://api.vitam.gouv.fr/{version}</p><ul><li><strong>version</strong>: <em>required (v1)</em></li></ul><h3 id="avertissements"><a href="#avertissements">Avertissements</a></h3><p>Cette version d&#39;API présente des fonctionnalités sous différents statuts :</p><ul><li>Supportées : rien n&#39;est spécifié, la fonctionnalité ou la donnée est supportée</li><li><p>Non supportées : le mot clef <strong>UNSUPPORTED</strong> est indiqué et précise que cette fonctionnalité ou donnée n&#39;est pas supportée par l&#39;implémentaton courante</p><p>Cette version d&#39;API présente des fonctionnalités sous différentes versions :</p></li><li><p><strong>Alpha</strong> : l&#39;API est dans une première version, susceptible d&#39;évoluer fortement</p></li><li><strong>Beta</strong> : l&#39;API est proche de sa version stable</li><li><strong>Production</strong> : l&#39;API est considérée comme "production ready"</li><li><strong>Deprecated</strong> : l&#39;API est considérée comme obsolète et devrait disparaître dans une version majeure prochaine</li></ul><h3 id="licence"><a href="#licence">Licence</a></h3><p>Ce document est distribué sous les termes de la licence <a href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Creative Commons Attribution - Partage dans les Mêmes Conditions 3.0 France (CC BY-SA 3.0 FR)</a></p><h3 id="conventions_rest_g_n_rales"><a href="#conventions_rest_g_n_rales">Conventions REST Générales</a></h3><p>Ici sont présentées des conventions dans le cadre des API Vitam.</p><h1 id="mod-le-rest">Modèle REST</h1><p>Les URL sont découpées de la façon suivantes :</p><ul><li>protocole: https</li><li>FQDN : exemple api.vitam.fr avec éventuellement un port spécifique</li><li>Base :<nom du service>/<version></version></nom></li><li>Resource : le nom d&#39;une collection</li><li>L&#39;URL peut contenir d&#39;autres éléments (item, sous-collections)</li></ul><p>Exemple: <a href="https://api.vitam.fr/access/v1/units/id">https://api.vitam.fr/access/v1/units/id</a></p><p>Les méthodes utilisées :</p><ul><li>GET: pour l&#39;équivalent de "Select" (possibilité d&#39;utiliser POST avec X-Http-Method-Override: GET dans le Header)</li><li>POST: pour l&#39;équivalent de "Insert"</li><li>PUT: pour l&#39;équivalent de "Update"</li><li>DELETE: pour l&#39;équivalent de "Delete" (possibilité d&#39;utiliser POST avec X-Http-Method-Override: DELETE dans le Header)</li><li>HEAD: pour l&#39;équivalent du "Test d&#39;existence"</li><li>OPTIONS: pour l&#39;équivalent de "Lister les commandes disponibles"</li></ul><p>Les codes retours HTTP standards utilisés sont :</p><ul><li>200: Sur des opérations de GET, PUT, DELETE, HEAD, OPTIONS</li><li>201: Sur l&#39;opération POST (sans X-Http-Method-Override)</li><li>202: Pour les réponses asynchrones (<strong>UNSUPPORTED</strong>)</li><li>204: Pour des réponses sans contenu (type HEAD sans options)</li><li>206: Pour des réponses partielles ou des réponses en mode Warning (OK mais avec une alerte)</li></ul><p>Les codes d&#39;erreurs HTTP standards utilisés sont :</p><ul><li>400: Requête mal formulée</li><li>401: Requête non autorisée</li><li>404: Resource non trouvée</li><li>409: Requête en conflit</li><li>412: Des préconditions ne sont pas respectées</li><li>413: La requête dépasse les capacités du service</li><li>415: Le Media Type demandé n&#39;est pas supporté</li><li>501: Le service n&#39;est pas implémenté</li></ul><h2 id="mod-le-asynchrone-unsupported-">Modèle asynchrone <strong>UNSUPPORTED</strong></h2><p>Dans le cas d&#39;une opération asynchrone, deux options sont possibles :</p><h3 id="mode-pooling-unsupported-">Mode Pooling <strong>UNSUPPORTED</strong></h3><p>Dans le mode pooling, le client est responsable de requêter de manière répétée l&#39;URI de vérification du statut, et ce de manière raisonnée (pas trop souvent).</p><p>Le principe est le suivant :</p><ul><li>Création de l&#39;opération à effectuer<ul><li>Exemple: POST /ingests et retourne 202 + #id</li></ul></li><li>Pooling sur l&#39;opération demandée<ul><li>Exemple: GET /ingests/#id et retourne 202 + #id tant que non terminé</li><li>Intervalle recommandé : pas moins que la minute</li></ul></li><li>Fin de pooling sur l&#39;opération demandée<ul><li>Exemple : GET /ingests/#id et retourne 200 + le résultat</li></ul></li></ul><h3 id="mode-callback-unsupported-">Mode Callback <strong>UNSUPPORTED</strong></h3><p>Dans le mode Callback, le client soumet une création d&#39;opération et simultanément propose une URI de Callback sur laquelle Vitam rappellera le client pour lui indiquer que cette opération est terminée.</p><p>Le principe est le suivant :</p><ul><li>Création de l&#39;opération à effectuer avec l&#39;URI de Callback<ul><li>Exemple: POST /ingests + dans le Header X-Callback: <a href="https://uri?id={id}&amp;status={status}">https://uri?id={id}&amp;status={status}</a> et retourne 202 + #id + Header X-Callback confirmé</li></ul></li><li>A la fin de l&#39;opération, Vitam rappelle le client avec l&#39;URI de Callback<ul><li>Exemple: GET /uri?id=idop&amp;status=OK</li></ul></li><li>Le client rappelle alors Vitam pour obtenir l&#39;information<ul><li>Exemple: GET /ingests/#id et retourne 200 + le résultat</li></ul></li></ul><h3 id="perspectives-d-volution">Perspectives d&#39;évolution</h3><p>Dans le cas où l&#39;accès au résulat final ne doit pas se faire sur l&#39;URI /resources/id, il faudra ajouter une réponse 303.</p><h2 id="authentification">Authentification</h2><p>L&#39;authentification dans Vitam authentifie l&#39;application Front-Office qui se connecte à ses API. Cette authentification s&#39;effectue en trois temps :</p><ul><li>Un premier composant authentifie la nouvelle connexion<ul><li>La première implémentation sera basée sur une authentification du certificat client dans la connexion TLS</li></ul></li><li>Le premier composant passe au service REST la variable Header "X-Identity" contenant l&#39;identifiant de l&#39;application Front-Office.<ul><li>Comme cette identification est actuellement interne, ce Header est actuellement non généré.</li></ul></li><li>Le service REST, sur la base de cette authentification, s&#39;assure que l&#39;application Front-Office ait bien l&#39;habilitation nécessaire pour effectuer la requête exprimée.</li></ul><h2 id="identifiant-de-corr-lation">Identifiant de corrélation</h2><p>Vitam étant un service REST, il est "State Less". Il ne dispose donc pas de notion de session en propre. Cependant chaque requête retourne un identifiant de requête "<strong>X-Request-Id</strong>" qui est traçé dans les logs et journaux du SAE et permet donc de faire une corrélation avec les événements de l&#39;application Front-Office cliente si celle-ci enregistre elle-aussi cet identifiant.</p><p>Considérant que cela peut rendre difficile le suivi d&#39;une session utilisateur connecté sur un Front-Office, il est proposé que l&#39;application Front-Office puisse passer en paramètre dans le Header l&#39;argument "<strong>X-Application-Id</strong>" correspondant à un identifiant de session de l&#39;utilisateur connecté. Cet identifiant DOIT être non signifiant car il sera lui aussi dans les logs et les journaux de Vitam. Il est inclus dans chaque réponse de Vitam si celui-ci est exprimé dans la requête correspondante. Grâce à cet identifiant externe de session, il est alors plus facile de retracer l&#39;activité d&#39;un utilisateur grâce d&#39;une part au regroupement de l&#39;ensemble des actions dans Vitam au travers de cet identifiant, et d&#39;autre part grâce aux logs de l&#39;application Front-Office utilisant ce même identifiant de session.</p><h2 id="pagination">Pagination</h2><p>Vitam ne dispose pas de notion de session en raison de son implémentation « State Less ». Néanmoins, pour des raisons d&#39;optimisations sur des requêtes où le nombre de résultats serait important, il est proposé une option tendant à améliorer les performances : X-Cursor et X-Cursor-Id.</p><h3 id="m-thode-standard">Méthode standard</h3><p>De manière standard, il est possible de paginer les résultats en utilisant le DSL avec les arguments suivants dans la requête : (pour GET uniquement)</p><ul><li><strong>$limit</strong> : le nombre maximum d&#39;items retournés (limité à 1000 par défaut, maximum à 100000)</li><li><strong>$per_page</strong> : le nombre maximum des premiers items retournés (limité à 100 par défaut, maximum à 100) (<strong>UNSUPPORTED</strong>)</li><li><strong>$offset</strong> : la position de démarrage dans la liste retournée (positionné à 0 par défaut, maximum à 100000)</li></ul><p>En raison du principe State-less, les requêtes suivantes (en manipulant notamment $offset) seront à nouveau exécutées, conduisant à des performances réduites.</p><h3 id="m-thode-optimis-e-unsupported-">Méthode optimisée <strong>UNSUPPORTED</strong></h3><p>Afin d&#39;optimiser, il est proposé d&#39;ajouter de manière optionnelle dans le Header lors de la première requête le champs suivant : <strong>X-Cursor: true</strong> Si la requête nécessite une pagination (plus d&#39;une page de réponses possible), le SAE répondra alors la première page (dans le Body) et dans le Header :</p><ul><li><strong>X-Cursor-Id</strong>: id (identifiant du curseur)</li><li><strong>X-Cursor-Timeout</strong>: datetime (date limite de validité du curseur)</li></ul><p>Le client peut alors demander les pages suivantes en envoyant simplement une requête GET avec un Body vide et dans le Header : <strong>X-Cursor-Id</strong>: id.</p><h3 id="dsl_vitam"><a href="#dsl_vitam">DSL Vitam</a></h3><p>Le DSL (Domain Specific Language) Vitam est composé de deux parties :</p><ul><li>Request: Contient la structure du Body contenant la requête au format Json. Le DSL permet d&#39;exprimer un grand nombre de possibilités de requêtes. Dans le cadre des <em>Units</em> et <em>Objects</em>, cette requête peut être arborescente et multiples.</li><li>Response: Contient la structure du Body contenant le résultat au format Json. Il contient différentes informations utiles ou demandées.</li></ul><h1 id="request">Request</h1><p>Une requête est composée de plusieurs parties, et en particulier le Body qui contient un Json exprimant la requête.</p><p>Elle peut être complétée par quelques valeurs dans le <em>Header</em> :</p><ul><li><strong>X-Application-Id</strong> : pour conserver la session (valeur non signifiante) dans les journaux et logs du SAE associés à l&#39;opération demandée</li><li><strong>X-Valid: true</strong> : pour une requête HEAD sur un <strong>Object</strong> pour vérifier la validité (check d&#39;empreinte)</li><li><strong>X-Qualifier</strong> et <strong>X-Version</strong> : pour une requête GET sur un <strong>Object</strong> pour récupérer un usage et une version particulière</li><li><strong>X-Callback</strong> (<strong>UNSUPPORTED</strong>) : pour les opérations de longue durée et donc asynchrones pour indiquer l&#39;URL de Callback</li><li><strong>X-Cursor: true</strong> et <strong>X-Cursor-Id</strong> (<strong>UNSUPPORTED</strong>) : pour la gestion d&#39;une requête en mode "curseur"</li><li><strong>X-Http-Method-Override</strong> : pour permettre aux clients HTTP ne supportant pas tous les modes de la RFC 7231 (GET/PUT/DELETE avec Body)</li></ul><h2 id="units-et-objects-uniquement">Units et Objects uniquement</h2><ul><li><strong>$roots</strong>:<ul><li>Il s&#39;agit des racines (Units) à partir desquelles la requête est exprimée (toutes les recherches sur les Units et Objects sont en mode arborescente). Il correspond d&#39;une certaine façon à "<em>FROM x</em>" dans le langage SQL étendu au cas des arborescences.</li><li>Autres collections: ce champ n&#39;existe pas car il n&#39;y a pas d&#39;arborescence.</li></ul></li><li><strong>$query</strong>:<ul><li>Il s&#39;agit de la liste des <strong>Query</strong> successives à exécuter côté Vitam (tableau de Query).</li><li>Une Query correspond à la formulation "<em>WHERE xxx</em>" dans le langage SQL, c&#39;est à dire les critères de sélection.</li><li>La succession est exécutée avec la signification suivante :<ul><li>Depuis $roots, chercher les Units/Objects tel que Query[1] =&gt; liste d&#39;identifiants[1]</li><li>Depuis cette liste d&#39;identifiant, chercher les Units/Objects tel que Query[2] =&gt; liste d&#39;identifiants[2]</li><li>Et ainsi de suite, la liste d&#39;identifiants[n] de la dernière Query[n] est la liste de résultat définitive</li></ul></li></ul></li><li><p><strong>$filter</strong>:</p><ul><li>Il permet de spécifier des filtres additionnels :<ul><li>Pour <em>GET</em> :<ul><li><strong>$limit</strong>: le nombre maximum d&#39;items retournés (limité à 1000 par défaut, maximum à 100000)</li><li><strong>$per_page</strong>: le nombre maximum des premiers items retournés (limité à 100 par défaut, maximum à 100)</li><li><strong>$offset</strong>: la position de démarrage dans la liste retournée (positionné à 0 par défaut, maximum à 100000)</li><li><strong>$orderby: { fieldname: 1, fieldname: -1 }</strong> : permet de définir un tri</li><li><strong>$hint: "nocache"</strong> permet de spécifier si l&#39;on ne veut pas bénéficier du cache (cache actif par défaut)</li></ul></li><li>Pour <em>POST</em>, <em>PUT</em> et <em>DELETE</em><ul><li><strong>$mult</strong>: booléen où <em>true</em> signifie que l&#39;opération peut concerner de multiples items (par défaut, positionné à <em>false</em>)<ul><li><em>POST</em>: les pères sélectionnés peuvent être multiples</li><li><em>PUT</em>: la mise à jour peut concerner de multiples items simultanément</li><li><em>DELETE</em>: l&#39;effacement peut concerner plusieurs items</li></ul></li></ul></li></ul></li></ul></li><li><p><strong>$projection: { fieldname: 0, fieldname: 1 }</strong> uniquement pour <em>GET</em></p><ul><li>Il permet de définir la forme du résultat que l&#39;on souhaite. Il correspond au "<em>SELECT *</em>" dans le langage SQL.</li><li>Une valeur à 1 réclame le champ.</li><li>Une valeur à 0 exclut le champ.</li><li>Si rien n&#39;est spécifié, cela correspond à tous les champs (équivalent à "SELECT *")</li></ul></li><li><strong>$data</strong>: uniquement pour <em>POST</em><ul><li>Permet de définir le contenu à insérer dans la collection.</li></ul></li><li><strong>$action</strong>: uniquement pour <em>PUT</em><ul><li>Permet de définir le contenu à modifier dans la collection.</li></ul></li><li><strong>facetQuery</strong> (<strong>UNSUPPORTED</strong>): uniquement pour <em>GET</em> et optionnel<ul><li>Permet de définir des sous-requêtes (sous la forme d&#39;agrégats) correspondant généralement à des facettes dans l&#39;application Front-Office</li></ul></li></ul><h2 id="autres-collections">Autres collections</h2><ul><li><strong>$query</strong>:<ul><li>Il s&#39;agit d&#39;une <strong>Query</strong> unique.</li><li>Une Query correspond à la formulation "<em>WHERE xxx</em>" dans le langage SQL, c&#39;est à dire les critères de sélection.</li></ul></li><li><p><strong>$filter</strong>:</p><ul><li>Il permet de spécifier des filtres additionnels :<ul><li>Pour <em>GET</em> :<ul><li><strong>$limit</strong>: le nombre maximum d&#39;items retournés (limité à 1000 par défaut, maximum à 100000)</li><li><strong>$per_page</strong> (<strong>UNSUPPORTED</strong>): le nombre maximum des premiers items retournés (limité à 100 par défaut, maximum à 100)</li><li><strong>$offset</strong>: la position de démarrage dans la liste retournée (positionné à 0 par défaut, maximum à 100000)</li><li><strong>$orderby: { fieldname: 1, fieldname: -1 }</strong> : permet de définir un tri</li><li><strong>$hint: "nocache"</strong> (<strong>UNSUPPORTED</strong>) permet de spécifier si l&#39;on ne veut pas bénéficier du cache (cache actif par défaut)</li></ul></li><li>Pour <em>POST</em>, <em>PUT</em> et <em>DELETE</em><ul><li><strong>$mult</strong> (<strong>UNSUPPORTED</strong>): booléen où <em>true</em> signifie que l&#39;opération peut concerner de multiples items (par défaut, positionné à <em>false</em>)<ul><li><em>POST</em>: les pères sélectionnés peuvent être multiples</li><li><em>PUT</em>: la mise à jour peut concerner de multiples items simultanément</li><li><em>DELETE</em>: l&#39;effacement peut concerner plusieurs items</li></ul></li></ul></li></ul></li></ul></li><li><p><strong>$projection: { fieldname: 0, fieldname: 1 }</strong> uniquement pour <em>GET</em></p><ul><li>Il permet de définir la forme du résultat que l&#39;on souhaite. Il correspond au "<em>SELECT *</em>" dans le langage SQL.</li><li>Une valeur à 1 réclame le champ.</li><li>Une valeur à 0 exclut le champ.</li><li>Si rien n&#39;est spécifié, cela correspond à tous les champs (équivalent à "SELECT *")</li></ul></li><li><strong>$data</strong>: uniquement pour <em>POST</em><ul><li>Permet de définir le contenu à insérer dans la collection.</li></ul></li><li><strong>$action</strong>: uniquement pour <em>PUT</em><ul><li>Permet de définir le contenu à modifier dans la collection.</li></ul></li><li><strong>facetQuery</strong> (<strong>UNSUPPORTED</strong>): uniquement pour <em>GET</em> et optionnel<ul><li>Permet de définir des sous-requêtes (sous la forme d&#39;agrégats) correspondant généralement à des facettes dans l&#39;application Front-Office</li></ul></li></ul><h2 id="query">Query</h2><p>Les commandes de la Query peuvent être :</p><table class="table"><thead><tr><th>Catégorie</th><th>Opérateur</th><th>Arguments</th><th>Commentaire</th></tr></thead><tbody><tr><td>Accès direct</td><td>$path</td><td>identifiants</td><td>Accès direct à un noeud</td></tr><tr><td>Booléens</td><td>$and, $or, $not</td><td>opérateurs</td><td>Combinaison logique d&#39;opérateurs</td></tr><tr><td>Comparaison</td><td>$eq, $ne, $lt, $lte, $gt, $gte</td><td>Champ et valeur</td><td>Comparaison de la valeur d&#39;un champ et la valeur passée en argument</td></tr><tr><td></td><td>$range</td><td>Champ, $lt, $lte, $gt, $gte et valeurs</td><td>Comparaison de la valeur d&#39;un champ avec l&#39;intervalle passé en argument</td></tr><tr><td>Existence</td><td>$exists, $missing, $isNull</td><td>Champ</td><td>Existence d&#39;un champ</td></tr><tr><td>Tableau</td><td>$in, $nin</td><td>Champ et valeurs</td><td>Présence de valeurs dans un tableau</td></tr><tr><td></td><td>$size</td><td>Champ et taille</td><td>Taille d&#39;un tableau</td></tr><tr><td></td><td>[n] <strong>UNSUPPORTED</strong></td><td>Position (n &gt;= 0)</td><td>Élément d&#39;un tableau</td></tr><tr><td>Textuel</td><td>$term, $wildcard</td><td>Champ, mot clef</td><td>Comparaison de champs mots-clefs</td></tr><tr><td></td><td>$match, $matchPhrase, $matchPhrasePrefix</td><td>Champ, phrase, $max_expansions (optionnel)</td><td>Recherche de phrase</td></tr><tr><td></td><td>$regex</td><td>Champ, Expression régulière</td><td>Recherche via une expression régulière</td></tr><tr><td></td><td>$search</td><td>Champ, valeur</td><td>Recherche du type moteur de recherche</td></tr><tr><td></td><td>$flt, $mlt</td><td>Champ, valeur</td><td>Recherche « More Like This »</td></tr><tr><td>Géomatique</td><td>$geometry, $box, $polygon, $center</td><td>Positions</td><td>Définition d&#39;une position géographique</td></tr><tr><td><strong>UNSUPPORTED</strong></td><td>$geoWithin, $geoIntersects, $near</td><td>Une forme</td><td>Recherche par rapport à une forme géométrique</td></tr></tbody></table><p>Chaque Query dispose éventuellement d&#39;arguments additionnels pour gérer l&#39;arborescence :</p><table class="table"><thead><tr><th>Catégorie</th><th>Opérateur</th><th>Arguments</th><th>Commentaire</th></tr></thead><tbody><tr><td>Profondeur</td><td>$depth, $exactdepth</td><td>+ ou - n</td><td>Permet de spécifier si la query effectue une recherche vers les racines (-) ou vers les feuilles (+) et de quelle profondeur (n), avec une profondeur relative ($depth) ou exacte ($exactdepth)</td></tr><tr><td>Collection</td><td>$source</td><td>units / objects</td><td>Permet dans une succession de Query de changer de collection. Attention, la dernière Query doit respecter la collection associée à la requête</td></tr></tbody></table><h2 id="actions">Actions</h2><p>Dans la commande PUT (Update) :</p><table class="table"><thead><tr><th>Opérateur</th><th>Arguments</th><th>Commentaire</th></tr></thead><tbody><tr><td>$set</td><td>nom de champ, valeur</td><td>change la valeur du champ</td></tr><tr><td>$unset</td><td>liste de noms de champ</td><td>enlève le champ</td></tr><tr><td>$min, $max</td><td>nom de champ, valeur</td><td>change la valeur du champ à la valeur minimale/maximale si elle est supérieure/inférieure</td></tr><tr><td>$inc</td><td>nom de champ, valeur</td><td>incrémente/décremente la valeur du champ</td></tr><tr><td>$rename</td><td>nom de champ, nouveau nom</td><td>change le nom du champ</td></tr><tr><td>$push, $pull</td><td>nom de champ, liste de valeurs</td><td>ajoute/retire les éléments de la liste du champ (qui est un tableau)</td></tr><tr><td>$add, $pop</td><td>nom de champ, liste de valeurs</td><td>ajoute/retire les éléments de la liste du champ (qui est un "set" avec unicité des valeurs)</td></tr></tbody></table><h2 id="facetquery-unsupported-">FacetQuery <strong>UNSUPPORTED</strong></h2><p>Lors d&#39;une commande GET (Select), les possibilités envisagées sont :</p><table class="table"><thead><tr><th>Opérateur</th><th>Arguments</th><th>Commentaire</th></tr></thead><tbody><tr><td>$cardinality</td><td>nom de champ</td><td>indique le nombre de valeurs différentes pour ce champ</td></tr><tr><td>$avg, $max, $min, $stats</td><td>nom de champ numérique</td><td>indique la valeur moyenne, maximale, minimale ou l&#39;ensemble des statistiques du champ</td></tr><tr><td>$percentile</td><td>nom de champ numérique, valeurs optionnelles</td><td>indique les percentiles de répartition des valeurs du champ, éventuellement selon la répartition des valeurs indiquées</td></tr><tr><td>$date_histogram</td><td>nom de champ, intervalle</td><td>indique la répartition selon les dates selon un intervalle définie sous la forme "nX" où n est un nombre et X une lettre parmi y (year), M (month), d(day), h(hour), m(minute), s(seconde) ou encore de la forme "year", "quarter", "month", "week", "day", "hour", "minute" ou "second"</td></tr><tr><td>$date_range</td><td>nom de champ, format, ranges</td><td>indique la répartition selon les dates selon un intervalle défini "ranges" : [ { "to": "now-10M/M" }, { "from": "now-10M/M" } ] et "format" : "MM-yyyy"</td></tr><tr><td>$range</td><td>nom de champ, intervalles</td><td>indique la répartition selon des valeurs numériques par la forme "ranges" : [ { "to": 50 }, { "from": 50, "to": 100 }, { "from": 100 } ]</td></tr><tr><td>$terms</td><td>nom de champ</td><td>indique la répartition selon des valeurs textuelles du champ</td></tr><tr><td>$significant_terms</td><td>nom de champ principal, nom de champ secondaire</td><td>indique la répartition selon des valeurs textuelles du champ principal et affiche pour chaque les termes significatifs pour le second champ</td></tr></tbody></table><h2 id="exemples">Exemples</h2><h3 id="get">GET</h3><ul><li>La query sélectionne les Units qui vont être retournées.</li><li>Le contenu est :<ul><li>Pour <strong>Units/Objects</strong> :<ul><li><strong>$roots</strong></li><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$projection: { fieldname: 0, fieldname: 1 }</strong></li><li><strong>facetQuery</strong> optionnel</li></ul></li><li>Pour les autres collections :<ul><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$projection: { fieldname: 0, fieldname: 1 }</strong></li><li><strong>facetQuery</strong> optionnel</li></ul></li></ul></li></ul><pre><code class="lang-json">  {
    "$roots": [ "id0" ],
    "$query": [
      { "$match": { "title": "titre" }, "$depth": 4 }
    ],
    "$filter": { "$limit": 100 },
    "$projection": { "$fields": { "#id": 1, "title": 1, "#type": 1, "#sector": 1, "#parents": 1, "#object": 1 } },
    "$facetQuery": { "$terms": "#object.#type" }
  }
</code></pre><h3 id="post">POST</h3><ul><li>La query sélectionne le ou les Units parents de celle qui va être créée.</li><li>Le contenu est :<ul><li>Pour <strong>Units/Objects</strong> :<ul><li><strong>$roots</strong></li><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$data</strong></li></ul></li><li>Pour les autres collections :<ul><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$data</strong></li></ul></li></ul></li></ul><pre><code class="lang-json">  {
    "$roots": [ "id0" ],
    "$query": [
      { "$match": { "title": "titre" }, "$depth": 4 }
    ],
    "$filter": {  },
    "$data": { "title": "mytitle", "description": "my description", "value": 1 }
  }
</code></pre><h3 id="put">PUT</h3><ul><li>La query sélectionne les Units sur lesquelles l&#39;update va être réalisé.</li><li>Le contenu est :<ul><li>Pour <strong>Units/Objects</strong> :<ul><li><strong>$roots</strong></li><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$action</strong></li></ul></li><li>Pour les autres collections :<ul><li><strong>$query</strong></li><li><strong>$filter</strong></li><li><strong>$action</strong></li></ul></li></ul></li></ul><pre><code class="lang-json">  {
    "$roots": [ "id0" ],
    "$query": [
      { "$eq": { "title": "mytitle" }, "$depth": 5 }
    ],
    "$filter": {  },
    "$action": [{ "$inc": { "value": 10 } }]
  }
</code></pre><h1 id="response">Response</h1><p>Une réponse est composée de plusieurs parties :</p><ul><li><strong>$hits</strong>:<ul><li><strong>limit</strong>: le nombre maximum d&#39;items retournés (limité à 1000 par défaut)</li><li><strong>offrset</strong>: la position de démarrage dans la liste retournée (positionné à 0 par défaut)</li><li><strong>total</strong>: le nombre total potentiel (estimation) des résultats possibles</li><li><strong>size</strong>: le nombre réel d&#39;items retournés</li><li><strong>time_out</strong>: Vrai si la requête a durée trop longtemps et donc avec un résultat potentiellement partiel</li></ul></li><li><strong>$context</strong>: rapelle la requête exprimée</li><li><strong>$results</strong>: contient le résultat de la requête sous forme d&#39;une liste d&#39;items</li><li><strong>$facets</strong>: contient le résultat de la partie $facetQuery.</li></ul><p>Des champs sont protégés dans les requêtes :</p><ul><li>Il est interdit d&#39;exprimer un champ qui démarre par un <em>&#39;_&#39;</em></li><li><strong>#id</strong> est l&#39;identifiant de l&#39;item</li><li><strong>#all</strong> permet de spécifier l&#39;équivalent de "SELECT *"</li><li><strong>#type</strong> permet de spécifier le type d&#39;item (Document Type)</li><li><strong>#sector</strong> permet de spécifier la filière de l&#39;item</li><li><strong>#parents</strong> permet de spécifier la liste des Units parents</li><li><strong>#object</strong> permet de spécifier l&#39;objet associé à un Unit (s&#39;il existe)</li><li>Les "qualifiers" disponibles pour les objets :<ul><li><strong>PhysicalMaster</strong> pour original physique</li><li><strong>BinaryMaster</strong> pour conservation</li><li><strong>Dissemination</strong> pour la version de diffusion compatible avec un accès rapide et via navigateur</li><li><strong>Thumbnail</strong> pour les vignettes pour les affichages en qualité très réduite et très rapide en "prévue"</li><li><strong>TextContent</strong> pour la partie native texte (ASCII UTF8)</li></ul></li></ul><p>La réponse dispose également de champs dans le <em>Header</em> :</p><ul><li><strong>FullApiVersion</strong> : retourne le numéro précis de la version de l&#39;API en cours d&#39;exécution</li><li><strong>X-Request-Id</strong> : pour chaque requête, un unique identifiant est fourni en réponse</li><li><strong>X-Application-Id</strong> : pour conserver la session (valeur non signifiante) dans les journaux et logs associés à l&#39;opération demandée</li><li><strong>X-Qualifier</strong> et <strong>X-Version</strong> : pour une requête GET sur un <strong>Object</strong> pour indiquer un usage et une version particulière</li><li><strong>X-Callback</strong> (<strong>UNSUPPORTED</strong>): pour les opérations de longue durée et donc asynchrones pour indiquer l&#39;URL de Callback</li><li>(<strong>UNSUPPORTED</strong>) Si <strong>X-Cursor: true</strong> a été spécifié et si la réponse nécessite l&#39;usage d&#39;un curseur (nombre de réponses &gt; <em>$per_page</em>), le SAE retourne <strong>X-Cursor-Id</strong> et <strong>X-Cursor-Timeout</strong> (date de fin de validité du curseur) : pour la gestion d&#39;une requête en mode "curseur" par le client</li></ul><h2 id="exemples">Exemples</h2><h3 id="r-ponse-pour-units">Réponse pour Units</h3><pre><code class="lang-json">  {
    "$hits": {
      "total": 3,
      "size": 3,
      "offset": 0,
      "limit": 100,
      "time_out": false
    },
    "$context": {
      "$roots": [ "id0" ],
      "$query": [
        { "$match": { "title": "titre" }, "$depth": 4 }
      ],
      "$filter": { "$limit": 100 },
      "$projection": { "$fields": { "#id": 1, "title": 1, "#type": 1, "#sector": 1, "#parents": 1, "#object": 1 } },
      "$facetQuery": { "$terms": "#object.#type" }
    },
    "$results": [
      {
        "#id": "id1", "title": "titre 1", "#type": "DemandeCongés", "#sector": "RessourcesHumaines",
        "#parents": [ { "#id": "id4", "#type": "DossierCongés", "#sector": "RessourcesHumaines" } ],
        "#object": { "#id": "id101", "#type": "Document",
          "#qualifiers": { "BinaryMaster": 5, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 } }
      },
      {
        "#id": "id2", "title": "titre 2", "#type": "DemandeCongés", "#sector": "RessourcesHumaines",
        "#parents": [ { "#id": "id4", "#type": "DossierCongés", "#sector": "RessourcesHumaines" } ],
        "#object": { "#id": "id102", "#type": "Document",
          "#qualifiers": { "BinaryMaster": 5, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 } }
      },
      {
        "#id": "id3", "title": "titre 3", "#type": "DemandeCongés", "#sector": "RessourcesHumaines",
        "#parents": [ { "#id": "id4", "#type": "DossierCongés", "#sector": "RessourcesHumaines" } ],
        "#object": { "#id": "id103", "#type": "Image",
          "#qualifiers": { "BinaryMaster": 3, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 } }
      }
    ],
    "$facet": {
      "#object.#type": { "Document": 2, "Image": 1 }
    }
  }
</code></pre><h3 id="r-ponse-pour-objects">Réponse pour Objects</h3><pre><code class="lang-json">  {
    "$hits": {
      "total": 3,
      "size": 3,
      "offset": 0,
      "limit": 100,
      "time_out": false
    },
    "$context": {
      "$roots": [ "id0" ],
      "$query": [
        { "$match": { "title": "titre" }, "$depth": 4, "$source": "units" },
        { "$eq": { "#type": "Document" }, "$source": "objects" }
      ],
      "$filter": { "$limit": 100 },
      "$projection": { "$fields": { "#id": 1, "#qualifiers": 1, "#type": 1, "#parents": 1 } }
    },
    "$results": [
      {
        "#id": "id101", "#type": "Document",
        "#qualifiers": { "BinaryMaster": 5, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 },
        "#parents": [ { "#id": "id1", "#type": "DemandeCongés", "#sector": "RessourcesHumaines" } ]
      },
      {
        "#id": "id102", "#type": "Document",
        "#qualifiers": { "BinaryMaster": 5, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 },
        "#parents": [ { "#id": "id2", "#type": "DemandeCongés", "#sector": "RessourcesHumaines" } ]
      },
      {
        "#id": "id103", "#type": "Document",
        "#qualifiers": { "BinaryMaster": 3, "Dissemination": 1, "Thumbnail": 1, "TextContent": 1 },
        "#parents": [ { "#id": "id3", "#type": "DemandeCongés", "#sector": "RessourcesHumaines" } ]
      }
    ]
  }
</code></pre><h2 id="r-ponse-en-cas-d-erreurs">Réponse en cas d&#39;erreurs</h2><p>En cas d&#39;erreur, Vitam retourne un message d&#39;erreur dont le format est :</p><ul><li><strong>httpCode</strong> : code erreur Http</li><li><strong>code</strong> : code erreur Vitam</li><li><strong>context</strong> : contexte de l&#39;erreur</li><li><strong>state</strong> : statut en format de message court sous forme de code</li><li><strong>message</strong> : statut en format de message court</li><li><strong>description</strong> : statut détaillé</li><li><strong>errors</strong> : le cas échéant des sous-erreurs associées avec le même format</li></ul><h3 id="exemple-de-retour-en-erreur">Exemple de retour en erreur</h3><pre><code class="lang-json">  {
    "httpCode": 404,
    "code" : "codeVitam1",
    "context": "ingest",
    "state": "Item_Not_Found",
    "message": "Item is not found",
    "description": "Operation on item xxx cannot be done since item is not found in &lt;&lt;resourcePathName&gt;&gt;",
    "errors": [
      { "httpCode": 415,
        "code" : "codevitam2",
        "context": "ingest",
        "state": "Unsupported_Media_Type",
        "message": "Unsupported media type detected",
        "description": "File xxx has an unsupported media type yyy" },
      { "httpCode": 412,
        "code": "codevitam3",
        "context": "ingest",
        "state": "Precondition_Failed",
        "message": "Precondition in error",
        "description": "Operation on file xxx cannot continue since precondition is in error" }
    ]
  }
</code></pre><h2 id="cas-particulier-head-pour-test-d-existence-et-validation-unsupported-">Cas particulier : HEAD pour test d&#39;existence et validation (<strong>UNSUPPORTED</strong>)</h2><p>La commande <em>HEAD</em> permet de savoir pour un item donné s&#39;il existe (retour <strong>204</strong>) ou pas (retour <strong>404</strong>).</p><p>Si dans le Header est ajoutée la commande <strong>X-Valid: true</strong>, la commande <em>HEAD</em> vérifie si l&#39;item (Unit ou Object) existe et s&#39;il est conforme (audit de l&#39;item sur la base de son empreinte). S&#39;il n&#39;est pas conforme mais qu&#39;il existe, le retour est <strong>417</strong> (Expectation Failed).</p></div><div class="panel panel-default"><div class="panel-heading"><h3 id="status" class="panel-title">/status</h3></div><div class="panel-body"><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_status"><span class="parent"></span>/status</a> <span class="methods"><a href="#status_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_status" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#status_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="status_get"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent"></span>/status</h4></div><div class="modal-body"><ul class="nav nav-tabs"><li class="active"><a href="#status_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="status_get_response"><h2>HTTP status code <a href="http://httpstatus.es/204" target="_blank">204</a></h2><p>No Content, Used to test existence or for Status</p><h3>Headers</h3><ul><li><strong>X-Request-Id</strong>: <em>required (string)</em><p>Unique Request Identifier</p><p><strong>Examples</strong>:</p><pre>AbDUh67jj</pre></li><li><strong>FullApiVersion</strong>: <em>required (string)</em><p>Complete Version of the API.</p><p><strong>Examples</strong>:</p><pre>V1.25</pre></li><li><strong>X-Application-Id</strong>: <em>(string)</em><p>Session Identifier from client Front-Office Application</p><p><strong>Examples</strong>:</p><pre>SESSION-ID-00001</pre></li></ul><h2>HTTP status code <a href="http://httpstatus.es/401" target="_blank">401</a></h2><p>Unauthorized, authentication in error</p><h3>Headers</h3><ul><li><strong>X-Request-Id</strong>: <em>required (string)</em><p>Unique Request Identifier</p><p><strong>Examples</strong>:</p><pre>AbDUh67jj</pre></li><li><strong>FullApiVersion</strong>: <em>required (string)</em><p>Complete Version of the API.</p><p><strong>Examples</strong>:</p><pre>V1.25</pre></li><li><strong>X-Application-Id</strong>: <em>(string)</em><p>Session Identifier from client Front-Office Application</p><p><strong>Examples</strong>:</p><pre>SESSION-ID-00001</pre></li></ul><h2>HTTP status code <a href="http://httpstatus.es/404" target="_blank">404</a></h2><p>Not Found, requested resource does not exist</p><h3>Headers</h3><ul><li><strong>X-Request-Id</strong>: <em>required (string)</em><p>Unique Request Identifier</p><p><strong>Examples</strong>:</p><pre>AbDUh67jj</pre></li><li><strong>FullApiVersion</strong>: <em>required (string)</em><p>Complete Version of the API.</p><p><strong>Examples</strong>:</p><pre>V1.25</pre></li><li><strong>X-Application-Id</strong>: <em>(string)</em><p>Session Identifier from client Front-Office Application</p><p><strong>Examples</strong>:</p><pre>SESSION-ID-00001</pre></li></ul><h2>HTTP status code <a href="http://httpstatus.es/503" target="_blank">503</a></h2><p>Service Unavailable, the requested service is unavailable</p></div></div></div></div></div></div></div></div></div></div></div><div class="col-md-3"><div id="sidebar" class="hidden-print affix" role="complementary"><ul class="nav nav-pills nav-stacked"><li><a href="#status">/status</a></li></ul></div></div></div></div></body></html>