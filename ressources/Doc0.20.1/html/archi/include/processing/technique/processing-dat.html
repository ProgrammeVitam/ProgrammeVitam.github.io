

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.9.2.2. DAT : module processing &mdash; documentation VITAM - Architecture 0.20.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="..\..\..\_static\css\theme.css" type="text/css">
  

  

  
        <link rel="index" title="Index" href="..\..\..\genindex.html">
        <link rel="search" title="Recherche" href="..\..\..\search.html">
    <link rel="top" title="documentation VITAM - Architecture 0.20.0" href="..\..\..\index.html">
        <link rel="up" title="7.9.2. Architecture Technique" href="index.html">
        <link rel="next" title="7.9.2.3. Rangement des objets" href="storage.html">
        <link rel="prev" title="7.9.2.1. Introduction" href="introduction.html"> 

  
  <script src="..\..\..\_static\js\modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="..\..\..\index.html" class="icon icon-home"> VITAM - Architecture
          

          
            
            <img src="..\..\..\_static\LogoVitamGrand2.png" class="logo">
          
          </a>

          
            
            
              <div class="version">
                0.20.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="..\..\..\introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\..\..\introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\..\..\overview\_toc.html">3. Vue d&#8217;ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\..\..\archi-applicative\_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\..\..\archi-exploit-infra\_toc.html">5. Architecture technique / exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\..\..\securite\_toc.html">6. Securite</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="..\..\_toc.html">7. Architecture détaillée</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="..\..\access\_toc.html">7.1. Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\common\_toc.html">7.2. Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\functional-administration\_toc.html">7.3. Functional administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\ihm-demo\_toc.html">7.4. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\ihm-recette\_toc.html">7.5. IHM recette</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\ingest\_toc.html">7.6. Ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\logbook\_toc.html">7.7. Logbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\metadata\_toc.html">7.8. Metadata</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="..\_toc.html">7.9. Processing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="..\archi-fonctionnelle\index.html">7.9.1. architecture-fontionnelle-processing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">7.9.2. Architecture Technique</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="introduction.html">7.9.2.1. Introduction</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">7.9.2.2. DAT : module processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage.html">7.9.2.3. Rangement des objets</a></li>
<li class="toctree-l4"><a class="reference internal" href="check-availability.html">7.9.2.4. Vérification de la disponibilité</a></li>
<li class="toctree-l4"><a class="reference internal" href="seda-check.html">7.9.2.5. Vérifier SEDA</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="..\securite\index.html">7.9.3. Securite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="..\..\storage\_toc.html">7.10. Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\technical-administration\_toc.html">7.11. Technical administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="..\..\workspace\_toc.html">7.12. Workspace</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..\..\..\index.html">VITAM - Architecture</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..\..\..\index.html">Docs</a> &raquo;</li>
      
          <li><a href="..\..\_toc.html">7. Architecture détaillée</a> &raquo;</li>
      
          <li><a href="..\_toc.html">7.9. Processing</a> &raquo;</li>
      
          <li><a href="index.html">7.9.2. Architecture Technique</a> &raquo;</li>
      
    <li>7.9.2.2. DAT : module processing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="..\..\..\_sources\include\processing\technique\processing-dat.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dat-module-processing">
<h1>7.9.2.2. DAT : module processing<a class="headerlink" href="#dat-module-processing" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ce document présente l&#8217;ensemble de manuel développement concernant le développment du module
metadata qui représente le story #70, qui contient :</p>
<ul class="simple">
<li>modules &amp; parkages</li>
<li>classes de métiers</li>
</ul>
<div class="section" id="module-et-packages">
<h2>7.9.2.2.1. 1. Module et packages<a class="headerlink" href="#module-et-packages" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les principaux modules sont :</p>
<p><a href="#id1"><span class="problematic" id="id2">|</span></a>&#8212; processing-common: contient les méthodes commons: les modèles, les exceptions, SedaUtil, ...
<a href="#id3"><span class="problematic" id="id4">|</span></a>&#8212; processing-distributor: appelle un worker de processus et distribue le workflow. Offre la possibilité au worker de s&#8217;enregistrer, se désabonner.
<a href="#id5"><span class="problematic" id="id6">|</span></a>&#8212; processing-distributor-client: client de module processing-distributor
<a href="#id7"><span class="problematic" id="id8">|</span></a>&#8212; processing-engine: appelle un distributeur de processus
<a href="#id9"><span class="problematic" id="id10">|</span></a>&#8212; processing-engine-client: client de module processing-engine
|
<a href="#id11"><span class="problematic" id="id12">|</span></a>&#8212; processing-management: gestion de workflow
|
<a href="#id13"><span class="problematic" id="id14">|</span></a>&#8212; processing-management-client: client de module processing-management</p>
</div>
<div class="section" id="modele">
<h2>7.9.2.2.2. 2. Modèle<a class="headerlink" href="#modele" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un modèle a été mis en place pour permettre la remontée et l&#8217;agrégation des status des différents item du worflow.</p>
<p>Un état du worflow utilise l&#8217;objet <strong>ItemStatus</strong> qui contient :
* itemId : l&#8217;identifiant de l&#8217;item de processus résponsable du status (identifiant de step, handler, transaction, etc)
* statusMeter : une liste de nombre de code status (nombre de OK, KO, WARNING, etc)
* globalStatus : un status global
* une liste de données remontée par l&#8217;item du processus (comme messageIdentifier)</p>
<p>Les statuts du processus de workflow utilisent un objet composite <strong>CompositeItemStatus</strong> qui est un <strong>ItemStatus</strong> et contient une Map de statut de workflow de ses sous-items.</p>
<p>Un workflow est défini par un fichier json contenant les steps ainsi que toutes les actions qui doivent être exécutées par les steps. Chaque Step et Action doivent être identifiés par un ID unique qui est également utilisé pour récupérer les messages.</p>
<p>La combinaison d&#8217;un état du processus (PAUSE, RUNNING, COMPLETED) et de son statut qui peut être (OK, WARNING, KO, FATAL) nous donne un vue global sur le processus. Le processus peut être en état COMPLETED avec tous les statut possible. Il faut être en état RUNNING ou PAUSE avec le statut de l&#8217;exécution des dernières étapes.</p>
</div>
<div class="section" id="process-distributor">
<h2>7.9.2.2.3. 3. Process Distributor<a class="headerlink" href="#process-distributor" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le distributor, en plus de lancer les workflow, offre désormais la possibilité aux Workers de s&#8217;abonner, se désabonner.
Lors d&#8217;un abonnement, le Worker est ajouté à une liste de workers (regroupés par famille de worker). Pour un désabonnement, il est supprimé.
Pour le moment, les workers ajoutés ne pourront être appelés, cela sera codé dans une autre itération.</p>
<p>A l&#8217;heure actuelle voici les méthodes REST proposées :</p>
<p>POST /processing/v1/worker_family/{id_family}/workers/{id_worker}</p>
<blockquote>
<div>-&gt; permet d&#8217;enregistrer un nouveau worker pour la famille donnée.
-&gt; Une query json est passé en paramètre et correspond à la configuration du worker.</div></blockquote>
<p>DELETE /processing/v1/worker_family/{id_family}/workers/{id_worker}</p>
<blockquote>
<div>-&gt; permet de désinscrire un worker pour la famille donnée, selon son id.</div></blockquote>
<p>Dans les itérations suivantes les autres méthodes suivantes seront implémentées :</p>
<ul class="simple">
<li>liste des familles de worker</li>
<li>ajouter/mettre à jour/effacer une famille de worker</li>
<li>statut d&#8217;une fammile de worker</li>
<li>liste des workers d&#8217;une famille</li>
<li>effacer les workers d&#8217;une famille</li>
<li>statut d&#8217;un worker</li>
<li>mise à jour d&#8217;un worker</li>
</ul>
</div>
<div class="section" id="parallelisme-dans-le-distributeur">
<h2>7.9.2.2.4. 4. Parallélisme dans le distributeur<a class="headerlink" href="#parallelisme-dans-le-distributeur" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les parallélismes suivants sont mis en oeuvre dans le distributeur</p>
<ul>
<li><p class="first">Parallélisme dans l&#8217;exécution des steps entre plusieurs workflows : celui-ci est géré de manière naturelle sous la forme de plusieurs requêtes (actuellement Java, demain en HTTP) entre le moteur du processing (process-engine) et le distributeur.</p>
</li>
<li><p class="first">Parallélisme dans l&#8217;exécution d&#8217;un step pour une distribution de type list vers un même worker. Les principes sont les suivants</p>
<p>-&gt; Worker : chaque worker associé à un WorkerConfiguration pré-défini. Chaque worker appartient à une famille correspondant à ses fonctions.
et il possède aussi une capacité pour gérer plusieurs threads en parallèle, précisé par le paramètre capacity de WorkerCongiguration, et ces paramètres seront initialisés lors du lancement du Worker.</p>
<p>-&gt; Enregistrement/déenregistrement d&#8217;un worker : Le principe est un découplage asynchrone basé sur plusieurs queues de messages bloquantes (BlockingQueue en java)
Il y a plusieurs famille de worker et chaque famille lié à une queue de messages bloquantes. Pour l&#8217;enregistrement du worker, nous faisons aussi un contrôle pour s&#8217;assurer que le worker
ne peut s&#8217;enregistrer qu&#8217;à une famille lui appartenant. Au moment de l&#8217;enregistrement, si la queue de la famille n&#8217;existe pas encore, elle sera créée.</p>
<p>-&gt; Opérarations:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>Lors de l&#8217;enregistrement d&#8217;un worker (voir section ci-dessus), un thread (cf WorkerManager) est crée et se met en écoute sur la blocking queue (Consommateur) correspondante de la famille.</li>
</ul>
</div></blockquote>
<p>Une fois une tâche consommée, s&#8217;il a une capacité suffisante (fournie par le worker lors de l&#8217;enregistrement), ce thread (WorkerThreadManager) va créer un thread (WorkerThread) pour gérer l&#8217;envoi de la demande au Worker ainsi que la gestion de la callback vers le producteur.</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>Lors de distribution d&#8217;un step d&#8217;un workflow,</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>le distributeur pousse les tâches dans la blockingQueue (Producteur) et garde en mémoire les tâches qui sont en cours</li>
<li>La queue n&#8217;est qu&#8217;un élement de découplage et a donc une taile réduite : le thread de distribution est donc bloqué soit lors de son insertion dans la queue soit en attente que toutes les tâches soient terminées</li>
<li>Une callback est exécutée par le consommateur en fin de traitement pour supprimer la tâche terminée des tâches en cours</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
</ul>
<p>Le parallélisme entre plusieurs workers sera mis en oeuvre en V1</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="storage.html" class="btn btn-neutral float-right" title="7.9.2.3. Rangement des objets" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="7.9.2.1. Introduction" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.20.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="..\..\..\_static\jquery.js"></script>
      <script type="text/javascript" src="..\..\..\_static\underscore.js"></script>
      <script type="text/javascript" src="..\..\..\_static\doctools.js"></script>
      <script type="text/javascript" src="..\..\..\_static\translations.js"></script>

  

  
  
    <script type="text/javascript" src="..\..\..\_static\js\theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>