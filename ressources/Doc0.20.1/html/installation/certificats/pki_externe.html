

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.3. Cas 2: Je dispose d’une PKI &mdash; documentation VITAM - Documentation d&#39;installation 0.20.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="..\_static\css\theme.css" type="text/css">
  

  

  
        <link rel="index" title="Index" href="..\genindex.html">
        <link rel="search" title="Recherche" href="..\search.html">
    <link rel="top" title="documentation VITAM - Documentation d&#39;installation 0.20.0" href="..\index.html">
        <link rel="up" title="8. Explications relatives à la génération des certificats" href="_toc.html">
        <link rel="next" title="9. Procédures d’installation / mise à jour" href="..\packages\_toc.html">
        <link rel="prev" title="8.2. Cas 1: Je ne dispose pas de PKI, je souhaite utiliser celle de Vitam" href="pki_vitam.html"> 

  
  <script src="..\_static\js\modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="..\index.html" class="icon icon-home"> VITAM - Documentation d'installation
          

          
            
            <img src="..\_static\LogoVitamGrand2.png" class="logo">
          
          </a>

          
            
            
              <div class="version">
                0.20.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="..\introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\architecture.html">3. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\prerequis.html">4. Pré-requis</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\10-it-services.html">5. Dépendances aux services d&#8217;infrastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\fiche_type.html">6. Fiche type de déploiement VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\get_version.html">7. Récupération de la version</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">8. Explications relatives à la génération des certificats</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction_certificats.html">8.1. Introduction sur les certificats dans Vitam</a></li>
<li class="toctree-l2"><a class="reference internal" href="pki_vitam.html">8.2. Cas 1: Je ne dispose pas de PKI, je souhaite utiliser celle de Vitam</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.3. Cas 2: Je dispose d&#8217;une PKI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#procedure-generale">8.3.1. Procédure générale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-de-certificats-existants">8.3.2. Intégration de certificats existants</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generation-des-magasins-de-certificats">8.3.3. Génération des magasins de certificats</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="..\packages\_toc.html">9. Procédures d&#8217;installation / mise à jour</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\validation_deploiement.html">10. Validation de la procédure</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\troubleshooting.html#retour-d-experience-cas-rencontres">12. Retour d&#8217;expérience / cas rencontrés</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\extras.html">13. Elements extras de l&#8217;installation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..\index.html">VITAM - Documentation d'installation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..\index.html">Docs</a> &raquo;</li>
      
          <li><a href="_toc.html">8. Explications relatives à la génération des certificats</a> &raquo;</li>
      
    <li>8.3. Cas 2: Je dispose d&#8217;une PKI</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="..\_sources\certificats\pki_externe.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cas-2-je-dispose-d-une-pki">
<h1>8.3. Cas 2: Je dispose d&#8217;une PKI<a class="headerlink" href="#cas-2-je-dispose-d-une-pki" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="procedure-generale">
<h2>8.3.1. Procédure générale<a class="headerlink" href="#procedure-generale" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous disposez d&#8217;une PKI, il n&#8217;est pas nécessaire d&#8217;utiliser celle de Vitam.
Il va par contre être nécessaire de déposer les certificats et les autorités de certifications correspondantes dans les bon répertoires.
Il sera aussi nécessaire de renseigner les mots de passe des clés privées des certificats dans le vault ansible environmements/certs/vault-certs.yml
Il faudra alors ensuite utiliser le script Vitam permettant de générer les différents keystores.</p>
</div>
<div class="section" id="integration-de-certificats-existants">
<h2>8.3.2. Intégration de certificats existants<a class="headerlink" href="#integration-de-certificats-existants" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous possédez déjà une <a class="reference internal" href="..\introduction.html#term-pki"><span class="xref std std-term">PKI</span></a>, il convient de positionner les certificats et CA sous <code class="docutils literal"><span class="pre">environmements/certs/....</span></code> en respectant la structure indiquée ci-dessous.</p>
<div class="figure align-center" id="id1">
<span id="arborescence-certs"></span><a class="reference external image-reference" href="..\_images\arborescence_certs.svg"><img alt="../_images/arborescence_certs.svg" src="..\_images\arborescence_certs.svg"></a>
<p class="caption"><span class="caption-text">Vue détaillée de l&#8217;arborescence des certificats</span></p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Astuce</p>
<p class="last">Dans le doute, n&#8217;hésitez pas à utiliser la PKI de test (étapes de génération de CA et de certificats) pour générer les fichiers requis au bon endroit et ainsi voir la structure exacte attendue ;
il vous suffira ensuite de remplacer ces certificats &#8220;placeholders&#8221; par les certificats définitifs avant de lncer le déploiement.</p>
</div>
<p>Ne pas oublier de renseigner le vault contenant les passphrases des clés des certificats: <code class="docutils literal"><span class="pre">environmements/certs/vault-certs.yml</span></code></p>
<p>Pour modifier/créer un vault ansible, se référer à la documentation sur <a class="reference external" href="http://docs.ansible.com/ansible/playbooks_vault.html">cette url</a>.</p>
</div>
<div class="section" id="generation-des-magasins-de-certificats">
<h2>8.3.3. Génération des magasins de certificats<a class="headerlink" href="#generation-des-magasins-de-certificats" title="Lien permanent vers ce titre">¶</a></h2>
<p>En prérequis, les certificats et les autorités de certification doivent être présents dans les répertoires attendus.</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Avant de lancer le script de génération des stores, il est nécessaire de modifier le vault contenant les mots de passe des stores: <code class="docutils literal"><span class="pre">environmements/group_vars/all/vault-keystores.yml</span></code>, décrit dans la section <a class="reference internal" href="..\packages\fresh_install.html#pkiconfsection"><span class="std std-ref">PKI</span></a>.</p>
</div>
<p>Lancer le script :</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./generate_stores.sh
</pre></div>
</div>
<p>Ci-dessous un exemple de sortie du script :</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> -------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Creation du keystore de access-external pour le serveur localhost
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Génération du p12
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Génération du jks
Entry <span class="k">for</span> <span class="nb">alias</span> access-external successfully imported.
Import <span class="nb">command</span> completed:  <span class="m">1</span> entries successfully imported, <span class="m">0</span> entries failed or cancelled
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Suppression du p12
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> -------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Creation du keystore de ingest-external pour le serveur localhost
    <span class="o">[</span>...<span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> -------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span>generate_stores.sh<span class="o">]</span> Fin de la génération des stores
</pre></div>
</div>
<p>Ce script génère sous <code class="docutils literal"><span class="pre">environmements/keystores</span></code> les stores (jks / p12) associés pour un bon fonctionnement dans VITAM.</p>
<p>Il est aussi possible de déposer directement les keystores au bon format en remplaçant ceux fournis par défaut, en indiquant les mots de passe d&#8217;accès dans le vault: <code class="docutils literal"><span class="pre">environmements/group_vars/all/vault-keystores.yml</span></code></p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="..\packages\_toc.html" class="btn btn-neutral float-right" title="9. Procédures d’installation / mise à jour" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pki_vitam.html" class="btn btn-neutral" title="8.2. Cas 1: Je ne dispose pas de PKI, je souhaite utiliser celle de Vitam" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.20.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="..\_static\jquery.js"></script>
      <script type="text/javascript" src="..\_static\underscore.js"></script>
      <script type="text/javascript" src="..\_static\doctools.js"></script>
      <script type="text/javascript" src="..\_static\translations.js"></script>

  

  
  
    <script type="text/javascript" src="..\_static\js\theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>