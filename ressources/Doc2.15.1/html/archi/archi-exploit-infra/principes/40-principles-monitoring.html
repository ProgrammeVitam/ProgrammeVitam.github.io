

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.1.6. Suivi de l’état du système &mdash; Documentation VITAM - Architecture 2.15.1-1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'2.15.1-1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="5.1.7. Administration technique" href="50-principles-technical-administration.html" />
    <link rel="prev" title="5.1.5. Déploiement de la solution" href="30-principles-deployment.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> VITAM - Architecture
          

          
            
            <img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.15.1-1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/_toc.html">3. Vue d’ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archi-applicative/_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">5. Architecture technique / exploitation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">5.1. Principes d’architecture technique</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="00-principles-services.html">5.1.1. Principes communs et environnement des services</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-principles-users-rights.html">5.1.2. Utilisateurs, dossiers &amp; droits</a></li>
<li class="toctree-l3"><a class="reference internal" href="10-principles-networking.html">5.1.3. Principes sur les communications inter-services et le clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="20-principles-packaging.html">5.1.4. Packaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="30-principles-deployment.html">5.1.5. Déploiement de la solution</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">5.1.6. Suivi de l’état du système</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#api-de-supervision">5.1.6.1. API de supervision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metriques">5.1.6.2. Métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logs">5.1.6.3. Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suivi-de-l-etat-de-deploiement">5.1.6.4. Suivi de l’état de déploiement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integration-a-un-systeme-de-monitoring-tiers">5.1.6.5. Intégration à un système de monitoring tiers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="50-principles-technical-administration.html">5.1.7. Administration technique</a></li>
<li class="toctree-l3"><a class="reference internal" href="60-principles-data-management.html">5.1.8. Gestion des données du système</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../01-services-techniques.html">5.2. Services techniques fournis par la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02-dependencies.html">5.3. Composants logiciels utilisés</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03-technical-architecture.html">5.4. Architecture technique détaillée</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04-data-storage.html">5.5. Stockage des données</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05-logs-architecture.html">5.6. Concentration et exploitation des logs applicatifs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06-metrics-architecture.html">5.7. Métriques applicatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07-deployment-tooling.html">5.8. Outillage de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-consul.html">5.9. Service registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10-it-services.html">5.10. Dépendances aux services d’infrastructures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15-services.html">5.11. Composants déployés</a></li>
<li class="toctree-l2"><a class="reference internal" href="../20-deployment-guidelines.html">5.12. Guidelines de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../25-resources.html">5.13. Eléments de dimensionnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../90-flux-all.html">5.14. Matrice des flux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../securite/_toc.html">6. Sécurité</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../include/_toc.html">7. Architecture détaillée</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Architecture</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../_toc.html">5. Architecture technique / exploitation</a> &raquo;</li>
        
          <li><a href="_toc.html">5.1. Principes d’architecture technique</a> &raquo;</li>
        
      <li>5.1.6. Suivi de l’état du système</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/archi-exploit-infra/principes/40-principles-monitoring.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="suivi-de-l-etat-du-systeme">
<span id="principles-monitoring"></span><h1>5.1.6. Suivi de l’état du système<a class="headerlink" href="#suivi-de-l-etat-du-systeme" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="api-de-supervision">
<h2>5.1.6.1. API de supervision<a class="headerlink" href="#api-de-supervision" title="Lien permanent vers ce titre">¶</a></h2>
<p>Chaque composant VITAM doit exposer en interne de la plate-forme, sur un port dédié, les API REST suivantes :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/admin/v1/status</span></code> : statut simple, renvoyant un statut de fonctionnement incluant des informations techniques sur l’état actuel du composant. Un exemple d’utilisation typique est l’intégration à un outil de supervision ou à un élément actif tiers (ex: load-balancer, …) . L’appel doit être peu coûteux.</li>
<li><code class="docutils literal notranslate"><span class="pre">/admin/v1/autotest</span></code> : autotest du composant, lançant un test de présence des différentes resources requises par le composant et renvoyant un statut d’état de ces resources.</li>
<li><code class="docutils literal notranslate"><span class="pre">/admin/v1/version</span></code> : statut renvoyant les informations relatives à la version.</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">D’autres interfaces de status dédiées aux applications métier sont disponibles sur les composants externes (zone accès) ; elles sont décrites dans la documentation d’API de VITAM.</p>
</div>
<p>Ces API sont exposées sur un réseau d’administration qui peut être différent du réseau de service.</p>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">D’autres API d’administration sont disponibles selon les composants ; se reporter au paragraphe idoine dans <a class="reference internal" href="../15-services.html"><span class="doc">la liste des services</span></a></p>
</div>
</div>
<div class="section" id="metriques">
<h2>5.1.6.2. Métriques<a class="headerlink" href="#metriques" title="Lien permanent vers ce titre">¶</a></h2>
<p>Chaque composant VITAM doit permettre l’envoi d’un certain nombre de métriques soit dans les logs de l’application, soit dans une base de données Elasticsearch ; ces métriques sont de 3 types différents :</p>
<ul>
<li><p class="first">Les métriques relatives aux statistiques d’accès des interfaces REST :</p>
<blockquote>
<div><ul>
<li><p class="first">Fréquence d’appel sur les dernière 1, 5 et 15 minutes ;</p>
</li>
<li><p class="first">Nombre de résultats selon le code HTTP renvoyé ;</p>
</li>
<li><p class="first">Avec un sampling des temps de réponses basé sur les 5 dernières minutes :</p>
<blockquote>
<div><ul class="simple">
<li>Le minimum</li>
<li>Le maximum</li>
<li>La moyenne</li>
<li>L’écart type</li>
<li>Le 95 <sup>ème</sup> percentile</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Les métriques relatives à l’usage de la JVM :</p>
<blockquote>
<div><ul class="simple">
<li>Consommation mémoire des différentes zones mémoire interne de la JVM</li>
<li>Etat des threads utilisés</li>
<li>Statistiques d’appels du/des ramasse-miette(s)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Les métriques métier, relatives à des cas d’utilisation métier (archivistes) du système.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">VITAM propose un sous-système dédié à la collecte et exploitation des métriques qui s’appuie sur les composants également utilisés pour la gestion centralisée des logs ; il est décrit plus en détails dans <a class="reference internal" href="../06-metrics-architecture.html"><span class="doc">la section dédiée</span></a>.</p>
</div>
</div>
<div class="section" id="logs">
<h2>5.1.6.3. Logs<a class="headerlink" href="#logs" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="protocoles-syslog">
<h3>5.1.6.3.1. Protocoles : syslog<a class="headerlink" href="#protocoles-syslog" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les protocoles d’emission de logs (entre un émetteur de logs et l’agent syslog local) possibles sont :</p>
<blockquote>
<div><ul class="simple">
<li>Le format syslog unix (écriture dans <code class="docutils literal notranslate"><span class="pre">/dev/log</span></code>), privilégié pour les messages émis par les scripts shell (protocole par défaut de la commande logger) .</li>
<li>Le format syslog udp (sans garantie d’acheminement, vers l’adresse <code class="docutils literal notranslate"><span class="pre">localhost</span></code>), privilégié pour les messages émis par les applications.</li>
</ul>
</div></blockquote>
<p>Dans les deux cas, et en se basant sur la RFC 5424, les paramètres imposés sur les messages syslog sont les suivants :</p>
<ul class="simple">
<li>Facility : <code class="docutils literal notranslate"><span class="pre">local0</span></code> (id 21) ; Vitam n’utilise pas les facilités «&nbsp;système&nbsp;» mais seulement les facilités local0 à local3.</li>
<li>Message Severity : dans le cas des applications Java, le mapping de sévérité suit le mapping imposé par <a class="reference external" href="http://logback.qos.ch/manual/appenders.html#SyslogAppender">l’appender logback SyslogAppender</a> (<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> 7, <code class="docutils literal notranslate"><span class="pre">INFO</span></code> 6, <code class="docutils literal notranslate"><span class="pre">WARN</span></code> 4 et <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 3).</li>
<li>Le positionnement du champ <code class="docutils literal notranslate"><span class="pre">APP-NAME</span></code> correspondant à l’application ; pour les applications VITAM, ce champ doit être égal à l’id du composant vitam (devant respecter le pattern <code class="docutils literal notranslate"><span class="pre">vitam-.*</span></code>). Pour les scripts, il doit être égal au nom du script (comportement par défaut pour un logger unix).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A noter que l’instance de l’application n’est pas mise dans le champ <code class="docutils literal notranslate"><span class="pre">APP-NAME</span></code> car du fait des principes de packaging, il ne peut y avoir qu’une seule instance d’application par hôte et le tuple (<code class="docutils literal notranslate"><span class="pre">HOSTNAME</span></code>, <code class="docutils literal notranslate"><span class="pre">APPNAME</span></code>) identifie bien l’application.</p>
</div>
</div>
<div class="section" id="types-de-log">
<h3>5.1.6.3.2. Types de log<a class="headerlink" href="#types-de-log" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les logs se divisent en plusieurs catégories :</p>
<div class="section" id="logs-applicatifs">
<h4>5.1.6.3.2.1. Logs applicatifs<a class="headerlink" href="#logs-applicatifs" title="Lien permanent vers ce titre">¶</a></h4>
<p>Les logs applicatifs couvrent les logs produits par le code des applications ; ils permettent de suivre un certain nombre d’évènements techniques et métiers remontés par les applications.</p>
<p>Leur format est imposé par VITAM (se reporter au <a class="reference internal" href="../../introduction.html#term-dex"><span class="xref std std-term">DEX</span></a> pour le format exact des logs).</p>
<p>Par défaut, ces logs sont déposés de deux manières différentes :</p>
<ul class="simple">
<li>des fichiers de logs (dans le répertoire de log dédié pour chaque composant (Cf. la <a class="reference internal" href="02-principles-users-rights.html"><span class="doc">section dédiée</span></a>)). Ils sont configurés pour rouler quotidiennement, avec une taille globale maximale ; le pattern des fichiers est <code class="docutils literal notranslate"><span class="pre">&lt;service_id&gt;.%d.log</span></code> (<code class="docutils literal notranslate"><span class="pre">%d</span></code> étant remplacé par <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>).</li>
<li>le service syslog local, en utilisant le protocole syslog UDP (port 514 ; format défini dans la RFC3164).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">VITAM propose un sous-système dédié à la collecte et exploitation des logs qui s’appuie sur ce service syslog local pour l’acquisition des logs ; il est décrit plus en détails dans <a class="reference internal" href="../05-logs-architecture.html"><span class="doc">la section dédiée</span></a>.</p>
</div>
<p>La corrélation des logs afférents à la même requête métier mais distribuée au sein des différents composants du système est réalisée grâce au positionnement d’un identifiant de requête au niveau des briques externes. Cet identifiant se retrouve dans tous les logs applcatifs, et est propagé entre les composants via l’usage du header HTTP <code class="docutils literal notranslate"><span class="pre">X-REQUEST-ID</span></code>.</p>
<p>Enfin, ces logs applicatifs transportent également les alertes émises par les composants VITAM, et notamment les alertes de sécurité.</p>
</div>
<div class="section" id="logs-du-garbage-collector-java">
<h4>5.1.6.3.2.2. Logs du garbage collector Java<a class="headerlink" href="#logs-du-garbage-collector-java" title="Lien permanent vers ce titre">¶</a></h4>
<p>Ces logs permettent de faire une analyse fine du fonctionnement interne de la JVM à travers les informations d’exécution des différents garbage collectors.</p>
<p>Leur format est imposé par l’implémentation de la <a class="reference internal" href="../../introduction.html#term-jvm"><span class="xref std std-term">JVM</span></a>.</p>
<p>Ils sont déposés dans des fichiers (dans le répertoire de log dédié pour chaque composant (Cf. la <a class="reference internal" href="02-principles-users-rights.html"><span class="doc">section dédiée</span></a>)) : <code class="docutils literal notranslate"><span class="pre">gc/gc.log</span></code> pour le fichier courant, <code class="docutils literal notranslate"><span class="pre">gc.log.&lt;n&gt;</span></code> pour les fichiers roulés (avec <code class="docutils literal notranslate"><span class="pre">&lt;n&gt;</span></code> le numéro du fichier, sur base 0). Le roulement est basé sur une limite de taille unitaire des fichiers, avec un nombre maximal de fichiers.</p>
</div>
<div class="section" id="logs-d-acces">
<h4>5.1.6.3.2.3. Logs d’accès<a class="headerlink" href="#logs-d-acces" title="Lien permanent vers ce titre">¶</a></h4>
<p>Les logs d’accès sont placés sur tous les services métiers VITAM ; ils permettent de tracer de manière fine (avec une granularité à la requête) les appels de ces services.</p>
<p>Leur format est imposé par VITAM (se reporter au <a class="reference internal" href="../../introduction.html#term-dex"><span class="xref std std-term">DEX</span></a> pour le format exact des logs).</p>
<p>Ces logs sont déposés dans des fichiers (dans le répertoire de log dédié pour chaque composant (Cf. la <a class="reference internal" href="02-principles-users-rights.html"><span class="doc">section dédiée</span></a>)). Ils sont configurés pour rouler quotidiennement, avec une taille globale maximale ; le pattern des fichiers est <code class="docutils literal notranslate"><span class="pre">accesslog-&lt;service_id&gt;.%d.log</span></code> (<code class="docutils literal notranslate"><span class="pre">%d</span></code> étant remplacé par <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>).</p>
</div>
</div>
</div>
<div class="section" id="suivi-de-l-etat-de-deploiement">
<h2>5.1.6.4. Suivi de l’état de déploiement<a class="headerlink" href="#suivi-de-l-etat-de-deploiement" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le suivi de l’état de déploiement se fait au travers de l’outil de déploiement utilisé.</p>
</div>
<div class="section" id="integration-a-un-systeme-de-monitoring-tiers">
<h2>5.1.6.5. Intégration à un système de monitoring tiers<a class="headerlink" href="#integration-a-un-systeme-de-monitoring-tiers" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’intégration à un système de monitoring tiers est possible via les points d’extension suivants :</p>
<ul class="simple">
<li>Les API REST de monitoring des composants Java</li>
<li>L’utilisation des composants standards de monitoring des COTS utilisés</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="50-principles-technical-administration.html" class="btn btn-neutral float-right" title="5.1.7. Administration technique" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="30-principles-deployment.html" class="btn btn-neutral float-left" title="5.1.5. Déploiement de la solution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>