<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.22. Procédure d’exploitation suite à la création ou la modification d’une ontologie &mdash; Documentation VITAM - Documentation d&#39;exploitation 7.0.1</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="5.24. Procédure d’exploitation pour la mise en pause forcée d’une opération" href="60-forcedpause.html" />
    <link rel="prev" title="5.21. Audit comparatif entre 2 offres de stockage miroirs" href="45-offerdiff.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VITAM - Documentation d'exploitation
              <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                7.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">5. Exploitation globale</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10-accessgrants.html">5.1. Gestion des accès</a></li>
<li class="toctree-l2"><a class="reference internal" href="100-auditDataConsistency.html">5.2. Audit de cohérence de données entre MongoDb et Elasticsearch</a></li>
<li class="toctree-l2"><a class="reference internal" href="101-objectGroup-blackList-fields-in-search.html">5.3. Configuration des champs ObjectGroup devant être exclus de la recherche</a></li>
<li class="toctree-l2"><a class="reference internal" href="11-adminportals.html">5.4. Portails d’administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="12-appconfig.html">5.5. Paramétrage &amp; configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="14-miseajour.html">5.6. Déploiement / mises à jour</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-maintenance.html">5.7. Interruption / maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="16-backup_restore.html">5.8. Sauvegarde / restauration</a></li>
<li class="toctree-l2"><a class="reference internal" href="17-backup_restore_gros_volume.html">5.9. Sauvegarde et restauration de mongodb gros volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="18-securityprofile.html">5.10. Gestion des profils de sécurité</a></li>
<li class="toctree-l2"><a class="reference internal" href="19-certificatpersonae.html">5.11. Certificats personae</a></li>
<li class="toctree-l2"><a class="reference internal" href="19-grouped_tenants.html">5.12. Gestion des indexes Elasticseach dans un contexte massivement multi-tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-batchs.html">5.13. Batchs et traitements</a></li>
<li class="toctree-l2"><a class="reference internal" href="21-graphstorage.html">5.14. Sauvegarde des données graphe (Log shipping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-graphcompute.html">5.15. Recalcul des données graphe</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-siegfried_signature.html">5.16. Montée de version du fichier de signature de Siegfried</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-griffins.html">5.17. Griffins</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-reconstruction.html">5.18. Reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-pra.html">5.19. Plan de Reprise d’Activité (<code class="docutils literal notranslate"><span class="pre">PRA</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="40-resynchronisation.html">5.20. Resynchronisation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="45-offerdiff.html">5.21. Audit comparatif entre 2 offres de stockage miroirs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.22. Procédure d’exploitation suite à la création ou la modification d’une ontologie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creation-d-une-ontologie">5.22.1. Création d’une ontologie</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changement-de-type-d-une-ontologie-existante">5.22.2. Changement de type d’une ontologie existante</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#l-ontologie-externe-suite-a-la-montee-de-version-de-vitam">5.23. L’ontologie externe suite à la montée de version de <code class="docutils literal notranslate"><span class="pre">VITAM</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="60-forcedpause.html">5.24. Procédure d’exploitation pour la mise en pause forcée d’une opération</a></li>
<li class="toctree-l2"><a class="reference internal" href="60-reindexation.html">5.25. Réindexation</a></li>
<li class="toctree-l2"><a class="reference internal" href="65-ingest-cleanup.html">5.26. Nettoyage des ingests incomplets</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-dip-cleanup.html">5.27. Suppression des DIP et des fichiers de transfert</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-certificate-revocation.html">5.28. Procédure d’exploitation pour la révocation des certificats SIA et Personae</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-offer-activation.html">5.29. Activation/désactivation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-environment-cleaning.html">5.30. Nettoyage d’un environnement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">12. Annexes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'exploitation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="_toc.html">5. Exploitation globale</a></li>
      <li class="breadcrumb-item active">5.22. Procédure d’exploitation suite à la création ou la modification d’une ontologie</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/50-ontologies.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="procedure-d-exploitation-suite-a-la-creation-ou-la-modification-d-une-ontologie">
<h1>5.22. Procédure d’exploitation suite à la création ou la modification d’une ontologie<a class="headerlink" href="#procedure-d-exploitation-suite-a-la-creation-ou-la-modification-d-une-ontologie" title="Lien permanent vers ce titre">¶</a></h1>
<p>Au préalable à la création ou à la modification d’une ontologie, les index Elasticsearch correspondant aux ontologies doivent être créés ou mis à jour.</p>
<div class="section" id="creation-d-une-ontologie">
<h2>5.22.1. Création d’une ontologie<a class="headerlink" href="#creation-d-une-ontologie" title="Lien permanent vers ce titre">¶</a></h2>
<p>Suite à la création d’une nouvelle ontologie, les index Elasticsearch doivent être mis à jour selon la procédure suivante:</p>
<ul class="simple">
<li>Dans le cas d’une création, il suffit de créer un nouveau mapping dans les index concernés.</li>
</ul>
<p>Ex : Ajout d’une propriété Licence dans tous les index unit (unit* signifiant tous les index unit unit_0, unit_1 etc …)</p>
<p>Commandes à lancer sur une des partitions hébergeant le cluster elasticsearch «&nbsp;data&nbsp;» :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPUT <span class="s2">&quot;http://localhost:9200/unit*/_mapping/typeunique?update_all_types&quot;</span> -d<span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">      &quot;properties&quot;: {</span>
<span class="s1">    &quot;Licence&quot;: {</span>
<span class="s1">      &quot;type&quot;: &quot;text&quot;</span>
<span class="s1">    }</span>
<span class="s1">      }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p>Pour verifier sur un ou tous les index <code class="docutils literal notranslate"><span class="pre">unit</span></code> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XGET <span class="s2">&quot;http://localhost:9200/unit_0/_mapping/?pretty=true&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XGET <span class="s2">&quot;http://localhost:9200/unit*/_mapping/?pretty=true&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="changement-de-type-d-une-ontologie-existante">
<h2>5.22.2. Changement de type d’une ontologie existante<a class="headerlink" href="#changement-de-type-d-une-ontologie-existante" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans ce cas, le changement de type dans elasticsearch n’est pas possible. Il faut donc créer un nouvel index ElasticSearch avec un nouveau mapping, puis reindexer l’ancien index dans ce dernier.</p>
<p>On récupère d’abord l’ancien index</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XGET <span class="s1">&#39;localhost:9200/unit_1/_mapping?pretty=true&#39;</span>
</pre></div>
</div>
<p>On créé un fichier json et on y copie les données obtenues ( ne conserver que la balise «&nbsp;mappings&nbsp;» : { …} et son contenu).
On modifie le mapping en changeant le type des propriétés choisies.
On créé un nouvel index on lui passant en paramètre le fichier du nouveau mapping .</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPUT <span class="s2">&quot;http://localhost:9200/new_unit_1&quot;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> -d @newmapping.json
</pre></div>
</div>
<p>Verifier l’index :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XGET <span class="s1">&#39;localhost:9200/new_unit_1/_mapping/&#39;</span>
</pre></div>
</div>
<p>On reindexe unit_1 vers le nouvel index new_unit_1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPOST <span class="s1">&#39;localhost:9200/_reindex&#39;</span> -H <span class="s1">&#39;Content-Type:application/json&#39;</span> -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;source&quot; : {</span>
<span class="s1">        &quot;index&quot; : &quot;unit_1&quot;</span>
<span class="s1">    },</span>
<span class="s1">    &quot;dest&quot; : {</span>
<span class="s1">        &quot;index&quot; : &quot;new_unit_1&quot;,</span>
<span class="s1">        &quot;version_type&quot;: &quot;external&quot;</span>
<span class="s1">    }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p>On efface l’alias de l’ancien index unit_1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XDELETE <span class="s1">&#39;localhost:9200/unit_1/_alias/unit_1&#39;</span>
</pre></div>
</div>
<p>et on l’affecte au nouvel index new_unit_1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPUT <span class="s1">&#39;localhost:9200/new_unit_1/_alias/unit_1&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">les index elasticsearch de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> sont créés par tenant. Il faudra refaire l’opération ci-dessus pour chaque tenant.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">En cas du changement des mappings elasticsearch, il faudra veiller à ce qu’ils soient en cohérence avec l’ontologie.</p>
</div>
</div>
</div>
<div class="section" id="l-ontologie-externe-suite-a-la-montee-de-version-de-vitam">
<h1>5.23. L’ontologie externe suite à la montée de version de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a><a class="headerlink" href="#l-ontologie-externe-suite-a-la-montee-de-version-de-vitam" title="Lien permanent vers ce titre">¶</a></h1>
<p>Lors de la montée de version, les ontologies externes en cours d’exploitation par <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> ne sont pas touchées et seront mergées avec les ontologies internes de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>.</p>
<p>Le fichier du référentiel de l’ontologie se trouve désormais dans <code class="docutils literal notranslate"><span class="pre">environments/ontology/VitamOntology.json</span></code></p>
<p>La procédure de merge manuelle du référentiel de l’ontologie avant chaque montée de version n’est plus nécessaire. Depuis la version 3.4.0 de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, le vocabulaire externe de l’ontologie est géré automatiquement avec le vocabulaire interne. Cependant, il est nécessaire de s’assurer que le merge est effectivement possible sans conflits.</p>
<p>Lors du lancement du procédure de mise à jour de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, une phase de vérification devra être effectuée pour détecter des éventuels conflits entre les vocabulaires internes et externes.</p>
<p>Cette vérification s’exécute avant de charger l’ontologie externe afin de préserver celle existante en cas de conflit de merge.</p>
<p>Ainsi, il est recommandé, avant de procéder à une montée de version, de jouer le script ansible : <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/check_ontologies.yml</span></code></p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">En cas d’échec lors de l’exécution de ce playbook, cela signifie qu’il y a des conflits entre les deux vocabulaires. L’exploitant devra alors adapter l’ontology externe afin de résoudre ces conflits.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Dans le cadre d’une montée de version, se référer également au <a class="reference internal" href="../introduction.html#term-dmv"><span class="xref std std-term">DMV</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="45-offerdiff.html" class="btn btn-neutral float-left" title="5.21. Audit comparatif entre 2 offres de stockage miroirs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="60-forcedpause.html" class="btn btn-neutral float-right" title="5.24. Procédure d’exploitation pour la mise en pause forcée d’une opération" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>