<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.4.2.3. Configuration jetty &mdash; Documentation VITAM - Architecture 6.rc.1</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
      <script>
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'6.rc.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="next" title="7.4.2.5. Schéma de certificats et d’authentification" href="certs-auth.html" />
    <link rel="prev" title="7.4.2.2. GUID" href="GUID.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> VITAM - Architecture<img src="../../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                6.rc.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/_toc.html">3. Vue d’ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archi-applicative/_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archi-exploit-infra/_toc.html">5. Architecture technique / exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../securite/_toc.html">6. Sécurité</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../_toc.html">7. Architecture détaillée</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../access/_toc.html">7.1. Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../batch-report/_toc.html">7.2. Batch-report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collect/_toc.html">7.3. Access</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_toc.html">7.4. Common</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../fonctionnelle/index.html">7.4.1. Architecture Fonctionnelle</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">7.4.2. Architecture Technique</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="introduction.html">7.4.2.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="GUID.html">7.4.2.2. GUID</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">7.4.2.3. Configuration jetty</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gestion-des-handlers">7.4.2.4. Gestion des Handlers :</a></li>
<li class="toctree-l4"><a class="reference internal" href="certs-auth.html">7.4.2.5. Schéma de certificats et d’authentification</a></li>
<li class="toctree-l4"><a class="reference internal" href="format-identifier.html">7.4.2.6. Common format identification</a></li>
<li class="toctree-l4"><a class="reference internal" href="messages.html">7.4.2.7. Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="messages.html#messages-logbook">7.4.2.8. Messages Logbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="requestID.html">7.4.2.9. Request ID</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../securite/index.html">7.4.3. Securite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../functional-administration/_toc.html">7.5. Functional administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ihm-demo/_toc.html">7.6. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ihm-recette/_toc.html">7.7. IHM recette</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ingest/_toc.html">7.8. Ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-security/_toc.html">7.9. Security-Internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logbook/_toc.html">7.10. Logbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metadata/_toc.html">7.11. Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../processing/_toc.html">7.12. Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scheduler/_toc.html">7.13. Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/_toc.html">7.14. Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical-administration/_toc.html">7.15. Technical administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../worker/_toc.html">7.16. Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../workspace/_toc.html">7.17. Workspace</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VITAM - Architecture</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../_toc.html">7. Architecture détaillée</a></li>
          <li class="breadcrumb-item"><a href="../_toc.html">7.4. Common</a></li>
          <li class="breadcrumb-item"><a href="index.html">7.4.2. Architecture Technique</a></li>
      <li class="breadcrumb-item active">7.4.2.3. Configuration jetty</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/include/common/technique/jetty.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="configuration-jetty">
<h1>7.4.2.3. Configuration jetty<a class="headerlink" href="#configuration-jetty" title="Lien permanent vers ce titre">¶</a></h1>
<p>Le besoin est de pouvoir fournir la capacité de configurer de manière programmatique Jetty. On peut penser aux besoins suivants :</p>
<ol class="arabic">
<li><p class="first">Choisir le port de connection</p>
</li>
<li><p class="first">Choisir le connecteur HTTP/HTTPS que l’on désire utiliser</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Paramètres communs aux connecteurs HTTP et HTTPS</dt>
<dd><ul class="first last">
<li>Taille des pools de thread (min,max nombre de threads)</li>
<li>Taille du backlog (nombre de connections en attente d’un thread disponible)</li>
<li>Différents timeout</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Paramétres spécifiques à la couche TLS</dt>
<dd><ul class="first last">
<li>Paramétres liés aux keystore (emplacement, mot de passe keystore, mot de passe des clés privées)</li>
<li>Paramétres liés aux trustore (idem keystore)</li>
<li>Paramétres liés à TLS (protocoles autorisés, ciphers autorisés, options TLS)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="gestion-des-handlers">
<h1>7.4.2.4. Gestion des Handlers :<a class="headerlink" href="#gestion-des-handlers" title="Lien permanent vers ce titre">¶</a></h1>
<p>Pour la gestion de ces différents paramètres, on utilise le système de configuration en “Inversion of Control” de Jetty.
Un exemple de configuration est disponible à l’adresse suivante : <a class="reference external" href="https://gist.github.com/gustavosoares/1438086">https://gist.github.com/gustavosoares/1438086</a></p>
<dl class="docutils">
<dt>Cette solution présente les avantages suivants :</dt>
<dd>une gestion relativement souple de la configuration (la prise en compte du binding d’un paramètre ne nécessite pas de coder le binding)
un exploitant qui connaît déjà Jetty sera en terrain connu de configuration</dd>
</dl>
<p>Parmi les choix à faire, il faut décider si on limite la configuration par fichier xml à la configuration “serveur d’application” ou si on pousse à la configuration des servlet .</p>
<p>L’important est d’utiliser la classe XMLConfiguration (package maven jetty-xml) dont la javadoc est disponible à l’adresse : <a class="reference external" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/xml/XmlConfiguration.html">http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/xml/XmlConfiguration.html</a>
Pour la mise en oeuvre de ce composant, voici le pseudo code :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">URL</span> <span class="n">jettyConfigFileURL</span> <span class="o">=</span> <span class="n">PropertiesUtils</span><span class="p">.</span><span class="na">findFile</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fichier</span><span class="o">&gt;</span><span class="p">).</span><span class="na">toURI</span><span class="p">().</span><span class="na">toURL</span><span class="p">();</span>
<span class="n">Server</span> <span class="n">jettyServer</span> <span class="o">=</span> <span class="p">(</span><span class="n">Server</span><span class="p">)</span> <span class="k">new</span> <span class="n">XmlConfiguration</span><span class="p">(</span><span class="n">jettyConfigFileURL</span><span class="p">).</span><span class="na">configure</span><span class="p">();</span>
<span class="o">&lt;</span><span class="n">Ajout</span> <span class="n">RequestHandler</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Ajout</span> <span class="n">ContextHandler</span><span class="o">&gt;</span>
<span class="n">jettyServer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="p">...</span>
</pre></div>
</div>
<p>avec fichier qui est défini de la manière suivante :</p>
<blockquote>
<div><ul class="simple">
<li>Si Le fichier passé en 1er argument du module (ex: access.conf) contient une variable nommé «&nbsp;jettyConfig&nbsp;» alors le serveur cherche dans son répertoire un configuration un fichier du nom de la valeur de jettyConfig .</li>
<li>Si la variable jettyConfig n’existe ou s’il n’existe pas de fichier correspond à la valeur de la variable “jettyConfig” , le serveur cherche un fichier «&nbsp;jetty-vitam.xml&nbsp;» dans le répertoire de configuration</li>
<li>Si les 2 premiers cas échoue, le serveur s’arrête en erreur</li>
</ul>
</div></blockquote>
<p>A noter : pour les tests Unitaires, comme il n’y a pas de besoins de tuning particulier (pour l’instant) et qu’il y a un besoin d’avoir le port variable, on conserve la méthode actuelle pour démarrer les serveur (la méthode actuelle est de faire un (new Server (port) de la classe org.eclipse.jetty.server.Server).</p>
<dl class="docutils">
<dt>Les modules concernées sont :</dt>
<dd><ul class="first simple">
<li>access-rest</li>
<li>ihm-demo-web-application</li>
<li>ingest-external-rest</li>
<li>ingest-internal-rest</li>
<li>metadata-rest</li>
</ul>
<p class="last">TODO :
* functional-administration-rest
* logbook-rest
* processing-management
* storage-engine-server
* storage-offer-default
* workspace-rest</p>
</dd>
</dl>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="GUID.html" class="btn btn-neutral float-left" title="7.4.2.2. GUID" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="certs-auth.html" class="btn btn-neutral float-right" title="7.4.2.5. Schéma de certificats et d’authentification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>