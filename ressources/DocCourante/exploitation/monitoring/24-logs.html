

<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>6.3. Logs &mdash; Documentation VITAM - Documentation d&#39;exploitation 5.0</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'5.0',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="6.4. Audit" href="25-audit.html" />
    <link rel="prev" title="6.2. API de de supervision" href="22-status-api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VITAM - Documentation d'exploitation
          

          
            
            <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/_toc.html">5. Exploitation globale</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">6. Suivi de l’état du système</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10-veille.html">6.1. Veille et patchs sécurité</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-status-api.html">6.2. API de de supervision</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.3. Logs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parametrage-des-regles-de-log">6.3.1. Paramétrage des règles de log</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retention-des-index-sous-elasticsearch-log">6.3.2. Rétention des index sous elasticsearch-log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="25-audit.html">6.4. Audit</a></li>
<li class="toctree-l2"><a class="reference internal" href="26-capacity_planning.html">6.5. Gestion de la capacité</a></li>
<li class="toctree-l2"><a class="reference internal" href="27-security_sup.html">6.6. Suivi de l’état de sécurité</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-alerting.html">6.7. Alerting</a></li>
<li class="toctree-l2"><a class="reference internal" href="40-workflow.html">6.8. Suivi des Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="41-logbook-consistency.html">6.9. Cohérence des journaux</a></li>
<li class="toctree-l2"><a class="reference internal" href="50-timers-systems.html">6.10. Liste des <cite>timers</cite> systemd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">12. Annexes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'exploitation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="_toc.html">6. Suivi de l’état du système</a> &raquo;</li>
        
      <li>6.3. Logs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/monitoring/24-logs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="logs">
<h1>6.3. Logs<a class="headerlink" href="#logs" title="Lien permanent vers ce titre">¶</a></h1>
<p>La solution logicielle <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> propose une solution ouverte, au choix de l’exploitant. Ce dernier peut, à l’installation, comme à la mise à jour de la solution logicielle <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, choisir d’utiliser sa propre solution de «&nbsp;regroupement&nbsp;» des logs ou la solution embarquée dans la solution logicielle <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>.</p>
<p>Dans le cas de la solution embarquée, celle-ci se décompose en :</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">rsyslog</span></code> ou <code class="docutils literal notranslate"><span class="pre">syslog-ng</span></code> (choix à l’installation, se référer au <a class="reference internal" href="../introduction.html#term-din"><span class="xref std std-term">DIN</span></a>) déployé sur les machines «&nbsp;applicatives&nbsp;» <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> et les envois applicatifs syslog vers un serveur de centralisation de logs (via <code class="docutils literal notranslate"><span class="pre">facility</span> <span class="pre">local0</span></code>)</p>
</li>
<li><p class="first">un serveur de centralisation de logs, comprenant :</p>
<blockquote>
<div><ul class="simple">
<li>un mono-noeud (au minimum, ou multi-noeuds) Elasticsearch</li>
<li>un moteur logstash, parsant les messages VITAM</li>
<li>un afficheur de rendu/aggrégation de données Kibana dédié</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">Les principes et implémentations du système de gestion de logs inclus dans VITAM sont décrits plus en détail dans le DAT.</p>
</div>
<div class="section" id="parametrage-des-regles-de-log">
<h2>6.3.1. Paramétrage des règles de log<a class="headerlink" href="#parametrage-des-regles-de-log" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est conseillé de modifier le paramétrage du rolling des fichiers de log afin d’éviter une saturation des volumes disque. En fonction de la topologie de déploiement des composants vitam, il faut s’assurer que les quantités maximales de fichiers de log (en nombre et taille) ne dépassent pas la taille du disque, en décomptant la volumétrie évaluée aux données ainsi qu’aux fichiers temporaires.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Dans le cas de la colocalisation des composants Vitam, il faut prendre en compte les quantités maximales par composant, afin de paramétrer des quantités cohérentes pour ne pas dépasser la taille du disque.</p>
</div>
<p>Pour cela, il faut éditer le fichier <code class="docutils literal notranslate"><span class="pre">deployment/environments/group_vars/all/vitam_vars.yml</span></code> et définir, pour chaque composant, les paramètres suivants :</p>
<blockquote>
<div><ul class="simple">
<li>logback_rolling_policy: { true | false } active le rolling des fichiers de logs (applicatif et accès), avec la politique logback TimeBasedRollingPolicy (voir doc <code class="docutils literal notranslate"><span class="pre">&lt;http://logback.qos.ch/manual/appenders.html#RollingFileAppender&gt;</span></code>) dont les paramètres sont définis ci-après. Si ce paramètre est désactivé, les logs ne tournent pas et leur taille augmente à l’infini (cas ou l’implémentation de rolling est géré avec un composant externe à Vitam). La valeur par défaut est true.</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">Pour les logs applicatif :</p>
<blockquote>
<div><ul>
<li><p class="first">logback_max_file_size: { \d*[KB|MB|GB] } spécifie le seuil pour lequel une fois atteint, le fichier tourne. Le nom du fichier de log est suffixé par un index. La valeur par défaut est «&nbsp;10MB&nbsp;».</p>
</li>
<li><dl class="first docutils">
<dt>logback_total_size_cap: {struct yml}:</dt>
<dd><blockquote class="first">
<div><p>&lt;type&gt;: { file | security | offer_tape | offer_tape_backup | offersync }: spécifie le type de fichier de log (correspond à un appender logback). Tous les composants Vitam dispose au moins des types file et security. Les 3 autres types sont disponibles pour le composant offer.</p>
</div></blockquote>
<p>Pour chacun des types spécifiés dans la structure yml, les paramètres suivants sont éditables :</p>
<blockquote class="last">
<div><ul class="simple">
<li>history_days: { \d* } spécifie le nombre total de fichiers conservés. Ce nombre total est équivalent en nombre de jour conservé lorsque le fichier ne tourne pas dans une journée (lorsqu’il n’a pas atteint la limite logback_max_file_size). Cette équivalence est induite par le mécanisme interne au framework logback qui utilise le pattern date spécifié dans le nom du fichier (cf. documentation officielle pour plus de détail). Lorsqu’un fichier tourne et que le nombre de fichier présent est atteint, le premier fichier qui a été tourné est supprimé. La valeur par défaut est 10.</li>
<li>totalsize: { \d*[KB|MB|GB] } spécifie la taille totale des fichiers de logs. Lorsque la taille totale des fichiers présents dépasse la taille paramétrée, le premier fichier qui a été tourné est supprimé. La valeur par défaut est 5GB.</li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
<p>L’ensemble de ces paramètres sont utilisés lors de la génération du fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logback.xml</span></code> qui ne doit pas être édité manuellement, au risque de perdre les modifications au prochain déploiement.</p>
</div></blockquote>
</li>
<li><p class="first">Pour les logs d’accès http :</p>
<blockquote>
<div><ul class="simple">
<li>access_retention_days: { \d* } spécifie le nombre total de fichiers conservés. Ce nombre total est équivalent en nombre de jour conservé lorsque le fichier ne tourne pas dans une journée (lorsqu’il n’a pas atteint la limite logback_max_file_size). La valeur par défaut est 30.</li>
<li>access_total_size_cap: { \d*[KB|MB|GB] } spécifie la taille totale des fichiers de logs. Lorsque la taille totale des fichiers présents dépasse la taille paramétrée, le premier fichier qui a été tourné est supprimé. La valeur par défaut est 10GB.</li>
</ul>
<p>L’ensemble de ces paramètres sont utilisés lors de la génération du fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;service_id&gt;/logback-access.xml</span></code> qui ne doit pas être édité manuellement, au risque de perdre les modifications au prochain déploiement.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">La configuration de la durée de rétention des logs d’accès et/ou leur externalisation devra être ajustée pour respecter les contraintes légales en vigueur pour le système déployé.</p>
</div>
<p>D’autres paramètres sont disponibles :</p>
<ul>
<li><p class="first">Pour les logs de la jvm :</p>
<blockquote>
<div><ul class="simple">
<li>jvm_log: { true | false } : active les logs jvm en spécifiant les paramètres -XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile={vitam_folder_log}/jvm.log à la commande java. La valeur par défaut est false.</li>
</ul>
<p>Ce paramètre est utilisé lors de la génération du fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;service_id&gt;/java_opts</span></code> qui ne doit pas être édité manuellement, au risque de perdre les modifications au prochain déploiement.</p>
<p>L’activation de ces logs peut être nécessaire pour analyser un problème en rapport avec la jvm. Si besoin, d’autres paramètres sont disponibles, mais ne sont pas prévus dans les paramètres du fichier de déploiement. Il est possible toutefois de les ajouter temporairement au fichier généré. Par exemple, les paramètres des logs du GC sont:</p>
<ul>
<li><p class="first">Niveau de détail : activation des détails et des timestamps (paramètres JVM <code class="docutils literal notranslate"><span class="pre">-XX:+PrintGCDetails</span> <span class="pre">-XX:+PrintGCApplicationStoppedTime</span></code>)</p>
</li>
<li><p class="first">Roulement : le roulement des fichiers dépend de la taille des fichiers, avec un nombre de fichiers maximal ; il est défini comme suit :</p>
<blockquote>
<div><ul class="simple">
<li>Activation du roulement : paramètre JVM <code class="docutils literal notranslate"><span class="pre">-XX:+UseGCLogFileRotation</span></code></li>
<li>Nombre total de fichiers conservés : paramètre JVM <code class="docutils literal notranslate"><span class="pre">-XX:NumberOfGCLogFiles=10</span></code></li>
<li>Taille unitaire maximale d’un fichier de logs : paramètre JVM <code class="docutils literal notranslate"><span class="pre">-XX:GCLogFileSize=10M</span></code></li>
<li>Pattern des fichiers : dans le répertoire de logs de l’application (paramètre <code class="docutils literal notranslate"><span class="pre">-Xloggc:$LOG_FOLDER/gc.log</span></code>) pour le fichier courant ; après roulement, les fichiers sont nommés <code class="docutils literal notranslate"><span class="pre">gc.log.&lt;n&gt;</span></code> (avec <code class="docutils literal notranslate"><span class="pre">&lt;n&gt;</span></code> le numéro du fichier, sur base 0).</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Pour les logs applicatif :</p>
<blockquote>
<div><ul class="simple">
<li>performance_logger: { true | false } : active les traces qui consignent le temps d’exécution passé dans un composant ou traitement vitam. Ces métriques sont utilisées dans le dashboard Kibana <code class="docutils literal notranslate"><span class="pre">Metrics</span> <span class="pre">workflow</span> <span class="pre">vitam</span></code>. La valeur par défaut est false.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="retention-des-index-sous-elasticsearch-log">
<h2>6.3.2. Rétention des index sous elasticsearch-log<a class="headerlink" href="#retention-des-index-sous-elasticsearch-log" title="Lien permanent vers ce titre">¶</a></h2>
<p>Curator est l’outil défini dans <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> pour nettoyer les index du <em>cluster</em> elasticsearch de log.
Curator a été paramétré avec les informations contenues, durant l’installation, dans le fichier <code class="docutils literal notranslate"><span class="pre">cots_vars.yml</span></code>.</p>
<p>Pour les différents index dans le <em>cluster</em> Elasticsearch de log, deux paramètres sont définis pour Curator :</p>
<blockquote>
<div><ul class="simple">
<li>close: { \d* } nombre de jours avant clôture de l’index. La valeur par défaut est 7 (5 pour metricbeat/packetbeat).</li>
<li>delete: { \d* } nombre de jours avant suppression de l’index. La valeur par défaut est 30 (10 pour metricbeat/packetbeat).</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">concernant les index «&nbsp;logstash-*&nbsp;», il est recommandé de laisser une durée de rétention de 1 an dans un contexte de production.</p>
</div>
<p>Il est possible de modifier le comportement de curator. Pour ce faire, il faut :</p>
<ol class="arabic simple">
<li>modifier le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/cots_vars.yml</span></code></li>
<li>rejouer le playbook de déploiement, en ajoutant en fin de commande <code class="docutils literal notranslate"><span class="pre">--tags</span> <span class="pre">curator_logs</span></code>.</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="25-audit.html" class="btn btn-neutral float-right" title="6.4. Audit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="22-status-api.html" class="btn btn-neutral float-left" title="6.2. API de de supervision" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>