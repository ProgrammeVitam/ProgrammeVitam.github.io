<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>15.5. Idempotence &mdash; Documentation VITAM - Manuel de développement 8.1.0</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="16. Workspace" href="../workspace/_toc.html" />
    <link rel="prev" title="15.4. Worker Plugin" href="plugin.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VITAM - Manuel de développement
              <img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-environnement.html">Configuration de l’environnement de développement</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">Détails par composant</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../access/_toc.html">1. Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collect/_toc.html">2. Collect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common/_toc.html">3. Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functional-administration/_toc.html">4. Functional administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ihm-demo/_toc.html">5. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ihm-recette/_toc.html">6. IHM demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ingest/_toc.html">7. Ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-security/_toc.html">8. Security-Internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logbook/_toc.html">9. Logbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata/_toc.html">10. Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing/_toc.html">11. Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler/_toc.html">12. Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/_toc.html">13. Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technical-administration/_toc.html">14. Technical administration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">15. Worker</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">15.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="worker.html">15.2. Worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="worker-client.html">15.3. Worker Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.html">15.4. Worker Plugin</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">15.5. Idempotence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">15.5.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifications">15.5.2. Modifications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/_toc.html">16. Workspace</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../parallisation_tests.html">Parallélisation des tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugin-icu-elasticsearch.html">Plugin ICU Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gestion-database.html">Gestion des bases de données</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-ressource-rest.html">Ressources et clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devstack_vm.html">Création d’une machine de dev contenant <em>Swift</em></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Manuel de développement</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../_toc.html">Détails par composant</a></li>
          <li class="breadcrumb-item"><a href="_toc.html">15. Worker</a></li>
      <li class="breadcrumb-item active">15.5. Idempotence</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/include/worker/idempotent.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="idempotence">
<h1>15.5. Idempotence<a class="headerlink" href="#idempotence" title="Lien permanent vers ce titre">¶</a></h1>
<p>Pour permettre une bonne résilience de l’application Vitam, il est important de s’assurer de l’idem-potence des plugins et handlers exécutés lors des différents Workflows.
L’idem-potence veut dire que le résultat pour une opération que l’on exécute plusieurs fois, doit être le même que le résultalt pour une opération exécutée unitairement.</p>
<p>Ici on parle donc des différentes actions et étapes lancées durant les différents processus.</p>
<div class="section" id="introduction">
<h2>15.5.1. Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour pouvoir tester l’idem-potence du processus d’ingest, un test d’intégration a été mis en place et permet de lancer automatiquement un ingest en mode pas à pas.
Pour chaque étape, celle-ci sera relancée automatiquement. Son nombre d’exécution sera de 2.
Donc en toute logique, si un problème est rencontré (actuellement, il n’y a pas de problème) c’est que le développement en cours n’assure pas l’idem-potence.</p>
</div>
<div class="section" id="modifications">
<h2>15.5.2. Modifications<a class="headerlink" href="#modifications" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="handlerio">
<h3>15.5.2.1. HandlerIO<a class="headerlink" href="#handlerio" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le HandlerIO, classe permettant comme son nom l’indique de gérer les inputs et les outputs pour les différentes étapes, une méthode a été ajoutée : removeFolder.</p>
<p>Elle permet notamment de gérer le cas très précis de l’ExtractSeda.
Afin d’extraire du manifest, les différents ObjectGroup en une multitude de fichiers json dans un répertoire de travail commun, désormais on va tester l’existence de ce répertoire. Si ce répertoire existe déjà, cela signifie que cette étape a déjà été lancée (partiellement).
Pour garantir une bonne exécution de cette étape, on supprime le répertoire avec ce qu’il contient, afin de permettre de ne pas embarquer des morceaux de fichiers json faux qui auraient pu potentiellement être créés par une exécution précédente.</p>
</div>
<div class="section" id="handlers-plugins">
<h3>15.5.2.2. Handlers / plugins<a class="headerlink" href="#handlers-plugins" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="accessionregisteractionhandler">
<h4>15.5.2.2.1. AccessionRegisterActionHandler<a class="headerlink" href="#accessionregisteractionhandler" title="Lien permanent vers ce titre">¶</a></h4>
<p>Afin de veiller à ne pas enregistrer plusieurs fois la même opération dans la collection AccessionRegisterDetail, un test a été ajouté pour vérifier la présence ou non d’un précédent enregistrement.</p>
</div>
<div class="section" id="extractsedaactionhandler">
<h4>15.5.2.2.2. ExtractSedaActionHandler<a class="headerlink" href="#extractsedaactionhandler" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour ne pas dupliquer les fichiers générés lors de l’ExtractSeda, le répertoire contenant les outputs (fichiers json) est effacé au préalable, s’il existe déjà sur le Workspace.</p>
</div>
<div class="section" id="indexobjectgroupactionplugin">
<h4>15.5.2.2.3. IndexObjectGroupActionPlugin<a class="headerlink" href="#indexobjectgroupactionplugin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si l’on tente de sauvegarder plusieurs fois un même objectGroup dans Metadata, une exception est lancée par le composant Metadata.
Il convient dans ce cas de ne pas considérer cette exception comme FATAL pour le workflow. Un StatusCode particulier est retourné.</p>
</div>
<div class="section" id="indexunitactionplugin">
<h4>15.5.2.2.4. IndexUnitActionPlugin<a class="headerlink" href="#indexunitactionplugin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si l’on tente de sauvegarder plusieurs fois un même objectGroup dans Metadata, une exception est lancée par le composant Metadata.
Il convient dans ce cas de ne pas considérer cette exception comme FATAL pour le workflow. Un StatusCode particulier est retourné.</p>
</div>
<div class="section" id="storeobjectgroupactionplugin">
<h4>15.5.2.2.5. StoreObjectGroupActionPlugin<a class="headerlink" href="#storeobjectgroupactionplugin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si l’on tente de sauvegarder plusieurs fois un même objectGroup dans le Storage, lors de la deuxième exécution (si la première s’est bien terminée) la partie work ne sera plus présente dans le Json présent dans le workspace.
Il convient dans ce cas de ne pas considérer cette exception comme FATAL pour le workflow. Un StatusCode particulier est retourné.</p>
</div>
</div>
<div class="section" id="workerimpl">
<h3>15.5.2.3. WorkerImpl<a class="headerlink" href="#workerimpl" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans cette partie, on traite les retours des Handlers et des plugins. Si on se retrouve, dans le cadre d’actions distribuées, avec le StatusCode particulier (ALREADY_EXECUTED) alors on n’enregistre pas dans les LFC.
Cela permet d’éviter les doublons dans les LFC Unit et ObjectGroup.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plugin.html" class="btn btn-neutral float-left" title="15.4. Worker Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../workspace/_toc.html" class="btn btn-neutral float-right" title="16. Workspace" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>