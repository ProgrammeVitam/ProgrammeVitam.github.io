

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.7. Métriques applicatives &mdash; documentation VITAM - Architecture 1.0.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Recherche" href="../search.html"/>
    <link rel="top" title="documentation VITAM - Architecture 1.0.0" href="../index.html"/>
        <link rel="up" title="5. Architecture technique / exploitation" href="_toc.html"/>
        <link rel="next" title="5.8. Outillage de déploiement" href="07-deployment-tooling.html"/>
        <link rel="prev" title="5.6. Concentration et exploitation des logs applicatifs" href="05-logs-architecture.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> VITAM - Architecture
          

          
            
            <img src="../_static/logo_vitam.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/_toc.html">3. Vue d&#8217;ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../archi-applicative/_toc.html">4. Architecture applicative</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">5. Architecture technique / exploitation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="principes/_toc.html">5.1. Principes d&#8217;architecture technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="01-services-techniques.html">5.2. Services techniques fournis par la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-dependencies.html">5.3. Composants logiciels utilisés</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-technical-architecture.html">5.4. Architecture technique détaillée</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-data-storage.html">5.5. Stockage des données</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-logs-architecture.html">5.6. Concentration et exploitation des logs applicatifs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.7. Métriques applicatives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#besoins">5.7.1. Besoins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modele-generique">5.7.2. Modèle générique</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choix-des-implementations">5.7.3. Choix des implémentations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enregistreur-de-metriques">5.7.3.1. Enregistreur de métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reporters-de-metriques">5.7.3.2. Reporters de métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stockage-des-metriques">5.7.3.3. Stockage des métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualisation-des-metriques">5.7.3.4. Visualisation des métriques</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#limites">5.7.4. Limites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07-deployment-tooling.html">5.8. Outillage de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-consul.html">5.9. Service registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-it-services.html">5.10. Dépendances aux services d&#8217;infrastructures</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-services.html">5.11. Composants déployés</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-deployment-guidelines.html">5.12. Guidelines de déploiement</a></li>
<li class="toctree-l2"><a class="reference internal" href="25-resources.html">5.13. Eléments de dimensionnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-flux-all.html">5.14. Matrice des flux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../securite/_toc.html">6. Securite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">7. Architecture détaillée</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">VITAM - Architecture</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="_toc.html">5. Architecture technique / exploitation</a> &raquo;</li>
      
    <li>5.7. Métriques applicatives</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/archi-exploit-infra/06-metrics-architecture.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="metriques-applicatives">
<h1>5.7. Métriques applicatives<a class="headerlink" href="#metriques-applicatives" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="besoins">
<h2>5.7.1. Besoins<a class="headerlink" href="#besoins" title="Lien permanent vers ce titre">¶</a></h2>
<p>À des fins de monitoring des composants logiciels Java VITAM et de l&#8217;utilisation des ressources système par ceux-ci, VITAM intègre un reporting et une gestion de métriques applicatives.</p>
</div>
<div class="section" id="modele-generique">
<h2>5.7.2. Modèle générique<a class="headerlink" href="#modele-generique" title="Lien permanent vers ce titre">¶</a></h2>
<p>On peut noter les composants suivants :</p>
<ul class="simple">
<li>Enregistreur de métriques : il s&#8217;agit de la librairie en charge de l&#8217;enregistrement d&#8217;une métrique.</li>
<li>Reporters de métriques: il s&#8217;agit de librairies en charge de collecter les métriques enregistrées et d&#8217;en faire un reporting.</li>
<li>Stockage des métriques : il s&#8217;agit du composant stockant les métriques (de manière plus ou moins requêtable).</li>
<li>Visualisation des métriques : il s&#8217;agit du composant (souvent IHM) qui permet la recherche et la visualisation des métriques.</li>
</ul>
</div>
<div class="section" id="choix-des-implementations">
<h2>5.7.3. Choix des implémentations<a class="headerlink" href="#choix-des-implementations" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="enregistreur-de-metriques">
<h3>5.7.3.1. Enregistreur de métriques<a class="headerlink" href="#enregistreur-de-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le système VITAM, l&#8217;enregistrement de métriques s&#8217;effectue uniquement dans les composants logiciels Java à l&#8217;aide de la librairie <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/">Dropwizard metrics</a>.</p>
<p>Les plugins suivants sont utilisés pour leur métriques respectives :</p>
<ul class="simple">
<li><a class="reference external" href="http://metrics.dropwizard.io/3.1.0/manual/jersey/#instrumenting-jersey-2-x">Dropwizard Jersey integration</a> pour les métriques Jersey.</li>
<li><a class="reference external" href="http://metrics.dropwizard.io/3.1.0/manual/jvm/">Dropwizard JVM integration</a> pour les métriques JVM.</li>
</ul>
<p>L&#8217;enregistreur de métriques possède un registre interne qui peut stocker différentes métriques : <strong>Gauges</strong>, <strong>Timer</strong>, <strong>Meter</strong>, <strong>Counter</strong> ou <strong>Histograms</strong>. Ces métriques seront collectées dans le temps par le/les reporter(s) de métriques.</p>
<p>Les métriques Jersey sont automatiquement générées par application VITAM. Elles représentent un jeu de 3 métriques, <strong>Meter</strong>, <strong>Timer</strong> et <strong>ExceptionMeter</strong> pour chaque end-point des ressources de l&#8217;application.</p>
<p>Les métriques JVM sont aussi uniques par application. Elles représentent plusieurs types de métriques sur la consommation de ressources système.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Une description fonctionelle des métriques est disponible dans le <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/manual/core/">manuel utilisateur dropwizard metrics</a>.</p>
</div>
</div>
<div class="section" id="reporters-de-metriques">
<h3>5.7.3.2. Reporters de métriques<a class="headerlink" href="#reporters-de-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le système VITAM, un ou plusieurs reporters de métriques peuvent être utilisés. A ce jour, il existe deux reporters différents :</p>
<ul class="simple">
<li>Un reporter logback</li>
<li>Un reporter ElasticSearch issue de la librairie <a class="reference external" href="https://github.com/elastic/elasticsearch-metrics-reporter-java">metrics elasticsearch reporter</a>.</li>
</ul>
<p>Les reporters sont utilisés dans les composants logiciels Java. Ils sont en charge de récupérer les valeurs de toutes les métriques enregistrées et de les transmettre sur différents canaux, ici soit un logger logback ou une base de données ElasticSearch.</p>
</div>
<div class="section" id="stockage-des-metriques">
<h3>5.7.3.3. Stockage des métriques<a class="headerlink" href="#stockage-des-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si un reporter de métriques ElasticSearch est utilisé, celles-ci seront stockées dans le moteur d&#8217;indexation ElasticSearch, dans un cluster dédié au stockage des logs/métriques (pour séparer les données de logs/métriques et les données métier d&#8217;archives).</p>
<p>Ce cluster est configuré de la manière suivante :</p>
<ul class="simple">
<li>Taille du cluster (pour les déploiements VITAM de taille importante, ce nombre pourra être amené à évoluer (Cf. les abaques <a class="reference internal" href="25-resources.html"><span class="doc">fournies plus loin</span></a>)) :<ul>
<li>Nombre nominal de noeuds : 2 ;</li>
<li>Nombre nominal de shards primaires par index : 4 ;</li>
<li>Nombre nominal de replica : 1 ;</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ces paramètres ne permettent pas de se parer contre la perte d&#8217;un noeud elasticsearch, et correspondent à un compromis en terme d&#8217;usage des resources VS résilience du système.
Ces paramètres peuvent être changés si un besoin plus fort de résilience était identifié. Dans ce cas, on peut augmenter le nombre de noeuds ainsi que le nombre de replica, en veillant à ce que le nombre de shards primaires ne soit jamais inférieur au nombre de noeuds du cluster, et que le nombre de replica ne soit jamais supérieur au nombre de noeuds du cluster - 1.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Une modification du nombre de shards primaires d&#8217;un index est une opération coûteuse à réaliser sur un cluster en cours de fonctionnement et qui doit dans la mesure du possible être évitée (indisponibilité du cluster et/ou risque de corruption et de perte de données en cas de problème au cours de l&#8217;opération) ; le bon dimensionnement de cette valeur doit être réalisé dès l&#8217;installation du cluster.</p>
</div>
<ul>
<li><p class="first">Index : chaque index stockant des données de métriques correspond à 1 jour de métriques (déterminé à partir du timestamp de la métrique). Les index définis sont les suivants :</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">metrics-vitam-jersey-YYYY.MM.dd</span></code> pour les métriques de Jersey, avec un champ <em>name</em> automatiquement généré sous la forme :</p>
<blockquote>
<div><p><strong>uri:http_method:consumed_types:produced_types:metric_type</strong></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">metrics-vitam-jvm-YYYY.MM.dd</span></code> pour les métriques JVM.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">metrics-vitam-business-YYYY.MM.dd</span></code> pour les métriques métier.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">.kibana</span></code> pour le stockage des paramètres (et notamment des dashboards) Kibana.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="gestion-des-index">
<h4>5.7.3.3.1. Gestion des index<a class="headerlink" href="#gestion-des-index" title="Lien permanent vers ce titre">¶</a></h4>
<p>La gestion des index est réalisée par l&#8217;application <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/client/curator/4.0/index.html">Curator</a>. Par défaut, l&#8217;outil est livré avec la configuration suivante :</p>
<ul class="simple">
<li>Durée de maintien des index &#8220;online&#8221; : 7 jours ; cela signifie qu&#8217;au bout de 7 jours, les index seront fermés, et n&#8217;apparaîtront donc plus dans l&#8217;IHM de suivi des logs. Cependant, ils sont conservés, et pourront donc être réouverts en cas de besoin.</li>
<li>Durée de conservation des index : 30 jours ; au bout de cette durée, les index seront supprimés.</li>
</ul>
</div>
</div>
<div class="section" id="visualisation-des-metriques">
<h3>5.7.3.4. Visualisation des métriques<a class="headerlink" href="#visualisation-des-metriques" title="Lien permanent vers ce titre">¶</a></h3>
<p>La visalisation des métriques se fait par le composant Kibana. Il est instancié de manière unique, et persiste sa configuration dans ElasticSearch (dans l&#8217;index <code class="docutils literal"><span class="pre">.kibana</span></code>).</p>
<p>Aucun mécanisme d&#8217;authentification n&#8217;est mis en place pour sécuriser l&#8217;accès à Kibana.</p>
<div class="admonition hint">
<p class="first admonition-title">Indice</p>
<p class="last">La version opensource de Kibana, utilisée dans VITAM, ne supporte pas nativement l&#8217;authentification des clients ; d&#8217;autres solutions peuvent être mises en place (ex: l&#8217;utilisation du composant <a class="reference external" href="https://www.elastic.co/products/x-pack/security">Security</a>), sous réserve d&#8217;une étude de compatibilité de la solution choisie.</p>
</div>
</div>
</div>
<div class="section" id="limites">
<h2>5.7.4. Limites<a class="headerlink" href="#limites" title="Lien permanent vers ce titre">¶</a></h2>
<p>La solution implémentée dans Vitam possède les limites connues suivantes :</p>
<ul class="simple">
<li>Du fait que la librairie Dropwizard Metrics fait une agrégation des métriques et que le système de visualisation Kibana fonctionne lui aussi à l&#8217;aide d&#8217;agrégations, les résultats visualisés sont corrects dans la limite d&#8217;une certaine précision (certaines données deviennent non-représentatives de la réalité).</li>
<li>Il n&#8217;existe à ce jour que 3 types de métriques, <strong>Meter</strong>, <strong>Timer</strong> et <strong>ExceptionMeter</strong> supportés par le plugin Jersey Dropwizard Metrics.</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="07-deployment-tooling.html" class="btn btn-neutral float-right" title="5.8. Outillage de déploiement" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="05-logs-architecture.html" class="btn btn-neutral" title="5.6. Concentration et exploitation des logs applicatifs" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>