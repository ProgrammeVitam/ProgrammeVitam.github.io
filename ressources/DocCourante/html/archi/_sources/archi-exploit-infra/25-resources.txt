Utilisation des resources informatiques
#######################################

.. caution:: Les abaques de dimensionnement sont en cours de définition ; les éléments présentés ci-dessous correspondent aux cibles de dimensionnement en cours de test ou prévus pour les tests de performance. Les indications de volumétrie qui y sont présentées sont purement indicatives, et relatives au système VITAM dans son état actuel, à savoir au tout début de la phase de tuning et d'optimisations des performances. En outre, ils se basent sur des tests sur systèmes virtualisés (avec une surallocation CPU de 4), et comprennent une réservation de resources pour chaque OS.

.. note:: Sauf mention contraire, les enveloppes de resources ci-dessous comprennent notamment les composants associés à l'exploitation de la solution VITAM et fournis dans le cadre de la solution (traitement et stockage des logs et des métriques, gestion des bases de données, ...)

Configurations indicatives pour le développement et/ou la recette d'applications métier :

* Configuration "xsmall" : 1 VM (4 vCPU, 16 Go RAM) : adapté à un poste de développement ; ce déploiement ne comprend pas les composants d'exploitation de la solution VITAM ;
* Configuration "small" : 3 VM (4 vCPU, 16 Go RAM) : adapté à un environnement de recette simple d'application métier utilisant VITAM ;

Configurations indicatives pour la production :

* Configuration "medium" : déploiement à 11 VM (36 vCPU, 72 Go RAM) : déploiement simple pour des volumétries moyennes ; seules les bases de données et les offres de stockage sont multi-instanciées ;
* Configuration "large" : déploiement à 25 VM ( 80 vCPU, 160 Go RAM) : déploiement résilient pour des volumétries plus importantes ; ce déploiement comprend au moins deux instances pour tous les composants le supportant ;
* Configuration "xlarge" : déploiement à 52 VM (200 vCPU, 400 Go RAM) : déploiement pour de fortes volumétries (ordre de grandeur des capacités d'ingest : > 50 To / an, > 100.10^6 objets / an) ;

De manière générale, la consommation en resources (CPU/RAM/réseau) de VITAM dépend de 3 grands cas d'utilisation :

* La quantité d'archives versées (ingest) : supporter plus d'ingest nécessite de renforcer les resources disponibles pour les composants actifs lors d'un ingest : ingest-external, ingest-internal, processing, worker, workspace, storage, storage-offer, logbook, metadata, elasticsearch-data, mongodb ;
* La quantité d'archives gérées (audit & pérennisation) : dans cette version de VITAM, les fonctions liées à ces deux domaines sont limitées ; par conséquent, la quantité de données gérées a uniquement une influence sur les bases de données : elasticsearch-data, mongodb ;
* La quantité d'archives consultées (access) : supporter plus de requêtes concurrentes nécessite de renforcer les resources disponibles pour les composants actifs lors d'une consultation : access-external, access-internal, metadata, storage, storage-offer, elasticsearch-data, mongodb.

.. note:: les composants de référentiels (functional-administration, security-internal), même si ils sont utilisés dans la plupart des scénarii métiér, bénéficient d'un fort effet de cache du côté des clients de ces services ; par conséquent, ils sont moins sensibles que les autres à l'augmentation de capacité.


Dimensionnement indicatif (ingest uniquement)
=============================================

Voici un exemple de dimensionnement et des performances associées mesurées sur un environnement complètement virtualisé, dimensionné pour des performances :

.. csv-table:: Dimensionnement de l'environnement de recette de performance VITAM (release 25)
	:header-rows: 1
	:file: data/sizing-perf.csv
	:delim: ;

La plate-forme d'exécution est la suivante :

* Cloud OpenStack
* Flavors : règles imposée de 1 vCPU = 4 Go RAM
* CPU : Intel Broadwell, 2,6 Ghz
* Disques : disques attachés aux serveurs (carte RAID)
* Réseau : Réseau virtuel au-dessus d'un coeur de réseau 10 Gbps

Les performances atteintes à l'ingest sont les suivantes :

* Configuration des workers : capacité de 8
* Scénario d'ingest : 10 ingests en paralèlle de SIP contenant chacun 2501 AU, 2500 GOT, 2500 BDO de 100 Ko
* Capacité d'ingest maximale obtenue : 135 000 objets / heure


