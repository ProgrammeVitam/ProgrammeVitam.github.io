

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.2.2.4. Montée de version 1.4.9 vers 1.10.3 &mdash; Documentation VITAM - Documentation de montées de version 1.10.3</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="prev" title="4.2.2.3. Montée de version 1.4.5 vers 1.10.3" href="1.4.5_to_1.10.3.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> VITAM - Documentation de montées de version
          

          
            
            <img src="../../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.10.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nomenclature.html">3. Nomenclature des versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../_toc.html">4. Montées de version</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bugfixes_updates/_toc.html">4.1. Montées de version bugfix</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_toc.html">4.2. Montées de version mineure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../r6_to_r7/_toc.html">4.2.1. R6 vers R7</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="_toc.html">4.2.2. R7 vers R8</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="1.4.0_to_1.10.3.html">4.2.2.1. Montée de version 1.4.0 vers 1.10.3</a></li>
<li class="toctree-l4"><a class="reference internal" href="1.4.1_to_1.10.3.html">4.2.2.2. Montée de version 1.4.1 vers 1.10.3</a></li>
<li class="toctree-l4"><a class="reference internal" href="1.4.5_to_1.10.3.html">4.2.2.3. Montée de version 1.4.5 vers 1.10.3</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.2.2.4. Montée de version 1.4.9 vers 1.10.3</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VITAM - Documentation de montées de version</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../_toc.html">4. Montées de version</a> &raquo;</li>
        
          <li><a href="../_toc.html">4.2. Montées de version mineure</a> &raquo;</li>
        
          <li><a href="_toc.html">4.2.2. R7 vers R8</a> &raquo;</li>
        
      <li>4.2.2.4. Montée de version 1.4.9 vers 1.10.3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/updates/releases_updates/r7_to_r8/1.4.9_to_1.10.3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="montee-de-version-1-4-9-vers-1-10-3">
<span id="to-1-10-3"></span><h1>4.2.2.4. Montée de version 1.4.9 vers 1.10.3<a class="headerlink" href="#montee-de-version-1-4-9-vers-1-10-3" title="Lien permanent vers ce titre">¶</a></h1>
<p>La montée de version 1.4.9 (« R7.9 ») vers 1.10.3 (« R8.3 ») est réalisée par réinstallation de la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> grâce aux playbooks ansible fournis, et selon la procédure d’installation classique décrite dans le Document d’INstallation (DIN).</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">La migration doit être réalisée en partant de la version la plus récente de la version « R7 » (1.4.9).</p>
</div>
<div class="section" id="prerequis-a-l-installation">
<h2>4.2.2.4.1. Prérequis à l’installation<a class="headerlink" href="#prerequis-a-l-installation" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="arret-des-timers-systemd">
<h3>4.2.2.4.1.1. Arrêt des timers systemd<a class="headerlink" href="#arret-des-timers-systemd" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les commandes sont à lancer depuis le répertoire <code class="docutils literal notranslate"><span class="pre">deployment</span></code> sur les différents sites hébergeant la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/stop_vitam_timers.yml</span> <span class="pre">--vault-password-file</span> <span class="pre">vault_pass.txt</span></code></p>
<p>ou, si vault_pass.txt n’a pas été renseigné :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/stop_vitam_timers.yml</span> <span class="pre">--ask-vault-pass</span></code></p>
<p>A l’issue de ce <cite>playbook</cite>, les <cite>timers</cite> systemD ont été arrêtés, afin de ne pas perturber la migration.</p>
<p>Il est également recommandé de ne lancer la procédure de migration qu’une fois s’être assuré qu’aucun <cite>workflow</cite> n’est actuellement en cours de traitement.</p>
</div>
<div class="section" id="upgrade-mongodb-3-4-vers-4-0">
<h3>4.2.2.4.1.2. Upgrade Mongodb 3.4 vers 4.0<a class="headerlink" href="#upgrade-mongodb-3-4-vers-4-0" title="Lien permanent vers ce titre">¶</a></h3>
<p>La montée de version 1.4.9 (« R7.9 ») vers 1.10.3 (« R8.3 ») comprend une montée de version de MongoDB de la version 3.4 à la version 4.0.</p>
<p>Les commandes sont à lancer depuis le répertoire <code class="docutils literal notranslate"><span class="pre">deployment</span></code> sur les différents sites hébergeant la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> :</p>
<ul class="simple">
<li>Stopper Vitam (playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/stop_vitam.yml</span></code>)</li>
<li>Démarrer les différents cluster mongodb (playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/start_mongodb.yml</span></code>)</li>
<li>Upgrader mongodb en 3.6 (playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/migration_mongodb_36.yml</span></code>)</li>
<li>Upgrader mongodb en 4.0 (playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/migration_mongodb_40.yml</span></code>)</li>
<li>Démarrer Vitam (playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/start_vitam.yml</span></code>)</li>
</ul>
</div>
<div class="section" id="reprise-des-donnees-de-certificats">
<h3>4.2.2.4.1.3. Reprise des données de certificats<a class="headerlink" href="#reprise-des-donnees-de-certificats" title="Lien permanent vers ce titre">¶</a></h3>
<p>La version 1.10.0 (« R8 ») apporte une nouvelle fonctionnalité permettant la révocation des certificats SIA et Personae afin d’empecher des accès non autorisés aux API Vitam (vérification dans la couche https des CRL). Cette fonctionnalité impose d’effectuer une reprise des données des certificats (base MongoDB identity, collections Certificate et PersonalCertificate).</p>
<p>Les commandes sont à lancer depuis le répertoire <code class="docutils literal notranslate"><span class="pre">deployment</span></code> sur les différents sites hébergeant la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">ansible-vitam-exploitation/migration_r7_certificates.yml</span> <span class="pre">--ask-vault-pass</span></code></p>
</div>
</div>
<div class="section" id="etapes-post-installation">
<h2>4.2.2.4.2. Etapes post-installation<a class="headerlink" href="#etapes-post-installation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le cadre d’une montée de version 1.4.9 (« R7.9 ») vers 1.10.3 (« R8.3 »), il est nécessaire d’appliquer un <cite>playbook</cite> de migration de données à l’issue de réinstallation de la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>.</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Dans le cadre d’une installation multi-sites, il faut d’abord lancer la migration des données sur le site secondaire afin de purger les registres des fonds, ensuite lancer la migration sur le site primaire puis enfin lancer la reconstruction des registres des fonds sur le site secondaire.</p>
</div>
<div class="section" id="procedure-de-migration-des-donnees">
<h3>4.2.2.4.2.1. Procédure de migration des données<a class="headerlink" href="#procedure-de-migration-des-donnees" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lancer les commandes ci-après dans l’ordre suivant :</p>
<blockquote>
<div><ol class="arabic simple">
<li>D’abord sur le site secondaire pour purger les registres des fonds</li>
<li>Ensuite sur le site primaire pour la migration des registres des fonds.</li>
</ol>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/migration_r7_r8.yml</span> <span class="pre">--vault-password-file</span> <span class="pre">vault_pass.txt</span></code></p>
<p>ou, si vault_pass.txt n’a pas été renseigné :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/migration_r7_r8.yml</span> <span class="pre">--ask-vault-pass</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Selon la volumétrie des données précédement chargées, le <cite>playbook</cite> peut durer jusqu’à plusieurs heures.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Durant le temps des migrations, il est fortement recommandé de ne pas procéder à des injections de données. Le <cite>playbook</cite> se charge d’arrêter les composants «&nbsp;ingest-external&nbsp;» et «&nbsp;access-external&nbsp;», de réaliser les opérations de migration des données, puis de redémarrer les composants «&nbsp;ingest-external&nbsp;» et «&nbsp;access-external&nbsp;».</p>
</div>
<p>Les changements apportés par la migration R7 vers R8 sont :</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Les registres des fonds (Accession Registers)</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Diff AccessionRegisterDetail:</dt>
<dd><ul class="first last">
<li>Suppression du champs <code class="docutils literal notranslate"><span class="pre">Identifier</span></code>, remplacé par <code class="docutils literal notranslate"><span class="pre">Opc</span></code> (Opération courante)</li>
<li>Suppression du champs <code class="docutils literal notranslate"><span class="pre">OperationGroup</span></code>, remplacé par <code class="docutils literal notranslate"><span class="pre">Opi</span></code> (Opération d’ingest)</li>
<li>Suppression du champs <code class="docutils literal notranslate"><span class="pre">Symbolic</span></code></li>
<li>Suppression des champs <code class="docutils literal notranslate"><span class="pre">attached</span></code>, <code class="docutils literal notranslate"><span class="pre">detached</span></code>, <code class="docutils literal notranslate"><span class="pre">symbolicRemained</span></code> des sous objets («&nbsp;TotalUnits&nbsp;», «&nbsp;TotalObjectGroups&nbsp;», «&nbsp;TotalObjects&nbsp;», «&nbsp;ObjectSize&nbsp;»)</li>
<li>Ajout d’un sous objet <code class="docutils literal notranslate"><span class="pre">Events</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Diff AccessionRegisterSummary:</dt>
<dd><ul class="first last">
<li>Suppression des champs <code class="docutils literal notranslate"><span class="pre">attached</span></code>, <code class="docutils literal notranslate"><span class="pre">detached</span></code>, <code class="docutils literal notranslate"><span class="pre">symbolicRemained</span></code> des sous objets («&nbsp;TotalUnits&nbsp;», «&nbsp;TotalObjectGroups&nbsp;», «&nbsp;TotalObjects&nbsp;», «&nbsp;ObjectSize&nbsp;»)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Le journal des opérations</dt>
<dd><ul class="first last">
<li>On n’aura que les données du registre des fonds selon le nouveau modèle dans le <code class="docutils literal notranslate"><span class="pre">evDetData</span></code> du journal de l’opération d”<cite>ingest</cite>.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Se reporter à la documentation du nouveau modèle de données de la R8.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">En cas de souci, contacter l’équipe support.</p>
</div>
</div>
<div class="section" id="apres-la-migration-des-donnees">
<h3>4.2.2.4.2.2. Après la migration des données<a class="headerlink" href="#apres-la-migration-des-donnees" title="Lien permanent vers ce titre">¶</a></h3>
<p>A l’issue de la bonne exécution du <cite>playbook</cite>, il faut lancer la commande suivante pour réactiver les <cite>timers</cite> systemD sur les différents sites hébergeant la solution logicielle <a class="reference internal" href="../../../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/start_vitam_timers.yml</span> <span class="pre">--vault-password-file</span> <span class="pre">vault_pass.txt</span></code></p>
<p>ou, si vault_pass.txt n’a pas été renseigné :</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">-i</span> <span class="pre">environments/&lt;inventaire&gt;</span> <span class="pre">ansible-vitam-exploitation/start_vitam_timers.yml</span> <span class="pre">--ask-vault-pass</span></code></p>
</div>
<div class="section" id="une-fois-le-site-secondaire-up">
<h3>4.2.2.4.2.3. Une fois le site secondaire <cite>up</cite><a class="headerlink" href="#une-fois-le-site-secondaire-up" title="Lien permanent vers ce titre">¶</a></h3>
<p>Sur le site secondaire, vérifier que le processus de reconstruction des registres des fonds  s’est bien démarré, sur les machines hébergeant le composant «&nbsp;functional-administration&nbsp;».</p>
<p>La commande à passer en tant que root est la suivante :</p>
<p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">vitam-functional-administration-accession-register-reconstruction.service</span></code></p>
</div>
<div class="section" id="verification-de-la-bonne-migration-des-donnees">
<h3>4.2.2.4.2.4. Vérification de la bonne migration des données<a class="headerlink" href="#verification-de-la-bonne-migration-des-donnees" title="Lien permanent vers ce titre">¶</a></h3>
<p>A l’issue de la migration, il est fortement conseillé de lancer un «&nbsp;Audit de cohérence&nbsp;» sur les différents tenants.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="1.4.5_to_1.10.3.html" class="btn btn-neutral" title="4.2.2.3. Montée de version 1.4.5 vers 1.10.3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.10.3',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>