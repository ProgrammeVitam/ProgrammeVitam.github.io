

<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.3.9. Notes et procédures spécifiques R16 &mdash; Documentation VITAM - Documentation de montées de version 5.0</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'5.0',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="4.3.10. Notes et procédures spécifiques V5RC" href="v5rc_update.html" />
    <link rel="prev" title="4.3.8. Notes et procédures spécifiques R15" href="r15_updates.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> VITAM - Documentation de montées de version
          

          
            
            <img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generalites.html">3. Généralités sur les versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">4. Montées de version</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../principles.html">4.1. Principes généraux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bugfixes_updates/_toc.html">4.2. Montées de version <em>bugfix</em></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">4.3. Montées de version mineure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="r7_update.html">4.3.1. Notes et procédures spécifiques R7</a></li>
<li class="toctree-l3"><a class="reference internal" href="r8_update.html">4.3.2. Notes et procédures spécifiques R8</a></li>
<li class="toctree-l3"><a class="reference internal" href="r9_update.html">4.3.3. Notes et procédures spécifiques R9</a></li>
<li class="toctree-l3"><a class="reference internal" href="r10_update.html">4.3.4. Notes et procédures spécifiques R10</a></li>
<li class="toctree-l3"><a class="reference internal" href="r11_update.html">4.3.5. Notes et procédures spécifiques R11</a></li>
<li class="toctree-l3"><a class="reference internal" href="r12_update.html">4.3.6. Notes et procédures spécifiques R12</a></li>
<li class="toctree-l3"><a class="reference internal" href="r13_update.html">4.3.7. Notes et procédures spécifiques R13</a></li>
<li class="toctree-l3"><a class="reference internal" href="r15_updates.html">4.3.8. Notes et procédures spécifiques R15</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.3.9. Notes et procédures spécifiques R16</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#supprimer-les-indexes-de-configuration-kibana">4.3.9.1. Supprimer les indexes de configuration kibana</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deplacement-des-parametres-relatif-a-la-gestion-des-tenants">4.3.9.2. Déplacement des paramètres relatif à la gestion des tenants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gestion-des-regles-de-gestion">4.3.9.3. Gestion des régles de gestion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audit-coherence">4.3.9.4. Audit coherence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="v5rc_update.html">4.3.10. Notes et procédures spécifiques V5RC</a></li>
<li class="toctree-l3"><a class="reference internal" href="v5_update.html">4.3.11. Notes et procédures spécifiques V5</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Documentation de montées de version</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../_toc.html">4. Montées de version</a> &raquo;</li>
        
          <li><a href="_toc.html">4.3. Montées de version mineure</a> &raquo;</li>
        
      <li>4.3.9. Notes et procédures spécifiques R16</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/updates/releases_updates/r16_update.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="notes-et-procedures-specifiques-r16">
<h1>4.3.9. Notes et procédures spécifiques R16<a class="headerlink" href="#notes-et-procedures-specifiques-r16" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="supprimer-les-indexes-de-configuration-kibana">
<h2>4.3.9.1. Supprimer les indexes de configuration kibana<a class="headerlink" href="#supprimer-les-indexes-de-configuration-kibana" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée avant la montée de version vers la R16 sur l’ensemble des sites.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Sans cette opération, l’installation kibana est bloquée et arrête l’installation de Vitam</p>
</div>
<p>Lors de la montée de version ELK, les indices de configuration kibana : .kibana et .kibana_task_manager persistent avec une version et des informations incorrectes (celles de la version d’avant). Il est nécessaire des les effacer; autrement la montée de version est bloquée.</p>
<ul class="simple">
<li>Arrêt de Kibana (ne doit pas être relancé avant la fin de la procédure de montée de version).</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible hosts_kibana_log,hosts_kibana_data --vault-password-file vault_pass.txt -v -a <span class="s2">&quot;systemctl stop kibana&quot;</span> -i environments/&lt;inventaire&gt;
</pre></div>
</div>
<ul class="simple">
<li>Supprimer les indexes <cite>.kibana*</cite> via cerebro dans les clusters <cite>elasticsearch-log</cite> &amp; <cite>elasticsearch-data</cite>.</li>
</ul>
<p>Attention, ils faut cocher la case <cite>.special</cite> dans l’interface pour les voir.</p>
<div class="section" id="etapes-prealables-a-la-montee-de-version">
<h3>4.3.9.1.1. Étapes préalables à la montée de version<a class="headerlink" href="#etapes-prealables-a-la-montee-de-version" title="Lien permanent vers ce titre">¶</a></h3>
</div>
</div>
<div class="section" id="deplacement-des-parametres-relatif-a-la-gestion-des-tenants">
<h2>4.3.9.2. Déplacement des paramètres relatif à la gestion des tenants<a class="headerlink" href="#deplacement-des-parametres-relatif-a-la-gestion-des-tenants" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le cadre de la fonctionnalité introduite en R15 permettant de regrouper les tenants, les paramètres suivants ont étés déplacés du fichier d’inventaire au fichier <code class="docutils literal notranslate"><span class="pre">group_vars/all/tenants_vars.yml</span></code></p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">vitam_tenant_ids</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">vitam_tenant_admin</span></code></li>
</ul>
</div></blockquote>
<p>Si la montée de version s’effectue à partir d’une R13, il faut supprimer les valeurs précédentes de votre fichier d’inventaire et les reporter dans le fichier <code class="docutils literal notranslate"><span class="pre">tenants_vars.yml</span></code> en respectant la syntaxe YML adéquate.</p>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">Se référer à la documentation d’installation pour plus d’informations concernant le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/tenants_vars.yml</span></code></p>
</div>
</div>
<div class="section" id="gestion-des-regles-de-gestion">
<h2>4.3.9.3. Gestion des régles de gestion<a class="headerlink" href="#gestion-des-regles-de-gestion" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le cadre d’une correction de bug permettant la validation stricte des types de règles lors de l’import du référentiel des règles de gestion,
il faut impérativement, lors d’une montée de version, vérifier tous les types de règles de gestion existants sur Mongo et ES et les modifier manuellement en cas d’incohérence.
il faut que les types de règles de gestion respecte la casse (les majuscules et les minuscules)
Exemple :</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">APPRAISALRULE</span></code> devrait être <code class="docutils literal notranslate"><span class="pre">AppraisalRule</span></code></div></blockquote>
<div class="section" id="verification-de-la-bonne-migration-des-donnees">
<h3>4.3.9.3.1. Vérification de la bonne migration des données<a class="headerlink" href="#verification-de-la-bonne-migration-des-donnees" title="Lien permanent vers ce titre">¶</a></h3>
</div>
</div>
<div class="section" id="audit-coherence">
<h2>4.3.9.4. Audit coherence<a class="headerlink" href="#audit-coherence" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est recommandé de procéder à un audit de cohérence aléatoire suite à une procédure de montée de version VITAM ou de migration de données.
Pour ce faire, se référer au dossier d’exploitation (DEX) de la solution VITAM, section <code class="docutils literal notranslate"><span class="pre">Audit</span> <span class="pre">de</span> <span class="pre">cohérence</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="v5rc_update.html" class="btn btn-neutral float-right" title="4.3.10. Notes et procédures spécifiques V5RC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="r15_updates.html" class="btn btn-neutral float-left" title="4.3.8. Notes et procédures spécifiques R15" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>