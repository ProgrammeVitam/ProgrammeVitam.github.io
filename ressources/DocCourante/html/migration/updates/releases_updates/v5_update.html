<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.3.4. Notes et procédures spécifiques V5 &mdash; Documentation VITAM - Documentation de montées de version 6.rc.1</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
      <script>
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'6.rc.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="4.3.5. Notes et procédures spécifiques V6RC" href="v6rc_update.html" />
    <link rel="prev" title="4.3.3. Notes et procédures spécifiques V5RC" href="v5rc_update.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> VITAM - Documentation de montées de version<img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                6.rc.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generalites.html">3. Généralités sur les versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">4. Montées de version</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../principles.html">4.1. Principes généraux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bugfixes_updates/_toc.html">4.2. Montées de version <em>bugfix</em></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">4.3. Montées de version majeures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="r13_update.html">4.3.1. Notes et procédures spécifiques R13</a></li>
<li class="toctree-l3"><a class="reference internal" href="r16_update.html">4.3.2. Notes et procédures spécifiques R16</a></li>
<li class="toctree-l3"><a class="reference internal" href="v5rc_update.html">4.3.3. Notes et procédures spécifiques V5RC</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.3.4. Notes et procédures spécifiques V5</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adaptation-des-sources-de-deploiement-ansible">4.3.4.1. Adaptation des sources de déploiement ansible</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedures-a-executer-avant-la-montee-de-version">4.3.4.2. Procédures à exécuter AVANT la montée de version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedures-a-executer-apres-la-montee-de-version">4.3.4.3. Procédures à exécuter APRÈS la montée de version</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="v6rc_update.html">4.3.5. Notes et procédures spécifiques V6RC</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Documentation de montées de version</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../_toc.html">4. Montées de version</a></li>
          <li class="breadcrumb-item"><a href="_toc.html">4.3. Montées de version majeures</a></li>
      <li class="breadcrumb-item active">4.3.4. Notes et procédures spécifiques V5</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/updates/releases_updates/v5_update.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="notes-et-procedures-specifiques-v5">
<h1>4.3.4. Notes et procédures spécifiques V5<a class="headerlink" href="#notes-et-procedures-specifiques-v5" title="Lien permanent vers ce titre">¶</a></h1>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Pour une montée de version depuis la R16 de Vitam, veuillez appliquer les procédures spécifiques de la V5RC en complément des procédures suivantes. Pour une montée de version depuis la V5RC, vous pouvez appliquer la procédure suivante directement.</p>
</div>
<div class="section" id="adaptation-des-sources-de-deploiement-ansible">
<h2>4.3.4.1. Adaptation des sources de déploiement ansible<a class="headerlink" href="#adaptation-des-sources-de-deploiement-ansible" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="classement-des-offres-dans-une-strategie">
<h3>4.3.4.1.1. Classement des offres dans une stratégie<a class="headerlink" href="#classement-des-offres-dans-une-strategie" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans une stratégie de stockage, chaque offre renseignée déclare un ordre de lecture. Cet ordre est manifeste à travers la propriété <code class="docutils literal notranslate"><span class="pre">rank</span></code>. Il est obligatoire
de la renseigner dans chaque offre utilisée. La lecture depuis les offres se fait selon un ordre ascendant en se basant sur cette propriété.
Ci-dessous un exemple de déclaration de stratégie de stockage et ses offres, dans le fichier de configuration <code class="docutils literal notranslate"><span class="pre">deployment/environments/group_vars/all/offer_opts.yml</span></code> :</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">vitam_strategy</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offer-1</span>
  <span class="nt">referent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">rank</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offer-2</span>
  <span class="nt">referent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">rank</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offer-3</span>
  <span class="nt">referent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">rank</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">vitam_offers</span><span class="p">:</span>
    <span class="nt">offer-1</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">filesystem</span>
    <span class="nt">offer-2</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">filesystem</span>
    <span class="nt">offer-3</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">filesystem</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="ajout-d-un-nouveau-module-vitam-module-de-collecte">
<h3>4.3.4.1.2. Ajout d’un nouveau module VITAM : Module de collecte<a class="headerlink" href="#ajout-d-un-nouveau-module-vitam-module-de-collecte" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">À préparer dans les sources de déploiement AVANT le déploiement de la V5. Ce module est optionnel, si vous ne souhaitez pas l’activer, laissez les groupes de hosts vides dans le fichier d’inventaire.</p>
</div>
<p>Ce module a pour but de faciliter l’intégration d’archives dans Vitam via une API constructive de SIP.</p>
<p>Le module de <cite>collect</cite> nécessite la configuration et l’ajout :
- d’une autre instance de metadata appelée <cite>metadata-collect</cite>
- d’une autre instance de workspace appelée <cite>workspace-collect</cite></p>
<p>Pour la mise en oeuvre de cette nouvelle application, veuillez éditer les paramètres suivants:</p>
<ul>
<li><p class="first">Ajout des groupes de hosts du module de collect à votre fichier d’inventaire (cf. fichier d’inventaire d’exemple: <code class="docutils literal notranslate"><span class="pre">environments/hosts.example</span></code>).</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[zone_applicative:children]</span>
<span class="na">hosts_collect</span>
<span class="na">hosts_metadata_collect</span>
<span class="na">hosts_workspace_collect</span>

<span class="k">[hosts_collect]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : collect</span>


<span class="k">[hosts_metadata_collect]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : metadata_collect</span>


<span class="k">[hosts_workspace_collect]</span>
<span class="c1"># TODO: Put the server where this service will be deployed : workspace_collect</span>
<span class="c1"># WARNING: put only one server for this service, not more !</span>
</pre></div>
</div>
</li>
<li><p class="first">Ajout des bases mongo pour le module de collect dans le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/vault-vitam.yml</span></code>:</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Pensez à éditer les password avec des passwords sécurisés.</p>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mongodb</span><span class="p">:</span>
  <span class="nt">mongo-data</span><span class="p">:</span>
    <span class="nt">collect</span><span class="p">:</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">collect</span>
      <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">change_it_m39XvRQWixyDX566</span>
    <span class="nt">metadataCollect</span><span class="p">:</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">metadata-collect</span>
      <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">change_it_37b97KVaDV8YbCwt</span>
</pre></div>
</div>
</li>
<li><p class="first">Création de certificats dédiés au module de collecte</p>
<ul>
<li><p class="first">Créer un certificat client et un certificat serveur dédiés au module de collecte à l’aide de votre <code class="docutils literal notranslate"><span class="pre">PKI</span></code> et le mettre dans les chemins attendus (<code class="docutils literal notranslate"><span class="pre">environments/certs/client-external/clients/collect/</span></code> et <code class="docutils literal notranslate"><span class="pre">environments/certs/server/hosts/{hosts}</span></code>).</p>
<ul class="simple">
<li>Dans le cas de l’utilisation de la PKI de test de Vitam, vous pouvez simplement re-générer de nouveaux certificats à l’aide de la commande: <code class="docutils literal notranslate"><span class="pre">./pki/scripts/generate_certs.sh</span> <span class="pre">&lt;fichier_inventaire&gt;</span></code></li>
</ul>
</li>
<li><p class="first">Re-générer les stores: <code class="docutils literal notranslate"><span class="pre">./generate_stores.sh</span></code></p>
</li>
<li><p class="first">Ajouter le contexte de sécurité pour le module de collecte dans le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/vitam_security.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">admin_context_certs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;collect/collect.crt&quot;</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="procedures-a-executer-avant-la-montee-de-version">
<h2>4.3.4.2. Procédures à exécuter AVANT la montée de version<a class="headerlink" href="#procedures-a-executer-avant-la-montee-de-version" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="arret-des-timers-et-des-acces-externes-a-vitam">
<h3>4.3.4.2.1. Arrêt des timers et des accès externes à Vitam<a class="headerlink" href="#arret-des-timers-et-des-acces-externes-a-vitam" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée AVANT la montée de version vers la V5</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée avec les sources de déploiements de l’ancienne version.</p>
</div>
<p>Les timers et les externals de Vitam doivent être arrêtés sur <strong>tous les sites</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_external.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_vitam_timers.yml --ask-vault-pass
</pre></div>
</div>
</div>
<div class="section" id="reinitialisation-de-la-reconstruction-des-registres-de-fond-des-sites-secondaires">
<h3>4.3.4.2.2. Réinitialisation de la reconstruction des registres de fond des sites secondaires<a class="headerlink" href="#reinitialisation-de-la-reconstruction-des-registres-de-fond-des-sites-secondaires" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p>Cette procédure doit être exécutée uniquement en cas de :</p>
<ul class="last simple">
<li>migration majeure depuis une version R16.6- (4.0.6 ou inférieure)</li>
<li>migration majeure depuis une version v5.rc.3- (v5.rc.3 ou inférieure)</li>
</ul>
</div>
<p>Cette procédure permet la réinitialisation de la reconstruction des registre de fonds sur les sites secondaires.</p>
<p>La procédure est à réaliser sur tous les <strong>sites secondaires</strong> de Vitam AVANT l’installation de la nouvelle version :</p>
<ul>
<li><p class="first">S’assurer que les timers de Vitam aient bien été préalablement arrêtés (via le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/stop_vitam_timers.yml</span></code>)</p>
</li>
<li><p class="first">Exécuter le playbook :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook ansible-vitam-migration/migration_accession_register_reconstruction.yml -i environments/hosts.<span class="o">{</span>env<span class="o">}</span> --ask-vault-pass
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="controle-et-nettoyage-de-journaux-du-storage-engine-des-sites-secondaires">
<h3>4.3.4.2.3. Contrôle et nettoyage de journaux du storage engine des sites secondaires<a class="headerlink" href="#controle-et-nettoyage-de-journaux-du-storage-engine-des-sites-secondaires" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p>Cette procédure doit être exécutée uniquement en cas de :</p>
<ul class="last simple">
<li>migration majeure depuis une version R16.6- (4.0.6 ou inférieure)</li>
<li>migration majeure depuis une version v5.rc.3- (v5.rc.3 ou inférieure)</li>
</ul>
</div>
<p>Cette procédure permet le contrôle et la purge des journaux d’accès et des journaux d’écriture du storage engine des sites secondaires.</p>
<p>La procédure est à réaliser sur tous les <strong>sites secondaires</strong> de Vitam AVANT l’installation de la nouvelle version :</p>
<ul>
<li><p class="first">S’assurer que Vitam soit bien préalablement arrêté (via le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/stop_vitam.yml</span></code>)</p>
</li>
<li><p class="first">Exécuter le playbook :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook ansible-vitam-migration/migration_purge_storage_logs_secondary_sites.yml -i environments/hosts.<span class="o">{</span>env<span class="o">}</span> --ask-vault-pass
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="arret-complet-de-vitam">
<h3>4.3.4.2.4. Arrêt complet de Vitam<a class="headerlink" href="#arret-complet-de-vitam" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée AVANT la montée de version vers la V5</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée avec les sources de déploiements de l’ancienne version.</p>
</div>
<p>Vitam doit être arrêté sur <strong>tous les sites</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_vitam.yml --ask-vault-pass
</pre></div>
</div>
</div>
</div>
<div class="section" id="procedures-a-executer-apres-la-montee-de-version">
<h2>4.3.4.3. Procédures à exécuter APRÈS la montée de version<a class="headerlink" href="#procedures-a-executer-apres-la-montee-de-version" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="id1">
<h3>4.3.4.3.1. Arrêt des timers et des accès externes à Vitam<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée IMMÉDIATEMENT APRÈS la montée de version vers la V5</p>
</div>
<p>Les timers et les externals de Vitam doivent être arrêtés sur <strong>tous les sites</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_external.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_vitam_timers.yml --ask-vault-pass
</pre></div>
</div>
</div>
<div class="section" id="migration-des-unites-archivistiques">
<h3>4.3.4.3.2. Migration des unités archivistiques<a class="headerlink" href="#migration-des-unites-archivistiques" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette migration doit être effectuée APRÈS la montée de version V5 mais avant la réouverture du service aux utilisateurs.</p>
</div>
<p>Cette migration de données consiste à ajouter les champs <code class="docutils literal notranslate"><span class="pre">_acd</span></code> (date de création approximative) et <code class="docutils literal notranslate"><span class="pre">_aud</span></code> (date de modification approximative) dans la collection Unit.</p>
<p>Elle est réalisée en exécutant la procédure suivante sur <strong>tous les sites</strong> (primaire et secondaire(s)) :</p>
<ul class="simple">
<li>Migration des unités archivistiques sur mongo-data (le playbook va stopper les externals et les timers de Vitam avant de procéder à la migration) :</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-migration/migration_v5.yml --ask-vault-pass
</pre></div>
</div>
<p>Après le passage du script de migration, il faut procéder à la réindexation de toutes les unités archivistiques :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/reindex_es_data.yml --tags unit --ask-vault-pass
</pre></div>
</div>
</div>
<div class="section" id="mise-a-jour-des-certificats">
<h3>4.3.4.3.3. Mise à jour des certificats<a class="headerlink" href="#mise-a-jour-des-certificats" title="Lien permanent vers ce titre">¶</a></h3>
<p>Cette migration de données consiste à mettre à jour le champ <code class="docutils literal notranslate"><span class="pre">ExpirationDate</span></code> pour les anciens certificats existants dans la base de donnée.</p>
<p>Elle est réalisée en exécutant les commandes suivantes sur <strong>tous les sites</strong> (primaire et secondaire(s)) :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-migration/migration_v5_certificate.yml --ask-vault-pass
</pre></div>
</div>
</div>
<div class="section" id="migration-des-registres-de-fonds-en-details">
<h3>4.3.4.3.4. Migration des registres de fonds en détails<a class="headerlink" href="#migration-des-registres-de-fonds-en-details" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette migration doit être effectuée APRÈS la montée de version V5 mais avant la réouverture du service aux utilisateurs.</p>
</div>
<p>Suite à l’ajout des nouvelles propriétés <code class="docutils literal notranslate"><span class="pre">Comment</span></code> ( Commentaire ) et <code class="docutils literal notranslate"><span class="pre">obIdIn</span></code> (Identifiant du message ) au niveau de la collection <code class="docutils literal notranslate"><span class="pre">AccessionRegisterDetail</span></code>, il faut lancer une migration sur les anciennes données.</p>
<p>Exécutez la commande suivante uniquement sur <strong>le site primaire</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-migration/migration_accession_register_details_v5.yml --vault-password-file vault_pass.txt
</pre></div>
</div>
</div>
<div class="section" id="recalcul-du-graph-des-metadonnees-des-sites-secondaires">
<h3>4.3.4.3.5. Recalcul du graph des métadonnées des sites secondaires<a class="headerlink" href="#recalcul-du-graph-des-metadonnees-des-sites-secondaires" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p>Cette procédure doit être exécutée uniquement en cas de :</p>
<ul class="last simple">
<li>migration majeure depuis une version R16.6- (4.0.6 ou inférieure)</li>
<li>migration majeure depuis une version v5.rc.3- (v5.rc.3 ou inférieure)</li>
</ul>
</div>
<p>Cette procédure permet le recalcul du graphe des métadonnées sur les sites secondaires</p>
<p>La procédure est à réaliser sur tous les <strong>sites secondaires</strong> de Vitam APRÈS l’installation de la nouvelle version :</p>
<ul>
<li><p class="first">S’assurer que Vitam soit bien préalablement arrêté (via le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam-exploitation/stop_vitam_timers.yml</span></code>)</p>
</li>
<li><p class="first">Exécuter le playbook :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook ansible-vitam-migration/migration_metadata_graph_reconstruction.yml -i environments/hosts.<span class="o">{</span>env<span class="o">}</span> --ask-vault-pass
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="redemarrage-des-timers-et-des-acces-externes-a-vitam">
<h3>4.3.4.3.6. Redémarrage des timers et des accès externes à Vitam<a class="headerlink" href="#redemarrage-des-timers-et-des-acces-externes-a-vitam" title="Lien permanent vers ce titre">¶</a></h3>
<p>La montée de version est maintenant terminée, vous pouvez réactiver les services externals ainsi que les timers sur <strong>tous les sites</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/start_external.yml --ask-vault-pass
  ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/start_vitam_timers.yml --ask-vault-pass

..
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="v5rc_update.html" class="btn btn-neutral float-left" title="4.3.3. Notes et procédures spécifiques V5RC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="v6rc_update.html" class="btn btn-neutral float-right" title="4.3.5. Notes et procédures spécifiques V6RC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>