<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.2.6. Notes et procédures spécifiques V6 &mdash; Documentation VITAM - Documentation de montées de version 9.0.0</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="4.2.7. Notes et procédures spécifiques V7.0" href="v7_0_update.html" />
    <link rel="prev" title="4.2.5. Notes et procédures spécifiques V6RC" href="v6rc_update.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VITAM - Documentation de montées de version
              <img src="../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                9.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generalites.html">3. Généralités sur les versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_toc.html">4. Montées de version</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../principles.html">4.1. Principes généraux</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html">4.2. Montées de version <em>bugfix</em></a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="r13_update.html">4.2.1. Notes et procédures spécifiques R13</a></li>
<li class="toctree-l3"><a class="reference internal" href="r16_update.html">4.2.2. Notes et procédures spécifiques R16</a></li>
<li class="toctree-l3"><a class="reference internal" href="v5rc_update.html">4.2.3. Notes et procédures spécifiques V5RC</a></li>
<li class="toctree-l3"><a class="reference internal" href="v5_update.html">4.2.4. Notes et procédures spécifiques V5</a></li>
<li class="toctree-l3"><a class="reference internal" href="v6rc_update.html">4.2.5. Notes et procédures spécifiques V6RC</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.2.6. Notes et procédures spécifiques V6</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedures-a-executer-avant-la-montee-de-version">4.2.6.1. Procédures à exécuter AVANT la montée de version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedures-a-executer-apres-la-montee-de-version">4.2.6.2. Procédures à exécuter APRÈS la montée de version</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="v7_0_update.html">4.2.7. Notes et procédures spécifiques V7.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="v7_1_update.html">4.2.8. Notes et procédures spécifiques V7.1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases_updates/_toc.html">4.3. Montées de version majeures</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VITAM - Documentation de montées de version</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../_toc.html">4. Montées de version</a></li>
          <li class="breadcrumb-item"><a href="_toc.html">4.2. Montées de version <em>bugfix</em></a></li>
      <li class="breadcrumb-item active">4.2.6. Notes et procédures spécifiques V6</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/updates/bugfixes_updates/v6_update.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="notes-et-procedures-specifiques-v6">
<h1>4.2.6. Notes et procédures spécifiques V6<a class="headerlink" href="#notes-et-procedures-specifiques-v6" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="procedures-a-executer-avant-la-montee-de-version">
<h2>4.2.6.1. Procédures à exécuter AVANT la montée de version<a class="headerlink" href="#procedures-a-executer-avant-la-montee-de-version" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="duplication-des-packages-lors-de-la-mise-a-jour">
<h3>4.2.6.1.1. Duplication des packages lors de la mise à jour<a class="headerlink" href="#duplication-des-packages-lors-de-la-mise-a-jour" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette procédure doit être exécutée uniquement en cas de migration depuis une version 6.2- (v6.2 ou inférieur) vers une version 6.3+ (v6.3 ou supérieure).</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette opération doit être effectuée uniquement pour les systèmes d’exploitation à base de RPM (CentOS 7 &amp; AlmaLinux 9) sur un vitam éteint.</p>
</div>
<p>Un bug a été introduit dans la construction des packages RPM à partir de la V6RC. Si vous effectuez une montée de version depuis la V6RC ou de la V6, vous devrez appliquer la commande suivante pour supprimer les précédents packages. Sinon lors de de la mise à jour, le package précédent ne sera pas désinstallé conduisant à la présence de plusieurs versions du même package.</p>
<p>Exemple d’erreur:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/var/tmp/rpm-tmp.fGwZMk: ligne <span class="m">1</span> : fg: pas de contrôle de tâche
erreur : %preun<span class="o">(</span>vitam-offer-6.2-1.noarch<span class="o">)</span> scriptlet échoué, état de sortie <span class="m">1</span>
Error in PREUN scriptlet in rpm package vitam-offer
erreur : vitam-offer-6.2-1.noarch: effacer échoué
</pre></div>
</div>
<p>Voici la commande à exécuter pour permettre la désinstallation des packages de la version précédente:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible vitam --ask-vault-pass -v -a <span class="s2">&quot;yum --setopt=tsflags=noscripts remove -y vitam-*.noarch&quot;</span> -i environments/&lt;inventaire&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="procedures-a-executer-apres-la-montee-de-version">
<h2>4.2.6.2. Procédures à exécuter APRÈS la montée de version<a class="headerlink" href="#procedures-a-executer-apres-la-montee-de-version" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="migration-des-mappings-elasticsearch">
<h3>4.2.6.2.1. Migration des mappings elasticsearch<a class="headerlink" href="#migration-des-mappings-elasticsearch" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette procédure doit être exécutée uniquement en cas de migration depuis une version 6.1- (v6.1 ou inférieur) vers une version 6.2+ (6.2 ou supérieure).</p>
</div>
<p>Cette migration de données consiste à mettre à jour le modèle d’indexation elasticsearch-data.</p>
<p>Elle est réalisée en exécutant la procédure suivante sur <strong>tous les sites</strong> (primaire et secondaire(s)) :</p>
<ul class="simple">
<li>Les jobs Vitam et les services externals de Vitam doivent être arrêtés sur <strong>tous les sites</strong> :</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_external.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_vitam_scheduling.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/stop_vitam_scheduler.yml --ask-vault-pass
</pre></div>
</div>
<ul class="simple">
<li>Réindexation des référentiels sur elasticsearch :</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/reindex_es_data.yml --ask-vault-pass --tags <span class="s2">&quot;securityprofile, context, ontology, ingestcontract, agencies, accessionregisterdetail, archiveunitprofile, accessionregistersummary, accesscontract, fileformat, filerules, profile, griffin, preservationscenario, managementcontract&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Lancement de la migration du modèles d’indexation des métadonnées sur elasticsearch-data :</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-migration/migration_elasticsearch_mapping.yml --ask-vault-pass
</pre></div>
</div>
<ul class="simple">
<li>Réactivation des services externals ainsi que les timers sur <strong>tous les sites</strong> :</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/start_external.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/start_vitam_scheduler.yml --ask-vault-pass
ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-exploitation/start_vitam_scheduling.yml --ask-vault-pass
</pre></div>
</div>
</div>
<div class="section" id="migration-unites-archivistiques-avec-demande-de-transfert-non-completee">
<h3>4.2.6.2.2. Migration unités archivistiques avec demande de transfert non complétée<a class="headerlink" href="#migration-unites-archivistiques-avec-demande-de-transfert-non-completee" title="Lien permanent vers ce titre">¶</a></h3>
<p>Cette migration permet de corriger des erreurs de sécurisation ou d’audit sur des unités archivistiques pour lesquelles une demande de transfert a été initiée, mais dont le transfert effectif n’a pas été finalisée.</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette procédure doit être exécutée uniquement en cas de migration mineure depuis une version 6.3.1- (v6.3.1 ou inférieure) vers une version 6.4+ (v6.4 ou supérieure).</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Cette migration est à effectuer <strong>APRES</strong> l’installation et uniquement sur le <strong>site primaire</strong>.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Dans le cas où un tenant comporte un très grand nombre d’unités archivistiques dont la demande de transfert a été initiée pour un tenant donné (plus de 100 000 unités archivistiques), la migration ne pourra alors s’opérer. Le support Vitam devra alors être contacté.</p>
</div>
<p>Pour lancer la migration, le playbook suivant doit être exécuté :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i environments/&lt;inventaire&gt; ansible-vitam-migration/migration_metadata_transfer_request_traceability.yml --ask-vault-pass
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="v6rc_update.html" class="btn btn-neutral float-left" title="4.2.5. Notes et procédures spécifiques V6RC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="v7_0_update.html" class="btn btn-neutral float-right" title="4.2.7. Notes et procédures spécifiques V7.0" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>