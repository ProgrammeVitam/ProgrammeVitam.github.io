<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. Procédures d’exploitation &mdash; Vitam-UI documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="8. Procédures d’exploitation SSO AgentConnect" href="agentconnect.html" />
    <link rel="prev" title="6. Packaging" href="Packaging.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="../index.html">
            <img src="../_static/Vitam_Logo-CMJN.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pr%C3%A9_installation.html">2. Variabilisation et modifications possibles pré-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Personnalisation_applications.html">3. Personnalisation d’applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regroupement_des_services_VitamUI.html">4. Les impacts d’avoir plusieurs applications dans un seul micro-service</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regroupement_des_services_VitamUI.html#les-etapes-pour-ajouter-une-application-existante-dans-un-service-a-part-le-service-initial-de-lapplication">5. Les étapes pour ajouter une application existante dans un service à part le service initial de l’application</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packaging.html">6. Packaging</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Procédures d’exploitation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#demarrage-de-la-solution">7.1. Démarrage de la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arret-de-la-solution">7.2. Arrêt de la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-de-la-solution">7.3. Upgrade de la solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sauvegarde-de-la-solution">7.4. Sauvegarde de la solution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sauvegarde-via-playbook-1">7.4.1. Sauvegarde via playbook (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sauvegarde-via-la-commande-mongodump-2">7.4.2. Sauvegarde via la commande mongodump (2)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#restoration-de-la-solution">7.5. Restoration de la solution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#restoration-via-playbook-1">7.5.1. Restoration via playbook (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restoration-via-la-commande-mongodump-2">7.5.2. Restoration via la commande mongodump (2)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#changement-de-pki">7.6. Changement de PKI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#certificat-vitam-ui-client-expire-dans-vitam">7.6.1. Certificat Vitam-UI client expiré dans Vitam</a></li>
<li class="toctree-l3"><a class="reference internal" href="#certificats-expires-dans-les-services-vitamui">7.6.2. Certificats expirés dans les services VitamUI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analyse-des-problemes-vitam-ui">7.7. Analyse des problèmes Vitam-UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#logs">7.7.1. Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongodb">7.7.2. MongoDB</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-des-profils-de-mot-de-passe">7.8. Configuration des profils de mot de passe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#profil-anssi">7.8.1. Profil ANSSI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-changement-de-la-taille-du-mot-de-passe">7.8.1.1. Exemple de changement de la taille du mot de passe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-desactivation-du-contrainte-de-verification-d-existence-d-une-occurrence-d-un-nom-d-utilisateur-dans-les-mots-de-passe">7.8.1.2. Exemple de désactivation du contrainte de vérification d’existence d’une occurrence d’un nom d’utilisateur dans les mots de passe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-changement-du-nombre-de-caracteres-tolerables-du-nom-d-utilisateur-a-utiliser-dans-le-mot-de-passe">7.8.1.3. Exemple de changement du nombre de caractères tolérables du nom d’utilisateur à utiliser dans le mot de passe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser">7.8.1.4. Exemple de changement du nombre des anciens mots de passe à ne pas réutiliser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-personnalisation-des-messages-redues-a-l-utilisateur">7.8.1.5. Exemple de personnalisation des messages redues à l’utilisateur</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#profil-personnalise">7.8.2. Profil personnalisé</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-changement-de-la-taille-du-mot-de-passe-pour-le-profil-custom">7.8.2.1. Exemple de changement de la taille du mot de passe pour le profil custom</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser-pour-le-profil-custom">7.8.2.2. Exemple de changement du nombre des anciens mots de passe à ne pas réutiliser pour le profil custom</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gestion-du-timeout-lors-de-creation-d-organisations">7.8.3. Gestion du timeout lors de création d’organisations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#timers-vitam-ui">7.9. Timers Vitam-UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bascule-des-timers-en-cas-de-multi-instanciation-du-service-iam-internal">7.9.1. Bascule des timers en cas de multi-instanciation du service iam-internal</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="agentconnect.html">8. Procédures d’exploitation SSO AgentConnect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html">9. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#opentracing">10. OpenTracing :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#jager">11. Jager :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#principaux-composants-de-jaeger">12. Principaux composants de Jaeger</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#tests-en-local">13. Tests en local :</a></li>
<li class="toctree-l1"><a class="reference internal" href="RGPD.html">14. Anonymisation des données personnelles des utilisateurs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitam-UI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">7. </span>Procédures d’exploitation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/sections/procedure.md.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="procedures-d-exploitation">
<h1><span class="section-number">7. </span>Procédures d’exploitation<a class="headerlink" href="#procedures-d-exploitation" title="Lien permanent vers cette rubrique"></a></h1>
<section id="demarrage-de-la-solution">
<h2><span class="section-number">7.1. </span>Démarrage de la solution<a class="headerlink" href="#demarrage-de-la-solution" title="Lien permanent vers cette rubrique"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt --extra-vars=@./environments/vitamui_extra_vars.yml -i environments/&lt;hostfile_vitamui&gt; ansible-vitamui-exploitation/start_vitamui.yml</span>
</pre></div>
</div>
</section>
<section id="arret-de-la-solution">
<h2><span class="section-number">7.2. </span>Arrêt de la solution<a class="headerlink" href="#arret-de-la-solution" title="Lien permanent vers cette rubrique"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt --extra-vars=@./environments/vitamui_extra_vars.yml -i environments/&lt;hostfile_vitamui&gt; ansible-vitamui-exploitation/stop_vitamui.yml</span>
</pre></div>
</div>
</section>
<section id="upgrade-de-la-solution">
<h2><span class="section-number">7.3. </span>Upgrade de la solution<a class="headerlink" href="#upgrade-de-la-solution" title="Lien permanent vers cette rubrique"></a></h2>
<p>Actuellement, un upgrade de solution s’apparente à une installation de la solution.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt --extra-vars=@./environments/vitamui_extra_vars.yml -i environments/&lt;hostfile_vitamui&gt; ansible-vitamui/vitamui.yml</span>
</pre></div>
</div>
<p>Les services Vitam-UI sont stateless et vont être remplacés par une nouvelle version lors de l’opération précédente.</p>
<p>Les scripts de base de données MongoDB sont versionnés via un changelog interne. Un même script ne peut pas être joué 2 fois. Les nouveaux scripts vont être intégrés et les anciens scripts ou doublons de scripts ne vont pas être pris en compte.</p>
</section>
<hr class="docutils" />
<section id="sauvegarde-de-la-solution">
<h2><span class="section-number">7.4. </span>Sauvegarde de la solution<a class="headerlink" href="#sauvegarde-de-la-solution" title="Lien permanent vers cette rubrique"></a></h2>
<p>La base de données Mongodb utilisée par Vitam-UI peut être sauvegardée de 2 manières:</p>
<ol class="arabic simple">
<li><p>via un playbook de sauvegarde (mongo_backup.yml)</p></li>
<li><p>via un dump (commande mongodump)</p></li>
</ol>
<section id="sauvegarde-via-playbook-1">
<h3><span class="section-number">7.4.1. </span>Sauvegarde via playbook (1)<a class="headerlink" href="#sauvegarde-via-playbook-1" title="Lien permanent vers cette rubrique"></a></h3>
<p>Au préalable il est nécessaire de valoriser correctement les variables suivantes contenues dans le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/mongodb_vars.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mongo_dump_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/backup/mongod/</span><span class="w"></span>
<span class="nt">mongo_backup_reinstall</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;iam&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">collections</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;customers&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;externalParameters&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;groups&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;owners&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;profiles&quot;</span><span class="p p-Indicator">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;sequences&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;subrogations&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;tenants&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;users&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;providers&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">collections</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>La structure <code class="docutils literal notranslate"><span class="pre">mongo_backup_reinstall</span></code> va permettre de sauvegarder la base entière si elle est renseignée de la sorte:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mongo_backup_reinstall</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">collections</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Et les collections uniquement lorsque mentionné comme suit:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mongo_backup_reinstall</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;iam&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">collections</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;customers&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;externalParameters&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;groups&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;owners&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;profiles&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;sequences&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;subrogations&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;tenants&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;users&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;providers&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
</pre></div>
</div>
<p>Le résultat du backup pourra se retrouver dans</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mongo_dump_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/backup/mongod/</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook -i environments/&lt;hostfile_vitamui&gt; --vault-password-file vault_pass.txt --extra-vars=@./environments/vitamui_extra_vars.yml ansible-vitamui-exploitation/mongo_backup.yml</span>
</pre></div>
</div>
</section>
<section id="sauvegarde-via-la-commande-mongodump-2">
<h3><span class="section-number">7.4.2. </span>Sauvegarde via la commande mongodump (2)<a class="headerlink" href="#sauvegarde-via-la-commande-mongodump-2" title="Lien permanent vers cette rubrique"></a></h3>
<p>Se rendre sur la machine (vm) hébergeant l’instance mongodb de Vitam-UI et exécuter la commande suivante:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mongodump --host &quot;ip_machine:27017&quot; -u [user] -p [mdp] -v --gzip --out=&quot;/backup/mongod/`date \+\%Y\%m\%d_\%s`&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="restoration-de-la-solution">
<h2><span class="section-number">7.5. </span>Restoration de la solution<a class="headerlink" href="#restoration-de-la-solution" title="Lien permanent vers cette rubrique"></a></h2>
<p>De la même manière, la base de données Mongodb utilisée par VitamUI peut être sauvegardée de 2 manières:</p>
<ol class="arabic simple">
<li><p>via un playbook de sauvegarde (mongo_restore.yml)</p></li>
<li><p>via un dump (commande mongodump)</p></li>
</ol>
<section id="restoration-via-playbook-1">
<h3><span class="section-number">7.5.1. </span>Restoration via playbook (1)<a class="headerlink" href="#restoration-via-playbook-1" title="Lien permanent vers cette rubrique"></a></h3>
<p>La restoration va chercher le backup présent dans le dossier que renseigne la variable « mongo_dump_folder ».</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt --extra-vars=@./environments/vitamui_extra_vars.yml -i environments/&lt;hostfile_vitamui&gt; ansible-vitamui-exploitation/mongo_restore.yml</span>
</pre></div>
</div>
</section>
<section id="restoration-via-la-commande-mongodump-2">
<h3><span class="section-number">7.5.2. </span>Restoration via la commande mongodump (2)<a class="headerlink" href="#restoration-via-la-commande-mongodump-2" title="Lien permanent vers cette rubrique"></a></h3>
<p>Se rendre sur la machine (vm) hébergeant l’instance mongodb de Vitam-UI et exécuter la commande suivante:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mongorestore --host [ip machinie] --port 27017 --username [user] --password [mdp] &quot;/backup/mongod/[nom_backup] --drop --gzip --maintainInsertionOrder</span>
</pre></div>
</div>
<blockquote>
<div><p>Attention ! Certaines informations Vitam sont sauvegardées dans Vitam-UI.</p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="changement-de-pki">
<h2><span class="section-number">7.6. </span>Changement de PKI<a class="headerlink" href="#changement-de-pki" title="Lien permanent vers cette rubrique"></a></h2>
<p>Les certificats utilisés par Vitam et VitamUI peuvent être amenés à être changés pour des raisons de sécurité ou simplement suite à leur expiration.</p>
<section id="certificat-vitam-ui-client-expire-dans-vitam">
<h3><span class="section-number">7.6.1. </span>Certificat Vitam-UI client expiré dans Vitam<a class="headerlink" href="#certificat-vitam-ui-client-expire-dans-vitam" title="Lien permanent vers cette rubrique"></a></h3>
<p>Le certificat client vitamui.crt est utilisé par Vitam afin que l’application Vitam-UI accède aux informations de Vitam. Son échange se fait par les playbooks Vitam remove_contexts.yml et add_contexts.yml dans les sources de Vitam.</p>
<p>Renseigner le fichier <code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/postinstall_param.yml</span></code> avec les informations du certificat actuel et lancer la commande de suppression suivante:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt -i environments/&lt;hostfile_vitam&gt; ansible-vitam-exploitation/remove_contexts.yml</span>
</pre></div>
</div>
<p>Se connecter à l’ihm_demo de Vitam pour vérifier la bonne suppression du context vitamui_context dans les contextes applicatifs Vitam.</p>
<p>Une fois cette opération réalisée, il faut :</p>
<ul class="simple">
<li><p>Regénérer ou échanger le certificat vitamui.crt afin qu’il soit valide.</p></li>
<li><p>Modifier les informations du fichier postinstall_param.yml avec le nom du nouveau certificat et lancer la commande suivante:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook --vault-password-file vault_pass.txt -i environments/&lt;hostfile_vitam&gt; ansible-vitam-exploitation/add_contexts.yml</span>
</pre></div>
</div>
<p>Vérifier alors dans les contextes applicatifs Vitam que le contexte vitamui_context est de nouveau présent (rattaché de manière transparente au nouveau certificat).</p>
</section>
<section id="certificats-expires-dans-les-services-vitamui">
<h3><span class="section-number">7.6.2. </span>Certificats expirés dans les services VitamUI<a class="headerlink" href="#certificats-expires-dans-les-services-vitamui" title="Lien permanent vers cette rubrique"></a></h3>
<p>Regénérer la PKI complète VitamUI et Vitam.</p>
<p>Rédéployer la PKI pour les 2 solutions.</p>
<p>Les commandes sont précisées dans le dossier d’installation VitamUI.</p>
</section>
</section>
<hr class="docutils" />
<section id="analyse-des-problemes-vitam-ui">
<h2><span class="section-number">7.7. </span>Analyse des problèmes Vitam-UI<a class="headerlink" href="#analyse-des-problemes-vitam-ui" title="Lien permanent vers cette rubrique"></a></h2>
<section id="logs">
<h3><span class="section-number">7.7.1. </span>Logs<a class="headerlink" href="#logs" title="Lien permanent vers cette rubrique"></a></h3>
<p>Les traces applicatives ou techniques de Vitam-UI se trouvent sur les machines hébergeant l’application dans <code class="docutils literal notranslate"><span class="pre">/vitamui/log/nom_service/</span></code> pour le service considéré.</p>
<p>Les logs sont écrits via le service rsyslog installé sur toutes les machines de la solution.</p>
</section>
<section id="mongodb">
<h3><span class="section-number">7.7.2. </span>MongoDB<a class="headerlink" href="#mongodb" title="Lien permanent vers cette rubrique"></a></h3>
<p>Se connecter à la vm où est hébergé l’instance mongod.</p>
<p>Se connecter à la base de données via l’utilitaire mongo.</p>
<p>Exemple de commande:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mongo --host &lt;ip machine&gt; --port 27017 admin --username=&lt;user&gt; --password=&lt;password&gt;</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="configuration-des-profils-de-mot-de-passe">
<h2><span class="section-number">7.8. </span>Configuration des profils de mot de passe<a class="headerlink" href="#configuration-des-profils-de-mot-de-passe" title="Lien permanent vers cette rubrique"></a></h2>
<section id="profil-anssi">
<h3><span class="section-number">7.8.1. </span>Profil ANSSI<a class="headerlink" href="#profil-anssi" title="Lien permanent vers cette rubrique"></a></h3>
<p>Le profil par défaut chargé au démarrage de CAS, la configuration de ce profil sur une plateforme déjà installé se fait sur la machine hénergeante le serveur CAS, la configuration se situe dans <code class="docutils literal notranslate"><span class="pre">/vitamui/conf/cas-server/application.yml</span></code>, dans la section <code class="docutils literal notranslate"><span class="pre">password:</span></code></p>
<p>L’exploitant peut changer quelques contraintes de la complexité du mot de passe, sans violer les standards de l’ANSSI.</p>
<section id="exemple-de-changement-de-la-taille-du-mot-de-passe">
<h4><span class="section-number">7.8.1.1. </span>Exemple de changement de la taille du mot de passe<a class="headerlink" href="#exemple-de-changement-de-la-taille-du-mot-de-passe" title="Lien permanent vers cette rubrique"></a></h4>
<p>dans la section <code class="docutils literal notranslate"><span class="pre">password:</span></code>, l’attribut <code class="docutils literal notranslate"><span class="pre">length</span></code> est par défaut à 12, le changement de la taille du mot de passe revient à changer cet attribut <code class="docutils literal notranslate"><span class="pre">length</span></code>, cette valeur sera automatiquement portée par l’attribut <code class="docutils literal notranslate"><span class="pre">cas.authn.pm.core.policy-pattern:</span></code> qui contient l’expression <code class="docutils literal notranslate"><span class="pre">${password.length}$</span></code>.
l’attribut <code class="docutils literal notranslate"><span class="pre">cas.authn.pm.core.policy-pattern:</span></code> contient l’expression régulière de validation du mot de passe et qui se trouve dans le meme fichier de configuration.</p>
<blockquote>
<div><p>Cette valeur ne devra pas etre inférieur à la valeur par défaut, avec le profil anssi.</p>
</div></blockquote>
</section>
<section id="exemple-de-desactivation-du-contrainte-de-verification-d-existence-d-une-occurrence-d-un-nom-d-utilisateur-dans-les-mots-de-passe">
<h4><span class="section-number">7.8.1.2. </span>Exemple de désactivation du contrainte de vérification d’existence d’une occurrence d’un nom d’utilisateur dans les mots de passe<a class="headerlink" href="#exemple-de-desactivation-du-contrainte-de-verification-d-existence-d-une-occurrence-d-un-nom-d-utilisateur-dans-les-mots-de-passe" title="Lien permanent vers cette rubrique"></a></h4>
<p>Cette contrainte est traduite par l’attribut: <code class="docutils literal notranslate"><span class="pre">check-occurrence</span></code>, qui est un boolean par défaut égal à <code class="docutils literal notranslate"><span class="pre">true</span></code>,</p>
<p>Donc <code class="docutils literal notranslate"><span class="pre">check-occurrence:</span> <span class="pre">false</span></code> désactivera cette vérification.</p>
</section>
<section id="exemple-de-changement-du-nombre-de-caracteres-tolerables-du-nom-d-utilisateur-a-utiliser-dans-le-mot-de-passe">
<h4><span class="section-number">7.8.1.3. </span>Exemple de changement du nombre de caractères tolérables du nom d’utilisateur à utiliser dans le mot de passe<a class="headerlink" href="#exemple-de-changement-du-nombre-de-caracteres-tolerables-du-nom-d-utilisateur-a-utiliser-dans-le-mot-de-passe" title="Lien permanent vers cette rubrique"></a></h4>
<p>Cette contraintes pourra etre changée avec l’attribut <code class="docutils literal notranslate"><span class="pre">occurrences-chars-number:</span></code>, par défault la valeur est égal à <code class="docutils literal notranslate"><span class="pre">3</span></code>,</p>
<p>Donc <code class="docutils literal notranslate"><span class="pre">occurrences-chars-number:</span> <span class="pre">5</span></code>, augmentera le nombre de caractère tolérable issues du nom de l’utilisateur à utiliser dans un mot de passe.</p>
<blockquote>
<div><p>Cette valeur ne devra pas etre inférieur à la valeur par défaut.</p>
</div></blockquote>
<p>Si la taille du nom de l’utilisateur est inférieur à cette valeur, la contrainte est tolérable.</p>
</section>
<section id="exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser">
<h4><span class="section-number">7.8.1.4. </span>Exemple de changement du nombre des anciens mots de passe à ne pas réutiliser<a class="headerlink" href="#exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser" title="Lien permanent vers cette rubrique"></a></h4>
<p>Cette contraintes pourra etre changée avec l’attribut <code class="docutils literal notranslate"><span class="pre">max-old-password:</span></code>, par défault la valeur est égal à <code class="docutils literal notranslate"><span class="pre">12</span></code> dans le profil anssi, et <code class="docutils literal notranslate"><span class="pre">3</span></code> dans le profil custom,</p>
<p>Donc <code class="docutils literal notranslate"><span class="pre">max-old-password:</span> <span class="pre">13</span></code>, augmentera le nombre d’anciens mots de passe à ne pas réutiliser”</p>
<p>Ce changement devra etre fait aussi sur le composant <code class="docutils literal notranslate"><span class="pre">iam-internal</span></code>, dans le fichier <code class="docutils literal notranslate"><span class="pre">/vitamui/conf/iam-internal/application.yml</span></code>, dans la section <code class="docutils literal notranslate"><span class="pre">password</span></code>.</p>
<blockquote>
<div><p>Cette valeur ne devra pas etre inférieur à la valeur par défaut, avec le profil anssi.
Le redémarrage du composant iam-internal est nécessaire avec ce changement.</p>
</div></blockquote>
</section>
<section id="exemple-de-personnalisation-des-messages-redues-a-l-utilisateur">
<h4><span class="section-number">7.8.1.5. </span>Exemple de personnalisation des messages redues à l’utilisateur<a class="headerlink" href="#exemple-de-personnalisation-des-messages-redues-a-l-utilisateur" title="Lien permanent vers cette rubrique"></a></h4>
<p>Les messages peuvent etre personnalisés par l’exploitant dans le bloc, par langue</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">constraints</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">defaults</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">fr</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 1</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 2</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">            </span><span class="nt">special-chars</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;message</span><span class="nv"> </span><span class="s">3&#39;</span><span class="w"></span>
<span class="w">                </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 4</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 5</span><span class="w"></span>
<span class="w">            </span><span class="nt">en</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 1</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 2</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">                </span><span class="nt">special-chars</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;message</span><span class="nv"> </span><span class="s">3&#39;</span><span class="w"></span>
<span class="w">                    </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 4</span><span class="w"></span>
<span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 5</span><span class="w"></span>
<span class="w">            </span><span class="nt">de</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 1</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 2</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">                </span><span class="nt">special-chars</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;message</span><span class="nv"> </span><span class="s">3&#39;</span><span class="w"></span>
<span class="w">                    </span><span class="nt">messages</span><span class="p">:</span><span class="w"></span>
<span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 4</span><span class="w"></span>
<span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message 5</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>C’est à charge de l’exploitant de respecter les contraintes traduites, qui devront etre en cohérence avec les blocs / attributs de son profil anssi, et qui devront pas violer les standards préconisés par l’ANSSI et la PSSI du ministère de la culture.</p>
</div></blockquote>
</section>
</section>
<section id="profil-personnalise">
<h3><span class="section-number">7.8.2. </span>Profil personnalisé<a class="headerlink" href="#profil-personnalise" title="Lien permanent vers cette rubrique"></a></h3>
<section id="exemple-de-changement-de-la-taille-du-mot-de-passe-pour-le-profil-custom">
<h4><span class="section-number">7.8.2.1. </span>Exemple de changement de la taille du mot de passe pour le profil custom<a class="headerlink" href="#exemple-de-changement-de-la-taille-du-mot-de-passe-pour-le-profil-custom" title="Lien permanent vers cette rubrique"></a></h4>
<p>dans la section <code class="docutils literal notranslate"><span class="pre">password:</span></code>, l’attribut <code class="docutils literal notranslate"><span class="pre">length</span></code> est par défaut à 12, le changement de la taille du mot de passe revient à changer cet attribut <code class="docutils literal notranslate"><span class="pre">length</span></code>, cette valeur sera automatiquement portée par l’attribut <code class="docutils literal notranslate"><span class="pre">cas.authn.pm.core.policy-pattern:</span></code> qui contient l’expression <code class="docutils literal notranslate"><span class="pre">${password.length}$</span></code> , à la fin de l’expression régulière.
L’attribut <code class="docutils literal notranslate"><span class="pre">cas.authn.pm.core.policy-pattern:</span></code> contient l’expression régulière globale de validation du mot de passe et qui se trouve dans le meme fichier de configuration.</p>
<blockquote>
<div><p>Cette valeur est par défaut égal à 8 pour le profil custom.</p>
</div></blockquote>
</section>
<section id="exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser-pour-le-profil-custom">
<h4><span class="section-number">7.8.2.2. </span>Exemple de changement du nombre des anciens mots de passe à ne pas réutiliser pour le profil custom<a class="headerlink" href="#exemple-de-changement-du-nombre-des-anciens-mots-de-passe-a-ne-pas-reutiliser-pour-le-profil-custom" title="Lien permanent vers cette rubrique"></a></h4>
<p>Les memes configurations que pour le profil anssi.</p>
<blockquote>
<div><p>Veillez à redémarrer le serveur CAS, et le composant iam-internal pour appliquer ces changements.</p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="gestion-du-timeout-lors-de-creation-d-organisations">
<h3><span class="section-number">7.8.3. </span>Gestion du timeout lors de création d’organisations<a class="headerlink" href="#gestion-du-timeout-lors-de-creation-d-organisations" title="Lien permanent vers cette rubrique"></a></h3>
<p>La création d’oranisations est un worflow nécessitant l’execution de plusieurs actions, c’est pour cette raison que dans certains cas en fonction des performances de l’infrastructure, le super-admin peut constater un timeout dans ce workflow. Dans ce cas, on peut augmenter la valeur de ce timeout admin dans les fichiers de configurations des deux applications: iam-external et ui-identity-admin:</p>
<ul class="simple">
<li><p>Dans ui-identity-admin</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ui-identity</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">iam-external-client</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">connect-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">        </span><span class="nt">read-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">        </span><span class="nt">write-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Dans iam-external</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">iam-external</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">iam-internal-client</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">connect-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">        </span><span class="nt">read-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">        </span><span class="nt">write-time-out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
</pre></div>
</div>
<p>Cette section est détaillée dans le document d’installation de Vitam-UI.</p>
</section>
</section>
<hr class="docutils" />
<section id="timers-vitam-ui">
<h2><span class="section-number">7.9. </span>Timers Vitam-UI<a class="headerlink" href="#timers-vitam-ui" title="Lien permanent vers cette rubrique"></a></h2>
<section id="bascule-des-timers-en-cas-de-multi-instanciation-du-service-iam-internal">
<h3><span class="section-number">7.9.1. </span>Bascule des timers en cas de multi-instanciation du service iam-internal<a class="headerlink" href="#bascule-des-timers-en-cas-de-multi-instanciation-du-service-iam-internal" title="Lien permanent vers cette rubrique"></a></h3>
<p>Dans le cadre d’une installation multi-instances du service <code class="docutils literal notranslate"><span class="pre">iam-internal</span></code>, les timers de journalisation des évènements métiers de Vitam-UI sont exécutés sur la première instance du groupe <code class="docutils literal notranslate"><span class="pre">[hosts_vitamui_iam_internal]</span></code> via le paramètre <code class="docutils literal notranslate"><span class="pre">instance.primary:</span> <span class="pre">true</span></code> configuré dans le fichier <code class="docutils literal notranslate"><span class="pre">/vitamui/conf/iam-internal/application.yml</span></code>.</p>
<p>Si cette machine « primaire » est arrêtée, les timers ne sont pas automatiquement redémarrés sur une autre instance.</p>
<p>Pour effectuer la bascule, il sera nécessaire de modifier l’ordre de définition des machines du groupe <code class="docutils literal notranslate"><span class="pre">[hosts_vitamui_iam_internal]</span></code> dans le fichier d’inventaire puis réappliquer le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitamui/vitamui_apps.yml</span> <span class="pre">--tags</span> <span class="pre">iam-internal</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="Packaging.html" class="btn btn-neutral float-left" title="6. Packaging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="agentconnect.html" class="btn btn-neutral float-right" title="8. Procédures d’exploitation SSO AgentConnect" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Programme Vitam.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>