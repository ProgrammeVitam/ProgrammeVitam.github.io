

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. Packaging &mdash; Vitam-UI documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=6b8777ff" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d1a510d7"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=e6b791cb"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="8. Procédures d’exploitation" href="procedure.html" />
    <link rel="prev" title="5. Les impacts d’avoir plusieurs applications dans un seul micro-service" href="Regroupement_des_services_VitamUI.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/Vitam_Logo-CMJN.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pr%C3%A9_installation.html">2. Variabilisation et modifications possibles pré-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_archiving_systems.html">3. Configuration d’accès à des instances Vitam externes tierces (optionnel)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Personnalisation_applications.html">4. Personnalisation d’applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regroupement_des_services_VitamUI.html">5. Les impacts d’avoir plusieurs applications dans un seul micro-service</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regroupement_des_services_VitamUI.html#les-etapes-pour-ajouter-une-application-existante-dans-un-service-a-part-le-service-initial-de-lapplication">6. Les étapes pour ajouter une application existante dans un service à part le service initial de l’application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Packaging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#packaging-java">7.1. Packaging JAVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-javascript">7.2. Packaging Javascript</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-deployment-ansible">7.3. Packaging deployment - ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-rpm">7.4. Packaging RPM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tools-de-packaging-vitamui">7.4.1. Tools de packaging VITAMUI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fabrication-des-rpm">7.4.2. Fabrication des RPM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contenu-du-rpm-makefile-staging-directory">7.4.2.1. Contenu du RPM : Makefile Staging directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creation-des-templates-du-rpm">7.4.2.2. Creation des templates du RPM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-des-binaires-et-fichiers-templates-dans-le-stating-directory">7.4.2.3. Installation des binaires et fichiers templates dans le stating directory:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#packaging-du-repertoire">7.4.2.4. packaging du repertoire</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-dans-maven">7.4.3. Integration dans maven</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to">7.4.4. How to</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="procedure.html">8. Procédures d’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="agentconnect.html">9. Procédures d’exploitation SSO AgentConnect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html">10. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#opentracing">11. OpenTracing :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#jager">12. Jager :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#principaux-composants-de-jaeger">13. Principaux composants de Jaeger</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#tests-en-local">14. Tests en local :</a></li>
<li class="toctree-l1"><a class="reference internal" href="RGPD.html">15. Anonymisation des données personnelles des utilisateurs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitam-UI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">7. </span>Packaging</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/sections/Packaging.md.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="packaging">
<h1><span class="section-number">7. </span>Packaging<a class="headerlink" href="#packaging" title="Lien vers cette rubrique"></a></h1>
<section id="packaging-java">
<h2><span class="section-number">7.1. </span>Packaging JAVA<a class="headerlink" href="#packaging-java" title="Lien vers cette rubrique"></a></h2>
<p>!!! todo
Ecrire la doc sur le packaging Java</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>clean<span class="w"> </span>package
</pre></div>
</div>
</section>
<section id="packaging-javascript">
<h2><span class="section-number">7.2. </span>Packaging Javascript<a class="headerlink" href="#packaging-javascript" title="Lien vers cette rubrique"></a></h2>
<p>!!! todo
Ecrire la doc sur le packaging Javascript</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-P<span class="w"> </span>webpack
</pre></div>
</div>
</section>
<section id="packaging-deployment-ansible">
<h2><span class="section-number">7.3. </span>Packaging deployment - ansible<a class="headerlink" href="#packaging-deployment-ansible" title="Lien vers cette rubrique"></a></h2>
<ul class="simple">
<li><p>Le source code ansible contenu dans le repertoire deployement sera package sous forme d’archive tar.gz.</p></li>
<li><p>Cette archive sera versionnee et publiee comme un artifact Maven dans le repository maven private de VITAMUI.</p></li>
<li><p>Pour l’utiliser, il faudra la telecharger depuis le repo et reconfigurer les fichiers souhaites pour adapter la configuration par defaut a son environnement.</p></li>
</ul>
</section>
<section id="packaging-rpm">
<h2><span class="section-number">7.4. </span>Packaging RPM<a class="headerlink" href="#packaging-rpm" title="Lien vers cette rubrique"></a></h2>
<p>Un fichier RPM est un package utilisable par les repository des systemes RedHat.</p>
<p>Pour VITAMUI, Il contient:</p>
<ul class="simple">
<li><p>L’arboresence de repertoire du system de fichier vitamui pour l’applicatif en question</p></li>
<li><p>Des binaires a installer sur le systeme cible. Dans le cas des applicatifs VITAMUI, il s’agira des JAR files cree dans la phase de
packaging du compilateur maven.</p></li>
<li><p>Des fichiers de configuration par defaut</p></li>
<li><p>Des metadonnnees sur le package (version, license, nom …)</p></li>
<li><p>Des scripts execute avant l’installation, apres  l’installation, avant la desinstallation et apres la desinstallation. Ces scripts se chargeront de modifier les permissions/ownership des fichiers et dossiers installes par le rpm. Ils effectuerons egalement l’enregistrement(/suppression) des services dans systemd a l’installation(/desinstallation) des packages RPM.</p></li>
</ul>
<section id="tools-de-packaging-vitamui">
<h3><span class="section-number">7.4.1. </span>Tools de packaging VITAMUI<a class="headerlink" href="#tools-de-packaging-vitamui" title="Lien vers cette rubrique"></a></h3>
<p>Ils se trouvent dans le repertoire tools/packaging. On y trouve:</p>
<ul class="simple">
<li><p><strong>install_fpm.sh</strong>:  install l’outil FPM psur le systeme</p></li>
</ul>
<p>!!! note
FPM est un outil de package permettant de gerer tout type de package. Il est developpe (ruby) et maintenu par Jordan Sissel, lead du projet Logstash. Il serait cependant judicieux de remplacer cet outil par l’outil par la creation d’un fichier RPMSpec et rpmbuild pour creer les packages.
Ex: https://doc.fedora-fr.org/wiki/La_cr%C3%A9ation_de_RPM_pour_les_nuls_:_Cr%C3%A9ation_du_fichier_SPEC_et_du_Paquetage</p>
<ul class="simple">
<li><p><strong>Makefile</strong>: Makefile par default execute pour toutes les applications developpees par VITAMUI</p></li>
<li><p><strong>publish.sh</strong>: Script de publication d’un RPM sur le repository yum vitamui</p></li>
<li><p><strong>templates/</strong>: Repertoire contenant les templates de scripts RPM et unit systemd, appliques pour chaque application VITAMUI</p></li>
</ul>
</section>
<section id="fabrication-des-rpm">
<h3><span class="section-number">7.4.2. </span>Fabrication des RPM<a class="headerlink" href="#fabrication-des-rpm" title="Lien vers cette rubrique"></a></h3>
<p>La fabrication des paquets RPM se fait en plusieurs etapes:</p>
<ul class="simple">
<li><p>Creation de l’arboresence des application VITAMUI dans un staging directory</p></li>
<li><p>Processing des templates (scripts d’installation / unit systemd / fichier de config command line java)</p></li>
<li><p>Installation des binaires, fichiers et fichier templates dans l’arborescence VITAMUI ainsi que du fichier unit systemd</p></li>
<li><p>packaging en fichier RPM du staging directory avec les scripts RPM et les metadonnees du package.</p></li>
</ul>
<p>Ces etapes se font en appelant, dans le repertoire <strong>target/</strong>, le Makefile de packaging de la sorte:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-f<span class="w"> </span><span class="o">[</span>VITAMUI<span class="w"> </span>PROJECT<span class="w"> </span>DIR<span class="o">]</span>/tools/packaging/Makefile<span class="w">  </span>rpm<span class="w">  </span><span class="nv">NAME</span><span class="o">=[</span>APPLICATION<span class="w"> </span>NAME<span class="o">]</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=[</span>BUILD_VERSION<span class="o">]</span><span class="w">  </span><span class="nv">JAR_FILE</span><span class="o">=[</span>PATH<span class="w"> </span>TO<span class="w"> </span>BUILD<span class="w"> </span>JAR<span class="w"> </span>FILE<span class="o">]</span><span class="w">  </span><span class="nv">USER</span><span class="o">=[</span>USER<span class="w"> </span>THAT<span class="w"> </span>WILL<span class="w"> </span>RUN<span class="w"> </span>VITAMUI<span class="w"> </span>SERVICE<span class="o">]</span><span class="w"> </span><span class="nv">DEPENDENCIES</span><span class="o">=[</span>COMMA<span class="w"> </span>SEP<span class="w"> </span>LIST<span class="w"> </span>OF<span class="w"> </span>RPM<span class="w"> </span>DEPENDENCIES<span class="o">]</span>
</pre></div>
</div>
<p>Pour mieux comprendre ce qu’il se passe dans cette comande, voici le detail des operations effectuees.</p>
<section id="contenu-du-rpm-makefile-staging-directory">
<h4><span class="section-number">7.4.2.1. </span>Contenu du RPM : Makefile Staging directory<a class="headerlink" href="#contenu-du-rpm-makefile-staging-directory" title="Lien vers cette rubrique"></a></h4>
<p>Le staging directory est le pattern utilise pour creer les package VITAMUI. Il consiste a installer dans un repertoire de build l’arborescence de repertoires + fichiers comme elle seraint installée a la racine du serveur</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>package-stage/
├──<span class="w"> </span>vitamui
│<span class="w">   </span>├──<span class="w"> </span>app
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>bin
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>conf
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>data
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>defaults
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>lib
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>log
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>run
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>script
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>└──<span class="w"> </span>tmp
│<span class="w">       </span>└──<span class="w"> </span>archive-internal
</pre></div>
</div>
<p>Pour builder uniquement cet arborescence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">f</span> <span class="p">[</span><span class="n">VITAMUI</span> <span class="n">PROJECT</span> <span class="n">DIR</span><span class="p">]</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">packaging</span><span class="o">/</span><span class="n">Makefile</span>  <span class="n">vitamui</span><span class="o">-</span><span class="n">dirs</span>   <span class="n">NAME</span><span class="o">=</span><span class="p">[</span><span class="n">APPLICATION</span> <span class="n">NAME</span><span class="p">]</span> <span class="n">VERSION</span><span class="o">=</span><span class="p">[</span><span class="n">BUILD_VERSION</span><span class="p">]</span>  <span class="n">JAR_FILE</span><span class="o">=</span><span class="p">[</span><span class="n">PATH</span> <span class="n">TO</span> <span class="n">BUILD</span> <span class="n">JAR</span> <span class="n">FILE</span><span class="p">]</span>  <span class="n">USER</span><span class="o">=</span><span class="p">[</span><span class="n">USER</span> <span class="n">THAT</span> <span class="n">WILL</span> <span class="n">RUN</span> <span class="n">VITAMUI</span> <span class="n">SERVICE</span><span class="p">]</span> <span class="n">DEPENDENCIES</span><span class="o">=</span><span class="p">[</span><span class="n">COMMA</span> <span class="n">SEP</span> <span class="n">LIST</span> <span class="n">OF</span> <span class="n">RPM</span> <span class="n">DEPENDENCIES</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="creation-des-templates-du-rpm">
<h4><span class="section-number">7.4.2.2. </span>Creation des templates du RPM<a class="headerlink" href="#creation-des-templates-du-rpm" title="Lien vers cette rubrique"></a></h4>
<p>Le makefile va creer dans le repertoire <strong>target/package-template/</strong> les scripts d’installation, les fichiers de configurations ainsi que le fichier unit systemd pour l’application en question.</p>
<p>Nous noterons qu’il est possible de rajouter ou modifier des templates par default pour une application. Pour cela, il suffit de creer dans le repertoire de l’application un repertoire packaging avec les fichiers a ajouter ou modifier. C’est le cas pour l’application cas-server</p>
<p>Pour generer ces templates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">f</span> <span class="p">[</span><span class="n">VITAMUI</span> <span class="n">PROJECT</span> <span class="n">DIR</span><span class="p">]</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">packaging</span><span class="o">/</span><span class="n">Makefile</span>  <span class="n">template</span><span class="o">-</span><span class="n">files</span>   <span class="n">NAME</span><span class="o">=</span><span class="p">[</span><span class="n">APPLICATION</span> <span class="n">NAME</span><span class="p">]</span> <span class="n">VERSION</span><span class="o">=</span><span class="p">[</span><span class="n">BUILD_VERSION</span><span class="p">]</span>  <span class="n">JAR_FILE</span><span class="o">=</span><span class="p">[</span><span class="n">PATH</span> <span class="n">TO</span> <span class="n">BUILD</span> <span class="n">JAR</span> <span class="n">FILE</span><span class="p">]</span>  <span class="n">USER</span><span class="o">=</span><span class="p">[</span><span class="n">USER</span> <span class="n">THAT</span> <span class="n">WILL</span> <span class="n">RUN</span> <span class="n">VITAMUI</span> <span class="n">SERVICE</span><span class="p">]</span> <span class="n">DEPENDENCIES</span><span class="o">=</span><span class="p">[</span><span class="n">COMMA</span> <span class="n">SEP</span> <span class="n">LIST</span> <span class="n">OF</span> <span class="n">RPM</span> <span class="n">DEPENDENCIES</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="installation-des-binaires-et-fichiers-templates-dans-le-stating-directory">
<h4><span class="section-number">7.4.2.3. </span>Installation des binaires et fichiers templates dans le stating directory:<a class="headerlink" href="#installation-des-binaires-et-fichiers-templates-dans-le-stating-directory" title="Lien vers cette rubrique"></a></h4>
<p>C’est ce qui est fait en appelant la cible <strong>install</strong> du Makefile.  Le makefile va copier JAR_FILE dans le repertorie vitamui/app/APP_NAME/ puis ensuite copier les fichiers de configuration vitamui/app/APP_NAME/sysconfig/cmd_line_args vitamui/app/APP_NAME/sysconfig/cmd_line_args. Enfin, il copiera dans usr/lib/systemd/systemd  le fichier vitamui-APP_NAME.service gerant l’unit systemd de l’application</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">f</span> <span class="p">[</span><span class="n">VITAMUI</span> <span class="n">PROJECT</span> <span class="n">DIR</span><span class="p">]</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">packaging</span><span class="o">/</span><span class="n">Makefile</span>  <span class="n">install</span> <span class="n">NAME</span><span class="o">=</span><span class="p">[</span><span class="n">APPLICATION</span> <span class="n">NAME</span><span class="p">]</span> <span class="n">VERSION</span><span class="o">=</span><span class="p">[</span><span class="n">BUILD_VERSION</span><span class="p">]</span>  <span class="n">JAR_FILE</span><span class="o">=</span><span class="p">[</span><span class="n">PATH</span> <span class="n">TO</span> <span class="n">BUILD</span> <span class="n">JAR</span> <span class="n">FILE</span><span class="p">]</span>  <span class="n">USER</span><span class="o">=</span><span class="p">[</span><span class="n">USER</span> <span class="n">THAT</span> <span class="n">WILL</span> <span class="n">RUN</span> <span class="n">VITAMUI</span> <span class="n">SERVICE</span><span class="p">]</span> <span class="n">DEPENDENCIES</span><span class="o">=</span><span class="p">[</span><span class="n">COMMA</span> <span class="n">SEP</span> <span class="n">LIST</span> <span class="n">OF</span> <span class="n">RPM</span> <span class="n">DEPENDENCIES</span><span class="p">]</span>
</pre></div>
</div>
<p>Resultat:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>package-stage/
├──<span class="w"> </span>vitamui
│<span class="w">   </span>├──<span class="w"> </span>app
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>│<span class="w">       </span>└──<span class="w"> </span>archive-internal-develop.jar
│<span class="w">   </span>├──<span class="w"> </span>bin
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>conf
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>│<span class="w">       </span>└──<span class="w"> </span>sysconfig
│<span class="w">   </span>│<span class="w">           </span>├──<span class="w"> </span>cmd_line_args
│<span class="w">   </span>│<span class="w">           </span>└──<span class="w"> </span>java_opts
│<span class="w">   </span>├──<span class="w"> </span>data
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>defaults
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>lib
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>log
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>run
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>├──<span class="w"> </span>script
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>archive-internal
│<span class="w">   </span>└──<span class="w"> </span>tmp
│<span class="w">       </span>└──<span class="w"> </span>archive-internal
└──<span class="w"> </span>usr
<span class="w">    </span>└──<span class="w"> </span>lib
<span class="w">        </span>└──<span class="w"> </span>systemd
<span class="w">            </span>└──<span class="w"> </span>system
<span class="w">                </span>└──<span class="w"> </span>vitamui-archive-internal.service
</pre></div>
</div>
</section>
<section id="packaging-du-repertoire">
<h4><span class="section-number">7.4.2.4. </span>packaging du repertoire<a class="headerlink" href="#packaging-du-repertoire" title="Lien vers cette rubrique"></a></h4>
<p>Le packaging se fait avec fpm. Un exemple de packaging d’un source directory vers RPM (avec staging to /) :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>fpm<span class="w"> </span>-s<span class="w"> </span>dir<span class="w"> </span><span class="o">[</span>FPM_OPTIONS<span class="o">]</span><span class="w"> </span>--before-install<span class="w"> </span><span class="s2">&quot;before-install.sh&quot;</span><span class="w"> </span>--after-install<span class="w"> </span>after-install.sh<span class="w"> </span>-t<span class="w"> </span>rpm<span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>PACKAGE_PATH<span class="o">]</span><span class="w">  </span><span class="s2">&quot;[STAGING_ROOT]/=/&quot;</span>
</pre></div>
</div>
<p>Package creation options</p>
<ul class="simple">
<li><p>-s dir:                 indique un repertoire comme source de packaging</p></li>
<li><p>-t rpm:                 format de sortie rpm</p></li>
<li><p>[STAGING_ROOT]/=/       mapping du root path dans le rpm</p></li>
</ul>
<p>Dans les FPM_OPTIONS, nous aurons notammment:</p>
<ul class="simple">
<li><p>-d : la liste des dependances RPm</p></li>
<li><p>–description: description du package. Nous y integrerons par exemple commit id</p></li>
<li><p>–licence: la license du package</p></li>
<li><p>-v : version du pakage</p></li>
<li><p>les scripts RPM:  –before-install « $(TEMPLATE_TMP_DIR)/before-install.sh » –after-install « $(TEMPLATE_TMP_DIR)/after-install.sh »
= –before-remove « $(TEMPLATE_TMP_DIR)/before-remove.sh » –after-remove « $(TEMPLATE_TMP_DIR)/after-remove.sh »</p></li>
</ul>
<p>Cette etape se fait en appelant la target <strong>rpm</strong> du Makefile.</p>
</section>
</section>
<section id="integration-dans-maven">
<h3><span class="section-number">7.4.3. </span>Integration dans maven<a class="headerlink" href="#integration-dans-maven" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Le packaging des RPM est effecutuee dans maven en ajoutant le profil « rpm » lors de l’appel de build.</p></li>
<li><p>le profil RPM est decrit dans le fichier <strong>pom.xml</strong> general du projet</p></li>
<li><p>le packaging Rpm est effectue à la phase « package » de maven</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-P<span class="w"> </span>rpm
</pre></div>
</div>
</section>
<section id="how-to">
<h3><span class="section-number">7.4.4. </span>How to<a class="headerlink" href="#how-to" title="Lien vers cette rubrique"></a></h3>
<p>Liste d’operations utiles sur les rpm</p>
<ul class="simple">
<li><p>Telecharger un fichier RPM depuis un repository YUM</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Installer :</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">yum</span><span class="o">-</span><span class="n">utils</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># Pour downloader le package:</span>
<span class="n">yumdownloader</span> <span class="p">[</span><span class="n">PACKAGE_NAME</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Installer un rpm avec ses dependances depuis un fichiers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="p">[</span><span class="n">PATH_TO_FILE</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Extraire un fichier rpm sous ubuntu:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rpm2cpio<span class="w"> </span><span class="o">[</span>RPM_FILE<span class="o">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-idmv
</pre></div>
</div>
<ul class="simple">
<li><p>Voir les scripts d’installation du package:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rpm<span class="w"> </span>-qp<span class="w"> </span>--scripts<span class="w"> </span><span class="o">[</span>RPM_FILE<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="Regroupement_des_services_VitamUI.html" class="btn btn-neutral float-left" title="5. Les impacts d’avoir plusieurs applications dans un seul micro-service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="procedure.html" class="btn btn-neutral float-right" title="8. Procédures d’exploitation" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2021, Programme Vitam.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>