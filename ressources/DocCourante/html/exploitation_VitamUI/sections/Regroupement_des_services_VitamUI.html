<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Les impacts d’avoir plusieurs applications dans un seul micro-service &mdash; Vitam-UI documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="6. Packaging" href="Packaging.html" />
    <link rel="prev" title="3. Personnalisation d’applications" href="Personnalisation_applications.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="../index.html">
            <img src="../_static/Vitam_Logo-CMJN.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pr%C3%A9_installation.html">2. Variabilisation et modifications possibles pré-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Personnalisation_applications.html">3. Personnalisation d’applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Les impacts d’avoir plusieurs applications dans un seul micro-service</a></li>
<li class="toctree-l1"><a class="reference internal" href="#les-etapes-pour-ajouter-une-application-existante-dans-un-service-a-part-le-service-initial-de-lapplication">5. Les étapes pour ajouter une application existante dans un service à part le service initial de l’application</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packaging.html">6. Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="procedure.html">7. Procédures d’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="agentconnect.html">8. Procédures d’exploitation SSO AgentConnect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html">9. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#opentracing">10. OpenTracing :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#jager">11. Jager :</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#principaux-composants-de-jaeger">12. Principaux composants de Jaeger</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jaeger.html#tests-en-local">13. Tests en local :</a></li>
<li class="toctree-l1"><a class="reference internal" href="RGPD.html">14. Anonymisation des données personnelles des utilisateurs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitam-UI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">4. </span>Les impacts d’avoir plusieurs applications dans un seul micro-service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/sections/Regroupement_des_services_VitamUI.md.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="les-impacts-d-avoir-plusieurs-applications-dans-un-seul-micro-service">
<h1><span class="section-number">4. </span>Les impacts d’avoir plusieurs applications dans un seul micro-service<a class="headerlink" href="#les-impacts-d-avoir-plusieurs-applications-dans-un-seul-micro-service" title="Lien permanent vers cette rubrique"></a></h1>
<p><strong>Changement du mécanisme d’implémentation et de fonctionnement</strong>:</p>
<p>Avec un seul micro-service, il faut regrouper les modules développés dans un seul projet au niveau de la partie UI, c’est à dire avoir un seul projet ui-service qui contient les différents services et endpoint rest avec la partie front du service.
Suivre l’exemple de Identity et Referential (2 micro-services avec plusieurs applications).</p>
<p><strong>problème de casser l’application d’une manière complète (le service tombe en panne)</strong>:</p>
<p>Avec un seul micro service, il y aura juste un seul service déployé donc si on a un souci de déploiement ou un problème de configuration, l’application VitamUI sera en panne en attendant que le service soit up, ce problème peut etre évité si on a la possibilité de multi-instancier le service sur plusieurs VM et sur plusieurs serveur (scalabilité horizontale et verticale).</p>
<p><strong>Refonte des services développés</strong></p>
<p>Il faut refaire les développements coté UI, pour regrouper l’ensemble des services au niveau d’un seul service, c’est comme le service Identity et referential. Dans ce nouveau service il faut déclarer un ensemble des sous modules pour chaque application déclarée dans ce service.
la partie Front de notre service sera ajoutée dans le projet ui-frontend comme un projet à part et ce projet va contenir des sous-applications Angular selon le nombre des applications déclarées et définies au niveau de notre micro-service.</p>
<p><strong>Refonte de la configuration, la partie mongo et aussi Ansible</strong> :</p>
<ul class="simple">
<li><p>Il faut modifier les scripts qui alimentent la base de données Mongo lors de l’initialisation/ déploiement de VitamUI sur un environnement. Le fait d’avoir un seul service va automatiquement demander des modifications au niveau des scripts Ansible et Mongo soit pour la partie alimentation de la base de données (Iam, Services…) soit au niveau de la partie configuration.</p></li>
<li><p>Penser à des nouvelles category pour les applications qui seront regroupées.</p></li>
</ul>
<p><strong>Impossible d’implémenter une procédure de déploiement « par service » permettant de ne retrouver sur les serveurs que les packages/le code relatifs a ces services et que le système soit configuré en conséquence</strong></p>
<p>Avec un seul micro service qui contient plusieurs applications, c’est impossible de choisir quel service à déployer, parce qu’il y a un seul service déployé avec tout ses différents modules (back). Et pour qu’un exploitant a la possibilité d’installer et de déployer des services spécifiques, il faut les services soient séparés comme ça il peut déployer un par un.</p>
</section>
<section id="les-etapes-pour-ajouter-une-application-existante-dans-un-service-a-part-le-service-initial-de-lapplication">
<h1><span class="section-number">5. </span>Les étapes pour ajouter une application existante dans un service à part le service initial de l’application<a class="headerlink" href="#les-etapes-pour-ajouter-une-application-existante-dans-un-service-a-part-le-service-initial-de-lapplication" title="Lien permanent vers cette rubrique"></a></h1>
<ul class="simple">
<li><p>Déplacer le composant parent de l’application vers le composant du service (dans notre cas archive vers ingest).</p></li>
<li><p>Modifier le fichier app-routing-module.ts de notre service (front) en ajoutant un autre path qui pointe sur le composant parent de l’application qui sera ajoutée dans notre service.</p></li>
<li><p>Prendre les services et les contrôleurs de l’application et les mettre dans les services et les contrôleurs du nouveau service (dans notre cas ui-ingest), on déplace les services et les contrôleurs de ui-archive dans ui-ingest.</p></li>
<li><p>Modifier la partie configuration (fichiers yml).</p></li>
<li><p>Modifier la partie roles et templates pour ajouter la configuration en modifiant le fichier application.yml,j2 (c’est pour générer la partie déploiement).</p></li>
<li><p>Modifier le fichier <code class="docutils literal notranslate"><span class="pre">security_ref.js.j2</span></code> du service concerné en ajoutant les roles de la nouvelles application dans le ui_service_context.</p></li>
<li><p>Modifier le fichier <code class="docutils literal notranslate"><span class="pre">application_ref.js.j2</span></code> de l’application concernée en changeant l’URL.</p></li>
<li><p>Supprimer le contenu des fichiers : <code class="docutils literal notranslate"><span class="pre">security_application_ref.js.j2</span></code> ,  <code class="docutils literal notranslate"><span class="pre">cas_services_ref.js.j2</span></code>, <code class="docutils literal notranslate"><span class="pre">security.populate_certificates_ref.js.j2</span></code>, les 3 fichiers concernent l’application en question (ancien service qu’on souhaite ajouter comme application dans un autre service).</p></li>
<li><p>Modifier le fichier: <code class="docutils literal notranslate"><span class="pre">security.populate_certificates_ref.js.j2</span></code> en supprimant la ligne qui déclare l’ancien service de l’application.</p></li>
<li><p>Modifier les fichiers hosts.local et hosts.vitamui</p></li>
<li><p>Modifier le fichier <code class="docutils literal notranslate"><span class="pre">vault-keystores.yml</span></code></p></li>
<li><p>Modifier le fichier <code class="docutils literal notranslate"><span class="pre">vault-certs.yml</span></code>.</p></li>
<li><p>Générer les certificats en exécutant le script <code class="docutils literal notranslate"><span class="pre">generate_certs_dev.sh</span></code></p></li>
<li><p>Générer les stores en exécutant le script <code class="docutils literal notranslate"><span class="pre">generate_stores_dev.sh</span></code></p></li>
<li><p>Alimenter la base de données en exécutant le script : <code class="docutils literal notranslate"><span class="pre">restart_dev.sh</span></code></p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="Personnalisation_applications.html" class="btn btn-neutral float-left" title="3. Personnalisation d’applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="Packaging.html" class="btn btn-neutral float-right" title="6. Packaging" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Programme Vitam.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>