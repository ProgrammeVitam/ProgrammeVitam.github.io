<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.26. Recherche exacte sur des champs texte &mdash; Documentation VITAM - Documentation d&#39;exploitation 8.0.0</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="5.27. Nettoyage des ingests incomplets" href="65-ingest-cleanup.html" />
    <link rel="prev" title="5.25. Réindexation" href="60-reindexation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VITAM - Documentation d'exploitation
              <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">5. Exploitation globale</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10-accessgrants.html">5.1. Gestion des accès</a></li>
<li class="toctree-l2"><a class="reference internal" href="100-auditDataConsistency.html">5.2. Audit de cohérence de données entre MongoDb et Elasticsearch</a></li>
<li class="toctree-l2"><a class="reference internal" href="101-objectGroup-blackList-fields-in-search.html">5.3. Configuration des champs ObjectGroup devant être exclus de la recherche</a></li>
<li class="toctree-l2"><a class="reference internal" href="11-adminportals.html">5.4. Portails d’administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="12-appconfig.html">5.5. Paramétrage &amp; configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="14-miseajour.html">5.6. Déploiement / mises à jour</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-maintenance.html">5.7. Interruption / maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="16-backup_restore.html">5.8. Sauvegarde / restauration</a></li>
<li class="toctree-l2"><a class="reference internal" href="17-backup_restore_gros_volume.html">5.9. Sauvegarde et restauration de mongodb gros volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="18-securityprofile.html">5.10. Gestion des profils de sécurité</a></li>
<li class="toctree-l2"><a class="reference internal" href="19-certificatpersonae.html">5.11. Certificats personae</a></li>
<li class="toctree-l2"><a class="reference internal" href="19-grouped_tenants.html">5.12. Gestion des indexes Elasticseach dans un contexte massivement multi-tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-batchs.html">5.13. Batchs et traitements</a></li>
<li class="toctree-l2"><a class="reference internal" href="21-graphstorage.html">5.14. Sauvegarde des données graphe (Log shipping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-graphcompute.html">5.15. Recalcul des données graphe</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-siegfried_signature.html">5.16. Montée de version du fichier de signature de Siegfried</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-griffins.html">5.17. Griffins</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-reconstruction.html">5.18. Reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-pra.html">5.19. Plan de Reprise d’Activité (<code class="docutils literal notranslate"><span class="pre">PRA</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="40-resynchronisation.html">5.20. Resynchronisation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="45-offerdiff.html">5.21. Audit comparatif entre 2 offres de stockage miroirs</a></li>
<li class="toctree-l2"><a class="reference internal" href="50-ontologies.html">5.22. Procédure d’exploitation suite à la création ou la modification d’une ontologie</a></li>
<li class="toctree-l2"><a class="reference internal" href="50-ontologies.html#l-ontologie-externe-suite-a-la-montee-de-version-de-vitam">5.23. L’ontologie externe suite à la montée de version de <code class="docutils literal notranslate"><span class="pre">VITAM</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="60-forcedpause.html">5.24. Procédure d’exploitation pour la mise en pause forcée d’une opération</a></li>
<li class="toctree-l2"><a class="reference internal" href="60-reindexation.html">5.25. Réindexation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.26. Recherche exacte sur des champs texte</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ajout-du-nouvel-analyseur">5.26.1. Ajout du nouvel analyseur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modification-du-mapping">5.26.2. Modification du mapping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exemple">5.26.2.1. Exemple</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reindexation-des-indexes-lies-aux-tenants">5.26.3. Réindexation des indexes liés aux tenants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">5.26.3.1. Exemple</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="65-ingest-cleanup.html">5.27. Nettoyage des ingests incomplets</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-dip-cleanup.html">5.28. Suppression des DIP et des fichiers de transfert</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-certificate-revocation.html">5.29. Procédure d’exploitation pour la révocation des certificats SIA et Personae</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-offer-activation.html">5.30. Activation/désactivation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-environment-cleaning.html">5.31. Nettoyage d’un environnement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">12. Annexes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'exploitation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="_toc.html">5. Exploitation globale</a></li>
      <li class="breadcrumb-item active">5.26. Recherche exacte sur des champs texte</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/61-installation_nouveau_analyseur_elasticsearch.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="recherche-exacte-sur-des-champs-texte">
<span id="installation-nouvel-analyseur-elasticsearch"></span><h1>5.26. Recherche exacte sur des champs texte<a class="headerlink" href="#recherche-exacte-sur-des-champs-texte" title="Lien permanent vers ce titre">¶</a></h1>
<p>Pour pouvoir effectuer une recherche exacte sur un champ donné de type texte, il faudra un analyseur moins permissif que celui installé par défaut, il est possible d’avoir un second analyseur sur le même champ, pour cela il faudra suivre cette procédure:</p>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">il est important d’arrêter les <code class="docutils literal notranslate"><span class="pre">services</span> <span class="pre">externals</span></code> et <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> et s’assurer qu’aucun workflow n’est en cours avant de démarrer cette procédure.</p>
</div>
<p>Prenant comme exemple le champ <code class="docutils literal notranslate"><span class="pre">Title</span></code>.</p>
<div class="section" id="ajout-du-nouvel-analyseur">
<h2>5.26.1. Ajout du nouvel analyseur<a class="headerlink" href="#ajout-du-nouvel-analyseur" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour cela, il faudra ajouter la déclaration du nouvel analyseur dans le fichier de configuration d’elasticsearch qui se trouve ici :</p>
<p><code class="docutils literal notranslate"><span class="pre">deployment/ansible-vitam/roles/vitam/files/elasticsearch-settings/elasticsearch-configuration.json</span></code></p>
<dl class="docutils">
<dt>dans le bloc <code class="docutils literal notranslate"><span class="pre">analyzer</span></code> , nous ajoutons un nouvel analyseur nommé par exemple strict_title_analyzer, avec uniquement quelques filtres tels que:</dt>
<dd><ul class="first last simple">
<li>lowercase</li>
<li>asciifolding</li>
<li>html_strip</li>
</ul>
</dd>
<dt>nous pouvons enréchir l’analyseur avec un stemmer, par exemple pour le français, il existe 3 stemmers:</dt>
<dd><ul class="first last simple">
<li>light_french</li>
<li>french</li>
<li>minimal_french</li>
</ul>
</dd>
</dl>
<p>Dans la configuration par défaut de Vitam, nous utilisons le stemmer <code class="docutils literal notranslate"><span class="pre">french</span></code> qui est riche mais très permissif, il est recommandé de tester la configuration de l’analyseur en incluant d’autres filtres, ou stemmers, pour le cas de recherche strict, on peut tester <code class="docutils literal notranslate"><span class="pre">minimal_french</span></code></p>
<p>Voici un exemple de configuration d’un analyseur à ajouter dans les paramètres dans le bloc <code class="docutils literal notranslate"><span class="pre">analyzer</span></code> du fichier de configuration d’elasticsearch :</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;strict_title_analyzer&quot;: {
    &quot;type&quot;: &quot;custom&quot;,
    &quot;tokenizer&quot;: &quot;standard&quot;,
    &quot;char_filter&quot;: [
        &quot;html_strip&quot;
    ],
    &quot;filter&quot;: [
        &quot;lowercase&quot;,
        &quot;asciifolding&quot;
    ]
}
</pre></div>
</div>
<p>Par convention Vitam, si l’analyseur de recherche exacte est positionné sur un champ nommé <strong>NomDuChamps</strong>:</p>
<ul class="simple">
<li>la recherche classique se fait sur le critère de recherche «&nbsp;NomDuChamps&nbsp;»</li>
<li>la recherche exacte se fait sur le critère de recherche «&nbsp;NomDuChamps.Strict&nbsp;»</li>
</ul>
<p>Voici un autre example d’un analyseur un peu plus permissif que le précédent et moins permissif que celui installé par défaut, celui-ci utilise le stemmer <code class="docutils literal notranslate"><span class="pre">minimal_french</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;strict_title_analyzer&quot;: {
    &quot;type&quot;: &quot;custom&quot;,
    &quot;tokenizer&quot;: &quot;standard&quot;,
    &quot;char_filter&quot;: [
        &quot;html_strip&quot;
    ],
    &quot;filter&quot;: [
        &quot;lowercase&quot;,
        &quot;asciifolding&quot;,
        &quot;minimal_french&quot;
    ]
}
</pre></div>
</div>
</div>
<div class="section" id="modification-du-mapping">
<h2>5.26.2. Modification du mapping<a class="headerlink" href="#modification-du-mapping" title="Lien permanent vers ce titre">¶</a></h2>
<p>Après l’ajout du nouvel analyseur, pour pouvoir l’utiliser, il faudra le référencer dans le mapping elasticsearch.</p>
<p>Pour l’exemple du champ <code class="docutils literal notranslate"><span class="pre">Title</span></code> de la collection <code class="docutils literal notranslate"><span class="pre">Unit</span></code>, il faudra mettre à jour le mapping à travers le fichier</p>
<p><code class="docutils literal notranslate"><span class="pre">deployment/ansible-vitam/roles/elasticsearch-mapping/files/unit-es-mapping.json</span></code></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;Title&quot;: {
    &quot;type&quot;: &quot;text&quot;,
    &quot;analyzer&quot;: &quot;default&quot;,
    &quot;fields&quot;: {
        &quot;Strict&quot;: {
        &quot;type&quot;: &quot;text&quot;,
        &quot;analyzer&quot;: &quot;strict_title_analyzer&quot;
        }
    }
}
</pre></div>
</div>
<p>A l’issue, il faut lancer le playbook de déploiement de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> (et, si déployé, les extras) avec l’option supplémentaire <code class="docutils literal notranslate"><span class="pre">--tags</span> <span class="pre">update_vitam_configuration</span></code>.</p>
<div class="section" id="exemple">
<h3>5.26.2.1. Exemple<a class="headerlink" href="#exemple" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook ansible-vitam/vitam.yml -i environments/hosts.&lt;environnement&gt; --ask-vault-pass --tags update_vitam_configuration</span>
<span class="go">ansible-playbook ansible-vitam-extra/extra.yml -i environments/hosts.&lt;environnement&gt; --ask-vault-pass --tags update_vitam_configuration</span>
</pre></div>
</div>
<p>Cette procédure permettra d’appliquer la configuration sur une nouvelle installation, par contre, si on veut appliquer les modifications sur des tenants existants, il faudra une re-indexation à travers la procédure suivante.</p>
</div>
</div>
<div class="section" id="reindexation-des-indexes-lies-aux-tenants">
<h2>5.26.3. Réindexation des indexes liés aux tenants<a class="headerlink" href="#reindexation-des-indexes-lies-aux-tenants" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour pouvoir appliquer le nouvel analyseur et le nouveau mapping sur un tenant donné, il faudra re-indexer le contenu de l’index du tenant(s) en question.</p>
<p>Voir la documentation associée dans la rubrique : <a class="reference internal" href="60-reindexation.html#reindexation-es"><span class="std std-ref">Réindexation</span></a></p>
<div class="section" id="id1">
<h3>5.26.3.1. Exemple<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ansible-playbook ansible-vitam-exploitation/reindex_es_data.yml -i environments/hosts.&lt;environnement&gt; --ask-vault-pass --tags unit -e &quot;vitam_tenant_ids=&lt;tenantsList&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">La purge des anciens index n’est pas réalisée par cette procédure scriptée et est laissée à la charge de l’exploitant.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Si un tenant fait partie d’un groupe de tenant, il faudra re-indexer l’ensemble des tenants</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Si à un moment donné on ne souhaite appliquer la réindexation qu’à une sous partie de tenants, lors de certaines MDV on fait des full réindexation (et donc le mapping sera finalement appliqué à l’ensemble).</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="60-reindexation.html" class="btn btn-neutral float-left" title="5.25. Réindexation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="65-ingest-cleanup.html" class="btn btn-neutral float-right" title="5.27. Nettoyage des ingests incomplets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>