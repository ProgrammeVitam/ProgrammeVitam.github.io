

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.13. Plan de Reprise d’Activité (PRA) &mdash; Documentation VITAM - Documentation d&#39;exploitation 2.6.1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'2.6.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="5.14. Resynchronisation d’une offre" href="40-resynchronisation.html" />
    <link rel="prev" title="5.12. Reconstruction" href="30-reconstruction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VITAM - Documentation d'exploitation
          

          
            
            <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.6.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">5. Exploitation globale</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10-accessgrants.html">5.1. Gestion des accès</a></li>
<li class="toctree-l2"><a class="reference internal" href="11-adminportals.html">5.2. Portails d’administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="12-appconfig.html">5.3. Paramétrage &amp; configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="14-miseajour.html">5.4. Déploiement / mises à jour</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-maintenance.html">5.5. Interruption / maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="16-backup_restore.html">5.6. Sauvegarde / restauration</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-batchs.html">5.7. Batchs et traitements</a></li>
<li class="toctree-l2"><a class="reference internal" href="21-graphstorage.html">5.8. Sauvegarde des données graphe (Log shipping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-graphcompute.html">5.9. Recalcul des données graphe</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-siegfried_signature.html">5.10. Montée de version du fichier de signature de Siegfried</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-griffins.html">5.11. Griffins</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-reconstruction.html">5.12. Reconstruction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.13. Plan de Reprise d’Activité (PRA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#declenchement">5.13.1. Déclenchement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retour-en-situation-nominale">5.13.2. Retour en situation nominale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">5.13.2.1. Déclenchement</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="40-resynchronisation.html">5.14. Resynchronisation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="50-ontologies.html">5.15. Procédure d’exploitation suite à la création ou la modification d’une ontologie</a></li>
<li class="toctree-l2"><a class="reference internal" href="60-forcedpause.html">5.16. Procédure d’exploitation pour la mise en pause forcée d’une opération</a></li>
<li class="toctree-l2"><a class="reference internal" href="60-reindexation.html">5.17. Réindexation</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-certificate-revocation.html">5.18. Procédure d’exploitation pour la révocation des certificats SIA et Personae</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-offer-activation.html">5.19. Activation/désactivation d’une offre</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-environment-cleaning.html">5.20. Nettoyage d’un environnement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../include/_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">12. Annexes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'exploitation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="_toc.html">5. Exploitation globale</a> &raquo;</li>
        
      <li>5.13. Plan de Reprise d’Activité (PRA)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/topics/31-pra.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plan-de-reprise-d-activite-pra">
<h1>5.13. Plan de Reprise d’Activité (PRA)<a class="headerlink" href="#plan-de-reprise-d-activite-pra" title="Lien permanent vers ce titre">¶</a></h1>
<p>Le <a class="reference internal" href="../introduction.html#term-pra"><span class="xref std std-term">PRA</span></a> consiste à passer un site <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> secondaire en site primaire après incident majeur survenu sur le site primaire (cas de l’indisponibilité complète du site primaire).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Les actions en cours sur le site primaire sont perdues (versements non terminés, batchs etc.). L’incohérence des données sera traitée dans une version ultérieure de <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>..</p>
</div>
<p>Cette section décrit des actions qui ne peuvent  donc s’effectuer que si une installation multi-sites a été effectuée au préalable.</p>
<p>Cette section s’appuie sur les procédures décrites dans les chapitres suivants:</p>
<ul class="simple">
<li>Resynchronisation d’une offre à partir d’une autre offre (<a class="reference internal" href="40-resynchronisation.html#resynchronisation-offre"><span class="std std-ref">Resynchronisation d’une offre</span></a>)</li>
<li>Reconstruction des bases de données (MongoDB-data, Elasticsearch-data) en cas de perte de l’une ou l’autre, à partir des informations présentes dans les offres (<a class="reference internal" href="30-reconstruction.html#reconstruction"><span class="std std-ref">Reconstruction</span></a>)</li>
</ul>
<div class="section" id="declenchement">
<h2>5.13.1. Déclenchement<a class="headerlink" href="#declenchement" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avant le déclenchement de la procédure de <a class="reference internal" href="../introduction.html#term-pra"><span class="xref std std-term">PRA</span></a>, le système fonctionne en mode multi-sites (primaire/secondaire). Le service est indisponible à la suite de la perte du site primaire.</p>
<p>Le déclenchement du <a class="reference internal" href="../introduction.html#term-pra"><span class="xref std std-term">PRA</span></a> s’effecture selon la procédure suivante:</p>
<ol class="arabic">
<li><p class="first">Vérifier que le site primaire est bien complètement arrêté</p>
<blockquote>
<div><ul class="simple">
<li>Il est indispensable de valider que tous les services VITAM (y compris les <cite>timers</cite> systemd) sont bien arrêtés</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Attendre la fin de la reconstruction au fil de l’eau sur le site secondaire</p>
<blockquote>
<div><ul class="simple">
<li>Le suivi de la reconstruction se fait en observant l’évolution de l’offset de reconstruction stocké dans MongoDB-data.</li>
<li>Pour la release 7 (version 1.4.x) il faut lancer le service dédié <code class="docutils literal notranslate"><span class="pre">vitam-metadata-graph-builder.service</span></code> sur le composant metadata pour recalculer les données graphe des unités archivistiques et des groupes d’objets techniques n’ayant pas encore reconstruit leurs données graphe</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Reconfigurer le site secondaire en site primaire:</p>
<blockquote>
<div><ul>
<li><p class="first">Si le site secondaire était partiellement déployé, ne pas oublier de rajouter tous les composants requis pour un fonctionnement en site primaire</p>
</li>
<li><p class="first">Attention à adapter la stratégie de stockage en fonction du mode d’utilisation choisi pour le site de secours:</p>
<blockquote>
<div><ul class="simple">
<li>Mode «&nbsp;lecture/écriture&nbsp;» : la stratégie de stockage doit être modifiée afin de limiter les écritures aux seules offres encore disponibles sur le site de secours (<a class="reference internal" href="80-offer-activation.html#activation-offre"><span class="std std-ref">Activation/désactivation d’une offre</span></a>)</li>
<li>Mode «&nbsp;lecture seule&nbsp;» (recherche et consultation avec profil de droits dédié): la stratégie de stockage ne change pas. Seule une reconfiguration du site primaire initial en mode secondaire permettra le retour à un fonctionnement nominal (cf. ci-dessous)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Paramétrer la variable <code class="docutils literal notranslate"><span class="pre">primary_site</span></code> à <code class="docutils literal notranslate"><span class="pre">true</span></code> puis jouer le <cite>playbook</cite> <code class="docutils literal notranslate"><span class="pre">ansible-vitam/vitam.yml</span></code></p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">En lien avec le processus de reconstruction (cf. <a class="reference internal" href="30-reconstruction.html#reconstruction"><span class="std std-ref">Reconstruction</span></a>), en cas de bascule sur le site secondaire, il sera préférable de purger les documents des Unit et ObjectGroup reconstruits mais ne contenant potentiellement que des données de graphe (cas de l’éliminitaion par exemple). Cette opération s’effectue avec la commande suivante :</p>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -s -X DELETE -H <span class="s2">&quot;X-Tenant-Id: {{ vitam_tenant_admin }}&quot;</span> -H <span class="s2">&quot;Accept: application/json&quot;</span> -H <span class="s2">&quot;Content-Type: application/json&quot;</span> --user <span class="s2">&quot;{{ admin_basic_auth_user }}:{{ admin_basic_auth_password }}&quot;</span> http://<span class="o">{{</span> ip_admin <span class="o">}}</span>:<span class="o">{{</span> vitam.metadata.port_admin <span class="o">}}</span>/metadata/v1/purgeGraphOnlyDocuments/<span class="o">[</span>UNIT <span class="p">|</span> OBJECTGROUP <span class="p">|</span> UNIT_OBJECTGROUP<span class="o">]</span>
</pre></div>
</div>
<p>Après modification des accès pour les applications versantes (action infra. de type modification DNS, routage, conf etc.), le site secondaire peut alors être ouvert au service en tant que site primaire.</p>
<p>Le système fonctionne désormais en mode mono-site (primaire). Le service est de nouveau disponible sur le site de secours.</p>
</div>
<div class="section" id="retour-en-situation-nominale">
<h2>5.13.2. Retour en situation nominale<a class="headerlink" href="#retour-en-situation-nominale" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le retour à la solution nominale s’effectue en deux étapes:</p>
<ul class="simple">
<li>Rétablissement du contenu du site primaire intial par reconfiguration temporaire en tant que site secondaire</li>
<li>Retour à la configuration multi-sites initiale</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Dans cette version, la resynchronisation partielle d’une offre de stockage n’étant pas supportée, le retour à la configuration multi-sites initiale nécessite de repartir d’offres vierges de toutes données sur le site à resynchroniser (on parle ici d’offre de remplacement)</p>
</div>
<div class="section" id="id1">
<h3>5.13.2.1. Déclenchement<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Avant déclenchement de la procédure de <a class="reference internal" href="../introduction.html#term-pra"><span class="xref std std-term">PRA</span></a> inverse (retour en situation nominale), le système fonctionne en mode mono-site (primaire). Le service est disponible sur le site de secours.</p>
<p>Le déclenchement du <a class="reference internal" href="../introduction.html#term-pra"><span class="xref std std-term">PRA</span></a> inverse s’effecture selon la procédure suivante:</p>
<ul>
<li><p class="first">Vérifier que le site primaire initial est bien complètement arrêté</p>
<blockquote>
<div><ul class="simple">
<li>Il est indispensable de valider que tous les services VITAM (y compris les <cite>timers</cite> systemd) sont bien arrêtés</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Purger les données (le cas échéant) stockées dans MongoDB-data, excepté les bases <strong>identity</strong>, <strong>config</strong> et <strong>admin</strong></p>
</li>
<li><p class="first">Purger les données (le cas échéant) stockées dans Elasticsearch-data</p>
</li>
<li><p class="first">Reconfigurer et démarrer le site primaire initial en tant que site secondaire:</p>
<blockquote>
<div><ul class="simple">
<li>Paramétrer la variable primary_site à false puis utiliser le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam/vitam.yml</span></code></li>
<li>Le mécanisme de reconstruction du contenu des bases de données (MongoDB-data, Elasticsearch-data) à partir des informations présentes dans les offres de stockage est actif (aucune donnée à resynchroniser à cette étape)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Resynchroniser les offres de stockage à partir des offres du site de secours en se référant à la procédure suivante <a class="reference internal" href="40-resynchronisation.html#resynchronisation-offre"><span class="std std-ref">Resynchronisation d’une offre</span></a></p>
<blockquote>
<div><ul>
<li><p class="first">En fonction du mode d’utilisation choisi pour le site de secours:</p>
<blockquote>
<div><ul class="simple">
<li>Mode lecture/écriture: la stratégie de stockage du site de secours doit auparavant être modifiée afin de référencer de nouveau les offres du site primaire initial</li>
<li>Mode lecture seule: la stratégie de stockage ne change pas. Les offres du site primaire initial sont toujours connues du site de secours</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Le mécanisme de recontruction au fil de l’eau reconstruit progressivement le contenu des bases de données</p>
<blockquote>
<div><ul class="simple">
<li>Le suivi de la reconstruction se fait en observant l’évolution de l’offset de reconstruction stocké dans MongoDB data</li>
<li>Pour la release 7 (version 1.4.x) il faut lancer le service dédié <code class="docutils literal notranslate"><span class="pre">vitam-metadata-graph-builder.service</span></code> sur le composant metadata pour recalculer les données graphe des unités archivistiques et des groupes d’objets techniques n’ayant pas encore reconstruit leurs données graphe</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Une fois la reconstruction terminée, reconfiguration en tant que site primaire et démarrage:</p>
<blockquote>
<div><ul class="simple">
<li>Paramétrer la variable primary_site à true puis utiliser le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam/vitam.yml</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Reconfiguration et démarrage en tant que site secondaire du site de secours:</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Cette opération provoque une indisponibilité temporaire des principaux services <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> (versement, gestion, recherche et consultation)</p>
</div>
<ul class="simple">
<li>Paramétrer la variable primary_site à false puis utiliser le playbook <code class="docutils literal notranslate"><span class="pre">ansible-vitam/vitam.yml</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Après modification des accès pour les applications versantes (action infra. de type modification DNS, routage, conf etc.), le site primaire initial peut alors être de nouveau ouvert au service en tant que site primaire.</p>
<p>Le système fonctionne désormais de nouveau en mode multi-sites (primaire/secondaire). Le service est de nouveau disponible sur le site primaire initial.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="40-resynchronisation.html" class="btn btn-neutral float-right" title="5.14. Resynchronisation d’une offre" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="30-reconstruction.html" class="btn btn-neutral float-left" title="5.12. Reconstruction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>