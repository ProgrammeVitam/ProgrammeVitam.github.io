<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9. Intégration d’une application externe dans Vitam &mdash; Documentation VITAM - Documentation d&#39;exploitation 6.1</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="10. Aide à l’exploitation" href="troubleshoot/_toc.html" />
    <link rel="prev" title="8.2.20.3. Opérations" href="include/workspace/operations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VITAM - Documentation d'exploitation
              <img src="_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics/_toc.html">5. Exploitation globale</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="include/_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. Intégration d’une application externe dans Vitam</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequis">9.1. Prérequis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integration-de-certificats-clients-de-vitam">9.2. Intégration de certificats clients de VITAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentification-applicative-sia">9.2.1. Authentification applicative <code class="docutils literal notranslate"><span class="pre">SIA</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ajout-d-un-certificat-pour-l-authentification-applicative-sia">9.2.1.1. Ajout d’un certificat pour l’authentification applicative <code class="docutils literal notranslate"><span class="pre">SIA</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#authentification-personae">9.2.2. Authentification <em>Personae</em></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ajout-d-un-certificat-pour-l-authentification-personae">9.2.2.1. Ajout d’un certificat pour l’authentification <em>Personae</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#suppression-d-un-certificat-pour-l-authentification-personae">9.2.2.2. Suppression d’un certificat pour l’authentification <em>Personae</em></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#revocation-de-certificats-clients-de-vitam">9.3. Révocation de certificats clients de VITAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploiement-des-keystores">9.4. Déploiement des keystores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vitam-n-est-pas-encore-deploye">9.4.1. Vitam n’est pas encore déployé</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vitam-est-deja-deploye">9.4.2. Vitam est déjà déployé</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="annexes/_toc.html">12. Annexes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VITAM - Documentation d'exploitation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">9. Intégration d’une application externe dans Vitam</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/external_app.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="integration-d-une-application-externe-dans-vitam">
<span id="integration-certificats-sia-personae"></span><h1>9. Intégration d’une application externe dans Vitam<a class="headerlink" href="#integration-d-une-application-externe-dans-vitam" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="prerequis">
<h2>9.1. Prérequis<a class="headerlink" href="#prerequis" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’application externe devra être en mesure de requêter les composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <code class="docutils literal notranslate"><span class="pre">ingest-external</span></code> et <code class="docutils literal notranslate"><span class="pre">access-external</span></code> sur leurs ports de service respectifs par le protocole HTTPS.</p>
<p>Il faut donc prévoir une ouverture de flux réseau pour le protocole TCP (selon l’infrastructure en place) sur les ports de service des composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <code class="docutils literal notranslate"><span class="pre">ingest-external</span></code> et <code class="docutils literal notranslate"><span class="pre">access-external</span></code>.</p>
<p>La sécurisation des connexions HTTP avec les applications externes est déléguée aux composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <code class="docutils literal notranslate"><span class="pre">ingest-external</span></code> et <code class="docutils literal notranslate"><span class="pre">access-external</span></code> (ou bien éventuellement à un reverse-proxy, selon l’infrastructure de déploiement <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> retenue).</p>
<p>La création d’un certificat TLS client pour l’application externe est requise afin de permettre l’habilitation et l’authentification applicative des requêtes émises depuis l’application externe vers les composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> ingest-external et access-external.</p>
</div>
<div class="section" id="integration-de-certificats-clients-de-vitam">
<h2>9.2. Intégration de certificats clients de VITAM<a class="headerlink" href="#integration-de-certificats-clients-de-vitam" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cette section décrit l’ajout de certificats <a class="reference internal" href="introduction.html#term-sia"><span class="xref std std-term">SIA</span></a> ou personnels (<em>Personae</em>) dans le cadre des procédures d’exploitation de la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>. L’intégration de certificats clients de <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> au déploiement est décrite dans le document d’installation (<a class="reference internal" href="introduction.html#term-din"><span class="xref std std-term">DIN</span></a>).</p>
</div>
<div class="section" id="authentification-applicative-sia">
<h3>9.2.1. Authentification applicative <a class="reference internal" href="introduction.html#term-sia"><span class="xref std std-term">SIA</span></a><a class="headerlink" href="#authentification-applicative-sia" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le certificat client de l’application externe doit être ajouté dans la base de données du composant <code class="docutils literal notranslate"><span class="pre">security-internal</span></code>, afin de permettre la gestion des habilitations et l’authentification applicative de l’application externe.</p>
<p>L’exemple suivant permet d’ajouter un certificat présent sous <code class="docutils literal notranslate"><span class="pre">/path/to/certificate</span></code> et associé au contexte applicatif portant l’identifiant <code class="docutils literal notranslate"><span class="pre">contexte_identifier</span></code>.</p>
<div class="section" id="ajout-d-un-certificat-pour-l-authentification-applicative-sia">
<h4>9.2.1.1. Ajout d’un certificat pour l’authentification applicative <a class="reference internal" href="introduction.html#term-sia"><span class="xref std std-term">SIA</span></a><a class="headerlink" href="#ajout-d-un-certificat-pour-l-authentification-applicative-sia" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPOST -H <span class="s2">&quot;Content-Type:application/json&quot;</span> <span class="s1">&#39;http://&lt;ip admin security-internal&gt;:&lt;port admin security-internal&gt;/v1/api/identity&#39;</span> -d <span class="s2">&quot;</span>
<span class="s2">{</span>
<span class="s2">    \&quot;contextId\&quot;:\&quot;contexte_identifier\&quot;,</span>
<span class="s2">    \&quot;certificate\&quot;:\&quot;</span><span class="k">$(</span>base64 /path/to/certificate<span class="k">)</span><span class="s2">\&quot;</span>
<span class="s2">}&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Se repporter à la documentation sur la gestion des habilitations pour ce qui concerne l’ajout de contextes applicatifs.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Lorsque l’authentification du client, par le protocole TLS, est réalisée, la <a class="reference internal" href="introduction.html#term-ca"><span class="xref std std-term">CA</span></a> du certificat client doit être déployée dans le <em>truststore</em> des composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <code class="docutils literal notranslate"><span class="pre">ingest-external</span></code> et <code class="docutils literal notranslate"><span class="pre">access-external</span></code>. Dans ce cas de figure, suivre la procédure de la section <a class="reference internal" href="topics/14-miseajour.html#certifanchor"><span class="std std-ref">Mise à jour des certificats</span></a>, en ayant pris soin au préalable de déposer les certificats de la chaîne de certification client dans le répertoire <cite>environments/certs/client-external/ca</cite>. Si le certificat client est passé dans le <em>header</em> http (cas de l’authentification applicative par <em>header</em> http X-SSL-CLIENT-CERT), le certificat client n’est alors pas utilisé dans la négociation TLS et il n’est donc pas nécéssaire d’inclure la <a class="reference internal" href="introduction.html#term-ca"><span class="xref std std-term">CA</span></a> associée dans le <em>truststore</em> des composants <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <code class="docutils literal notranslate"><span class="pre">ingest-external</span></code> et <code class="docutils literal notranslate"><span class="pre">access-external</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="authentification-personae">
<h3>9.2.2. Authentification <em>Personae</em><a class="headerlink" href="#authentification-personae" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le certificat personnel (<em>Personae</em>) doit être ajouté dans la base de données du composant <code class="docutils literal notranslate"><span class="pre">security-internal</span></code>, afin de permettre l’authentification renforcée de l’utilisateur.</p>
<p>Les exemples suivants permettent d’ajouter ou supprimer un certificat présent sous <code class="docutils literal notranslate"><span class="pre">/path/to/certificate</span></code>.</p>
<div class="section" id="ajout-d-un-certificat-pour-l-authentification-personae">
<h4>9.2.2.1. Ajout d’un certificat pour l’authentification <em>Personae</em><a class="headerlink" href="#ajout-d-un-certificat-pour-l-authentification-personae" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XPOST -H <span class="s2">&quot;Content-type: application/octet-stream&quot;</span> --data-binary @/path/to/certificate <span class="s1">&#39;http://&lt;ip admin security-internal&gt;:&lt;port admin security-internal&gt;/v1/api/personalCertificate&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="suppression-d-un-certificat-pour-l-authentification-personae">
<h4>9.2.2.2. Suppression d’un certificat pour l’authentification <em>Personae</em><a class="headerlink" href="#suppression-d-un-certificat-pour-l-authentification-personae" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -XDELETE -H <span class="s2">&quot;Content-type: application/octet-stream&quot;</span> --data-binary @/path/to/certificate <span class="s1">&#39;http://&lt;ip admin security-internal&gt;:&lt;port admin security-internal&gt;/v1/api/personalCertificate&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="revocation-de-certificats-clients-de-vitam">
<h2>9.3. Révocation de certificats clients de VITAM<a class="headerlink" href="#revocation-de-certificats-clients-de-vitam" title="Lien permanent vers ce titre">¶</a></h2>
<p>La release « R8 » introduit une nouvelle fonctionnalité permettant la révocation des certificats <a class="reference internal" href="introduction.html#term-sia"><span class="xref std std-term">SIA</span></a> et <em>Personae</em> afin d’empecher des accès non autorisés aux <a class="reference internal" href="introduction.html#term-api"><span class="xref std std-term">API</span></a> de la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> (vérification dans la couche https des <a class="reference internal" href="introduction.html#term-crl"><span class="xref std std-term">CRL</span></a>).</p>
<p>Le fonctionnement de la validation des certifcats de la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> <a class="reference internal" href="introduction.html#term-sia"><span class="xref std std-term">SIA</span></a> et <cite>Personae</cite> par <a class="reference internal" href="introduction.html#term-crl"><span class="xref std std-term">CRL</span></a> est le suivant :</p>
<ul>
<li><p class="first">L’administrateur transmet à la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> le <a class="reference internal" href="introduction.html#term-crl"><span class="xref std std-term">CRL</span></a> d’un <a class="reference internal" href="introduction.html#term-ca"><span class="xref std std-term">CA</span></a> qui a émis le certificat présent dans la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, via le point d’API suivant</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">{{</span> <span class="n">hosts_security_internal</span> <span class="p">}}:{{</span><span class="n">vitam</span><span class="o">.</span><span class="n">security_internal</span><span class="o">.</span><span class="n">port_admin</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">crl</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">La CRL fournie doit être obligatoirement au format DER (cf. <a class="reference external" href="http://www.ietf.org/rfc/rfc3280.txt">http://www.ietf.org/rfc/rfc3280.txt</a>&nbsp;»&gt;RFC 3280: <em>Internet X.509 Public Key Infrastructure Certificate and CRL Profile</em>)</p>
</div>
<p>Exemple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">u</span> <span class="p">{{</span> <span class="n">admin_basic_auth_user</span> <span class="p">}}:{{</span> <span class="n">admin_basic_auth_password</span> <span class="p">}}</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">{{</span> <span class="n">hosts_security_internal</span> <span class="p">}}:{{</span><span class="n">vitam</span><span class="o">.</span><span class="n">security_internal</span><span class="o">.</span><span class="n">port_admin</span><span class="p">}}</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">crl</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/octet-stream&#39;</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="o">@/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">crl</span><span class="o">/</span><span class="n">my</span><span class="o">.</span><span class="n">crl</span>
</pre></div>
</div>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">adminUser</span></code> correspond à la valeur <code class="docutils literal notranslate"><span class="pre">admin_basic_auth_user</span></code> déclarée dans le fichier <code class="docutils literal notranslate"><span class="pre">vitam_security.yml</span></code></p>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">adminPassword</span></code> correspond à la valeur <code class="docutils literal notranslate"><span class="pre">admin_basic_auth_password</span></code> déclarée dans le fichier <code class="docutils literal notranslate"><span class="pre">vault-vitam.yml</span></code></p>
<ul class="simple">
<li>Le système va contrôler tous les certificats (collections <code class="docutils literal notranslate"><span class="pre">identity.Certificate</span></code> et <code class="docutils literal notranslate"><span class="pre">identity.PersonalCertificate</span></code>) émis par le <cite>IssuerDN</cite> correspondant à la <a class="reference internal" href="introduction.html#term-crl"><span class="xref std std-term">CRL</span></a>, en vérifiant si ces derniers sont révoqués ou non. Si c’est le cas, alors la solution logicielle <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> positionne le statut du certificat révoqué à <strong>REVOKED</strong>. Cela a pour conséquence le rejet de tout accès aux <a class="reference internal" href="introduction.html#term-api"><span class="xref std std-term">API</span></a> <a class="reference internal" href="introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> avec utilisation du certificat révoqué (les filtres de sécurité émettront des exceptions dans les journaux de <cite>log</cite>).</li>
<li>Une alerte de sécurité est émise dans les journaux en cas de révocation.</li>
</ul>
</div>
<div class="section" id="deploiement-des-keystores">
<h2>9.4. Déploiement des keystores<a class="headerlink" href="#deploiement-des-keystores" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="vitam-n-est-pas-encore-deploye">
<h3>9.4.1. Vitam n’est pas encore déployé<a class="headerlink" href="#vitam-n-est-pas-encore-deploye" title="Lien permanent vers ce titre">¶</a></h3>
<p>Déployer Vitam en suivant la procédure indiquée dans le <a class="reference internal" href="introduction.html#term-din"><span class="xref std std-term">DIN</span></a>.</p>
</div>
<div class="section" id="vitam-est-deja-deploye">
<h3>9.4.2. Vitam est déjà déployé<a class="headerlink" href="#vitam-est-deja-deploye" title="Lien permanent vers ce titre">¶</a></h3>
<p>Suivre la procédure de la section <a class="reference internal" href="topics/14-miseajour.html#certifanchor"><span class="std std-ref">Mise à jour des certificats</span></a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="include/workspace/operations.html" class="btn btn-neutral float-left" title="8.2.20.3. Opérations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshoot/_toc.html" class="btn btn-neutral float-right" title="10. Aide à l’exploitation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>