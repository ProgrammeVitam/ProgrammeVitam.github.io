

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.2.15.2.2. Storage Engine &mdash; Documentation VITAM - Documentation d&#39;exploitation 2.1.1</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="next" title="8.2.15.2.3. Configuration / fichiers utiles" href="configuration.html" />
    <link rel="prev" title="8.2.15.2.1. Présentation" href="presentation.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> VITAM - Documentation d'exploitation
          

          
            
            <img src="../../../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../topics/_toc.html">5. Exploitation globale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../_toc.html#generalites">8.1. Généralités</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../_toc.html#composants">8.2. Composants</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../common.html">8.2.1. Fichiers communs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../access/_toc.html">8.2.2. Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch-report/_toc.html">8.2.3. Batch-Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../common-plugin/_toc.html">8.2.4. common-plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../common/_toc.html">8.2.5. Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../functional-administration/_toc.html">8.2.6. Functional administration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hellow-world-plugin/_toc.html">8.2.7. Hello World Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ihm-demo/_toc.html">8.2.8. ihm-demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ihm-recette/_toc.html">8.2.9. ihm-recette</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ingest/_toc.html">8.2.10. Ingest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal-security/_toc.html">8.2.11. Security-Internal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../logbook/_toc.html">8.2.12. Logbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metadata/_toc.html">8.2.13. Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../processing/_toc.html">8.2.14. Processing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../_toc.html">8.2.15. Storage</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../introduction.html">8.2.15.1. Introduction</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="_toc.html">8.2.15.2. storage-engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../storage-offer-default/_toc.html">8.2.15.3. offer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../technical-administration/_toc.html">8.2.16. Technical administration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../worker/_toc.html">8.2.17. Worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workspace/_toc.html">8.2.18. Workspace</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../annexes/_toc.html">12. Annexes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VITAM - Documentation d'exploitation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a> &raquo;</li>
        
          <li><a href="../_toc.html">8.2.15. Storage</a> &raquo;</li>
        
          <li><a href="_toc.html">8.2.15.2. storage-engine</a> &raquo;</li>
        
      <li>8.2.15.2.2. Storage Engine</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/include/storage/storage-engine/storage-engine.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="storage-engine">
<h1>8.2.15.2.2. Storage Engine<a class="headerlink" href="#storage-engine" title="Lien permanent vers ce titre">¶</a></h1>
<p>Nom de l’image docker : <strong>storage-engine</strong></p>
<p>Dans cette image sont déployés :</p>
<ul class="simple">
<li>le moteur de stockage (storage-engine)</li>
<li>l’implémentation du driver correspondant à l’offre de stockage par défaut (storage-offer-default)</li>
</ul>
<div class="section" id="configuration-du-moteur-de-stockage">
<h2>8.2.15.2.2.1. Configuration du moteur de stockage<a class="headerlink" href="#configuration-du-moteur-de-stockage" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans <strong>/vitam/conf</strong> :</p>
<ol class="arabic simple">
<li><strong>storage-engine.conf</strong> : Fichier Yaml de configuration du server <em>storage-engine</em>.  Il possède une propriété :</li>
</ol>
<ul class="simple">
<li><strong>urlWorkspace</strong> : URL d’accès au service distant <em>workspace</em> (exemple <a class="reference external" href="http://localhost:8088">http://localhost:8088</a>)</li>
</ul>
<ol class="arabic simple" start="2">
<li><strong>driver-location.conf</strong> : Fichier Yaml de configuration du DriverManager, Il permet de définir l’emplacement où sont stockés les fichiers JAR contenant les implémentations des différents drivers pour les différentes offres. Il possède une seule propriété :</li>
</ol>
<ul class="simple">
<li><strong>driverLocation</strong> : emplacement des jars (chemin absolu de préférence)</li>
</ul>
<ol class="arabic simple" start="3">
<li><strong>driver-mapping.conf</strong> : Fichier Yaml de configuration du DriverMapper (persistance de l’association driver / offre). Pour le moment, ce fichier de configuration contient le chemin d’accès aux fichiers qui définissent le mapping driver&lt;-&gt;offre, plus tard il évoluera sans doute pour prendre en compte des données en base et donc contenir la configuration d’accès à la base. Il contient deux propriétés :</li>
</ol>
<ul class="simple">
<li><strong>driverMappingPath</strong> : Définit l’emplacement des fichiers de persistance (au jourd’hui on a 1 seul driver/offre, donc 1 seul fichier de persistence sera présent). La propriété doit finir par «&nbsp;/&nbsp;».</li>
<li><strong>delimiter</strong> : Définit le «&nbsp;délimiteur&nbsp;» (CSV style) des fichiers.</li>
</ul>
<ol class="arabic simple" start="4">
<li><strong>static-offer.json</strong> : Contient la description de l’offre “default” au format JSON (un jour sera sans doute dans une base de données). En PJ un exemple de ce fichier. La propriété baseUrl et parameters nécessitent d’être templaté. Et la propriété parameters doit contenir keystore, trustore et leur mot de passe que le storage driver va utiliser pour la vérification de l’authentication. Il s’agit de l’URL d’accès à l’offre de stockage “default”. Exemple :</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
  <span class="nt">&quot;baseUrl&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://localhost:8088&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parameters&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;bob&quot;</span>
    <span class="s2">&quot;keyStore-keyPath&quot;</span><span class="p">:</span> <span class="s2">&quot;src/test/resources/storage-test/tls/client/client.p12&quot;</span><span class="p">,</span>
    <span class="nt">&quot;keyStore-keyPassword&quot;</span><span class="p">:</span> <span class="s2">&quot;vitam2016&quot;</span><span class="p">,</span>
    <span class="nt">&quot;trustStore-keyPath&quot;</span><span class="p">:</span> <span class="s2">&quot;src/test/resources/storage-test/tls/server/truststore.jks&quot;</span><span class="p">,</span>
    <span class="nt">&quot;trustStore-keyPassword&quot;</span><span class="p">:</span> <span class="s2">&quot;tazerty&quot;</span><span class="p">,</span>
    <span class="nt">&quot;referent&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>To remove TLS support:</strong></p>
<ul class="simple">
<li>change «&nbsp;https&nbsp;» to «&nbsp;http&nbsp;» in <strong>baseUrl</strong></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
  <span class="nt">&quot;baseUrl&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://localhost:8088&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parameters&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;bob&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>To define «&nbsp;referent&nbsp;» offer:</strong></p>
<ul class="simple">
<li>choose <strong>exactly one</strong> offer by adding parameter <strong>referent</strong></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="nt">&quot;baseUrl&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://localhost:8088&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parameters&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;referent&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;offer2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;baseUrl&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://localhost:8089&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parameters&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;bob&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>change storage-default-offer.json to disable authentication</li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>jettyConfig: jetty-config-nossl.xml
authentication : false
</pre></div>
</div>
<ul class="simple">
<li>change the jetty-config-nossl.xml of the offer (CAS Manager) to not include any TLS configuration</li>
</ul>
<ol class="arabic simple" start="5">
<li><strong>static-strategy.json</strong> : Contient les informations de la stratégie de stockage (1 seule pour le moment). Ce fichier n’est pas à modifier.</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
 <span class="nt">&quot;hot&quot;</span> <span class="p">:</span> <span class="p">{</span>
   <span class="nt">&quot;copy&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&quot;offers&quot;</span> <span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">}</span>
   <span class="p">]</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><strong>server-identity.conf</strong> : identification du serveur</li>
<li><strong>logback.xml</strong> : configuration des logs</li>
</ol>
</div>
<div class="section" id="configuration-du-driver-de-l-offre-de-stockage-par-defaut">
<h2>8.2.15.2.2.2. Configuration du driver de l’offre de stockage par défaut<a class="headerlink" href="#configuration-du-driver-de-l-offre-de-stockage-par-defaut" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans <strong>/vitam/data</strong> :</p>
<ol class="arabic simple">
<li><strong>fr.gouv.vitam.storage.offers.workspace.driver.DriverImpl</strong> : Il s’agit du fichier de persistence. Il contient l’identifiant de l’offre associée au driver (plus tard potentiellement DES offres associées) : <em>«&nbsp;default&nbsp;»</em>. Il DOIT être placé dans le répertoire défini dans le fichier <em>driver-mapping.conf</em>.</li>
</ol>
<p>Dans <strong>/vitam/lib</strong> :</p>
<ol class="arabic simple">
<li><strong>storage-driver-default.jar</strong> : Il s’agit d’un jar contenant l’implémentation du Driver vitam pour l’offre <em>«&nbsp;storage-offer-default&nbsp;»</em>. Ce jar DOIT être placé dans le dossier défini dans la propriété <em>driverLocation</em> du fichier <em>driver-location.conf</em>. Par défaut il est chargé en tant que dépendance du projet.</li>
</ol>
</div>
<div class="section" id="supervision-du-service">
<h2>8.2.15.2.2.3. Supervision du service<a class="headerlink" href="#supervision-du-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>Contrôler le retour HTTP 200 et identité du serveur (cf <em>server-identity.conf</em>) sur l’URL <code class="docutils literal notranslate"><span class="pre">&lt;protocole</span> <span class="pre">web</span> <span class="pre">https</span> <span class="pre">ou</span> <span class="pre">https&gt;://&lt;host&gt;:&lt;port&gt;/storage/v1/status</span></code></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="8.2.15.2.3. Configuration / fichiers utiles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="presentation.html" class="btn btn-neutral" title="8.2.15.2.1. Présentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'2.1.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>