<!DOCTYPE html>
<html class="writer-html4" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8.2.1. Fichiers communs &mdash; Documentation VITAM - Documentation d&#39;exploitation 8.1.0</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="8.2.2. Access" href="access/_toc.html" />
    <link rel="prev" title="8. Exploitation des composants de la solution logicielle VITAM" href="_toc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VITAM - Documentation d'exploitation
              <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequis-competences.html">3. Expertises requises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">4. Architecture de la solution logicielle VITAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/_toc.html">5. Exploitation globale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/_toc.html">6. Suivi de l’état du système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composants/_toc.html">7. Exploitation des COTS de la solution logicielle VITAM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="_toc.html#generalites">8.1. Généralités</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html#composants">8.2. Composants</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">8.2.1. Fichiers communs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-sysconfig-java-opts">8.2.1.1. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/sysconfig/java_opts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-logback-access-xml">8.2.1.2. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logback-access.xml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-logback-xml">8.2.1.3. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logback.xml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-jetty-config-xml">8.2.1.4. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/jetty-config.xml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-logbook-client-conf">8.2.1.5. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logbook-client.conf</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-server-identity-conf">8.2.1.6. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/server-identity.conf</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-antisamy-esapi-xml">8.2.1.7. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/antisamy-esapi.xml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-vitam-conf">8.2.1.8. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/vitam.conf</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fichier-vitam-conf-composant-java-security">8.2.1.9. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/java.security</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="access/_toc.html">8.2.2. Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="batch-report/_toc.html">8.2.3. Batch-Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="collect/_toc.html">8.2.4. Collect</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-plugin/_toc.html">8.2.5. common-plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="common/_toc.html">8.2.6. Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="functional-administration/_toc.html">8.2.7. Functional administration</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world-plugin/_toc.html">8.2.8. Hello World Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="ihm-demo/_toc.html">8.2.9. ihm-demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="ihm-recette/_toc.html">8.2.10. ihm-recette</a></li>
<li class="toctree-l3"><a class="reference internal" href="ingest/_toc.html">8.2.11. Ingest</a></li>
<li class="toctree-l3"><a class="reference internal" href="internal-security/_toc.html">8.2.12. Security-Internal</a></li>
<li class="toctree-l3"><a class="reference internal" href="logbook/_toc.html">8.2.13. Logbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata/_toc.html">8.2.14. Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="processing/_toc.html">8.2.15. Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduler/_toc.html">8.2.16. scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage/_toc.html">8.2.17. Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="technical-administration/_toc.html">8.2.18. Technical administration</a></li>
<li class="toctree-l3"><a class="reference internal" href="worker/_toc.html">8.2.19. Worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="workspace/_toc.html">8.2.20. Workspace</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../external_app.html">9. Intégration d’une application externe dans Vitam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshoot/_toc.html">10. Aide à l’exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/_toc.html">11. Questions Fréquemment Posées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">12. Annexes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'exploitation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="_toc.html">8. Exploitation des composants de la solution logicielle VITAM</a></li>
      <li class="breadcrumb-item active">8.2.1. Fichiers communs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/include/common.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="fichiers-communs">
<span id="confcommon"></span><h1>8.2.1. Fichiers communs<a class="headerlink" href="#fichiers-communs" title="Lien permanent vers ce titre">¶</a></h1>
<p>Les composants de la solution logicielle <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> utilisent un socle de fichiers communs.</p>
<div class="section" id="fichier-vitam-conf-composant-sysconfig-java-opts">
<h2>8.2.1.1. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/sysconfig/java_opts</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-sysconfig-java-opts" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce fichier définit les JVMARGS.</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#*******************************************************************************
# Copyright French Prime minister Office/SGMAP/DINSIC/Vitam Program (2015-2022)
#
# contact.vitam@culture.gouv.fr
#
# This software is a computer program whose purpose is to implement a digital archiving back-office system managing
# high volumetry securely and efficiently.
#
# This software is governed by the CeCILL 2.1 license under French law and abiding by the rules of distribution of free
# software. You can use, modify and/ or redistribute the software under the terms of the CeCILL 2.1 license as
# circulated by CEA, CNRS and INRIA at the following URL &quot;https://cecill.info&quot;.
#
# As a counterpart to the access to the source code and rights to copy, modify and redistribute granted by the license,
# users are provided only with a limited warranty and the software&#39;s author, the holder of the economic rights, and the
# successive licensors have only limited liability.
#
# In this respect, the user&#39;s attention is drawn to the risks associated with loading, using, modifying and/or
# developing or reproducing the software by the user in light of its specific status of free software, that may mean
# that it is complicated to manipulate, and that also therefore means that it is reserved for developers and
# experienced professionals having in-depth computer knowledge. Users are therefore encouraged to load and test the
# software&#39;s suitability as regards their requirements in conditions enabling the security of their systems and/or data
# to be ensured and, more generally, to use and operate it in the same conditions as regards security.
#
# The fact that you are presently reading this means that you have had knowledge of the CeCILL 2.1 license and that you
# accept its terms.
#*******************************************************************************
JAVA_OPTS=&quot;{{ vitam_struct.jvm_opts.gc | default(gc_opts) }} {{ vitam_struct.jvm_opts.memory | default(memory_opts) }} {{ vitam_struct.jvm_opts.java | default(java_opts) }} -Dorg.owasp.esapi.resources={{ vitam_folder_conf }} -Dlogback.configurationFile={{ vitam_folder_conf }}/logback.xml -Dvitam.config.folder={{ vitam_folder_conf }} -Dvitam.data.folder={{ vitam_folder_data }} -Dvitam.tmp.folder={{ vitam_folder_tmp }} -Dvitam.log.folder={{ vitam_folder_log }} -Djava.security.properties={{ vitam_folder_conf }}/java.security -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath={{ vitam_folder_log }}{% if jvm_log %} -XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile={{ vitam_folder_log }}/jvm.log{% endif %} -XX:+UseG1GC {{ vitam_struct.jmx_exporter | default(jmx_exporter_opts) }} -XX:+ExitOnOutOfMemoryError&quot;
JAVA_ARGS=&quot;{{ vitam_folder_conf }}/{{ vitam_struct.vitam_component }}.conf&quot;
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-logback-access-xml">
<h2>8.2.1.2. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logback-access.xml</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-logback-access-xml" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
{% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/accesslog-{{ vitam_struct.vitam_component }}.%d{yyyy-MM-dd}.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.access_retention_days | default(access_retention_days) }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.access_total_size_cap | default(access_total_size_cap) }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
{% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/accesslog-{{ vitam_struct.vitam_component }}.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
{% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%h %l %u %t{ISO8601} &quot;%r&quot; %s %b &quot;%i{Referer}&quot; &quot;%i{User-agent}&quot; %D %i{X-Request-Id} %i{X-Tenant-Id} %i{X-Application-Id}<span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>
  <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;FILE&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-logback-xml">
<h2>8.2.1.3. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logback.xml</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-logback-xml" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#jinja2: lstrip_blocks: True
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

  <span class="c">&lt;!-- Send debug messages to System.out --&gt;</span>
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- By default, encoders are assigned the type ch.qos.logback.classic.encoder.PatternLayoutEncoder --&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1   at |\n&#39;,&#39;&#39;} : %msg %rootException%n<span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

{% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.file.history_days | default(logback_total_size_cap.file.history_days) }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.file.totalsize | default(logback_total_size_cap.file.totalsize) }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
{% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
{% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n<span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

{% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;SECURITY&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_security.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.security.history_days | default(logback_total_size_cap.security.history_days) }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.security.totalsize | default(logback_total_size_cap.security.totalsize) }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
{% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;SECURITY&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_security.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
{% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n
      <span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

{% if vitam_struct.vitam_component == &#39;storage&#39; %}
  {% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFERSYNC&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_sync.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.offersync.history_days }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.offersync.totalsize }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
  {% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFERSYNC&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_sync.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
  {% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n
      <span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

  {% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFERDIFF&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_diff.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.offerdiff.history_days }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.offerdiff.totalsize }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
  {% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFERDIFF&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_diff.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
  {% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n
      <span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>
{% endif %}

{% if vitam_struct.vitam_component == &#39;offer&#39; and vitam_offers[offer_conf][&quot;provider&quot;] == &#39;tape-library&#39; %}
  {% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFER_TAPE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_tape.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.offer_tape.history_days }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.offer_tape.totalsize }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
  {% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFER_TAPE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_offer_tape.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
  {% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n
      <span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

  {% if logback_rolling_policy|lower == &quot;true&quot; %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFER_TAPE_BACKUP&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileNamePattern&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_tape_backup.%d{yyyy-MM-dd}.%i.log.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
      <span class="nt">&lt;maxFileSize&gt;</span>{{ vitam_struct.logback_max_file_size | default(logback_max_file_size) }}<span class="nt">&lt;/maxFileSize&gt;</span>
      <span class="nt">&lt;maxHistory&gt;</span>{{ vitam_struct.logback_total_size_cap.offer_tape_backup.history_days }}<span class="nt">&lt;/maxHistory&gt;</span>
      <span class="nt">&lt;totalSizeCap&gt;</span>{{ vitam_struct.logback_total_size_cap.offer_tape_backup.totalsize }}<span class="nt">&lt;/totalSizeCap&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
  {% else %}
  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OFFER_TAPE_BACKUP&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.FileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>{{ vitam_folder_log }}/{{ vitam_struct.vitam_component }}_tape_backup.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>
  {% endif %}
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n
      <span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>
{% endif %}

  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;SYSLOG&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.classic.net.SyslogAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;syslogHost&gt;</span>localhost<span class="nt">&lt;/syslogHost&gt;</span>
    <span class="nt">&lt;facility&gt;</span>{{ vitam_defaults.syslog_facility | default(&#39;local0&#39;) }}<span class="nt">&lt;/facility&gt;</span>
    <span class="nt">&lt;suffixPattern&gt;</span>vitam-{{ vitam_struct.vitam_component }}: %d{ISO8601} [[%thread]] [%X{X-Request-Id}] [%X{X-Tenant-Id}] %-5level %logger - %replace(%caller{1..2}){&#39;Caller\+1     at |\n&#39;,&#39;&#39;} : %msg %rootException%n<span class="nt">&lt;/suffixPattern&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>
  <span class="c">&lt;!-- By default, the level of the root level is set to TRACE --&gt;</span>
  <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.log_level | default(vitam_defaults.services.log_level) }}&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- &lt;appender-ref ref=&quot;STDOUT&quot; /&gt; --&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;FILE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;SYSLOG&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/root&gt;</span>

  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.eclipse.jetty&quot;</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.storage.engine.server.logbook.StorageLogbookMock&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.metadata.core.graph.StoreGraphService&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.metadata.core.graph.GraphComputeServiceImpl&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.common&quot;</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span> <span class="nt">/&gt;</span>
{% if vitam_defaults.reconstruction.log_level is defined or reconstruction.log_level is defined %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.metadata.core.reconstruction.service.MetadataReconstructionService&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.metadata.core.reconstruction.service.RestoreBackupService&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.logbook.common.server.reconstruction.ReconstructionService&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.logbook.common.server.reconstruction.RestoreBackupService&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.functional.administration.common.impl.ReconstructionServiceImpl&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.functional.administration.common.impl.RestoreBackupServiceImpl&quot;</span> <span class="na">level=</span><span class="s">&quot;{{ vitam_struct.reconstruction.log_level | default(reconstruction.log_level) }}&quot;</span><span class="nt">/&gt;</span>
{% endif %}

{% if performance_logger|lower == &quot;true&quot; %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.common.performance.PerformanceLogger&quot;</span> <span class="na">level=</span><span class="s">&quot;DEBUG&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;SYSLOG&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>
{% endif %}

  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.common.alert.AlertServiceImpl&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;SECURITY&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>

{% if vitam_struct.vitam_component == &#39;storage&#39; %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.storage.engine.server.offersynchronization&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;OFFERSYNC&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.storage.engine.server.offerdiff&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;OFFERDIFF&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>
{% endif %}

{% if vitam_struct.vitam_component == &#39;offer&#39; %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.storage.offers.tape.process.ProcessExecutor&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;OFFER_TAPE&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>

  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.storage.offers.tape.utils.BackupLogInformation&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;OFFER_TAPE_BACKUP&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/logger&gt;</span>
{% endif %}

{% if vitam_struct.vitam_component == &#39;metadata&#39; %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.metadata.core.migration&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
{% endif %}

{% if vitam_struct.vitam_component == &#39;scheduler&#39; %}
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.quartz&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;fr.gouv.vitam.scheduler&quot;</span> <span class="na">level=</span><span class="s">&quot;INFO&quot;</span><span class="nt">/&gt;</span>
{% endif %}

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-jetty-config-xml">
<h2>8.2.1.4. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/jetty-config.xml</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-jetty-config-xml" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE Configure PUBLIC &quot;-//Jetty//Configure//EN&quot; &quot;http://www.eclipse.org/jetty/configure_9_0.dtd&quot;&gt;</span>

<span class="c">&lt;!-- =============================================================== --&gt;</span>
<span class="c">&lt;!-- Documentation of this file format can be found at:              --&gt;</span>
<span class="c">&lt;!-- http://wiki.eclipse.org/Jetty/Reference/jetty.xml_syntax        --&gt;</span>
<span class="c">&lt;!--                                                                 --&gt;</span>
<span class="c">&lt;!-- Additional configuration files are available in $JETTY_HOME/etc --&gt;</span>
<span class="c">&lt;!-- and can be mixed in. See start.ini file for the default         --&gt;</span>
<span class="c">&lt;!-- configuration files.                                            --&gt;</span>
<span class="c">&lt;!--                                                                 --&gt;</span>
<span class="c">&lt;!-- For a description of the configuration mechanism, see the       --&gt;</span>
<span class="c">&lt;!-- output of:                                                      --&gt;</span>
<span class="c">&lt;!--   java -jar start.jar -?                                        --&gt;</span>
<span class="c">&lt;!-- =============================================================== --&gt;</span>

<span class="c">&lt;!-- =============================================================== --&gt;</span>
<span class="c">&lt;!-- Configure a Jetty Server instance with an ID &quot;Server&quot;           --&gt;</span>
<span class="c">&lt;!-- Other configuration files may also configure the &quot;Server&quot;       --&gt;</span>
<span class="c">&lt;!-- ID, in which case they are adding configuration to the same     --&gt;</span>
<span class="c">&lt;!-- instance.  If other configuration have a different ID, they     --&gt;</span>
<span class="c">&lt;!-- will create and configure another instance of Jetty.            --&gt;</span>
<span class="c">&lt;!-- Consult the javadoc of o.e.j.server.Server for all              --&gt;</span>
<span class="c">&lt;!-- configuration that may be set here.                             --&gt;</span>
<span class="c">&lt;!-- =============================================================== --&gt;</span>
<span class="nt">&lt;Configure</span> <span class="na">id=</span><span class="s">&quot;Server&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.Server&quot;</span><span class="nt">&gt;</span>


    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- Add shared Scheduler instance                               --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="nt">&lt;Call</span> <span class="na">name=</span><span class="s">&quot;addBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg&gt;</span>
            <span class="nt">&lt;New</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.util.thread.ScheduledExecutorScheduler&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
    <span class="nt">&lt;/Call&gt;</span>

    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- Http Configuration.                                         --&gt;</span>
    <span class="c">&lt;!-- This is a common configuration instance used by all         --&gt;</span>
    <span class="c">&lt;!-- connectors that can carry HTTP semantics (HTTP, HTTPS, SPDY)--&gt;</span>
    <span class="c">&lt;!-- It configures the non wire protocol aspects of the HTTP     --&gt;</span>
    <span class="c">&lt;!-- semantic.                                                   --&gt;</span>
    <span class="c">&lt;!--                                                             --&gt;</span>
    <span class="c">&lt;!-- This configuration is only defined here and is used by      --&gt;</span>
    <span class="c">&lt;!-- reference from the jetty-http.xml, jetty-https.xml and      --&gt;</span>
    <span class="c">&lt;!-- jetty-spdy.xml configuration files which instantiate the    --&gt;</span>
    <span class="c">&lt;!-- connectors.                                                 --&gt;</span>
    <span class="c">&lt;!--                                                             --&gt;</span>
    <span class="c">&lt;!-- Consult the javadoc of o.e.j.server.HttpConfiguration       --&gt;</span>
    <span class="c">&lt;!-- for all configuration that may be set here.                 --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;httpConfig&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.HttpConfiguration&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;secureScheme&quot;</span><span class="nt">&gt;</span>http<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;securePort&quot;</span><span class="nt">&gt;</span>8443<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;outputBufferSize&quot;</span><span class="nt">&gt;</span>32768<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;requestHeaderSize&quot;</span><span class="nt">&gt;</span>8192<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;responseHeaderSize&quot;</span><span class="nt">&gt;</span>8192<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;sendServerVersion&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;sendDateHeader&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;headerCacheSize&quot;</span><span class="nt">&gt;</span>512<span class="nt">&lt;/Set&gt;</span>

        <span class="c">&lt;!-- Uncomment to enable handling of X-Forwarded- style headers --&gt;</span>
        <span class="c">&lt;!-- &lt;Call name=&quot;addCustomizer&quot;&gt;</span>
<span class="c">          &lt;Arg&gt;&lt;New class=&quot;org.eclipse.jetty.server.ForwardedRequestCustomizer&quot;/&gt;&lt;/Arg&gt;</span>
<span class="c">        &lt;/Call&gt; --&gt;</span>

    <span class="nt">&lt;/New&gt;</span>

    <span class="c">&lt;!-- ======================= Original Connector ======================= --&gt;</span>
    <span class="c">&lt;!-- &lt;Call name=&quot;addConnector&quot;&gt;</span>
<span class="c">        &lt;Arg&gt;</span>
<span class="c">            &lt;New class=&quot;org.eclipse.jetty.server.ServerConnector&quot;&gt;</span>
<span class="c">                &lt;Arg name=&quot;server&quot;&gt;&lt;Ref refid=&quot;Server&quot; /&gt;&lt;/Arg&gt;</span>
<span class="c">                &lt;Arg name=&quot;factories&quot;&gt;</span>
<span class="c">                    &lt;Array type=&quot;org.eclipse.jetty.server.ConnectionFactory&quot;&gt;</span>
<span class="c">                        &lt;Item&gt;</span>
<span class="c">                            &lt;New class=&quot;org.eclipse.jetty.server.HttpConnectionFactory&quot;&gt;</span>
<span class="c">                                &lt;Arg name=&quot;config&quot;&gt;&lt;Ref refid=&quot;httpConfig&quot; /&gt;&lt;/Arg&gt;</span>
<span class="c">                            &lt;/New&gt;</span>
<span class="c">                        &lt;/Item&gt;</span>
<span class="c">                    &lt;/Array&gt;</span>
<span class="c">                &lt;/Arg&gt;</span>
<span class="c">                &lt;Set name=&quot;port&quot;&gt;{{ vitam_struct.port_service }}&lt;/Set&gt;</span>
<span class="c">                &lt;Set name=&quot;idleTimeout&quot;&gt;</span>
<span class="c">                    &lt;Property name=&quot;http.timeout&quot; default=&quot;{{ vitam_defaults.services.port_service_timeout }}&quot;/&gt;</span>
<span class="c">                &lt;/Set&gt;</span>
<span class="c">            &lt;/New&gt;</span>
<span class="c">        &lt;/Arg&gt;</span>
<span class="c">    &lt;/Call&gt; --&gt;</span>

    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- Set the default handler structure for the Server            --&gt;</span>
    <span class="c">&lt;!-- A handler collection is used to pass received requests to   --&gt;</span>
    <span class="c">&lt;!-- both the ContextHandlerCollection, which selects the next   --&gt;</span>
    <span class="c">&lt;!-- handler by context path and virtual host, and the           --&gt;</span>
    <span class="c">&lt;!-- DefaultHandler, which handles any requests not handled by   --&gt;</span>
    <span class="c">&lt;!-- the context handlers.                                       --&gt;</span>
    <span class="c">&lt;!-- Other handlers may be added to the &quot;Handlers&quot; collection,   --&gt;</span>
    <span class="c">&lt;!-- for example the jetty-requestlog.xml file adds the          --&gt;</span>
    <span class="c">&lt;!-- RequestLogHandler after the default handler                 --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;handler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;Handlers&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.handler.HandlerCollection&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;handlers&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;org.eclipse.jetty.server.Handler&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;Item&gt;</span>
                        <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;Contexts&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.handler.ContextHandlerCollection&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/Item&gt;</span>
                    <span class="nt">&lt;Item&gt;</span>
                        <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;DefaultHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.handler.DefaultHandler&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/Item&gt;</span>
                <span class="nt">&lt;/Array&gt;</span>
            <span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;/New&gt;</span>
    <span class="nt">&lt;/Set&gt;</span>

    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;RequestLog&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;RequestLogImpl&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.access.jetty.VitamRequestLogImpl&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;fileName&quot;</span><span class="nt">&gt;</span>{{ vitam_folder_conf }}/logback-access.xml<span class="nt">&lt;/Set&gt;</span>
            <span class="nt">&lt;/New&gt;</span>
    <span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;RequestLogImpl&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;Call</span> <span class="na">name=</span><span class="s">&quot;start&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Ref&gt;</span>

    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- extra server options                                        --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;stopAtShutdown&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;stopTimeout&quot;</span><span class="nt">&gt;</span>5000<span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;dumpAfterStart&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;dumpBeforeStop&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>

{% if vitam_struct.https_enabled | bool == true %}
   <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;httpsConfig&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.HttpConfiguration&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;sendServerVersion&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;sendDateHeader&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Call</span> <span class="na">name=</span><span class="s">&quot;addCustomizer&quot;</span><span class="nt">&gt;</span>
               <span class="nt">&lt;Arg&gt;</span>
                   <span class="nt">&lt;New</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.SecureRequestCustomizer&quot;</span><span class="nt">&gt;</span>
                       <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;sniHostCheck&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>
                           <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">&quot;jetty.ssl.sniHostCheck&quot;</span> <span class="na">default=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
                       <span class="nt">&lt;/Arg&gt;</span>
                   <span class="nt">&lt;/New&gt;</span>
               <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;/Call&gt;</span>
    <span class="nt">&lt;/New&gt;</span>
        <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;sslContextFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.util.ssl.SslContextFactory$Server&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;KeyStorePath&quot;</span><span class="nt">&gt;</span>{{ vitam_folder_conf }}/keystore_{{ vitam_struct.vitam_component }}.jks<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;KeyStorePassword&quot;</span><span class="nt">&gt;</span>{{ password_keystore }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;KeyManagerPassword&quot;</span><span class="nt">&gt;</span>{{ password_manager_keystore }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;TrustStorePath&quot;</span><span class="nt">&gt;</span>{{ vitam_folder_conf }}/truststore_{{ vitam_struct.vitam_component }}.jks<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;TrustStorePassword&quot;</span><span class="nt">&gt;</span>{{ password_truststore }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;TrustStoreType&quot;</span><span class="nt">&gt;</span>JKS<span class="nt">&lt;/Set&gt;</span>
{% if (vitam_struct.vitam_component in [ vitam.ingestexternal.vitam_component, vitam.accessexternal.vitam_component, vitam.collect_external.vitam_component ]) %}
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;NeedClientAuth&quot;</span><span class="nt">&gt;</span>{{ (not(vitam_defaults.trust_client_certificate_header | default(false) | bool)) | lower }}<span class="nt">&lt;/Set&gt;</span>
{% else %}
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;NeedClientAuth&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Set&gt;</span>
{% endif %}
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;WantClientAuth&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/Set&gt;</span>
      <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;IncludeCipherSuites&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;String&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_ECDHE.*<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_DHE_RSA.*<span class="nt">&lt;/Item&gt;</span>
        <span class="nt">&lt;/Array&gt;</span>
      <span class="nt">&lt;/Set&gt;</span>
       <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;IncludeProtocols&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;String&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLSv1.2<span class="nt">&lt;/Item&gt;</span>
        <span class="nt">&lt;/Array&gt;</span>
      <span class="nt">&lt;/Set&gt;</span>
      <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;ExcludeCipherSuites&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;String&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Item&gt;</span>.*NULL.*<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>.*RC4.*<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>.*MD5.*<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>.*DES.*<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>.*DSS.<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_DHE_RSA_WITH_AES_256_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
          <span class="nt">&lt;Item&gt;</span>TLS_DHE_RSA_WITH_AES_128_CBC_SHA<span class="nt">&lt;/Item&gt;</span>
        <span class="nt">&lt;/Array&gt;</span>
      <span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;UseCipherSuitesOrder&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;RenegotiationAllowed&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;/New&gt;</span>
    <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;sslConnectionFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.SslConnectionFactory&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;sslContextFactory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;sslContextFactory&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;</span>http/1.1<span class="nt">&lt;/Arg&gt;</span>
    <span class="nt">&lt;/New&gt;</span>
    <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;businessConnector&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.ServerConnector&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;Server&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;factories&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;org.eclipse.jetty.server.ConnectionFactory&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;sslConnectionFactory&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;New</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.HttpConnectionFactory&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;config&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;httpsConfig&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;/Arg&gt;</span>
                    <span class="nt">&lt;/New&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;/Array&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span><span class="nt">&gt;</span>{{ ip_service }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;SystemProperty</span> <span class="na">name=</span><span class="s">&quot;jetty.port&quot;</span> <span class="na">default=</span><span class="s">&quot;{{ vitam_struct.port_service }}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>business<span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;/New&gt;</span>

{% else %}

    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- Connector for API business                                  --&gt;</span>
    <span class="c">&lt;!-- Attach all ContextHanlder except Admin                      --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>

    <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;businessConnector&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.ServerConnector&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;Server&quot;</span> <span class="nt">/&gt;&lt;/Arg&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;factories&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;org.eclipse.jetty.server.ConnectionFactory&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;New</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.HttpConnectionFactory&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;config&quot;</span><span class="nt">&gt;&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;httpConfig&quot;</span> <span class="nt">/&gt;&lt;/Arg&gt;</span>
                    <span class="nt">&lt;/New&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;/Array&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span><span class="nt">&gt;</span>{{ ip_service }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span><span class="nt">&gt;</span>{{ vitam_struct.port_service }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>business<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;idleTimeout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">&quot;http.timeout&quot;</span> <span class="na">default=</span><span class="s">&quot;{{ vitam_defaults.services.port_service_timeout }}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;/New&gt;</span>

{% endif %}

    <span class="c">&lt;!-- =========================================================== --&gt;</span>
    <span class="c">&lt;!-- Connector for API Admin                                     --&gt;</span>
    <span class="c">&lt;!-- Attach all ContextHanlder                                   --&gt;</span>
    <span class="c">&lt;!-- =========================================================== --&gt;</span>

    <span class="nt">&lt;New</span> <span class="na">id=</span><span class="s">&quot;adminConnector&quot;</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.ServerConnector&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;Server&quot;</span> <span class="nt">/&gt;&lt;/Arg&gt;</span>
        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;factories&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;org.eclipse.jetty.server.ConnectionFactory&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;New</span> <span class="na">class=</span><span class="s">&quot;org.eclipse.jetty.server.HttpConnectionFactory&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Arg</span> <span class="na">name=</span><span class="s">&quot;config&quot;</span><span class="nt">&gt;&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;httpConfig&quot;</span> <span class="nt">/&gt;&lt;/Arg&gt;</span>
                    <span class="nt">&lt;/New&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;/Array&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span><span class="nt">&gt;</span>{{ ip_admin }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span><span class="nt">&gt;</span>{{ vitam_struct.port_admin }}<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>admin<span class="nt">&lt;/Set&gt;</span>
        <span class="nt">&lt;Set</span> <span class="na">name=</span><span class="s">&quot;idleTimeout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">&quot;http.timeout&quot;</span> <span class="na">default=</span><span class="s">&quot;{{ vitam_defaults.services.port_service_timeout }}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Set&gt;</span>
    <span class="nt">&lt;/New&gt;</span>

    <span class="nt">&lt;Call</span> <span class="na">name=</span><span class="s">&quot;setConnectors&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Arg&gt;</span>
             <span class="nt">&lt;Array</span> <span class="na">type=</span><span class="s">&quot;org.eclipse.jetty.server.ServerConnector&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;businessConnector&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
                <span class="nt">&lt;Item&gt;</span>
                    <span class="nt">&lt;Ref</span> <span class="na">refid=</span><span class="s">&quot;adminConnector&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;/Array&gt;</span>
        <span class="nt">&lt;/Arg&gt;</span>
    <span class="nt">&lt;/Call&gt;</span>

<span class="nt">&lt;/Configure&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-logbook-client-conf">
<h2>8.2.1.5. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/logbook-client.conf</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-logbook-client-conf" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce fichier permet de configurer l’appel au composant logbook.</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>serverHost: {{ vitam.logbook.host }}
serverPort: {{ vitam.logbook.port_service }}
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-server-identity-conf">
<h2>8.2.1.6. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/server-identity.conf</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-server-identity-conf" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>identityName: {{ ansible_nodename }}
identityRole: {{ vitam_struct.vitam_component }}
identitySiteId: {{ vitam_site_id }}
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fichier-vitam-conf-composant-antisamy-esapi-xml">
<h2>8.2.1.7. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/antisamy-esapi.xml</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-antisamy-esapi-xml" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="fichier-vitam-conf-composant-vitam-conf">
<h2>8.2.1.8. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/vitam.conf</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-vitam-conf" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span>secret : {{ plateforme_secret }}
filterActivation : {{ vitam_struct.secret_platform }}
{% if vitam_struct.vitam_component == vitam.processing.vitam_component %}
distributeurBatchSize: 800
workerBulkSize: 16
{% endif %}
{% if vitam_struct.vitam_component == vitam.metadata.vitam_component %}
storeGraphElementsPerFile: 10000
storeGraphOverlapDelay: 300
expireCacheEntriesDelay: 300
deleteIncompleteReconstructedUnitDelay: 2592000
migrationBulkSize: 10000
workspaceFreespaceThreshold: {{ vitam.metadata.workspaceFreespaceThreshold | default(25) }}
{% endif %}
distributionThreshold : 100000
eliminationAnalysisThreshold : 100000
eliminationActionThreshold : 10000
computedInheritedRulesThreshold : 100000000
intervalDelayCheckIdle : 5000
maxDelayUnusedConnection : 5000
delayValidationAfterInactivity : 2500
tenants: [ &quot;{{ vitam_tenant_ids | join(&#39;&quot;, &quot;&#39;) }}&quot; ]
adminTenant : {{ vitam_tenant_admin | default(1) }}
forceChunkModeInputStream : {{ vitam_defaults.vitam_force_chunk_mode | default(false) }}

{% if vitam_struct.vitam_component == vitam.worker.vitam_component %}
reclassificationMaxBulkThreshold: 1000
reclassificationMaxUnitsThreshold: 10000
reclassificationMaxGuildListSizeInLogbookOperation: 1000
queriesThreshold: {{ vitam.worker.queriesThreshold | default(100000) }}
bulkAtomicUpdateBatchSize: {{ vitam.worker.bulkAtomicUpdateBatchSize | default(100) }}
bulkAtomicUpdateThreadPoolSize: {{ vitam.worker.bulkAtomicUpdateThreadPoolSize | default(8) }}
bulkAtomicUpdateThreadPoolQueueSize: {{ vitam.worker.bulkAtomicUpdateThreadPoolQueueSize | default(16) }}

binarySizePlatformThreshold: # 1 Go
 limit: {{ vitam.worker.binarySizePlatformThreshold | default(1) }}
 sizeUnit: {{ vitam.worker.binarySizePlatformThresholdSizeUnit | default(&#39;GIGABYTE&#39;) }}

binarySizeTenantThreshold: # exemple for tenant 0 max dip/transfer size is 20 Mo, true means can exceed tenant threshold.
#  - tenant: 0
#    limit: 20
#    sizeUnit: MEGABYTE
#    authorize: true

eliminationReportExtraFields:
{% for tenant_id in vitam_tenant_ids %}
  - tenant: {{ tenant_id }}
    metadataFields: {{ extendedConfiguration.custom[tenant_id].eliminationReportExtraFields | default(default_eliminationReportExtraFields) | to_json }}
{% endfor %}

ingestReportUnitExtraFields:
{% for tenant_id in vitam_tenant_ids %}
  - tenant: {{ tenant_id }}
    metadataFields: {{ extendedConfiguration.custom[tenant_id].ingestReportUnitExtraFields | default(default_ingestReportUnitExtraFields) | to_json }}
{% endfor %}

ingestReportObjectExtraFields:
{% for tenant_id in vitam_tenant_ids %}
  - tenant: {{ tenant_id }}
    metadataFields: {{ extendedConfiguration.custom[tenant_id].ingestReportObjectExtraFields | default(default_ingestReportObjectExtraFields) | to_json }}
{% endfor %}
{% endif %}

keywordMaxLength: {{ vitam_defaults.keywordMaxLength | default(32766) }}
textMaxLength: {{ vitam_defaults.textMaxLength | default(32766) }}

classificationLevel :
  allowList : [{% for classification in classificationList %}{{ classification }}{% if not loop.last %},{% endif %}{% endfor %}]
  authorizeNotDefined: {{ classificationLevelOptional }}

indexInheritedRulesWithAPIV2OutputByTenant: [ &quot;{{ vitam.worker.api_output_index_tenants | join(&#39;&quot;, &quot;&#39;) }}&quot; ]
indexInheritedRulesWithRulesIdByTenant: [ &quot;{{ vitam.worker.rules_index_tenants | join(&#39;&quot;, &quot;&#39;) }}&quot; ]

environmentName: {{ vitam_prefix_offer|default(vitam_site_name) }}

acceptableRequestTime: {{ acceptableRequestTime|default(10) }}
criticalRequestTime: {{ criticalRequestTime|default(60) }}
requestTimeAlertThrottlingDelay: {{ requestTimeAlertThrottlingDelay|default(60) }}

# Ontology cache settings (max entries in cache &amp; retention timeout in seconds)
ontologyCacheMaxEntries: {{ vitam_defaults.ontologyCacheMaxEntries | default(100) }}
ontologyCacheTimeoutInSeconds: {{ vitam_defaults.ontologyCacheTimeoutInSeconds | default(300) }}

# Elasticsearch scroll timeout settings
elasticSearchScrollTimeoutInMilliseconds: {{ vitam_defaults.elasticSearchScrollTimeoutInMilliseconds | default(300000) }}

{% if vitam_struct.vitam_component == vitam.processing.vitam_component %}
processEngineWaitForStepTimeout: 172800
{% endif %}

restoreBulkSize: {{ restoreBulkSize | default(10000) }}
</pre></div>
</td></tr></table></div>
<p>Ce fichier permet de définir les variables d’environnement vitam.</p>
<ul>
<li><dl class="first docutils">
<dt><cite>binarySizePlatformThreshold</cite> est le seuil de plate-forme du poids binaire max autorisé pour un DIP.</dt>
<dd><dl class="first docutils">
<dt>elle comporte deux clés :</dt>
<dd><p class="first last">limit : le seuil
sizeUnit : l’unité de taille (GIGABYTE / MEGABYTE / KILOBYTE / BYTE)</p>
</dd>
</dl>
<p>par défaut le seuil est 1 Go.
exemple :</p>
<div class="last highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">binarySizePlatformThreshold</span><span class="p">:</span>
    <span class="nt">limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">sizeUnit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GIGABYTE / MEGABYTE / KILOBYTE / BYTE</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>binarySizeTenantThreshold</cite> est une liste qui constitue l’ensemble des seuils du poids binaire max autorisé pour un DIP par tenant.</dt>
<dd><dl class="first docutils">
<dt>Cette liste comporte 4 clés :</dt>
<dd><p class="first last">tenant : le tenant
limit : le seuil
sizeUnit : l’unité de taille (GIGABYTE / MEGABYTE / KILOBYTE / BYTE)
authorise : true si l’utilisateur peut excéder le seuil prédéfini.</p>
</dd>
</dl>
<p>exemple :</p>
<div class="last highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">binarySizeTenantThreshold</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">tenant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="l l-Scalar l-Scalar-Plain">limit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
      <span class="l l-Scalar l-Scalar-Plain">sizeUnit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MEGABYTE</span>
      <span class="l l-Scalar l-Scalar-Plain">authorize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="p p-Indicator">-</span> <span class="nt">tenant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="l l-Scalar l-Scalar-Plain">limit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
      <span class="l l-Scalar l-Scalar-Plain">sizeUnit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MEGABYTE</span>
      <span class="l l-Scalar l-Scalar-Plain">authorize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="fichier-vitam-conf-composant-java-security">
<h2>8.2.1.9. Fichier <code class="docutils literal notranslate"><span class="pre">/vitam/conf/&lt;composant&gt;/java.security</span></code><a class="headerlink" href="#fichier-vitam-conf-composant-java-security" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Use Bouncy Castle Provider when it is available</span>
<span class="na">security.provider.9</span><span class="o">=</span><span class="s">org.bouncycastle.jce.provider.BouncyCastleProvider</span>

<span class="c1"># Override the default list of Centos 7 that disable Elliptic Curved Based Algorithms</span>
<span class="na">jdk.tls.disabledAlgorithms</span><span class="o">=</span><span class="s">&quot;SSLv3, TLSv1, TLSv1.1, RC4, MD5withRSA, DH keySize &lt; 768,RSA keySize &lt; 2048&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="_toc.html" class="btn btn-neutral float-left" title="8. Exploitation des composants de la solution logicielle VITAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="access/_toc.html" class="btn btn-neutral float-right" title="8.2.2. Access" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>