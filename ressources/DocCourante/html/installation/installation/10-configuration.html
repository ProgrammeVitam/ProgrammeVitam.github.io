

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.2.3. Configuration du déploiement &mdash; Documentation VITAM - Documentation d&#39;installation 3.0.1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'3.0.1',
              LANGUAGE:'fr',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="4.2.4. Gestion des certificats" href="20-certificats.html" />
    <link rel="prev" title="4.2.2. Cas particulier d’une installation multi-sites" href="05_multisite.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VITAM - Documentation d'installation
          

          
            
            <img src="../_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html#rappels">2. Rappels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pre_install/_toc.html">3. Prérequis à l’installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">4. Procédures d’installation / mise à jour</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="_toc.html#verifications-prealables">4.1. Vérifications préalables</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="_toc.html#procedures">4.2. Procédures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_cinematique.html">4.2.1. Cinématique de déploiement</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_multisite.html">4.2.2. Cas particulier d’une installation multi-sites</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.2.3. Configuration du déploiement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fichiers-de-deploiement">4.2.3.1. Fichiers de déploiement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#informations-plate-forme">4.2.3.2. Informations <cite>plate-forme</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#declaration-des-secrets">4.2.3.3. Déclaration des secrets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="20-certificats.html">4.2.4. Gestion des certificats</a></li>
<li class="toctree-l3"><a class="reference internal" href="21-addons.html">4.2.5. Paramétrages supplémentaires</a></li>
<li class="toctree-l3"><a class="reference internal" href="30-installation.html">4.2.6. Procédure de première installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="80-extras.html">4.2.7. Elements <em>extras</em> de l’installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../update/_toc.html">5. Procédures de mise à jour de la configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../post_install/_toc.html">6. Post installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/_toc.html">7. Montée de version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/_toc.html">8. Annexes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VITAM - Documentation d'installation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="_toc.html">4. Procédures d’installation / mise à jour</a> &raquo;</li>
        
      <li>4.2.3. Configuration du déploiement</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/installation/10-configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-du-deploiement">
<h1>4.2.3. Configuration du déploiement<a class="headerlink" href="#configuration-du-deploiement" title="Lien permanent vers ce titre">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">L’architecture de la solution logicielle, les éléments de dimensionnement ainsi que les principes de déploiement sont définis dans le <a class="reference internal" href="../introduction.html#term-dat"><span class="xref std std-term">DAT</span></a>.</p>
</div>
<div class="section" id="fichiers-de-deploiement">
<h2>4.2.3.1. Fichiers de déploiement<a class="headerlink" href="#fichiers-de-deploiement" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les fichiers de déploiement sont disponibles dans la version <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a> livrée, dans le sous-répertoire <code class="docutils literal notranslate"><span class="pre">deployment</span></code> . Concernant l’installation, ils se déclinent en 2 parties&nbsp;:</p>
<blockquote>
<div><ul class="simple">
<li>les <em>playbook</em> ansible de déploiement, présents dans le sous-répertoire <code class="docutils literal notranslate"><span class="pre">ansible-vitam</span></code>, qui est indépendant de l’environnement à déployer ; ces fichiers ne sont normalement pas à modifier pour réaliser une installation.</li>
<li>l’arborescence d’inventaire&nbsp;; des fichiers d’exemples sont disponibles dans le sous-répertoire <code class="docutils literal notranslate"><span class="pre">environments</span></code>. Cette arborescence est valable pour le déploiement d’un environnement, et doit être dupliquée lors de l’installation d’environnements ultérieurs. Les fichiers contenus dans cette arborescence doivent être adaptés avant le déploiement, comme expliqué dans les paragraphes suivants.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="informations-plate-forme">
<span id="inventaire"></span><h2>4.2.3.2. Informations <cite>plate-forme</cite><a class="headerlink" href="#informations-plate-forme" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="id1">
<h3>4.2.3.2.1. Inventaire<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour configurer le déploiement, il est nécessaire de créer, dans le répertoire <code class="docutils literal notranslate"><span class="pre">environments</span></code>, un nouveau fichier d’inventaire (par la suite, ce fichier sera communément appelé  <code class="docutils literal notranslate"><span class="pre">hosts.&lt;environnement&gt;</span></code>). Ce fichier devra se conformer à la structure présente dans le fichier <code class="docutils literal notranslate"><span class="pre">hosts.example</span></code> (et notamment respecter scrupuleusement l’arborescence des groupes <cite>ansible</cite>). Les commentaires dans ce fichier fournissent les explications permettant l’adaptation à l’environnement cible :</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[hosts]</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[hosts:children]</span>
<span class="na">vitam</span>
<span class="na">reverse</span>
<span class="na">hosts_dev_tools</span>
<span class="na">ldap</span>


<span class="c1">########### Tests environments specifics ###########</span>

<span class="c1"># EXTRA : Front reverse-proxy (test environments ONLY) ; add machine name after</span>
<span class="k">[reverse]</span>
<span class="c1"># optional : after machine, if this machine is different from VITAM machines, you can specify another become user</span>
<span class="c1"># Example</span>
<span class="c1"># vitam-centos-01.vitam ansible_ssh_user=centos</span>

<span class="c1">########### Extra VITAM applications ###########</span>

<span class="na">[ldap] # Extra : OpenLDAP server</span>
<span class="c1"># LDAP server !!! NOT FOR PRODUCTION !!! Test only</span>

<span class="k">[library]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : library</span>

<span class="k">[hosts_dev_tools]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : mongo-express, elasticsearch-head</span>

<span class="na">[elasticsearch:children] # EXTRA : elasticsearch</span>
<span class="na">hosts_elasticsearch_data</span>
<span class="na">hosts_elasticsearch_log</span>

<span class="c1">########### VITAM services ###########</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[vitam:children]</span>
<span class="na">zone_external</span>
<span class="na">zone_access</span>
<span class="na">zone_applicative</span>
<span class="na">zone_storage</span>
<span class="na">zone_data</span>
<span class="na">zone_admin</span>
<span class="na">library</span>


<span class="c1">##### Zone externe</span>


<span class="k">[zone_external:children]</span>
<span class="na">hosts_ihm_demo</span>
<span class="na">hosts_ihm_recette</span>


<span class="k">[hosts_ihm_demo]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : ihm-demo. If you own another frontend, it is recommended to leave this group blank</span>
<span class="c1"># If you don&#39;t need consul for ihm-demo, you can set this var after each hostname :</span>
<span class="c1"># consul_disabled=true</span>

<span class="k">[hosts_ihm_recette]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : ihm-recette (extra feature)</span>


<span class="c1">##### Zone access</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[zone_access:children]</span>
<span class="na">hosts_ingest_external</span>
<span class="na">hosts_access_external</span>

<span class="k">[hosts_ingest_external]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : ingest-external</span>


<span class="k">[hosts_access_external]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : access-external</span>


<span class="c1">##### Zone applicative</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[zone_applicative:children]</span>
<span class="na">hosts_ingest_internal</span>
<span class="na">hosts_processing</span>
<span class="na">hosts_batch_report</span>
<span class="na">hosts_worker</span>
<span class="na">hosts_access_internal</span>
<span class="na">hosts_metadata</span>
<span class="na">hosts_functional_administration</span>
<span class="na">hosts_logbook</span>
<span class="na">hosts_workspace</span>
<span class="na">hosts_storage_engine</span>
<span class="na">hosts_security_internal</span>

<span class="k">[hosts_security_internal]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : security-internal</span>


<span class="k">[hosts_logbook]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : logbook</span>


<span class="k">[hosts_workspace]</span>
<span class="c1"># TODO: Put the server where this service will be deployed : workspace</span>
<span class="c1"># WARNING: put only one server for this service, not more !</span>


<span class="k">[hosts_ingest_internal]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : ingest-internal</span>


<span class="k">[hosts_access_internal]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : access-internal</span>


<span class="k">[hosts_metadata]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : metadata</span>


<span class="k">[hosts_functional_administration]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : functional-administration</span>


<span class="k">[hosts_processing]</span>
<span class="c1"># TODO: Put the server where this service will be deployed : processing</span>
<span class="c1"># WARNING: put only one server for this service, not more !</span>


<span class="k">[hosts_storage_engine]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : storage-engine</span>

<span class="k">[hosts_batch_report]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : batch-report</span>

<span class="k">[hosts_worker]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : worker</span>
<span class="c1"># Optional parameter after each host : vitam_worker_capacity=&lt;integer&gt; ; please refer to your infrastructure for defining this number ; default is ansible_processor_vcpus value (cpu number in /proc/cpuinfo file)</span>


<span class="c1">##### Zone storage</span>

<span class="na">[zone_storage:children] # DO NOT MODIFY</span>
<span class="na">hosts_storage_offer_default</span>
<span class="na">hosts_mongodb_offer</span>

<span class="k">[hosts_storage_offer_default]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : storage-offer-default</span>
<span class="c1"># LIMIT : only 1 offer per machine </span>
<span class="c1"># LIMIT and 1 machine per offer when filesystem or filesystem-hash provider</span>
<span class="c1"># Possibility to declare multiple machines with same provider only when provider is s3 or swift.</span>
<span class="c1"># Mandatory param for each offer is offer_conf and points to offer_opts.yml &amp; vault-vitam.yml (with same tree)</span>
<span class="c1"># for swift</span>
<span class="c1"># hostname-offre-1.vitam offer_conf=offer-swift-1</span>
<span class="c1"># hostname-offre-2.vitam offer_conf=offer-swift-1</span>
<span class="c1"># for filesystem</span>
<span class="c1"># hostname-offre-2.vitam offer_conf=offer-fs-1</span>
<span class="c1"># for s3</span>
<span class="c1"># hostname-offre-3.vitam offer_conf=offer-s3-1</span>
<span class="c1"># hostname-offre-4.vitam offer_conf=offer-s3-1</span>

<span class="k">[hosts_mongodb_offer:children]</span>
<span class="na">hosts_mongos_offer</span>
<span class="na">hosts_mongoc_offer</span>
<span class="na">hosts_mongod_offer</span>

<span class="k">[hosts_mongos_offer]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongos_data]</span>
<span class="c1"># TODO: put here servers where this service will be deployed : mongos cluster for storage offers</span>
<span class="c1"># Mandatory param : mongo_cluster_name : name of the cluster (should exist in the offer_conf configuration)</span>
<span class="c1"># The recommended practice is to install the mongos instance on the same servers as the mongoc instances</span>
<span class="c1"># Example (for a more complete one, see the one in the group hosts_mongos_data) :</span>
<span class="c1"># vitam-mongo-swift-offer-01   mongo_cluster_name=offer-swift-1</span>
<span class="c1"># vitam-mongo-swift-offer-02   mongo_cluster_name=offer-swift-1</span>
<span class="c1"># vitam-mongo-fs-offer-01      mongo_cluster_name=offer-fs-1</span>
<span class="c1"># vitam-mongo-fs-offer-02      mongo_cluster_name=offer-fs-1</span>
<span class="c1"># vitam-mongo-s3-offer-01      mongo_cluster_name=offer-s3-1</span>
<span class="c1"># vitam-mongo-s3-offer-02      mongo_cluster_name=offer-s3-1</span>

<span class="k">[hosts_mongoc_offer]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongoc_data]</span>
<span class="c1"># TODO: put here servers where this service will be deployed : mongoc cluster for storage offers</span>
<span class="c1"># Mandatory param : mongo_cluster_name : name of the cluster (should exist in the offer_conf configuration)</span>
<span class="c1"># Optional param : mandatory for 1 node of the shard, some init commands will be executed on it</span>
<span class="c1"># Optional param : mongo_arbiter=true : the node will be only an arbiter ; do not add this paramter on a mongo_rs_bootstrap node</span>
<span class="c1"># Recommended practice in production: use 3 instances</span>
<span class="c1"># Example :</span>
<span class="c1"># vitam-mongo-swift-offer-01   mongo_cluster_name=offer-swift-1                       mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-swift-offer-02   mongo_cluster_name=offer-swift-1</span>
<span class="c1"># vitam-swift-offer            mongo_cluster_name=offer-swift-1                       mongo_arbiter=true</span>
<span class="c1"># vitam-mongo-fs-offer-01      mongo_cluster_name=offer-fs-1                          mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-fs-offer-02      mongo_cluster_name=offer-fs-1</span>
<span class="c1"># vitam-fs-offer               mongo_cluster_name=offer-fs-1                          mongo_arbiter=true</span>
<span class="c1"># vitam-mongo-s3-offer-01      mongo_cluster_name=offer-s3-1                       mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-s3-offer-02      mongo_cluster_name=offer-s3-1</span>
<span class="c1"># vitam-s3-offer               mongo_cluster_name=offer-s3-1                       mongo_arbiter=true</span>

<span class="k">[hosts_mongod_offer]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongod_data]</span>
<span class="c1"># TODO: put here servers where this service will be deployed : mongod cluster for storage offers</span>
<span class="c1"># Mandatory param : mongo_cluster_name : name of the cluster (should exist in the offer_conf configuration)</span>
<span class="c1"># Mandatory param : id of the current shard, increment by 1 from 0 to n</span>
<span class="c1"># Optional param : mandatory for 1 node of the shard, some init commands will be executed on it</span>
<span class="c1"># Optional param : mongo_arbiter=true : the node will be only an arbiter ; do not add this paramter on a mongo_rs_bootstrap node</span>
<span class="c1"># Optional param : mongod_memory=x ; this will force the wiredtiger cache size to x (unit is GB) ; can be usefull when colocalization with elasticsearch</span>
<span class="c1"># Optional param : is_small=true ; this will force the priority for this server to be lower when electing master ; hardware can be downgraded for this machine</span>
<span class="c1"># Recommended practice in production: use 3 instances per shard</span>
<span class="c1"># Example :</span>
<span class="c1"># vitam-mongo-swift-offer-01   mongo_cluster_name=offer-swift-1    mongo_shard_id=0                   mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-swift-offer-02   mongo_cluster_name=offer-swift-1    mongo_shard_id=0</span>
<span class="c1"># vitam-swift-offer            mongo_cluster_name=offer-swift-1    mongo_shard_id=0                   mongo_arbiter=true</span>
<span class="c1"># vitam-mongo-fs-offer-01      mongo_cluster_name=offer-fs-1       mongo_shard_id=0                   mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-fs-offer-02      mongo_cluster_name=offer-fs-1       mongo_shard_id=0</span>
<span class="c1"># vitam-fs-offer               mongo_cluster_name=offer-fs-1       mongo_shard_id=0                   mongo_arbiter=true</span>
<span class="c1"># vitam-mongo-s3-offer-01      mongo_cluster_name=offer-s3-1       mongo_shard_id=0                   mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mongo-s3-offer-02      mongo_cluster_name=offer-s3-1       mongo_shard_id=0                   is_small=true # PSsmin, this machine needs less hardware</span>
<span class="c1"># vitam-s3-offer               mongo_cluster_name=offer-s3-1       mongo_shard_id=0                   mongo_arbiter=true</span>

<span class="c1">##### Zone data</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[zone_data:children]</span>
<span class="na">hosts_elasticsearch_data</span>
<span class="na">hosts_mongodb_data</span>

<span class="k">[hosts_elasticsearch_data]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : elasticsearch-data cluster</span>
<span class="c1"># 2 params available for huge environments (parameter to be declared after each server) :</span>
<span class="c1">#    is_data=true/false</span>
<span class="c1">#    is_master=true/false</span>
<span class="c1">#    for site/room balancing : is_balancing=&lt;whatever&gt; so replica can be applied on all sites/rooms ; default is vitam_site_name</span>
<span class="c1">#    other options are not handled yet</span>
<span class="c1"># defaults are set to true, if undefined. If defined, at least one server MUST be is_data=true</span>
<span class="c1"># Examples :</span>
<span class="c1"># server1 is_master=true is_data=false</span>
<span class="c1"># server2 is_master=false is_data=true</span>
<span class="c1"># More explanation here : https://www.elastic.co/guide/en/elasticsearch/reference/5.6/modules-node.html</span>


<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[hosts_mongodb_data:children]</span>
<span class="na">hosts_mongos_data</span>
<span class="na">hosts_mongoc_data</span>
<span class="na">hosts_mongod_data</span>

<span class="k">[hosts_mongos_data]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongos_offer]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : mongos cluster</span>
<span class="c1"># Mandatory param : mongo_cluster_name=mongo-data  (&quot;mongo-data&quot; is mandatory)</span>
<span class="c1"># The recommended practice is to install the mongos instance on the same servers as the mongoc instances</span>
<span class="c1"># Example :</span>
<span class="c1"># vitam-mdbs-01   mongo_cluster_name=mongo-data</span>
<span class="c1"># vitam-mdbs-02   mongo_cluster_name=mongo-data</span>
<span class="c1"># vitam-mdbs-03   mongo_cluster_name=mongo-data</span>

<span class="k">[hosts_mongoc_data]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongoc_offer]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : mongoc cluster</span>
<span class="c1"># Mandatory param : mongo_cluster_name=mongo-data  (&quot;mongo-data&quot; is mandatory)</span>
<span class="c1"># Optional param : mandatory for 1 node of the shard, some init commands will be executed on it</span>
<span class="c1"># Recommended practice in production: use 3 instances</span>
<span class="c1"># Example :</span>
<span class="c1"># vitam-mdbc-01   mongo_cluster_name=mongo-data                     mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mdbc-02   mongo_cluster_name=mongo-data</span>
<span class="c1"># vitam-mdbc-03   mongo_cluster_name=mongo-data</span>

<span class="k">[hosts_mongod_data]</span>
<span class="c1"># WARNING : DO NOT COLLOCATE WITH [hosts_mongod_offer]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : mongod cluster</span>
<span class="c1"># Each replica_set should have an odd number of members (2n + 1)</span>
<span class="c1"># Reminder: For Vitam, one mongodb shard is using one replica_set</span>
<span class="c1"># Mandatory param : mongo_cluster_name=mongo-data (&quot;mongo-data&quot; is mandatory)</span>
<span class="c1"># Mandatory param : id of the current shard, increment by 1 from 0 to n</span>
<span class="c1"># Optional param : mandatory for 1 node of the shard, some init commands will be executed on it</span>
<span class="c1"># Optional param : mongod_memory=x ; this will force the wiredtiger cache size to x (unit is GB) ; can be usefull when colocalization with elasticsearch</span>
<span class="c1"># Recommended practice in production: use 3 instances per shard</span>
<span class="c1"># Example:</span>
<span class="c1"># vitam-mdbd-01  mongo_cluster_name=mongo-data   mongo_shard_id=0  mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mdbd-02  mongo_cluster_name=mongo-data   mongo_shard_id=0</span>
<span class="c1"># vitam-mdbd-03  mongo_cluster_name=mongo-data   mongo_shard_id=0</span>
<span class="c1"># vitam-mdbd-04  mongo_cluster_name=mongo-data   mongo_shard_id=1  mongo_rs_bootstrap=true</span>
<span class="c1"># vitam-mdbd-05  mongo_cluster_name=mongo-data   mongo_shard_id=1</span>
<span class="c1"># vitam-mdbd-06  mongo_cluster_name=mongo-data   mongo_shard_id=1</span>

<span class="c1">###### Zone admin</span>

<span class="c1"># Group definition ; DO NOT MODIFY</span>
<span class="k">[zone_admin:children]</span>
<span class="na">hosts_cerebro</span>
<span class="na">hosts_consul_server</span>
<span class="na">hosts_kibana_data</span>
<span class="na">log_servers</span>
<span class="na">hosts_elasticsearch_log</span>

<span class="k">[hosts_cerebro]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : vitam-elasticsearch-cerebro</span>

<span class="k">[hosts_consul_server]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : consul</span>

<span class="k">[hosts_kibana_data]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : kibana (for data cluster)</span>

<span class="k">[log_servers:children]</span>
<span class="na">hosts_kibana_log</span>
<span class="na">hosts_logstash</span>


<span class="k">[hosts_kibana_log]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : kibana (for log cluster)</span>

<span class="k">[hosts_logstash]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : logstash</span>
<span class="c1"># IF you connect VITAM to external SIEM, DO NOT FILL THE SECTION</span>


<span class="k">[hosts_elasticsearch_log]</span>
<span class="c1"># TODO: Put here servers where this service will be deployed : elasticsearch-log cluster</span>
<span class="c1"># IF you connect VITAM to external SIEM, DO NOT FILL THE SECTION</span>

<span class="c1">########### Global vars ###########</span>

<span class="k">[hosts:vars]</span>

<span class="c1"># ===============================</span>
<span class="c1"># VITAM</span>
<span class="c1"># ===============================</span>

<span class="c1"># Declare user for ansible on target machines</span>
<span class="na">ansible_ssh_user</span><span class="o">=</span>
<span class="c1"># Can target user become as root ? ; true is required by VITAM (usage of a sudoer is mandatory)</span>
<span class="na">ansible_become</span><span class="o">=</span><span class="s">true</span>
<span class="c1"># How can ansible switch to root ?</span>
<span class="c1"># See https://docs.ansible.com/ansible/latest/user_guide/become.html</span>

<span class="c1"># Related to Consul ; apply in a table your DNS server(s)</span>
<span class="c1"># Example : dns_servers=[&quot;8.8.8.8&quot;,&quot;8.8.4.4&quot;]</span>
<span class="c1"># If no recursors, use : dns_servers=</span>
<span class="na">dns_servers</span><span class="o">=</span>

<span class="c1"># Vitam tenants to create</span>
<span class="na">vitam_tenant_ids</span><span class="o">=</span><span class="s">[0,1,2]</span>
<span class="na">vitam_tenant_admin</span><span class="o">=</span><span class="s">1</span>

<span class="c1">### Logback configuration ###</span>
<span class="c1"># Days before deleting logback log files (java &amp; access logs for vitam components)</span>
<span class="na">days_to_delete_logback_logfiles</span><span class="o">=</span>

<span class="c1"># Define local Consul datacenter name</span>
<span class="c1"># CAUTION !!! Only alphanumeric characters when using s3 as offer backend !!!</span>
<span class="na">vitam_site_name</span><span class="o">=</span><span class="s">prod-dc1</span>
<span class="c1"># On offer, value is the prefix for all containers&#39; names. If upgrading from R8, you MUST UNCOMMENT this parameter AS IS !!!</span>
<span class="c1">#vitam_prefix_offer=&quot;&quot;</span>
<span class="c1"># EXAMPLE : vitam_site_name = prod-dc1</span>
<span class="c1"># check whether on primary site (true) or secondary (false)</span>
<span class="na">primary_site</span><span class="o">=</span><span class="s">true</span>


<span class="c1"># ===============================</span>
<span class="c1"># EXTRA</span>
<span class="c1"># ===============================</span>
<span class="c1"># Environment (defines title in extra on reverse homepage). Variable is DEPRECATED !</span>
<span class="c1">#environnement=</span>

<span class="c1">### vitam-itest repository ###</span>
<span class="na">vitam_tests_branch</span><span class="o">=</span><span class="s">master</span>
<span class="na">vitam_tests_gitrepo_protocol</span><span class="o">=</span>
<span class="na">vitam_tests_gitrepo_baseurl</span><span class="o">=</span>
<span class="na">vitam_tests_gitrepo_url</span><span class="o">=</span>

<span class="c1"># Used when VITAM is behind a reverse proxy (provides configuration for reverse proxy &amp;&amp; displayed in header page)</span>
<span class="na">vitam_reverse_external_dns</span><span class="o">=</span>
<span class="c1"># For reverse proxy use</span>
<span class="na">reverse_proxy_port</span><span class="o">=</span><span class="s">443</span>
<span class="na">vitam_reverse_external_protocol</span><span class="o">=</span><span class="s">https</span>
<span class="c1"># http_proxy env var to use ; has to be declared even if empty</span>
<span class="na">http_proxy_environnement</span><span class="o">=</span>
</pre></div>
</td></tr></table></div>
<p>Pour chaque type de <cite>host</cite>, indiquer le(s) serveur(s) défini(s), pour chaque fonction. Une colocalisation de composants est possible (Cf. le paragraphe idoine du <a class="reference internal" href="../introduction.html#term-dat"><span class="xref std std-term">DAT</span></a>)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Concernant le groupe <cite>hosts_consul_server</cite>, il est nécessaire de déclarer au minimum 3 machines.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Il n’est pas possible de colocaliser les clusters MongoDB <cite>data</cite> et <cite>offer</cite>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Il n’est pas possible de colocaliser <cite>kibana-data</cite> et <cite>kibana-log</cite>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour les composants considérés par l’exploitant comme étant «&nbsp;hors <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>&nbsp;» (typiquement, le composant <code class="docutils literal notranslate"><span class="pre">ihm-demo</span></code>), il est possible de désactiver la création du servcie Consul associé. Pour cela, après chaque hostname impliqué, il faut rajouter la directive suivante : <code class="docutils literal notranslate"><span class="pre">consul_disabled=true</span></code>.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Concernant la valeur de <code class="docutils literal notranslate"><span class="pre">vitam_site_name</span></code>, seuls les caractères alphanumériques et le tiret («&nbsp;-«&nbsp;) sont autorisés.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Il est possible de multi-instancier le composant «&nbsp;storage-offer-default&nbsp;» dans le cas d’un <em>provider</em> de type objet (s3, swift). Il faut ajouter <code class="docutils literal notranslate"><span class="pre">offer_conf=&lt;le</span> <span class="pre">nom&gt;</span></code>.</p>
</div>
</div>
<div class="section" id="fichier-vitam-security-yml">
<h3>4.2.3.2.2. Fichier <code class="docutils literal notranslate"><span class="pre">vitam_security.yml</span></code><a class="headerlink" href="#fichier-vitam-security-yml" title="Lien permanent vers ce titre">¶</a></h3>
<p>La configuration des droits d’accès à VITAM est réalisée dans le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/vitam_security.yml</span></code>, comme suit :</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">hide_passwords_during_deploy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1">### Admin context name and tenants ###</span>
<span class="nt">admin_context_name</span><span class="p">:</span> <span class="s">&quot;admin-context&quot;</span>
<span class="nt">admin_context_tenants</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vitam_tenant_ids</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="c1"># Indicate context certificates relative paths under {{ inventory_dir }}/certs/client-external/clients</span>
<span class="c1"># vitam-admin-int is mandatory for internal use (PRONOM upload)</span>
<span class="nt">admin_context_certs</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;ihm-demo/ihm-demo.crt&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;ihm-recette/ihm-recette.crt&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;reverse/reverse.crt&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;vitam-admin-int/vitam-admin-int.crt&quot;</span> <span class="p p-Indicator">]</span>
<span class="c1"># Indicate here all the personal certificates relative paths under {{ inventory_dir }}/certs/client-vitam-users/clients</span>
<span class="nt">admin_personal_certs</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;userOK.crt&quot;</span> <span class="p p-Indicator">]</span>

<span class="c1"># Admin security profile name</span>
<span class="nt">admin_security_profile</span><span class="p">:</span> <span class="s">&quot;admin-security-profile&quot;</span>

<span class="nt">admin_basic_auth_user</span><span class="p">:</span> <span class="s">&quot;adminUser&quot;</span>

<span class="c1"># SElinux state, can be: enforcing, permissive, disabled</span>
<span class="nt">selinux_state</span><span class="p">:</span> <span class="s">&quot;disabled&quot;</span>
<span class="c1"># SELinux Policy, can be: targeted, minimum, mls</span>
<span class="nt">selinux_policy</span><span class="p">:</span> <span class="s">&quot;targeted&quot;</span>
<span class="c1"># If needed, reboot the VM to enable SELinux</span>
<span class="nt">selinux_reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="c1"># Relabel the entire filesystem ?</span>
<span class="nt">selinux_relabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour la directive <code class="docutils literal notranslate"><span class="pre">admin_context_certs</span></code> concernant l’intégration de certificats <a class="reference internal" href="../introduction.html#term-sia"><span class="xref std std-term">SIA</span></a> au déploiement, se reporter à la section <a class="reference internal" href="certificats/pki_externe.html#external-sia-certs-integration"><span class="std std-ref">Intégration d’une application externe (cliente)</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour la directive <code class="docutils literal notranslate"><span class="pre">admin_personal_certs</span></code> concernant l’intégration de certificats personnels (<em>personae</em>) au déploiement, se reporter à la section <a class="reference internal" href="certificats/pki_externe.html#personal-certs-integration"><span class="std std-ref">Intégration d’un certificat personnel (personae)</span></a>.</p>
</div>
</div>
<div class="section" id="fichier-offers-opts-yml">
<h3>4.2.3.2.3. Fichier <code class="docutils literal notranslate"><span class="pre">offers_opts.yml</span></code><a class="headerlink" href="#fichier-offers-opts-yml" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition hint">
<p class="first admonition-title">Indication</p>
<p class="last">Fichier à créer depuis <code class="docutils literal notranslate"><span class="pre">offers_opts.yml.example</span></code> et à paramétrer selon le besoin.</p>
</div>
<p>La déclaration de configuration des offres de stockage associées se fait dans le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/offers_opts.yml</span></code> :</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># This is the default vitam strategy (&#39;default&#39;). It is mandatory and must define a referent offer.</span>
<span class="c1"># This list of offers is ordered. It can and has to be completed if more offers are necessary</span>
<span class="c1"># Strategy order (1st has to be the preferred one)</span>
<span class="nt">vitam_strategy</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offer-fs-1</span>
    <span class="nt">referent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="c1">#    status: ACTIVE # status : enable (value=ACTIVE, default value) or disable (value=INACTIVE) this offer</span>
<span class="c1">#    vitam_site_name: prod-dc2 # optional, should be related to vitam_site_name if local ; remote vitam_site_name if distant</span>
<span class="c1">#  - name: offer-swift-1</span>
<span class="c1"># Example distant:</span>
<span class="c1">#  - name: distant</span>
<span class="c1">#    referent: true</span>
<span class="c1">#    status: INACTIVE</span>
<span class="c1">#    vitam_site_name: distant-dc2</span>
<span class="c1">#    distant: true # Only add this parameter when distant offer (not on same platform)</span>

<span class="c1"># WARNING : multi-strategy is a BETA functionality</span>
<span class="c1"># More strategies can be added but are optional</span>
<span class="c1"># Strategy name must only use [a-z][a-z0-9-]* pattern</span>
<span class="c1"># Any strategy must contain at least one offer</span>
<span class="c1"># This list of offers is ordered. It can and has to be completed if more offers are necessary</span>
<span class="c1"># Every strategy can define at most one referent offer.</span>
<span class="c1"># other_strategies:</span>
<span class="c1">#  metadata:</span>
<span class="c1">#    - name: offer-fs-1</span>
<span class="c1">#      referent: true</span>
<span class="c1">#    - name: offer-fs-2</span>
<span class="c1">#      referent: false</span>
<span class="c1">#  binary:</span>
<span class="c1">#    - name: offer-fs-2</span>
<span class="c1">#      referent: false</span>
<span class="c1">#    - name: offer-s3-1</span>
<span class="c1">#      referent: false</span>

<span class="c1"># DON&#39;T forget to add associated passwords in vault-vitam.yml with same tree when using provider openstack-swift*</span>
<span class="c1"># ATTENTION !!! Each offer has to have a distinct name, except for clusters binding a same physical storage</span>
<span class="c1"># WARNING : for offer names, please only use [a-z][a-z0-9-]* pattern</span>
<span class="nt">vitam_offers</span><span class="p">:</span>
  <span class="nt">offer-tape-1</span><span class="p">:</span>
    <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tape-library</span>
    <span class="nt">tapeLibraryConfiguration</span><span class="p">:</span>
      <span class="nt">maxTarEntrySize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100000</span>
      <span class="nt">maxTarFileSize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000000</span>
      <span class="c1"># Enable overriding non empty cartridges</span>
      <span class="c1"># WARNING : FOR DEV/TEST ONLY. DO NOT ENABLE IN PRODUCTION.</span>
      <span class="nt">forceOverrideNonEmptyCartridges</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="c1"># Archive (Tar) file expire time for retention in local FS</span>
      <span class="nt">archiveRetentionCacheTimeoutInMinutes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>

      <span class="nt">useSudo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">topology</span><span class="p">:</span>
      <span class="nt">buckets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
          <span class="nt">tenants</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">]</span>
          <span class="nt">tarBufferingTimeoutInMinutes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
        <span class="p p-Indicator">-</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
          <span class="nt">tenants</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]</span>
          <span class="nt">tarBufferingTimeoutInMinutes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
        <span class="p p-Indicator">-</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
          <span class="nt">tenants</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="nv">4</span><span class="p p-Indicator">,</span><span class="nv">5</span><span class="p p-Indicator">,</span><span class="nv">6</span><span class="p p-Indicator">,</span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="nv">9</span><span class="p p-Indicator">]</span>
          <span class="nt">tarBufferingTimeoutInMinutes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
    <span class="nt">tapeLibraries</span><span class="p">:</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TAPE_LIB_1</span>
        <span class="nt">robots</span><span class="p">:</span>
          <span class="p p-Indicator">-</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/tape/by-id/scsi-1QUANTUM_10F73224E6664C84A1D00000</span>
            <span class="nt">mtxPath</span><span class="p">:</span> <span class="s">&quot;/usr/sbin/mtx&quot;</span>
            <span class="nt">timeoutInMilliseconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600000</span>
        <span class="nt">drives</span><span class="p">:</span>
          <span class="p p-Indicator">-</span>
            <span class="nt">index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/tape/by-id/scsi-1IBM_ULT3580-TD6_1235308739-nst</span>
            <span class="nt">mtPath</span><span class="p">:</span> <span class="s">&quot;/bin/mt&quot;</span>
            <span class="nt">ddPath</span><span class="p">:</span> <span class="s">&quot;/bin/dd&quot;</span>
            <span class="nt">tarPath</span><span class="p">:</span> <span class="s">&quot;/bin/tar&quot;</span>
            <span class="nt">timeoutInMilliseconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600000</span>
            <span class="nt">readWritePriority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BACKUP</span>
          <span class="p p-Indicator">-</span>
            <span class="nt">index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/tape/by-id/scsi-1IBM_ULT3580-TD6_0951859786-nst</span>
            <span class="nt">mtPath</span><span class="p">:</span> <span class="s">&quot;/bin/mt&quot;</span>
            <span class="nt">ddPath</span><span class="p">:</span> <span class="s">&quot;/bin/dd&quot;</span>
            <span class="nt">tarPath</span><span class="p">:</span> <span class="s">&quot;/bin/tar&quot;</span>
            <span class="nt">timeoutInMilliseconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600000</span>
            <span class="nt">readWritePriority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">READ</span>
          <span class="p p-Indicator">-</span>
            <span class="nt">index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/tape/by-id/scsi-1IBM_ULT3580-TD6_0269493808-nst</span>
            <span class="nt">mtPath</span><span class="p">:</span> <span class="s">&quot;/bin/mt&quot;</span>
            <span class="nt">ddPath</span><span class="p">:</span> <span class="s">&quot;/bin/dd&quot;</span>
            <span class="nt">tarPath</span><span class="p">:</span> <span class="s">&quot;/bin/tar&quot;</span>
            <span class="nt">timeoutInMilliseconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600000</span>
          <span class="p p-Indicator">-</span>
            <span class="nt">index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/tape/by-id/scsi-1IBM_ULT3580-TD6_0566471858-nst</span>
            <span class="nt">mtPath</span><span class="p">:</span> <span class="s">&quot;/bin/mt&quot;</span>
            <span class="nt">ddPath</span><span class="p">:</span> <span class="s">&quot;/bin/dd&quot;</span>
            <span class="nt">tarPath</span><span class="p">:</span> <span class="s">&quot;/bin/tar&quot;</span>
            <span class="nt">readWritePriority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">READ</span>
            <span class="nt">timeoutInMilliseconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3600000</span>
    <span class="nt">offer_log_compaction</span><span class="p">:</span>
      <span class="c1">## Expiration, here offer logs 21 days old will be compacted</span>
      <span class="nt">expiration_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21</span>
      <span class="c1">## Choose one of &quot;MILLENNIA&quot;, &quot;HALF_DAYS&quot;, &quot;MILLIS&quot;, &quot;FOREVER&quot;, &quot;MICROS&quot;, &quot;CENTURIES&quot;, &quot;DECADES&quot;, &quot;YEARS&quot;, &quot;DAYS&quot;, &quot;SECONDS&quot;, &quot;HOURS&quot;, &quot;MONTHS&quot;, &quot;WEEKS&quot;, &quot;NANOS&quot;, &quot;MINUTES&quot;, &quot;ERAS&quot;</span>
      <span class="nt">expiration_unit</span><span class="p">:</span> <span class="s">&quot;DAYS&quot;</span>
      <span class="c1">## Compaction bulk size here 10 000 offers logs (at most) will be compacted (Expected value between 1 000 and 200 000)</span>
      <span class="nt">compaction_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
  <span class="nt">offer-fs-1</span><span class="p">:</span>
    <span class="c1"># param can be filesystem-hash (recomended) or filesystem (not recomended)</span>
    <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">filesystem-hash</span>
    <span class="c1"># Offer log compaction</span>
    <span class="nt">offer_log_compaction</span><span class="p">:</span>
      <span class="c1">## Expiration, here offer logs 21 days old will be compacted</span>
      <span class="nt">expiration_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21</span>
      <span class="c1">## Choose one of &quot;MILLENNIA&quot;, &quot;HALF_DAYS&quot;, &quot;MILLIS&quot;, &quot;FOREVER&quot;, &quot;MICROS&quot;, &quot;CENTURIES&quot;, &quot;DECADES&quot;, &quot;YEARS&quot;, &quot;DAYS&quot;, &quot;SECONDS&quot;, &quot;HOURS&quot;, &quot;MONTHS&quot;, &quot;WEEKS&quot;, &quot;NANOS&quot;, &quot;MINUTES&quot;, &quot;ERAS&quot;</span>
      <span class="nt">expiration_unit</span><span class="p">:</span> <span class="s">&quot;DAYS&quot;</span>
      <span class="c1">## Compaction bulk size here 10 000 offers logs (at most) will be compacted (Expected value between 1 000 and 200 000)</span>
      <span class="nt">compaction_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
  <span class="nt">offer-swift-1</span><span class="p">:</span>
    <span class="c1"># provider : openstack-swift for v1 or openstack-swift-v3 for v3</span>
    <span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack-swift-v3</span>
    <span class="c1"># swiftKeystoneAuthUrl : URL de connexion à keystone</span>
    <span class="nt">swiftKeystoneAuthUrl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://openstack-hostname:port/auth/1.0</span>
    <span class="c1"># swiftDomain : domaine OpenStack dans lequel l&#39;utilisateur est enregistré</span>
    <span class="nt">swiftDomain</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">domaine</span>
    <span class="c1"># swiftUser : identifiant de l&#39;utilisateur</span>
    <span class="nt">swiftUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">utilisateur</span>
    <span class="c1"># swiftPassword: has to be set in vault-vitam.yml (encrypted) with same structure =&gt; DO NOT COMMENT OUT</span>
    <span class="c1"># swiftProjectName : nom du projet openstack</span>
    <span class="nt">swiftProjectName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">monTenant</span>
    <span class="c1"># swiftUrl: optional variable to force the swift URL</span>
    <span class="c1"># swiftUrl: https://swift-hostname:port/swift/v1</span>
    <span class="c1">#SSL TrustStore</span>
    <span class="nt">swiftTrustStore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/chemin_vers_mon_fichier/monSwiftTrustStore.jks</span>
    <span class="c1">#Max connection (concurrent connections), per route, to keep in pool (if a pooling ConnectionManager is used) (by default 2 for Apache HttpClient)</span>
    <span class="nt">swiftMaxConnectionsPerRoute</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
    <span class="c1">#Max total connection (concurrent connections) to keep in pool (if a pooling ConnectionManager is used) (by default 20 for Apache HttpClient)</span>
    <span class="nt">swiftMaxConnections</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
    <span class="c1">#Max time (in milliseconds) for waiting to establish connection</span>
    <span class="nt">swiftConnectionTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200000</span>
    <span class="c1">#Max time (in milliseconds) waiting for a data from the server (socket)</span>
    <span class="nt">swiftReadTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60000</span>
    <span class="c1">#Time (in seconds) to renew a token before expiration occurs (blocking)</span>
    <span class="nt">swiftHardRenewTokenDelayBeforeExpireTime</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
    <span class="nt">offer_log_compaction</span><span class="p">:</span>
      <span class="c1">## Expiration, here offer logs 21 days old will be compacted</span>
      <span class="nt">expiration_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21</span>
      <span class="c1">## Choose one of &quot;MILLENNIA&quot;, &quot;HALF_DAYS&quot;, &quot;MILLIS&quot;, &quot;FOREVER&quot;, &quot;MICROS&quot;, &quot;CENTURIES&quot;, &quot;DECADES&quot;, &quot;YEARS&quot;, &quot;DAYS&quot;, &quot;SECONDS&quot;, &quot;HOURS&quot;, &quot;MONTHS&quot;, &quot;WEEKS&quot;, &quot;NANOS&quot;, &quot;MINUTES&quot;, &quot;ERAS&quot;</span>
      <span class="nt">expiration_unit</span><span class="p">:</span> <span class="s">&quot;DAYS&quot;</span>
      <span class="c1">## Compaction bulk size here 10 000 offers logs (at most) will be compacted (Expected value between 1 000 and 200 000)</span>
      <span class="nt">compaction_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
  <span class="nt">offer-s3-1</span><span class="p">:</span>
    <span class="c1"># provider : can only be amazon-s3-v1 for Amazon SDK S3 V1</span>
    <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;amazon-s3-v1&#39;</span>
    <span class="c1"># s3Endpoint :  : URL of connection to S3</span>
    <span class="nt">s3Endpoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://s3.domain/</span>
    <span class="c1"># s3RegionName (optional):  Region name (default value us-east-1)</span>
    <span class="nt">s3RegionName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
    <span class="c1"># s3SignerType (optional):  Signing algorithm.</span>
    <span class="c1">#     - signature V4 : &#39;AWSS3V4SignerType&#39; (default value)</span>
    <span class="c1">#     - signature V2 : &#39;S3SignerType&#39;</span>
    <span class="nt">s3SignerType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWSS3V4SignerType</span>
    <span class="c1"># s3PathStyleAccessEnabled (optional):  &#39;true&#39; to access bucket in &quot;path-style&quot;, else &quot;virtual-hosted-style&quot; (false by default in java client, true by default in ansible scripts) </span>
    <span class="nt">s3PathStyleAccessEnabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="c1"># s3MaxConnections (optional): Max total connection (concurrent connections) (50 by default)</span>
    <span class="nt">s3MaxConnections</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
    <span class="c1"># s3ConnectionTimeout (optional): Max time (in milliseconds) for waiting to establish connection (10000 by default)</span>
    <span class="nt">s3ConnectionTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
    <span class="c1"># s3SocketTimeout (optional): Max time (in milliseconds) for reading from a connected socket (50000 by default)</span>
    <span class="nt">s3SocketTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
    <span class="c1"># s3RequestTimeout (optional): Max time (in milliseconds) for a request (0 by default, disabled)</span>
    <span class="nt">s3RequestTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="c1"># s3ClientExecutionTimeout (optional): Max time (in milliseconds) for a request by java client (0 by default, disabled)</span>
    <span class="nt">s3ClientExecutionTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>

    <span class="c1">#Time (in seconds) to renew a token before expiration occurs</span>
    <span class="nt">swiftSoftRenewTokenDelayBeforeExpireTime</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="nt">offer_log_compaction</span><span class="p">:</span>
      <span class="c1">## Expiration, here offer logs 21 days old will be compacted</span>
      <span class="nt">expiration_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21</span>
      <span class="c1">## Choose one of &quot;MILLENNIA&quot;, &quot;HALF_DAYS&quot;, &quot;MILLIS&quot;, &quot;FOREVER&quot;, &quot;MICROS&quot;, &quot;CENTURIES&quot;, &quot;DECADES&quot;, &quot;YEARS&quot;, &quot;DAYS&quot;, &quot;SECONDS&quot;, &quot;HOURS&quot;, &quot;MONTHS&quot;, &quot;WEEKS&quot;, &quot;NANOS&quot;, &quot;MINUTES&quot;, &quot;ERAS&quot;</span>
      <span class="nt">expiration_unit</span><span class="p">:</span> <span class="s">&quot;DAYS&quot;</span>
      <span class="c1">## Compaction bulk size here 10 000 offers logs (at most) will be compacted (Expected value between 1 000 and 200 000)</span>
      <span class="nt">compaction_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>

  <span class="c1"># example_swift_v1:</span>
  <span class="c1">#    provider: openstack-swift</span>
  <span class="c1">#    swiftKeystoneAuthUrl: https://keystone/auth/1.0</span>
  <span class="c1">#    swiftDomain: domain</span>
  <span class="c1">#    swiftUser: user</span>
  <span class="c1">#    swiftPassword: has to be set in vault-vitam.yml (encrypted) with same structure =&gt; DO NOT COMMENT OUT</span>
  <span class="c1"># example_swift_v3:</span>
  <span class="c1">#    provider: openstack-swift-v3</span>
  <span class="c1">#    swiftKeystoneAuthUrl: https://keystone/v3</span>
  <span class="c1">#    swiftDomain: domaine</span>
  <span class="c1">#    swiftUser: user</span>
  <span class="c1">#    swiftPassword: has to be set in vault-vitam.yml (encrypted) with same structure =&gt; DO NOT COMMENT OUT</span>
  <span class="c1">#    swiftProjectName: monTenant</span>
  <span class="c1">#    projectName: monTenant</span>
  <span class="c1"># swiftTrustStore: /chemin_vers_mon_fichier/monSwiftTrustStore.jks</span>
  <span class="c1"># swiftMaxConnectionsPerRoute: 200</span>
  <span class="c1"># swiftMaxConnections: 1000</span>
  <span class="c1"># swiftConnectionTimeout: 200000</span>
  <span class="c1"># swiftReadTimeout: 60000</span>
  <span class="c1"># Time (in seconds) to renew a token before expiration occurs</span>
  <span class="c1"># swiftHardRenewTokenDelayBeforeExpireTime: 60</span>
  <span class="c1"># swiftSoftRenewTokenDelayBeforeExpireTime: 300</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Se référer aux commentaires dans le fichier pour le renseigner correctement.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dans le cas d’un déploiement multi-sites, dans la section <code class="docutils literal notranslate"><span class="pre">vitam_strategy</span></code>, la directive <code class="docutils literal notranslate"><span class="pre">vitam_site_name</span></code> définit pour l’offre associée le nom du datacenter Consul. Par défaut, si non définie, c’est la valeur de la variable <code class="docutils literal notranslate"><span class="pre">vitam_site_name</span></code> définie dans l’inventaire qui est prise en compte.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">La cohérence entre l’inventaire et la section <code class="docutils literal notranslate"><span class="pre">vitam_strategy</span></code> (et <code class="docutils literal notranslate"><span class="pre">other_strategies</span></code> si multi-stratégies) est critique pour le bon déploiement et fonctionnement de la solution logicielle VITAM. En particulier, la liste d’offres de <code class="docutils literal notranslate"><span class="pre">vitam_strategy</span></code> doit correspondre <em>exactement</em> aux noms d’offres déclarés dans l’inventaire (ou les inventaires de chaque datacenter, en cas de fonctionnement multi-site).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Ne pas oublier, en cas de connexion à un keystone en https, de répercuter dans la <a class="reference internal" href="../introduction.html#term-pki"><span class="xref std std-term">PKI</span></a> la clé publique de la <a class="reference internal" href="../introduction.html#term-ca"><span class="xref std std-term">CA</span></a> du keystone.</p>
</div>
</div>
<div class="section" id="fichier-cots-vars-yml">
<h3>4.2.3.2.4. Fichier <code class="docutils literal notranslate"><span class="pre">cots_vars.yml</span></code><a class="headerlink" href="#fichier-cots-vars-yml" title="Lien permanent vers ce titre">¶</a></h3>
<p>Fichier le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/cots_vars.yml</span></code> :</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">consul</span><span class="p">:</span>
    <span class="nt">retry_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
    <span class="nt">check_internal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
    <span class="nt">check_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span> <span class="c1"># in seconds</span>
    <span class="nt">network</span><span class="p">:</span> <span class="s">&quot;ip_admin&quot;</span> <span class="c1"># Which network to use for consul communications ? ip_admin or ip_service ?</span>

<span class="nt">consul_remote_sites</span><span class="p">:</span>
    <span class="c1"># wan contains the wan addresses of the consul server instances of the external vitam sites</span>
    <span class="c1"># Exemple, if our local dc is dc1, we will need to set dc2 &amp; dc3 wan conf:</span>
    <span class="c1"># - dc2:</span>
    <span class="c1">#   wan: [&quot;10.10.10.10&quot;,&quot;1.1.1.1&quot;]</span>
    <span class="c1"># - dc3:</span>
    <span class="c1">#   wan: [&quot;10.10.10.11&quot;,&quot;1.1.1.1&quot;]</span>
<span class="c1"># Please uncomment and fill values if you want to connect VITAM to external SIEM</span>
<span class="c1"># external_siem:</span>
<span class="c1">#     host:</span>
<span class="c1">#     port:</span>

<span class="nt">elasticsearch</span><span class="p">:</span>
    <span class="nt">log</span><span class="p">:</span>
        <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;elasticsearch-log.service.{{</span><span class="nv"> </span><span class="s">consul_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">port_http</span><span class="p">:</span> <span class="s">&quot;9201&quot;</span>
        <span class="nt">groupe</span><span class="p">:</span> <span class="s">&quot;log&quot;</span>
        <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;elasticsearch-log&quot;</span>
        <span class="nt">cluster_name</span><span class="p">:</span> <span class="s">&quot;elasticsearch-log&quot;</span>
        <span class="nt">consul_check_http</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="nt">consul_check_tcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="nt">action_log_level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">error</span>
        <span class="nt">https_enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="nt">indices_fielddata_cache_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span> <span class="c1"># related to https://www.elastic.co/guide/en/elasticsearch/reference/6.8/modules-fielddata.html</span>
        <span class="nt">indices_breaker_fielddata_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.4</span> <span class="c1"># related to https://www.elastic.co/guide/en/elasticsearch/reference/6.8/circuit-breaker.html#fielddata-circuit-breaker</span>
        <span class="nt">dynamic_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30s</span>
        <span class="c1"># default index template</span>
        <span class="nt">index_templates</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span>
                <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
                <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="nt">packetbeat</span><span class="p">:</span>
                <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
        <span class="nt">log_appenders</span><span class="p">:</span>
            <span class="nt">root</span><span class="p">:</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;info&quot;</span>
            <span class="nt">rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;50&quot;</span>
            <span class="nt">deprecation_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;1GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;10&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
            <span class="nt">index_search_slowlog_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;1GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;10&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
            <span class="nt">index_indexing_slowlog_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;1GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;10&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
        <span class="c1"># By default, is commented. Should be uncommented if ansible computes badly vCPUs number ;  values are associated vCPUs numbers ; please adapt to your configuration</span>
        <span class="c1"># thread_pool:</span>
        <span class="c1">#     index:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     get:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     search:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     write:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     warmer:</span>
        <span class="c1">#         max: 2</span>
    <span class="nt">data</span><span class="p">:</span>
        <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;elasticsearch-data.service.{{</span><span class="nv"> </span><span class="s">consul_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="c1"># default is 0.1 (10%) and should be quite enough in most cases</span>
        <span class="c1">#index_buffer_size_ratio: &quot;0.15&quot;</span>
        <span class="nt">port_http</span><span class="p">:</span> <span class="s">&quot;9200&quot;</span>
        <span class="nt">groupe</span><span class="p">:</span> <span class="s">&quot;data&quot;</span>
        <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;elasticsearch-data&quot;</span>
        <span class="nt">cluster_name</span><span class="p">:</span> <span class="s">&quot;elasticsearch-data&quot;</span>
        <span class="nt">consul_check_http</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="nt">consul_check_tcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="nt">action_log_level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debug</span>
        <span class="nt">https_enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="c1"># discovery_zen_minimum_master_nodes: 2 # comented by default ; by default, value is half the length of ansible associated group whose racks have the same number of machine. If it is not the case, this value have to be set with the smallest rack (if using param is_balancing). ONLY EXISTS FOR DATA CLUSTER !!!! DO NOT FORGET TO APPLY PARAMETER WITH REPLICA NUMBER !!!!</span>
        <span class="nt">indices_fielddata_cache_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span> <span class="c1"># related to https://www.elastic.co/guide/en/elasticsearch/reference/6.5/modules-fielddata.html</span>
        <span class="nt">indices_breaker_fielddata_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.4</span> <span class="c1"># related to https://www.elastic.co/guide/en/elasticsearch/reference/6.5/circuit-breaker.html#fielddata-circuit-breaker</span>
        <span class="nt">dynamic_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30s</span>
        <span class="c1"># default index template</span>
        <span class="nt">index_templates</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span>
                <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
                <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="nt">log_appenders</span><span class="p">:</span>
            <span class="nt">root</span><span class="p">:</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;info&quot;</span>
            <span class="nt">rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;50&quot;</span>
            <span class="nt">deprecation_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;50&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
            <span class="nt">index_search_slowlog_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;50&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
            <span class="nt">index_indexing_slowlog_rolling</span><span class="p">:</span>
                <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
                <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
                <span class="nt">max_files</span><span class="p">:</span> <span class="s">&quot;50&quot;</span>
                <span class="nt">log_level</span><span class="p">:</span> <span class="s">&quot;warn&quot;</span>
        <span class="c1"># By default, is commented. Should be uncommented if ansible computes badly vCPUs number ;  values are associated vCPUs numbers ; please adapt to your configuration</span>
        <span class="c1"># thread_pool:</span>
        <span class="c1">#     index:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     get:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     search:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     write:</span>
        <span class="c1">#         size: 2</span>
        <span class="c1">#     warmer:</span>
        <span class="c1">#         max: 2</span>

<span class="nt">mongodb</span><span class="p">:</span>
    <span class="nt">mongos_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
    <span class="nt">mongoc_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">27018</span>
    <span class="nt">mongod_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">27019</span>
    <span class="nt">mongo_authentication</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
    <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;mongos.service.{{</span><span class="nv"> </span><span class="s">consul_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">check_consul</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
    <span class="nt">drop_info_log</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span> <span class="c1"># Drop mongo (I)nformational log, for Verbosity Level of 0</span>

<span class="nt">logstash</span><span class="p">:</span>
    <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;logstash.service.{{</span><span class="nv"> </span><span class="s">consul_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logstash</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10514</span>
    <span class="nt">rest_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20514</span>
    <span class="nt">check_consul</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
    <span class="c1"># logstash xms &amp; xmx in Megabytes</span>
    <span class="c1"># jvm_xms: 2048</span>
    <span class="c1"># jvm_xmx: 2048</span>
    <span class="c1"># workers_number: 4</span>
    <span class="nt">log_appenders</span><span class="p">:</span>
        <span class="nt">rolling</span><span class="p">:</span>
            <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
            <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>
        <span class="nt">json_rolling</span><span class="p">:</span>
            <span class="nt">max_log_file_size</span><span class="p">:</span> <span class="s">&quot;100MB&quot;</span>
            <span class="nt">max_total_log_size</span><span class="p">:</span> <span class="s">&quot;5GB&quot;</span>

<span class="c1"># Curator units: days</span>
<span class="nt">curator</span><span class="p">:</span>
    <span class="nt">log</span><span class="p">:</span>
        <span class="nt">metrics</span><span class="p">:</span>
            <span class="nt">close</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
        <span class="nt">logstash</span><span class="p">:</span>
            <span class="nt">close</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
        <span class="nt">metricbeat</span><span class="p">:</span>
            <span class="nt">close</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
        <span class="nt">packetbeat</span><span class="p">:</span>
            <span class="nt">close</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">kibana</span><span class="p">:</span>
    <span class="nt">header_value</span><span class="p">:</span> <span class="s">&quot;reporting&quot;</span>
    <span class="nt">import_delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="nt">import_retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="nt">log</span><span class="p">:</span>
        <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;kibana_log&quot;</span>
        <span class="nt">api_call_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
        <span class="nt">groupe</span><span class="p">:</span> <span class="s">&quot;log&quot;</span>
        <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5601</span>
        <span class="nt">default_index_pattern</span><span class="p">:</span> <span class="s">&quot;logstash-vitam*&quot;</span>
        <span class="nt">check_consul</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="c1"># default shards &amp; replica</span>
        <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
        <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="c1"># pour index logstash-*</span>
        <span class="nt">metrics</span><span class="p">:</span>
            <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="c1"># pour index metrics-vitam-*</span>
        <span class="nt">logs</span><span class="p">:</span>
            <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="c1"># pour index metricbeat-*</span>
        <span class="nt">metricbeat</span><span class="p">:</span>
            <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span> <span class="c1"># must be a factor of 30</span>
            <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">data</span><span class="p">:</span>
        <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;kibana_data&quot;</span>
        <span class="c1"># OMA : bugdette : api_call_timeout is used for retries ; should ceate a separate variable rather than this one</span>
        <span class="nt">api_call_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
        <span class="nt">groupe</span><span class="p">:</span> <span class="s">&quot;data&quot;</span>
        <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5601</span>
        <span class="nt">default_index_pattern</span><span class="p">:</span> <span class="s">&quot;logbookoperation_*&quot;</span>
        <span class="nt">check_consul</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>
        <span class="c1"># index template for .kibana</span>
        <span class="nt">shards</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">replica</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">syslog</span><span class="p">:</span>
    <span class="c1"># value can be syslog-ng or rsyslog</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;rsyslog&quot;</span>

<span class="nt">cerebro</span><span class="p">:</span>
    <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;cerebro&quot;</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9000</span>
    <span class="nt">check_consul</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>

<span class="nt">siegfried</span><span class="p">:</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">19000</span>
    <span class="nt">consul_check</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> <span class="c1"># in seconds</span>

<span class="nt">clamav</span><span class="p">:</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3310</span>
    <span class="c1"># frequency freshclam for database update per day (from 0 to 24 - 24 meaning hourly check)</span>
    <span class="nt">db_update_periodicity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">mongo_express</span><span class="p">:</span>
    <span class="nt">baseuri</span><span class="p">:</span> <span class="s">&quot;mongo-express&quot;</span>

<span class="nt">ldap_authentification</span><span class="p">:</span>
    <span class="nt">ldap_protocol</span><span class="p">:</span> <span class="s">&quot;ldap&quot;</span>
    <span class="nt">ldap_server</span><span class="p">:</span> <span class="s">&quot;{%</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">groups[&#39;ldap&#39;]|length</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">%}{{</span><span class="nv"> </span><span class="s">groups[&#39;ldap&#39;]|first</span><span class="nv"> </span><span class="s">}}{%</span><span class="nv"> </span><span class="s">endif</span><span class="nv"> </span><span class="s">%}&quot;</span>
    <span class="nt">ldap_port</span><span class="p">:</span> <span class="s">&quot;389&quot;</span>
    <span class="nt">ldap_base</span><span class="p">:</span> <span class="s">&quot;dc=programmevitam,dc=fr&quot;</span>
    <span class="nt">ldap_login</span><span class="p">:</span> <span class="s">&quot;cn=Manager,dc=programmevitam,dc=fr&quot;</span>
    <span class="nt">uid_field</span><span class="p">:</span> <span class="s">&quot;uid&quot;</span>
    <span class="nt">ldap_userDn_Template</span><span class="p">:</span> <span class="s">&quot;uid={0},ou=people,dc=programmevitam,dc=fr&quot;</span>
    <span class="nt">ldap_group_request</span><span class="p">:</span> <span class="s">&quot;(&amp;(objectClass=groupOfNames)(member={0}))&quot;</span>
    <span class="nt">ldap_admin_group</span><span class="p">:</span> <span class="s">&quot;cn=admin,ou=groups,dc=programmevitam,</span><span class="nv"> </span><span class="s">dc=fr&quot;</span>
    <span class="nt">ldap_user_group</span><span class="p">:</span> <span class="s">&quot;cn=user,ou=groups,dc=programmevitam,</span><span class="nv"> </span><span class="s">dc=fr&quot;</span>
    <span class="nt">ldap_guest_group</span><span class="p">:</span> <span class="s">&quot;cn=guest,ou=groups,dc=programmevitam,</span><span class="nv"> </span><span class="s">dc=fr&quot;</span>

<span class="nt">java_prerequisites</span><span class="p">:</span>
    <span class="nt">debian</span><span class="p">:</span> <span class="s">&quot;openjdk-11-jre-headless&quot;</span>
    <span class="nt">redhat</span><span class="p">:</span> <span class="s">&quot;java-11-openjdk-headless&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Dans le cas du choix du <a class="reference internal" href="../introduction.html#term-cots"><span class="xref std std-term">COTS</span></a> d’envoi des messages syslog dans logastsh, il est possible de choisir entre <code class="docutils literal notranslate"><span class="pre">syslog-ng</span></code> et <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code>. Il faut alors modifier la valeur de la directive <code class="docutils literal notranslate"><span class="pre">syslog.name</span></code> ; la valeur par défaut est <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">si vous  décommentez et renseignez les valeurs dans le bloc <code class="docutils literal notranslate"><span class="pre">external_siem</span></code>, les messages seront envoyés (par <code class="docutils literal notranslate"><span class="pre">syslog</span></code> ou <code class="docutils literal notranslate"><span class="pre">syslog-ng</span></code>, selon votre choix de déploiement) dans un <a class="reference internal" href="../introduction.html#term-siem"><span class="xref std std-term">SIEM</span></a> externe à la solution logicielle <a class="reference internal" href="../introduction.html#term-vitam"><span class="xref std std-term">VITAM</span></a>, aux valeurs indiquées dans le bloc ; il n’est alors pas nécessaire de renseigner de partitions pour les groupes ansible <code class="docutils literal notranslate"><span class="pre">[hosts_logstash]</span></code> et <code class="docutils literal notranslate"><span class="pre">[hosts_elasticsearch_log]</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="declaration-des-secrets">
<span id="pkiconfsection"></span><h2>4.2.3.3. Déclaration des secrets<a class="headerlink" href="#declaration-des-secrets" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">L’ensemble des mots de passe fournis ci-après le sont par défaut et doivent être changés !</p>
</div>
<div class="section" id="vitam">
<h3>4.2.3.3.1. vitam<a class="headerlink" href="#vitam" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Cette section décrit des fichiers contenant des données sensibles. Il est important d’implémenter une politique de mot de passe robuste conforme à ce que l’ANSSI préconise. Par exemple: ne pas utiliser le même mot de passe pour chaque service, renouveler régulièrement son mot de passe, utiliser des majuscules, minuscules, chiffres et caractères spéciaux (Se référer à la documentation ANSSI <a class="reference external" href="https://www.ssi.gouv.fr/guide/mot-de-passe">https://www.ssi.gouv.fr/guide/mot-de-passe</a>). En cas d’usage d’un fichier de mot de passe (<cite>vault-password-file</cite>), il faut renseigner ce mot de passe comme contenu du fichier et ne pas oublier de sécuriser ou supprimer ce fichier à l’issue de l’installation.</p>
</div>
<p>Les secrets utilisés par la solution logicielle (en-dehors des certificats qui sont abordés dans une section ultérieure) sont définis dans des fichiers chiffrés par <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Tous les vault présents dans l’arborescence d’inventaire doivent être tous protégés par le même mot de passe !</p>
</div>
<p>La première étape consiste à changer les mots de passe de tous les vaults présents dans l’arborescence de déploiement (le mot de passe par défaut est contenu dans le fichier <code class="docutils literal notranslate"><span class="pre">vault_pass.txt</span></code>) à l’aide de la commande <code class="docutils literal notranslate"><span class="pre">ansible-vault</span> <span class="pre">rekey</span> <span class="pre">&lt;fichier</span> <span class="pre">vault&gt;</span></code>.</p>
<p>Voici la liste des vaults pour lesquels il est nécessaire de modifier le mot de passe:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/vault-vitam.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/vault-keystores.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">environments/group_vars/all/vault-extra.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">environments/certs/vault-certs.yml</span></code></li>
</ul>
<p>2 vaults sont principalement utilisés dans le déploiement d’une version :</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Leur contenu est donc à modifier avant tout déploiement.</p>
</div>
<ul>
<li><p class="first">Le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/vault-vitam.yml</span></code> contient les secrets généraux :</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="na">---</span>
<span class="c1"># Vitam platform secret key</span>
<span class="na">plateforme_secret: vitamsecret</span>

<span class="c1"># The consul key must be 16-bytes, Base64 encoded: https://www.consul.io/docs/agent/encryption.html</span>
<span class="c1"># You can generate it with the &quot;consul keygen&quot; command</span>
<span class="c1"># Or you can use this script: deployment/pki/scripts/generate_consul_key.sh</span>
<span class="na">consul_encrypt: Biz14ohqN4HtvZmrXp3N4A</span><span class="o">=</span><span class="s">=</span>

<span class="na">mongodb:</span>
  <span class="na">mongo-data:</span>
    <span class="na">passphrase: changeitkM4L6zBgK527tWBb</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_1MpG22m2MywvKW5E</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">metadata:</span>
      <span class="na">user: metadata</span>
      <span class="na">password: change_it_37b97KVaDV8YbCwt</span>
    <span class="na">logbook:</span>
      <span class="na">user: logbook</span>
      <span class="na">password: change_it_jVi6q8eX4H1Ce8UC</span>
    <span class="na">report:</span>
      <span class="na">user: report</span>
      <span class="na">password: change_it_jb7TASZbU6n85t8L</span>
    <span class="na">functionalAdmin:</span>
      <span class="na">user: functional-admin</span>
      <span class="na">password: change_it_9eA2zMCL6tm6KF1e</span>
    <span class="na">securityInternal:</span>
      <span class="na">user: security-internal</span>
      <span class="na">password: change_it_m39XvRQWixyDX566</span>
  <span class="na">offer-fs-1:</span>
    <span class="na">passphrase: changeitmB5rnk1M5TY61PqZ</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_FLkM5emt63N73EcN</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_QeH8q4e16ah4QKXS</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_pQi1T1yT9LAF8au8</span>
  <span class="na">offer-fs-2:</span>
    <span class="na">passphrase: changeiteSY1By57qZr4MX2s</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_84aTMFZ7h8e2NgMe</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_Am1B37tGY1w5VfvX</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_mLDYds957sNQ53mA</span>
  <span class="na">offer-tape-1:</span>
    <span class="na">passphrase: changeitmB5rnk1M5TY61PqZ</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_FLkM5emt63N73EcN</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_QeH8q4e16ah4QKXS</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_pQi1T1yT9LAF8au8</span>
  <span class="na">offer-swift-1:</span>
    <span class="na">passphrase: changeitgYvt42M2pKL6Zx3T</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_e21hLp51WNa4sJFS</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_QB8857SJrGrQh2yu</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_AWJg2Bp3s69P6nMe</span>
  <span class="na">offer-s3-1:</span>
    <span class="na">passphrase: changeituF1jVdR9NqdTG625</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_5b7cSWcS5M1NF4kv</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_S9jE24rxHwUZP6y5</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_TuTB1i2k7iQW3zL2</span>
  <span class="na">offer-tape-1:</span>
    <span class="na">passphrase: changeituF1jghT9NqdTG625</span>
    <span class="na">admin:</span>
      <span class="na">user: vitamdb-admin</span>
      <span class="na">password: change_it_5b7cSWcab91NF4kv</span>
    <span class="na">localadmin:</span>
      <span class="na">user: vitamdb-localadmin</span>
      <span class="na">password: change_it_S9jE24rxHwUZP5a6</span>
    <span class="na">system:</span>
      <span class="na">user: vitamdb-system</span>
      <span class="na">password: change_it_HycFEVD74g397iRe</span>
    <span class="na">offer:</span>
      <span class="na">user: offer</span>
      <span class="na">password: change_it_TuTB1i2k7iQW3c2a</span>

<span class="na">vitam_users:</span>
  <span class="na">- vitam_aadmin:</span>
    <span class="na">login: aadmin</span>
    <span class="na">password: change_it_z5MP7GC4qnR8nL9t</span>
    <span class="na">role: admin</span>
  <span class="na">- vitam_uuser:</span>
    <span class="na">login: uuser</span>
    <span class="na">password: change_it_w94Q3jPAT2aJYm8b</span>
    <span class="na">role: user</span>
  <span class="na">- vitam_gguest:</span>
    <span class="na">login: gguest</span>
    <span class="na">password: change_it_E5v7Tr4h6tYaQG2W</span>
    <span class="na">role: guest</span>
  <span class="na">- techadmin:</span>
    <span class="na">login: techadmin</span>
    <span class="na">password: change_it_K29E1uHcPZ8zXji8</span>
    <span class="na">role: admin</span>

<span class="na">ldap_authentification:</span>
    <span class="na">ldap_pwd: &quot;change_it_t69Rn5NdUv39EYkC&quot;</span>

<span class="na">admin_basic_auth_password: change_it_5Yn74JgXwbQ9KdP8</span>

<span class="na">vitam_offers:</span>
    <span class="na">offer-swift-1:</span>
        <span class="na">swiftPassword: change_it_m44j57aYeRPnPXQ2</span>
    <span class="na">offer-s3-1:</span>
        <span class="na">s3AccessKey: accessKey_change_grLS8372Uga5EJSx</span>
        <span class="na">s3SecretKey: secretKey_change_p97es2m2CHXPJA1m</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Prudence</p>
<p class="last">Seuls les caractères alphanumériques sont valides pour les directives <code class="docutils literal notranslate"><span class="pre">passphrase</span></code>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Le paramétrage du mode d’authentifications des utilisateurs à l”<a class="reference internal" href="../introduction.html#term-ihm"><span class="xref std std-term">IHM</span></a> démo est géré au niveau du fichier <code class="docutils literal notranslate"><span class="pre">deployment/environments/group_vars/all/vitam_vars.yml</span></code>. Plusieurs modes d’authentifications sont proposés au niveau de la section <code class="docutils literal notranslate"><span class="pre">authentication_realms</span></code>. Dans le cas d’une authentification se basant sur le mécanisme <code class="docutils literal notranslate"><span class="pre">iniRealm</span></code> (configuration <code class="docutils literal notranslate"><span class="pre">shiro</span></code> par défaut), les mots de passe déclarés dans la section <code class="docutils literal notranslate"><span class="pre">vitam_users</span></code> devront s’appuyer sur une politique de mot de passe robuste, comme indiqué en début de chapitre. Il est par ailleurs possible de  choisir un mode d’authentification s’appuyant sur un annuaire LDAP externe (<code class="docutils literal notranslate"><span class="pre">ldapRealm</span></code> dans la section <code class="docutils literal notranslate"><span class="pre">authentication_realms</span></code>).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dans le cadre d’une installation avec au moins une offre <cite>swift</cite>, il faut déclarer, dans la section <code class="docutils literal notranslate"><span class="pre">vitam_offers</span></code>, le nom de chaque offre et le mot de passe de connexion <cite>swift</cite> associé, défini dans le fichier <code class="docutils literal notranslate"><span class="pre">offers_opts.yml</span></code>. L’exemple ci-dessus présente la déclaration du mot de passe pour l’offre swift <cite>offer-swift-1</cite>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dans le cadre d’une installation avec au moins une offre <cite>s3</cite>, il faut déclarer, dans la section <code class="docutils literal notranslate"><span class="pre">vitam_offers</span></code>, le nom de chaque offre et l’access key secret <cite>s3</cite> associé, défini dans le fichier <code class="docutils literal notranslate"><span class="pre">offers_opts.yml</span></code>. L’exemple ci-dessus présente la déclaration du mot de passe pour l’offre s3 <cite>offer-s3-1</cite>.</p>
</div>
<ul>
<li><p class="first">Le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/vault-keystores.yml</span></code> contient les mots de passe des magasins de certificats utilisés dans VITAM :</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># NO UNDERSCORE ALLOWED IN VALUES</span>
<span class="na">keystores:</span>
  <span class="na">server:</span>
    <span class="na">offer: changeit817NR75vWsZtgAgJ</span>
    <span class="na">access_external: changeitMZFD2YM4279miitu</span>
    <span class="na">ingest_external: changeita2C74cQhy84BLWCr</span>
    <span class="na">ihm_recette: changeit4FWYVK1347mxjGfe</span>
    <span class="na">ihm_demo: changeit6kQ16eyDY7QPS9fy</span>
  <span class="na">client_external:</span>
    <span class="na">ihm_demo: changeitGT38hhTiA32x1PLy</span>
    <span class="na">gatling: changeit2sBC5ac7NfGF9Qj7</span>
    <span class="na">ihm_recette: changeitdAZ9Eq65UhDZd9p4</span>
    <span class="na">reverse: changeite5XTzb5yVPcEX464</span>
    <span class="na">vitam_admin_int: changeitz6xZe5gDu7nhDZd9</span>
  <span class="na">client_storage:</span>
    <span class="na">storage: changeit647D7LWiyM6qYMnm</span>
  <span class="na">timestamping:</span>
    <span class="na">secure_logbook: changeitMn9Skuyx87VYU62U</span>
    <span class="na">secure_storage: changeite5gDu9Skuy84BLW9</span>
<span class="na">truststores:</span>
  <span class="na">server: changeitxNe4JLfn528PVHj7</span>
  <span class="na">client_external: changeitJ2eS93DcPH1v4jAp</span>
  <span class="na">client_storage: changeitHpSCa31aG8ttB87S</span>
<span class="na">grantedstores:</span>
  <span class="na">client_external: changeitLL22HkmDCA2e2vj7</span>
  <span class="na">client_storage: changeitR3wwp5C8KQS76Vcu</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">il convient de sécuriser votre environnement en définissant des mots de passe <cite>forts</cite>.</p>
</div>
</div>
<div class="section" id="cas-des-extras">
<h3>4.2.3.3.2. Cas des extras<a class="headerlink" href="#cas-des-extras" title="Lien permanent vers ce titre">¶</a></h3>
<ul>
<li><p class="first">Le fichier <code class="docutils literal notranslate"><span class="pre">environments</span></code> <code class="docutils literal notranslate"><span class="pre">/group_vars/all/vault-extra.yml</span></code> contient les mots de passe des magasins de certificats utilisés dans VITAM :</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Example for git lfs ; uncomment &amp; use if needed</span>
<span class="c1">#vitam_gitlab_itest_login: &quot;account&quot;</span>
<span class="c1">#vitam_gitlab_itest_password: &quot;change_it_4DU42JVf2x2xmPBs&quot;</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">le playbook <code class="docutils literal notranslate"><span class="pre">vitam.yml</span></code> comprend des étapes avec la mention <code class="docutils literal notranslate"><span class="pre">no_log</span></code> afin de ne pas afficher en clair des étapes comme les mots de passe des certificats. En cas d’erreur, il est possible de retirer la ligne dans le fichier pour une analyse plus fine d’un éventuel problème sur une de ces étapes.</p>
</div>
</div>
<div class="section" id="commande-ansible-vault">
<h3>4.2.3.3.3. Commande ansible-vault<a class="headerlink" href="#commande-ansible-vault" title="Lien permanent vers ce titre">¶</a></h3>
<p>Certains fichiers présents sous <code class="docutils literal notranslate"><span class="pre">environments</span></code>/group_vars/all commençant par <strong>vault-</strong> doivent être protégés (encryptés) avec l’utilitaire <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ne pas oublier de mettre en conformité le fichier <code class="docutils literal notranslate"><span class="pre">vault_pass.txt</span></code></p>
</div>
<div class="section" id="generer-des-fichiers-vaultes-depuis-des-fichier-en-clair">
<h4>4.2.3.3.3.1. Générer des fichiers <em>vaultés</em> depuis des fichier en clair<a class="headerlink" href="#generer-des-fichiers-vaultes-depuis-des-fichier-en-clair" title="Lien permanent vers ce titre">¶</a></h4>
<p>Exemple du fichier <code class="docutils literal notranslate"><span class="pre">vault-cots.example</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">vault</span><span class="o">-</span><span class="n">cots</span><span class="o">.</span><span class="n">example</span> <span class="n">vault</span><span class="o">-</span><span class="n">cots</span><span class="o">.</span><span class="n">yml</span>
<span class="n">ansible</span><span class="o">-</span><span class="n">vault</span> <span class="n">encrypt</span> <span class="n">vault</span><span class="o">-</span><span class="n">cots</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
<div class="section" id="re-encoder-un-fichier-vaulte">
<h4>4.2.3.3.3.2. Ré-encoder un fichier <em>vaulté</em><a class="headerlink" href="#re-encoder-un-fichier-vaulte" title="Lien permanent vers ce titre">¶</a></h4>
<p>Exemple du fichier <code class="docutils literal notranslate"><span class="pre">vault-cots.yml</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">vault</span> <span class="n">rekey</span> <span class="n">vault</span><span class="o">-</span><span class="n">cots</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="20-certificats.html" class="btn btn-neutral float-right" title="4.2.4. Gestion des certificats" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="05_multisite.html" class="btn btn-neutral float-left" title="4.2.2. Cas particulier d’une installation multi-sites" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>