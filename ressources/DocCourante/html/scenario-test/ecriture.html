

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ecriture des TNR &mdash; Documentation VITAM - Scénarios de test 1.4.0</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Guide d’écriture des tests Cucumber" href="guide_cucumber.html" />
    <link rel="prev" title="Tests Automatisés" href="tests_automatises.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> VITAM - Scénarios de test
          

          
            
            <img src="_static/logo_vitam.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Objectif du document</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests_manuels.html">Tests Manuels</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests_automatises.html">Tests Automatisés</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ecriture des TNR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#structure-des-repertoires">Structure des répertoires</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fichiers-de-configuration">Fichiers de Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nommage-des-fichiers">Nommage des fichiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#informations-transverses">Informations transverses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ecriture-d-un-scenario">Ecriture d’un scénario</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure-d-un-scenario">Structure d’un scénario</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inserer-une-requete-dsl">Insérer une requète DSL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inserer-un-tableau">Insérer un tableau</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#annexes">Annexes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#liste-des-actions-d-etapes-disponibles">Liste des actions d’étapes disponibles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#liste-des-fonctions-disponibles">Liste des fonctions disponibles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guide_cucumber.html">Guide d’écriture des tests Cucumber</a></li>
<li class="toctree-l1"><a class="reference internal" href="curl.html">Tests curl</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VITAM - Scénarios de test</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Ecriture des TNR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ecriture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ecriture-des-tnr">
<h1>Ecriture des TNR<a class="headerlink" href="#ecriture-des-tnr" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="structure-des-repertoires">
<h2>Structure des répertoires<a class="headerlink" href="#structure-des-repertoires" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le répertoire du dépot vitam-itest est strucutré de la façon suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitam</span><span class="o">-</span><span class="n">itests</span>
                <span class="o">|-------</span> <span class="n">data</span>
</pre></div>
</div>
<p><strong>Dossier vitam-itests</strong> : contient les fichiers de configurations des tests fonctionnels.</p>
<p><strong>Dossier data</strong> : contient les éventuels jeux de données nécessaires à l’exécution des tests.</p>
</div>
<div class="section" id="fichiers-de-configuration">
<h2>Fichiers de Configuration<a class="headerlink" href="#fichiers-de-configuration" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="nommage-des-fichiers">
<h3>Nommage des fichiers<a class="headerlink" href="#nommage-des-fichiers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un fichier regroupe tous les tests à effectuer sur une fonctionnalité. Il ne peut y avoir deux fonctionnalités dans un fichier de configuration.</p>
<p>On va par exemple réaliser :</p>
<blockquote>
<div><ul class="simple">
<li>un fichier pour les tests sur l’Ingest</li>
<li>un fichier pour les test sur l’accès aux unités archivistiques</li>
</ul>
</div></blockquote>
<p>Les noms des fichiers sont composés de la façon suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EndPoint</span><span class="o">-</span><span class="n">Fonctionnalité</span><span class="o">.</span><span class="n">feature</span>
</pre></div>
</div>
<p>Par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access</span><span class="o">-</span><span class="n">archive</span><span class="o">-</span><span class="n">unit</span><span class="o">.</span><span class="n">feature</span>
<span class="n">admin</span><span class="o">-</span><span class="n">logbook</span><span class="o">-</span><span class="n">traceability</span><span class="o">.</span><span class="n">feature</span>
</pre></div>
</div>
</div>
<div class="section" id="informations-transverses">
<h3>Informations transverses<a class="headerlink" href="#informations-transverses" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les fichiers de configuration doivent contenir les informations suivantes qui s’appliqueront ensuite à l’ensemble des scénarios du fichier :</p>
<p><strong># language</strong> : information obligatoire. Correspond à la langue utilisée pour les descriptions. Par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">language</span> <span class="p">:</span> <span class="n">fr</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Annotation</strong> : information optionnelle. L’annotation permet par la suite de lancer uniquement un fichier de configuration en ligne de commande en utilisant son annotation en paramètre. Par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AccessArchiveUnit</span>
</pre></div>
</div>
<p><strong>Fonctionnalité</strong> : information obligatoire. La fonctionnalité est une description qui permet d’identifier le périmètre testé. Il est notamment repris dans les rapports réalisés à la fin d’une campagne de test. Par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fonctionnalité</span><span class="p">:</span> <span class="n">Recherche</span> <span class="n">une</span> <span class="n">archive</span> <span class="n">unit</span> <span class="n">existante</span>
</pre></div>
</div>
<p><strong>Contexte</strong> : information optionnelle. Les informations contenues dans contexte sont des actions qui vont s’exécuter pour chacun des scénarios. A ce titre, elles s’écrivent comme les actions d’un scénario. Le constexte doit être indenté de 1 par rapport aux autres éléments. Par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Contexte</span><span class="p">:</span>
<span class="n">Etant</span> <span class="n">donné</span> <span class="n">les</span> <span class="n">tests</span> <span class="n">effectués</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">tenant</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ecriture-d-un-scenario">
<h2>Ecriture d’un scénario<a class="headerlink" href="#ecriture-d-un-scenario" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="structure-d-un-scenario">
<h3>Structure d’un scénario<a class="headerlink" href="#structure-d-un-scenario" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un scénario correspond à un test. Son nom doit être défini de la façon suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scénario</span><span class="p">:</span> <span class="n">Description</span> <span class="n">du</span> <span class="n">scénario</span>
</pre></div>
</div>
<p>Il doit être sur la même indentation que le contexte, soit 1 par rapport à la fonctionnalité, à l’annotation et au langage.</p>
<p>Un scénario est constitué d’une succession d’actions, chacune décrite sur une ligne.</p>
<p>Les actions sont composées des trois informations suivantes :</p>
<blockquote>
<div><ul class="simple">
<li>Contexte</li>
<li>Fonction</li>
<li>Paramètre (pas toujours obligatoire)</li>
</ul>
</div></blockquote>
<p><strong>Actions d’étapes</strong> : permet d’introduire l’action, de l’insérer par rapport à l’action précédente. La liste des contextes disponibles se trouve en annexe.</p>
<p><strong>Fonction</strong> : mobilise, via un langage naturel, une fonction de Vitam. La liste des fonctions disponibles se trouve en annexe.</p>
<p><strong>Paramètre</strong> : certaines fonctions ont besoin d’être suivies d’un paramètre. Ils sont listés dans le tableau des fonctionnalités disponibles en annexe.</p>
<p>Les actions doivent être indentées de 1 par rapport aux scénarios.</p>
<p>Exemple d’un scénario constitué de trois actions :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scénario</span><span class="p">:</span> <span class="n">SIP</span> <span class="n">au</span> <span class="n">mauvais</span> <span class="nb">format</span>
  <span class="n">Etant</span> <span class="n">donné</span> <span class="n">un</span> <span class="n">fichier</span> <span class="n">SIP</span> <span class="n">nommé</span> <span class="n">data</span><span class="o">/</span><span class="n">SIP_KO</span><span class="o">/</span><span class="n">ZIP</span><span class="o">/</span><span class="n">KO_SIP_Mauvais_Format</span><span class="o">.</span><span class="n">pdf</span>
  <span class="n">Quand</span> <span class="n">je</span> <span class="n">télécharge</span> <span class="n">le</span> <span class="n">SIP</span>
  <span class="n">Alors</span> <span class="n">le</span> <span class="n">statut</span> <span class="n">final</span> <span class="n">du</span> <span class="n">journal</span> <span class="n">des</span> <span class="n">opérations</span> <span class="n">est</span> <span class="n">KO</span>
</pre></div>
</div>
</div>
<div class="section" id="inserer-une-requete-dsl">
<h3>Insérer une requète DSL<a class="headerlink" href="#inserer-une-requete-dsl" title="Lien permanent vers ce titre">¶</a></h3>
<p>Certaines fonctions nécessitent l’entrée de requêtes DSL en paramètre. Celles-ci doivent être insérées entre guillemets (&nbsp;» «&nbsp;), après un retour à la ligne à la suite de la fonction.</p>
<p>Voici un exemple d’une action suivie d’une requête DSL :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Et</span> <span class="n">j</span><span class="s1">&#39;utilise la requête suivante</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        { &quot;$roots&quot;: [],</span>
<span class="sd">                &quot;$query&quot;: [</span>
<span class="sd">                { &quot;$and&quot;: [</span>
<span class="sd">                        { &quot;$gte&quot;: {</span>
<span class="sd">                        &quot;StartDate&quot;: &quot;1914-01-01T23:00:00.000Z&quot;</span>
<span class="sd">                                } }, {&quot;$lte&quot;: {</span>
<span class="sd">                                &quot;EndDate&quot;: &quot;1918-12-31T22:59:59.000Z&quot;</span>
<span class="sd">                                } } ],</span>
<span class="sd">                        &quot;$depth&quot;: 20}],</span>
<span class="sd">                        &quot;$filter&quot;: {&quot;$orderby&quot;: { &quot;TransactedDate&quot;: 1 }</span>
<span class="sd">                        }, &quot;$projection&quot;: {</span>
<span class="sd">                        &quot;$fields&quot;: {&quot;TransactedDate&quot;: 1, &quot;#id&quot;: 1, &quot;Title&quot;: 1, &quot;#object&quot;: 1, &quot;DescriptionLevel&quot;: 1, &quot;EndDate&quot;: 1, &quot;StartDate&quot;: 1}}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="inserer-un-tableau">
<h3>Insérer un tableau<a class="headerlink" href="#inserer-un-tableau" title="Lien permanent vers ce titre">¶</a></h3>
<p>Certaines fonctions attendent un tableau en paramètre. Les lignes des tableaux doivent simplement être séparées par des «&nbsp;pipes&nbsp;» ( | ).</p>
<p>Voici un exemple de fonction prenant un tableau en paramètre.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Alors</span> <span class="n">les</span> <span class="n">metadonnées</span> <span class="n">sont</span>
<span class="o">|</span> <span class="n">Title</span>            <span class="o">|</span> <span class="n">Liste</span> <span class="n">des</span> <span class="n">armements</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">DescriptionLevel</span> <span class="o">|</span> <span class="n">Item</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">StartDate</span>        <span class="o">|</span> <span class="mi">1917</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">EndDate</span>          <span class="o">|</span> <span class="mi">1918</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>          <span class="o">|</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="annexes">
<h2>Annexes<a class="headerlink" href="#annexes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="liste-des-actions-d-etapes-disponibles">
<h3>Liste des actions d’étapes disponibles<a class="headerlink" href="#liste-des-actions-d-etapes-disponibles" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les types d’actions sont les suivants :</p>
<ul class="simple">
<li>une situation initial (les acquis) : <strong>Etant donné</strong></li>
<li>un événement survient : <strong>Quand</strong> (peut être suivi de <strong>Et</strong> et/ou <strong>Mais</strong>)</li>
<li>on s’assure de l’obtention de certains résultats : <strong>Alors</strong> (peut être suivi de <strong>Et</strong> et/ou <strong>Mais</strong>)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Etant donné</td>
</tr>
<tr class="row-odd"><td>Quand</td>
</tr>
<tr class="row-even"><td>Alors</td>
</tr>
<tr class="row-odd"><td>Mais</td>
</tr>
<tr class="row-even"><td>Et</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="liste-des-fonctions-disponibles">
<h3>Liste des fonctions disponibles<a class="headerlink" href="#liste-des-fonctions-disponibles" title="Lien permanent vers ce titre">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fonctionnalité</th>
<th class="head">Doit être suivi par</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>les tests effectués sur le tenant (*)</td>
<td>un tenant</td>
</tr>
<tr class="row-odd"><td>les données du jeu de test du SIP nommé (.*)</td>
<td>un fichier</td>
</tr>
<tr class="row-even"><td>un fichier SIP nommé (.*)</td>
<td>un fichier</td>
</tr>
<tr class="row-odd"><td>je télécharge le SIP</td>
<td>une autre action</td>
</tr>
<tr class="row-even"><td>je recherche le journal des opérations</td>
<td>une autre action</td>
</tr>
<tr class="row-odd"><td>je télécharge son fichier ATR</td>
<td>une autre action</td>
</tr>
<tr class="row-even"><td>je recherche le JCV de l’unité archivistique dont le titre est (.*)</td>
<td>un titre d’unité archivistique</td>
</tr>
<tr class="row-odd"><td>je recherche le JCV du groupe d’objet de l’unité archivistique dont le titre est (.*)</td>
<td>un titre d’unité archivistique</td>
</tr>
<tr class="row-even"><td>le statut final du journal des opérations est (.*)</td>
<td>un statut</td>
</tr>
<tr class="row-odd"><td>le[s]? statut[s]? (?:de l’événement|des événements) (.*) (?:est|sont) (.*)</td>
<td>un ou plusieur evType et un Statut</td>
</tr>
<tr class="row-even"><td>l’outcome détail de l’événement (.*) est (.*)</td>
<td>un outcome detail et une valeur</td>
</tr>
<tr class="row-odd"><td>l’état final du fichier ATR est (.*)</td>
<td>un statut</td>
</tr>
<tr class="row-even"><td>le fichier ATR contient (.*) balise[s] de type (.*)</td>
<td>un nombre et un type de balise</td>
</tr>
<tr class="row-odd"><td>le fichier ATR contient les valeurs (.*)</td>
<td>une ou plusieurs valeurs séparées par des virgules</td>
</tr>
<tr class="row-even"><td>le fichier ATR contient la  chaîne de caractères (.*)</td>
<td>un texte ou une simple chaîne de caractères</td>
</tr>
<tr class="row-odd"><td>j’utilise la requête suivante</td>
<td>une requête</td>
</tr>
<tr class="row-even"><td>j’utilise le fichier de requête suivant (.*)</td>
<td>un fichier</td>
</tr>
<tr class="row-odd"><td>j’utilise dans la requête le GUID de l’unité archivistique pour le titre (.*)</td>
<td>un titre d’unité archivistique</td>
</tr>
<tr class="row-even"><td>j’utilise dans la requête le paramètre (.*) avec la valeur (.*)</td>
<td>un nom de paramêtre et une valeur de remplacement</td>
</tr>
<tr class="row-odd"><td>je recherche les unités archivistiques</td>
<td>une autre action</td>
</tr>
<tr class="row-even"><td>je recherche les groupes d’objets des unités archivistiques</td>
<td>une autre action</td>
</tr>
<tr class="row-odd"><td>je recherche les groupes d’objets de l’unité archivistique dont le titre est (.*)</td>
<td>un titre d’unité archivistique</td>
</tr>
<tr class="row-even"><td>le nombre de résultat est (.*)</td>
<td>un nombre</td>
</tr>
<tr class="row-odd"><td>les metadonnées sont (.*)</td>
<td>un tableau</td>
</tr>
<tr class="row-even"><td>les metadonnées pour le résultat (.*)</td>
<td>un nombre et un tableau</td>
</tr>
<tr class="row-odd"><td>je recherche les registres de fonds (.*)</td>
<td>une autre action</td>
</tr>
<tr class="row-even"><td>le nombre de registres de fonds est (.*)</td>
<td>un nombre</td>
</tr>
<tr class="row-odd"><td>les metadonnées pour le registre de fond sont</td>
<td>un tableau</td>
</tr>
<tr class="row-even"><td>je recherche les détails du registre des fonds pour le service producteur (.*)</td>
<td>un identifiant de service producteur</td>
</tr>
<tr class="row-odd"><td>le nombre de détails du registre des fonds est (.*)</td>
<td>un nombre</td>
</tr>
<tr class="row-even"><td>les metadonnées pour le détail du registre des fonds sont</td>
<td>un tableau</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="guide_cucumber.html" class="btn btn-neutral float-right" title="Guide d’écriture des tests Cucumber" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tests_automatises.html" class="btn btn-neutral" title="Tests Automatisés" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Ce document est distribué sous les termes de la Licence Ouverte V2.0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.4.0',
            LANGUAGE:'fr',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>